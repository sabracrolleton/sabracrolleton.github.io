<!DOCTYPE html>
<html lang="en">
<head>
<!-- 2023-01-17 Tue 09:14 -->
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Comparison of Common Lisp Testing Frameworks (16 Jan 2023 Edition)</title>
<meta name="author" content="Sabra Crolleton" />
<meta name="generator" content="Org Mode" />
<link rel="stylesheet" type="text/css" href="https://fniessen.github.io/org-html-themes/src/readtheorg_theme/css/htmlize.css"/>
<link rel="stylesheet" type="text/css" href="https://fniessen.github.io/org-html-themes/src/readtheorg_theme/css/readtheorg.css"/>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
<script type="text/javascript" src="https://fniessen.github.io/org-html-themes/src/lib/js/jquery.stickytableheaders.min.js"></script>
<script type="text/javascript" src="https://fniessen.github.io/org-html-themes/src/readtheorg_theme/js/readtheorg.js"></script>
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        displayAlign: "center",
        displayIndent: "0em",

        "HTML-CSS": { scale: 100,
                        linebreaks: { automatic: "false" },
                        webFont: "TeX"
                       },
        SVG: {scale: 100,
              linebreaks: { automatic: "false" },
              font: "TeX"},
        NativeMML: {scale: 100},
        TeX: { equationNumbers: {autoNumber: "AMS"},
               MultLineWidth: "85%",
               TagSide: "right",
               TagIndent: ".8em"
             }
});
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS_HTML"></script>
</head>
<body>
<div id="content" class="content">
<header>
<h1 class="title">Comparison of Common Lisp Testing Frameworks (16 Jan 2023 Edition)</h1>
</header><nav id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#orgd62e853">1. Changelog</a></li>
<li><a href="#org518b8a2">2. Introduction</a></li>
<li><a href="#org9bc49bd">3. Testing Libraries Considered</a>
<ul>
<li><a href="#org63a5467">3.1. Testing Frameworks</a></li>
<li><a href="#org290a6c0">3.2. Speciality Libaries</a></li>
<li><a href="#org951a1c3">3.3. Helper Libraries</a></li>
<li><a href="#orgc946500">3.4. Dependencies</a></li>
</ul>
</li>
<li><a href="#orgb1fa812">4. Quick Summary</a>
<ul>
<li><a href="#org67dd2da">4.1. Opinionated Awards</a></li>
<li><a href="#org4743261">4.2. Features Considered</a></li>
</ul>
</li>
<li><a href="#orgc9f9957">5. Functionality Comparison</a>
<ul>
<li><a href="#orgab98e25">5.1. Hierarchy Overview</a></li>
<li><a href="#org38f706c">5.2. Run on compile, funcallable tests</a></li>
<li><a href="#orgc190358">5.3. Fixtures</a></li>
<li><a href="#orga36fdaf">5.4. Control over debugging, and user-provided diagnostic messages</a></li>
<li><a href="#org93fbc48">5.5. Output of Run Functions (other than what is printed to the stream)</a></li>
<li><a href="#org54dd870">5.6. Progress Reports</a></li>
<li><a href="#org866989f">5.7. Skipping, Shuffling and Re-running</a></li>
<li><a href="#orgcfa75d2">5.8. Timing Reporting and Time Limits</a></li>
<li><a href="#orgc23de65">5.9. Dribble and Output Streams</a></li>
<li><a href="#orge998bf2">5.10. Edge Cases: Float Testing, Value Expressions and Closure Variables</a></li>
<li><a href="#org3461a1e">5.11. Compatibility and Customizable Assertions</a></li>
<li><a href="#orgb75a1d5">5.12. Claims Not Test</a></li>
</ul>
</li>
<li><a href="#org9ee3c43">6. Assertion Failure Comments</a>
<ul>
<li><a href="#org0301039">6.1. 1am</a></li>
<li><a href="#org01bc113">6.2. 2am</a></li>
<li><a href="#org2c5b923">6.3. cacau</a></li>
<li><a href="#org922dfa0">6.4. clunit and clunit2</a></li>
<li><a href="#orgff63093">6.5. fiasco</a></li>
<li><a href="#orga3ff291">6.6. fiveam</a></li>
<li><a href="#orgda57e13">6.7. gigamonkeys</a></li>
<li><a href="#org873562c">6.8. confidence</a></li>
<li><a href="#orgcb097da">6.9. lift</a></li>
<li><a href="#org36dc64a">6.10. lisp-unit</a></li>
<li><a href="#orgc88162d">6.11. lisp-unit2</a></li>
<li><a href="#org12a8da6">6.12. parachute</a></li>
<li><a href="#org964cf7f">6.13. ptester</a></li>
<li><a href="#orgd019601">6.14. prove</a></li>
<li><a href="#orga11ce63">6.15. rove</a></li>
<li><a href="#org1e62a61">6.16. rt</a></li>
<li><a href="#orgb0d56b5">6.17. should-test</a></li>
<li><a href="#org25395ee">6.18. tap-unit-test</a></li>
<li><a href="#org33f129d">6.19. try</a></li>
<li><a href="#org86a9ea6">6.20. unit-test</a></li>
</ul>
</li>
<li><a href="#orgec20ed4">7. Benchmarking</a>
<ul>
<li><a href="#org49fcfb2">7.1. Stack Ranking</a></li>
<li><a href="#orga5a4c8e">7.2. 1am</a></li>
<li><a href="#orgeda958d">7.3. 2am</a></li>
<li><a href="#org138a102">7.4. cacua</a></li>
<li><a href="#org6cefd23">7.5. cardiogram</a></li>
<li><a href="#org78bdb40">7.6. clunit</a></li>
<li><a href="#org6881e2a">7.7. clunit2</a></li>
<li><a href="#orgfd1820f">7.8. confidence</a></li>
<li><a href="#org7b9028b">7.9. fiasco</a></li>
<li><a href="#orgaf780c5">7.10. fiveam</a></li>
<li><a href="#org6fa16ca">7.11. gigamonkeys</a></li>
<li><a href="#org8b38c93">7.12. lift</a></li>
<li><a href="#org59d5484">7.13. lisp-unit</a></li>
<li><a href="#orga46d621">7.14. list-unit2</a></li>
<li><a href="#org0cae2ef">7.15. nst</a></li>
<li><a href="#orge83724c">7.16. parachute</a></li>
<li><a href="#orge26ea41">7.17. prove</a></li>
<li><a href="#orgc31e447">7.18. ptester</a></li>
<li><a href="#orgb5c0042">7.19. rove</a></li>
<li><a href="#org5dc6e54">7.20. rt</a></li>
<li><a href="#orgbc91d29">7.21. should-test</a></li>
<li><a href="#org1eb821d">7.22. tap-unit-test</a></li>
<li><a href="#orgb329fff">7.23. try</a></li>
<li><a href="#org0794cd1">7.24. unit-test</a></li>
<li><a href="#org8c4d81d">7.25. xlunit</a></li>
<li><a href="#org38e9234">7.26. xptest</a></li>
</ul>
</li>
<li><a href="#orgd5873f4">8. Mapping Functions Against Each Other</a>
<ul>
<li><a href="#orgf0b5685">8.1. Assertion Functions</a></li>
<li><a href="#org70a877d">8.2. Defining or Adding Tests</a></li>
<li><a href="#org483e865">8.3. Running Tests</a></li>
<li><a href="#org93850a0">8.4. Fixture Functions</a></li>
<li><a href="#org111e7e2">8.5. Removing Tests etc</a></li>
<li><a href="#org9b1461c">8.6. Suites</a></li>
<li><a href="#orge438b25">8.7. Generators</a></li>
</ul>
</li>
<li><a href="#orge44f059">9. Generic Usage Example to be Followed for Each Framework Library</a>
<ul>
<li><a href="#org2570067">9.1. Basics</a></li>
<li><a href="#org93d2da7">9.2. Multiple Values, Variables, Loops and Closures</a></li>
<li><a href="#org004af2f">9.3. Errors, Conditions and signal handling</a></li>
<li><a href="#orgdd31ea4">9.4. Suites, tags and other multiple test abilities</a></li>
<li><a href="#orgdd92f30">9.5. Random Data Generators</a></li>
</ul>
</li>
<li><a href="#org588a6db">10. 1am</a>
<ul>
<li><a href="#org1e6380c">10.1. Summary</a></li>
<li><a href="#org7e81f82">10.2. Assertion Functions</a></li>
<li><a href="#org51d0a04">10.3. Usage</a></li>
<li><a href="#org92274bd">10.4. Discussion</a></li>
<li><a href="#orgda71be2">10.5. Who Uses 1am?</a></li>
</ul>
</li>
<li><a href="#org07198d3">11. 2am</a>
<ul>
<li><a href="#org1e51554">11.1. Summary</a></li>
<li><a href="#orgbf1e97e">11.2. Assertion Functions</a></li>
<li><a href="#org79d1642">11.3. Usage</a></li>
<li><a href="#orgb8f5746">11.4. Discussion</a></li>
</ul>
</li>
<li><a href="#orga817fc0">12. cacau</a>
<ul>
<li><a href="#org3eb2c8c">12.1. Summary</a></li>
<li><a href="#org12e4361">12.2. Assertion Functions</a></li>
<li><a href="#orge11a1db">12.3. Usage</a></li>
<li><a href="#org9f4da4a">12.4. Discussion</a></li>
<li><a href="#orgb53343f">12.5. Who Uses</a></li>
</ul>
</li>
<li><a href="#org89fe890">13. cardiogram</a>
<ul>
<li><a href="#org2776b7a">13.1. Summary</a></li>
</ul>
</li>
<li><a href="#org187eda4">14. checkl</a>
<ul>
<li><a href="#org8201f4f">14.1. Summary</a></li>
<li><a href="#orgf0708cc">14.2. Usage</a></li>
<li><a href="#org5ed108f">14.3. Who Uses Checkl?</a></li>
</ul>
</li>
<li><a href="#org5a0b94a">15. clunit</a>
<ul>
<li><a href="#org72772af">15.1. Summary</a></li>
<li><a href="#org94c22cf">15.2. Assertion Functions</a></li>
<li><a href="#org50c7b0e">15.3. Usage</a></li>
<li><a href="#orge05e059">15.4. Discussion</a></li>
<li><a href="#org2b867f9">15.5. Who Uses</a></li>
</ul>
</li>
<li><a href="#org0fcec11">16. clunit2</a>
<ul>
<li><a href="#orga7c1620">16.1. Summary</a></li>
<li><a href="#orgfbde03d">16.2. Assertion Functions</a></li>
<li><a href="#org1e1c7a3">16.3. Usage</a></li>
<li><a href="#org971a9e4">16.4. Discussion</a></li>
<li><a href="#org7e8bae9">16.5. Who Uses</a></li>
</ul>
</li>
<li><a href="#org742132c">17. com.gigamonkeys.test-framework</a>
<ul>
<li><a href="#org904b795">17.1. Summary</a></li>
<li><a href="#org8844b03">17.2. Assertion Functions</a></li>
<li><a href="#org96dc5b4">17.3. Usage</a></li>
<li><a href="#org08f4337">17.4. Discussion</a></li>
<li><a href="#org8bdb925">17.5. Who Uses com.gigamonkeys.test-framework</a></li>
</ul>
</li>
<li><a href="#org57804c2">18. Confidence</a>
<ul>
<li><a href="#org6149b7c">18.1. Summary</a></li>
<li><a href="#org0d15ccb">18.2. Assertion Functions</a></li>
<li><a href="#org2f2bcc5">18.3. Usage</a></li>
<li><a href="#org6130cc1">18.4. Discussion</a></li>
<li><a href="#orgfff7138">18.5. Who Uses</a></li>
</ul>
</li>
<li><a href="#org53910ab">19. fiasco</a>
<ul>
<li><a href="#orgc78be66">19.1. Summary</a></li>
<li><a href="#orgd752f39">19.2. Assertion Functions</a></li>
<li><a href="#orgdbe8dd6">19.3. Usage</a></li>
<li><a href="#org38b8837">19.4. Additional Discussion</a></li>
<li><a href="#org5ea5188">19.5. Who Uses Fiasco</a></li>
</ul>
</li>
<li><a href="#orgfbcc16c">20. fiveam</a>
<ul>
<li><a href="#orgcab0d2d">20.1. Summary</a></li>
<li><a href="#org72ca438">20.2. Assertion Functions</a></li>
<li><a href="#org194b378">20.3. Usage</a></li>
<li><a href="#orgac37614">20.4. Discussion</a></li>
<li><a href="#orgda7d0cd">20.5. Who Uses Fiveam</a></li>
</ul>
</li>
<li><a href="#orgb50a770">21. lift</a>
<ul>
<li><a href="#org5c5b94d">21.1. Summary</a></li>
<li><a href="#orga950b40">21.2. Assertion Functions</a></li>
<li><a href="#orgebe4fcf">21.3. Usage</a></li>
<li><a href="#org5b27c79">21.4. Discussion</a></li>
<li><a href="#orgac4db1e">21.5. Who Uses Lift</a></li>
</ul>
</li>
<li><a href="#org8383655">22. lisp-unit</a>
<ul>
<li><a href="#orga92aaff">22.1. Summary</a></li>
<li><a href="#orgc7f65f0">22.2. Assertion Functions</a></li>
<li><a href="#orge8b47a8">22.3. Usage</a></li>
<li><a href="#org34e1193">22.4. Who Uses Lisp-Unit</a></li>
</ul>
</li>
<li><a href="#org770701c">23. lisp-unit2</a>
<ul>
<li><a href="#org7fdbd6a">23.1. Summary</a></li>
<li><a href="#orgea750ea">23.2. Assertion Functions</a></li>
<li><a href="#org76e1df2">23.3. Usage</a></li>
<li><a href="#orgb369304">23.4. Discussion</a></li>
<li><a href="#orgcad40fa">23.5. Who Uses Lift-Unit2</a></li>
</ul>
</li>
<li><a href="#org4763117">24. nst</a>
<ul>
<li><a href="#org1092b9d">24.1. Summary</a></li>
<li><a href="#org7b86e1f">24.2. Assertion Functions</a></li>
<li><a href="#org13bd9a4">24.3. Usage</a></li>
<li><a href="#org61b8a49">24.4. Discussion</a></li>
<li><a href="#orga26515e">24.5. Who Uses NST</a></li>
</ul>
</li>
<li><a href="#org03e88aa">25. parachute</a>
<ul>
<li><a href="#org938c836">25.1. Summary</a></li>
<li><a href="#org05cb8f1">25.2. Assertion Functions</a></li>
<li><a href="#org6b8e8cf">25.3. Usage</a></li>
<li><a href="#org4f59d24">25.4. Discussion</a></li>
<li><a href="#org892018d">25.5. Who uses parachute</a></li>
</ul>
</li>
<li><a href="#orgbe12c22">26. prove</a>
<ul>
<li><a href="#orgd76b7c1">26.1. Summary</a></li>
<li><a href="#orgce5dfa9">26.2. Assertion Functions</a></li>
<li><a href="#orgbd19419">26.3. Usage</a></li>
<li><a href="#org6204ea8">26.4. Discussion</a></li>
<li><a href="#orgf499830">26.5. Who Uses Prove?</a></li>
</ul>
</li>
<li><a href="#org997a28b">27. ptester</a>
<ul>
<li><a href="#orgbd8c8ac">27.1. Summary</a></li>
<li><a href="#org57b511f">27.2. Assertion Functions</a></li>
<li><a href="#org4905d34">27.3. Usage</a></li>
<li><a href="#org5d5569f">27.4. Discussion</a></li>
<li><a href="#org4b9af06">27.5. Who depends on ptester?</a></li>
</ul>
</li>
<li><a href="#orgd6685a1">28. rove</a>
<ul>
<li><a href="#org89a492d">28.1. Summary</a></li>
<li><a href="#org74443af">28.2. Assertion Functions</a></li>
<li><a href="#orgb5032cf">28.3. Usage</a></li>
<li><a href="#org884db10">28.4. Additional Discussion Points</a></li>
<li><a href="#org97c09c8">28.5. Who Uses</a></li>
</ul>
</li>
<li><a href="#orgaeb7141">29. rt</a>
<ul>
<li><a href="#org9ce1118">29.1. Summary</a></li>
<li><a href="#org8b25cb7">29.2. Assertion Functions</a></li>
<li><a href="#org7690ebe">29.3. Usage</a></li>
<li><a href="#orgd13f531">29.4. Discussion</a></li>
<li><a href="#org0d60b22">29.5. Who depends on rt?</a></li>
</ul>
</li>
<li><a href="#org5279729">30. should-test</a>
<ul>
<li><a href="#org9498618">30.1. Summary</a></li>
<li><a href="#org8e42191">30.2. Assertion Functions</a></li>
<li><a href="#org8ef12a0">30.3. Usage</a></li>
<li><a href="#orgdf5ddbe">30.4. Who Depends on Should-test</a></li>
</ul>
</li>
<li><a href="#org481b762">31. simplet</a>
<ul>
<li><a href="#org42db8f3">31.1. Summary</a></li>
</ul>
</li>
<li><a href="#orgdc1cd10">32. tap-unit-test</a>
<ul>
<li><a href="#org543cba8">32.1. Summary</a></li>
<li><a href="#orgfbf2bce">32.2. Assertion Functions</a></li>
<li><a href="#orge3f754f">32.3. Usage</a></li>
<li><a href="#org00741e9">32.4. Discussion</a></li>
</ul>
</li>
<li><a href="#org34a2285">33. try</a>
<ul>
<li><a href="#orgf56351b">33.1. Summary</a></li>
<li><a href="#org8cc688a">33.2. Assertion Functions</a></li>
<li><a href="#org8e186be">33.3. Usage</a></li>
<li><a href="#orgc97b517">33.4. Discussion</a></li>
<li><a href="#orge1d9c53">33.5. Who uses try</a></li>
</ul>
</li>
<li><a href="#org40556cd">34. unit-test</a>
<ul>
<li><a href="#org9ac029a">34.1. Summary</a></li>
<li><a href="#org5e808df">34.2. Assertion Functions</a></li>
<li><a href="#orgd9aba70">34.3. Usage</a></li>
<li><a href="#org46a4ee3">34.4. Discussion</a></li>
<li><a href="#org57708aa">34.5. Who Depends on Unit-Test?</a></li>
</ul>
</li>
<li><a href="#org197b08b">35. xlunit</a>
<ul>
<li><a href="#org6412370">35.1. Summary</a></li>
<li><a href="#org109ad2b">35.2. Assertion Functions</a></li>
<li><a href="#orgdab6718">35.3. Usage</a></li>
<li><a href="#org42b1d7a">35.4. Discussion</a></li>
<li><a href="#orgebc0b91">35.5. Who Depends on XLUnit?</a></li>
</ul>
</li>
<li><a href="#org82ee635">36. xptest</a>
<ul>
<li><a href="#org232bd00">36.1. Summary</a></li>
<li><a href="#org0a107b3">36.2. Assertion Functions</a></li>
<li><a href="#orgaf2c6a4">36.3. Usage</a></li>
<li><a href="#org3857fb9">36.4. Discussion</a></li>
<li><a href="#org6508f8d">36.5. Who Depends on xptest?</a></li>
</ul>
</li>
<li><a href="#org5233271">37. Helper Libraries</a>
<ul>
<li><a href="#org0a100b6">37.1. assert-p</a></li>
<li><a href="#org60d276e">37.2. assertion-error</a></li>
<li><a href="#org5338e57">37.3. check-it</a></li>
<li><a href="#orgd946025">37.4. cl-fuzz</a></li>
<li><a href="#orgf2ea57d">37.5. cl-quickcheck</a></li>
<li><a href="#org4b7b55d">37.6. hamcrest</a></li>
<li><a href="#org40744aa">37.7. mockingbird</a></li>
<li><a href="#org80ec78d">37.8. portch</a></li>
<li><a href="#orga7fcaa6">37.9. protest</a></li>
<li><a href="#org4c2de9d">37.10. rtch</a></li>
<li><a href="#org6efe64c">37.11. testbild</a></li>
<li><a href="#org022234a">37.12. test-utils</a></li>
</ul>
</li>
<li><a href="#org23fe8b8">38. Test Coverage Tools</a>
<ul>
<li><a href="#orgd9c533b">38.1. sb-cover</a></li>
<li><a href="#org6a4e491">38.2. CCL code coverage</a></li>
<li><a href="#orge2388c0">38.3. cover</a></li>
<li><a href="#orga9a1958">38.4. Source Code</a></li>
</ul>
</li>
<li><a href="#org478327e">39. Appendix</a>
<ul>
<li><a href="#orgd33efb8">39.1. Problem Space</a></li>
<li><a href="#org16929c6">39.2. Terminology</a></li>
</ul>
</li>
</ul>
</div>
</nav>
<p border="2" rules="all" frame="border" org-html-table-align-individual-fields="t">
<a id="org63aa282"></a>
</p>
<div id="outline-container-orgd62e853" class="outline-2">
<h2 id="orgd62e853"><span class="section-number-2">1.</span> Changelog</h2>
<div class="outline-text-2" id="text-1">
<p>
16 Jan 2023 - Updated adding Confidence and Try and deleting Kaputt. Thank you Michaël Le Barbier for actually doing the work of submitting the proposed pull request for Confidence.
</p>

<p>
2 October 2021 - Updated for changes at the Common Lisp Cookbook on testing. Updated number of issues and pull requests for FiveAM.
</p>

<p>
13 June 2021 - Updated clunit2 on its huge performance improvement update and new edge case abilities to compare multiple values in values expressions and handle variables declared in closures. Clunit2 is now substantially differentiated from clunit.
</p>
</div>
</div>

<div id="outline-container-org518b8a2" class="outline-2">
<h2 id="org518b8a2"><span class="section-number-2">2.</span> Introduction</h2>
<div class="outline-text-2" id="text-2">
<p>
What testing framework should I use? The response should not be X or Y because it is "battle-tested", or "extensible", or "has color coding". Those are just content-free advertising buzzwords. Some webpages which mention different Common Lisp unit test frameworks merely parrot comments from the framework authors without ensuring their veracity.
</p>

<p>
The real response should be to respond, "How do you code?" But even armed with that information, how do you match a testing framework to the user's needs? Common Lisp has a ridiculous number of testing framework libraries.
</p>

<p>
Some past reviews of testing frameworks were done in <a href="http://aperiodic.net/phil/archives/Geekery/notes-on-lisp-testing-frameworks.html">2007</a> and <a href="http://maraist.org/static/work/ILC2010-maraist.pdf">2010 (NST review)</a>. There was also some work in 2012 by the author of <a href="http://tgutu.github.io/clunit/">clunit</a>, which seems to have bitrotten and is now only accessible via the Wayback Machine - <a href="https://web.archive.org/web/20121119060726/http://ml.sun.ac.za/2012/11/09/developing-a-unit-test-framework-part-1/">part 1</a> and <a href="https://web.archive.org/web/20130303062507/http://ml.sun.ac.za/2012/11/09/developing-a-unit-test-framework-part-2/">part 2</a>. I thought it was time for an update. I am open to pull requests on this document for corrections, additions, whatever. See <a href="https://github.com/sabracrolleton/sabracrolleton.github.io">https://github.com/sabracrolleton/sabracrolleton.github.io</a>
</p>

<p>
The best testing framework is context-dependent, and that context includes how you work. As an example, there was an exchange on <a href="https://old.reddit.com/r/common_lisp">r/common​_lisp</a> between dzecniv and Shinmera. dzecniv likes Prove more than Parachute because they could run tests just by hitting (C-c) the source. Shinmera pointed out a way you could easily add that to Parachute, but he views compilation and execution as two different things. I'm in Shinmera's camp - I do not want to run the test until I want to run it. At the same time, I want to be clear on terminology. If I understand the context, dzecniv was talking about was what I would call an assertion. In the interest of clear terminology, consider the following pseudocode -
</p>

<div class="org-src-container">
<pre class="src src-lisp">(defsuite s0  <span class="org-comment">; (1)</span>
  (deftest t1 <span class="org-comment">; (2)</span>
    (<span class="org-warning">assert-true</span> (= 1 1)))) <span class="org-comment">; (3)</span>
</pre>
</div>

<dl class="org-dl">
<dt>(1)</dt><dd>I call this a suite - it contains one or more tests (or other suites) and hopefully composes the results</dd>
<dt>(2)</dt><dd>I will call this a test - it contains one or more assertions and hopefully composes the results</dd>
<dt>(3)</dt><dd>I will call this an assertion and the <code>assert-true</code> or equivalent as a testing function</dd>
</dl>

<p>
I do not want to run assertions at compile-time, but I do not compile assertions outside of tests anyway. So, just for Dzecniv and those like him, there is a <a href="#org4dbbe4f">functionality table on running assertions on compilation</a>.
</p>

<p>
Some people are just looking for regression testing - they focus on running all the tests at once. For example, the README for Prove does not even mention <code>deftest</code> or <code>run-test</code>. Others are looking for TDD or other continuous testing for their development. I use individual tests a lot during development, but obviously need regression testing as well.
</p>

<p>
Some testing frameworks insist on <a href="#orga30c9b3">tracking progress by printing little dots or checkmarks</a> for every assertion or test that passed or failed. Consider a library like <a href="https://github.com/Shinmera/uax-9">uax-9</a>, which has 1,815,582 assertions (yes, the tests are autogenerated). I don't want to waste screen space on that many dots; I don't want to waste time on printing those dots to screen, nor, if a test fails, in trying to find the failed test amidst the haystack of successful tests. Therefore, I prefer a testing framework that allows me to only collect failures, and to turn off progress reporting. Of course, some frameworks do not display progress reports at all - or do so at the test level rather than the assertion level - but you might really want or need those progress reports.
</p>

<p>
Some frameworks cannot find lexical variables declared in a closure containing the test. Most people will not care, but if you use closures, you might.
</p>

<p>
Other contexts are best served by other libraries. Complex fixture requirements might drive you towards something like <a href="#orga8cfe0a">NST</a>, the need to define your own bespoke assertions might be served by <a href="#org5279729">should-test</a> or <a href="#org4b0d432">confidence</a>. Numerical comparisons might lead you to use <a href="#orgc6e4266">lisp-unit</a>, <a href="#orgb8996ba">lisp-unit2</a> or <a href="#org4b0d432">confidence</a> (or just writing your own). For macro-expansion testing, <a href="#org5eea657">clunit</a>, <a href="#orge473393">clunit2</a>, <a href="#orgc6e4266">lisp-unit</a>, <a href="#orgb8996ba">lisp-unit2</a> and <a href="#org3d39ad7">rove</a> have specific assertion functions. Your situation should govern which testing framework you use, not your project skeleton or market share.
</p>

<p>
I occasionally hear "extensibility" used as a buzzword applied to a framework. I'm not sure what it means to people. Consider the following example in <code>sxql</code>, which is not a testing framework but which included this macro in its own test file to simplify its use of <code>prove</code> -
</p>
<div class="org-src-container">
<pre class="src src-lisp">(<span class="org-keyword">defmacro</span> <span class="org-function-name">is-mv</span> (test result <span class="org-type">&amp;optional</span> desc)
  `(is (multiple-value-list (yield ,test))
       ,result
       ,desc))

(is-mv (select ((<span class="org-builtin">:+</span> 1 1)))
       '(<span class="org-string">"SELECT (? + ?)"</span> (1 1))
       <span class="org-string">"field"</span>)
</pre>
</div>
<p>
How hard is that to do in any framework? This is Common Lisp.
</p>

<p>
In any event, yes, I will state my opinions, but what you think is important will drive your preferences in testing frameworks.
</p>
</div>
</div>

<div id="outline-container-org9bc49bd" class="outline-2">
<h2 id="org9bc49bd"><span class="section-number-2">3.</span> Testing Libraries Considered</h2>
<div class="outline-text-2" id="text-3">
</div>
<div id="outline-container-org63a5467" class="outline-3">
<h3 id="org63a5467"><span class="section-number-3">3.1.</span> Testing Frameworks</h3>
<div class="outline-text-3" id="text-3-1">
<table border="2" rules="all" frame="border">
<caption class="t-above"><span class="table-number">Table 1:</span> Libraries Considered (updated 16 Jan 2023)</caption>

<colgroup>
<col  class="org-left">

<col  class="org-left">

<col  class="org-left">

<col  class="org-left">

<col  class="org-right">
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Library</th>
<th scope="col" class="org-left">Homepage</th>
<th scope="col" class="org-left">Author</th>
<th scope="col" class="org-left">License</th>
<th scope="col" class="org-right">Last Update</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left"><a href="#orge4344cd">1am</a></td>
<td class="org-left"><a href="https://github.com/lmj/1am">homepage</a></td>
<td class="org-left">James Lawrence</td>
<td class="org-left">MIT</td>
<td class="org-right">2014</td>
</tr>

<tr>
<td class="org-left"><a href="#org4a2ad7a">2am</a> <sup><a id="fnr.1" class="footref" href="#fn.1" role="doc-backlink">1</a></sup></td>
<td class="org-left"><a href="https://gitlab.common-lisp.net/dkochmanski/2am">homepage</a></td>
<td class="org-left">Daniel Kochmański</td>
<td class="org-left">MIT</td>
<td class="org-right">2016</td>
</tr>

<tr>
<td class="org-left"><a href="#org12efa6c">cacau</a></td>
<td class="org-left"><a href="https://github.com/noloop/cacau">homepage</a></td>
<td class="org-left">Noloop</td>
<td class="org-left">GPL3</td>
<td class="org-right">2020</td>
</tr>

<tr>
<td class="org-left"><a href="#org0760669">cardiogram</a></td>
<td class="org-left"><a href="https://gitlab.com/a.aguilar/cardiogram">homepage</a></td>
<td class="org-left">Abraham Aguilar</td>
<td class="org-left">MIT</td>
<td class="org-right">2020</td>
</tr>

<tr>
<td class="org-left"><a href="#org5eea657">clunit</a> <sup><a id="fnr.2" class="footref" href="#fn.2" role="doc-backlink">2</a></sup></td>
<td class="org-left"><a href="http://tgutu.github.io/clunit/">homepage</a></td>
<td class="org-left">Tapiwa Gutu</td>
<td class="org-left">BSD</td>
<td class="org-right">2017</td>
</tr>

<tr>
<td class="org-left"><a href="#orge473393">clunit2</a></td>
<td class="org-left"><a href="https://notabug.org/cage/clunit2">homepage</a></td>
<td class="org-left">Cage (fork of clunit)</td>
<td class="org-left">BSD</td>
<td class="org-right">2022</td>
</tr>

<tr>
<td class="org-left"><a href="#org742132c">com.gigamonkeys.test-framework</a></td>
<td class="org-left"><a href="https://github.com/gigamonkey/monkeylib-test-framework">homepage</a></td>
<td class="org-left">Peter Seibel</td>
<td class="org-left">BSD</td>
<td class="org-right">2010</td>
</tr>

<tr>
<td class="org-left"><a href="#org4b0d432">confidence</a></td>
<td class="org-left"><a href="https://github.com/melusina-org/cl-confidence">homepage</a></td>
<td class="org-left">Michaël Le Barbier</td>
<td class="org-left">MIT</td>
<td class="org-right">2023</td>
</tr>

<tr>
<td class="org-left"><a href="#org53910ab">fiasco</a> <sup><a id="fnr.3" class="footref" href="#fn.3" role="doc-backlink">3</a></sup></td>
<td class="org-left"><a href="https://github.com/joaotavora/fiasco">homepage</a></td>
<td class="org-left">João Távora</td>
<td class="org-left">BSD 2 Clause</td>
<td class="org-right">2020</td>
</tr>

<tr>
<td class="org-left"><a href="#org3e895a0">fiveam</a></td>
<td class="org-left"><a href="https://github.com/lispci/fiveam">homepage</a></td>
<td class="org-left">Edward Marco Baringer</td>
<td class="org-left">BSD</td>
<td class="org-right">2020</td>
</tr>

<tr>
<td class="org-left"><a href="#orga50a995">lift</a></td>
<td class="org-left"><a href="https://github.com/gwkkwg/lift">homepage</a></td>
<td class="org-left">Gary Warren King</td>
<td class="org-left">MIT</td>
<td class="org-right">2019 <sup><a id="fnr.4" class="footref" href="#fn.4" role="doc-backlink">4</a></sup></td>
</tr>

<tr>
<td class="org-left"><a href="#orgc6e4266">lisp-unit</a></td>
<td class="org-left"><a href="https://github.com/OdonataResearchLLC/lisp-unit">homepage</a></td>
<td class="org-left">Thomas M. Hermann</td>
<td class="org-left">MIT</td>
<td class="org-right">2017</td>
</tr>

<tr>
<td class="org-left"><a href="#orgb8996ba">lisp-unit2</a></td>
<td class="org-left"><a href="https://github.com/AccelerationNet/lisp-unit2">homepage</a></td>
<td class="org-left">Russ Tyndall</td>
<td class="org-left">MIT</td>
<td class="org-right">2018</td>
</tr>

<tr>
<td class="org-left"><a href="#orga8cfe0a">nst</a></td>
<td class="org-left"><a href="https://github.com/jphmrst/cl-nst">homepage</a></td>
<td class="org-left">John Maraist</td>
<td class="org-left">LLGPL3 latest</td>
<td class="org-right">2021</td>
</tr>

<tr>
<td class="org-left"><a href="#orga8f69c2">parachute</a></td>
<td class="org-left"><a href="https://github.com/Shinmera/parachute">homepage</a></td>
<td class="org-left">Nicolas Hafner</td>
<td class="org-left">zlib</td>
<td class="org-right">2021</td>
</tr>

<tr>
<td class="org-left"><a href="#orga7f8a83">prove</a>  (archived)</td>
<td class="org-left"><a href="https://github.com/fukamachi/prove">homepage</a></td>
<td class="org-left">Eitaro Fukamachi</td>
<td class="org-left">MIT</td>
<td class="org-right">2020</td>
</tr>

<tr>
<td class="org-left"><a href="#org52f36e5">ptester</a></td>
<td class="org-left"><a href="http://git.kpe.io/?p=ptester.git;a=summary">homepage</a></td>
<td class="org-left">Kevin Layer</td>
<td class="org-left">LLGPL</td>
<td class="org-right">2016</td>
</tr>

<tr>
<td class="org-left"><a href="#org3d39ad7">rove</a></td>
<td class="org-left"><a href="https://github.com/fukamachi/rove">homepage</a></td>
<td class="org-left">Eitaro Fukamachi</td>
<td class="org-left">BSD 3 Clause</td>
<td class="org-right">2022</td>
</tr>

<tr>
<td class="org-left"><a href="#org55cd3c7">rt</a></td>
<td class="org-left">none</td>
<td class="org-left">Kevin M. Rosenberg</td>
<td class="org-left">MIT</td>
<td class="org-right">2010</td>
</tr>

<tr>
<td class="org-left"><a href="#org5279729">should-test</a></td>
<td class="org-left"><a href="https://github.com/vseloved/should-test">homepage</a></td>
<td class="org-left">Vsevolod Dyomkin</td>
<td class="org-left">MIT</td>
<td class="org-right">2019</td>
</tr>

<tr>
<td class="org-left"><a href="#org209a1fe">simplet</a></td>
<td class="org-left"><a href="https://github.com/noloop/simplet">homepage</a></td>
<td class="org-left">Noloop</td>
<td class="org-left">GPLv3</td>
<td class="org-right">2019</td>
</tr>

<tr>
<td class="org-left">stefil <sup><a id="fnr.5" class="footref" href="#fn.5" role="doc-backlink">5</a></sup></td>
<td class="org-left"><a href="http://dwim.hu/darcsweb/darcsweb.cgi?r=HEAD%20hu.dwim.stefil;a=summary">homepage</a></td>
<td class="org-left">Attila Lendvai, Tamas Borbely, Levente Meszaros</td>
<td class="org-left">BSD/Public Domain</td>
<td class="org-right">2018</td>
</tr>

<tr>
<td class="org-left"><a href="#orgdc1cd10">tap-unit-test</a> <sup><a id="fnr.6" class="footref" href="#fn.6" role="doc-backlink">6</a></sup></td>
<td class="org-left"><a href="https://github.com/jhanley634/tap-unit-test">homepage</a></td>
<td class="org-left">Christopher K. Riesbeck, John Hanley</td>
<td class="org-left">MIT</td>
<td class="org-right">2017</td>
</tr>

<tr>
<td class="org-left"><a href="#orgd9a48e8">try</a></td>
<td class="org-left"><a href="https://github.com/melisgl/try">homepage</a></td>
<td class="org-left">Gábor Melis</td>
<td class="org-left">MIT</td>
<td class="org-right">2022</td>
</tr>

<tr>
<td class="org-left"><a href="#org4b187d6">unit-test</a></td>
<td class="org-left"><a href="https://github.com/hanshuebner/unit-test">homepage</a></td>
<td class="org-left">Manuel Odendahl, Alain Picard</td>
<td class="org-left">MIT</td>
<td class="org-right">2012</td>
</tr>

<tr>
<td class="org-left"><a href="#orgea91eb1">xlunit</a></td>
<td class="org-left"><a href="http://git.kpe.io/?p=xlunit.git;a=tree">homepage</a></td>
<td class="org-left">Kevin RosenBerg</td>
<td class="org-left">BSD</td>
<td class="org-right">2015</td>
</tr>

<tr>
<td class="org-left"><a href="#org72de806">xptest</a></td>
<td class="org-left">none</td>
<td class="org-left">Craig Brozensky</td>
<td class="org-left">Public Domain</td>
<td class="org-right">2015</td>
</tr>
</tbody>
</table>
</div>
</div>

<div id="outline-container-org290a6c0" class="outline-3">
<h3 id="org290a6c0"><span class="section-number-3">3.2.</span> Speciality Libaries</h3>
<div class="outline-text-3" id="text-3-2">
<table border="2" rules="all" frame="border">
<caption class="t-above"><span class="table-number">Table 2:</span> Speciality Libaries</caption>

<colgroup>
<col  class="org-left">

<col  class="org-left">

<col  class="org-left">

<col  class="org-left">

<col  class="org-right">
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Library</th>
<th scope="col" class="org-left">Homepage</th>
<th scope="col" class="org-left">Author</th>
<th scope="col" class="org-left">License</th>
<th scope="col" class="org-right">Last Update</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left"><a href="#org187eda4">checkl</a></td>
<td class="org-left"><a href="https://github.com/rpav/CheckL">homepage</a></td>
<td class="org-left">Ryan Pavlik</td>
<td class="org-left">LLGPL, BSD</td>
<td class="org-right">2018</td>
</tr>
</tbody>
</table>

<table border="2" rules="all" frame="border">
<caption class="t-above"><span class="table-number">Table 3:</span> Selenium Interface Libaries</caption>

<colgroup>
<col  class="org-left">

<col  class="org-left">

<col  class="org-left">

<col  class="org-left">

<col  class="org-right">

<col  class="org-left">
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Library</th>
<th scope="col" class="org-left">Homepage</th>
<th scope="col" class="org-left">Author</th>
<th scope="col" class="org-left">License</th>
<th scope="col" class="org-right">Last Update</th>
<th scope="col" class="org-left">Selenium</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">cl-selenium-webdriver</td>
<td class="org-left"><a href="https://github.com/TatriX/cl-selenium-webdriver/">homepage</a></td>
<td class="org-left">TatriX</td>
<td class="org-left">MIT</td>
<td class="org-right">2018</td>
<td class="org-left">2.0</td>
</tr>

<tr>
<td class="org-left">selenium</td>
<td class="org-left"><a href="https://github.com/html/cl-selenium">homepage</a></td>
<td class="org-left">Matthew Kennedy</td>
<td class="org-left">LLGPL</td>
<td class="org-right">2016</td>
<td class="org-left">1.0?</td>
</tr>
</tbody>
</table>

<p>
The selenium interfaces are here for reference purposes and are not further discussed.
</p>
</div>
</div>

<div id="outline-container-org951a1c3" class="outline-3">
<h3 id="org951a1c3"><span class="section-number-3">3.3.</span> <a href="#orgd4a45f6">Helper Libraries</a></h3>
<div class="outline-text-3" id="text-3-3">
<table border="2" rules="all" frame="border">
<caption class="t-above"><span class="table-number">Table 4:</span> Libraries Considered</caption>

<colgroup>
<col  class="org-left">

<col  class="org-left">

<col  class="org-left">

<col  class="org-left">

<col  class="org-right">
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Library</th>
<th scope="col" class="org-left">Homepage</th>
<th scope="col" class="org-left">Author</th>
<th scope="col" class="org-left">License</th>
<th scope="col" class="org-right">Last Update</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left"><a href="#orga3783aa">assert-p</a></td>
<td class="org-left"><a href="https://github.com/noloop/assert-p">homepage</a></td>
<td class="org-left">Noloop</td>
<td class="org-left">GPL3</td>
<td class="org-right">2020</td>
</tr>

<tr>
<td class="org-left"><a href="#orged25ed0">assertion-error</a></td>
<td class="org-left"><a href="https://github.com/noloop/assertion-error">homepage</a></td>
<td class="org-left">Noloop</td>
<td class="org-left">GPL3</td>
<td class="org-right">2019</td>
</tr>

<tr>
<td class="org-left"><a href="#orgf730292">check-it</a></td>
<td class="org-left"><a href="https://github.com/DalekBaldwin/check-it">homepage</a></td>
<td class="org-left">Kyle Littler</td>
<td class="org-left">LLGPL</td>
<td class="org-right">2015</td>
</tr>

<tr>
<td class="org-left"><a href="#orgeec32e5">cl-fuzz</a></td>
<td class="org-left"><a href="https://github.com/ndantam/cl-fuzz/">homepage</a></td>
<td class="org-left">Neil T. Dantam</td>
<td class="org-left">BSD 2 Clause</td>
<td class="org-right">2018</td>
</tr>

<tr>
<td class="org-left"><a href="#org0489b8f">cl-quickcheck</a></td>
<td class="org-left"><a href="https://github.com/mcandre/cl-quickcheck">homepage</a></td>
<td class="org-left">Andrew Pennebaker</td>
<td class="org-left">MIT</td>
<td class="org-right">2020</td>
</tr>

<tr>
<td class="org-left"><a href="#org36debc1">cover</a></td>
<td class="org-left"><a href="https://gist.github.com/aamedina/ea994fc8f6e501dd862a2e866c9a08fa">homepage</a></td>
<td class="org-left">Richard Waters</td>
<td class="org-left">MIT</td>
<td class="org-right">1991</td>
</tr>

<tr>
<td class="org-left"><a href="#org1296f8c">hamcrest</a></td>
<td class="org-left"><a href="https://github.com/40ants/cl-hamcrest">homepage</a></td>
<td class="org-left">Alexander Artemenko</td>
<td class="org-left">BSD 3 Clause</td>
<td class="org-right">2022</td>
</tr>

<tr>
<td class="org-left"><a href="#orgcc396d4">mockingbird</a></td>
<td class="org-left"><a href="https://github.com/Chream/mockingbird">homepage</a></td>
<td class="org-left">Christopher Eames</td>
<td class="org-left">MIT</td>
<td class="org-right">2017</td>
</tr>

<tr>
<td class="org-left">portch (not in quicklisp)</td>
<td class="org-left"><a href="https://github.com/nallen05/portch">homepage</a></td>
<td class="org-left">Nick Allen</td>
<td class="org-left">BSD 3 Clause</td>
<td class="org-right">2009</td>
</tr>

<tr>
<td class="org-left"><a href="#org88667e0">protest</a></td>
<td class="org-left"><a href="https://github.com/phoe/protest/">homepage</a></td>
<td class="org-left">Michał Herda</td>
<td class="org-left">LLGPL</td>
<td class="org-right">2020</td>
</tr>

<tr>
<td class="org-left">rtch (not in quicklisp)</td>
<td class="org-left"><a href="http://downloads.sourceforge.net/retch/rtch_0.1.3.tar.gz">download</a></td>
<td class="org-left">David Thompson</td>
<td class="org-left">LLGPL</td>
<td class="org-right">2008</td>
</tr>

<tr>
<td class="org-left">slite</td>
<td class="org-left"><a href="https://github.com/tdrhq/slite/">homepage</a></td>
<td class="org-left">Arnold Noronha</td>
<td class="org-left">Apache 2.0</td>
<td class="org-right">2022</td>
</tr>

<tr>
<td class="org-left"><a href="#org781420d">testbild</a></td>
<td class="org-left"><a href="https://github.com/e-user/testbild">homepage</a></td>
<td class="org-left">Alexander Kahl</td>
<td class="org-left">GPLv3</td>
<td class="org-right">2010</td>
</tr>

<tr>
<td class="org-left"><a href="#org31b5dc8">test-utils</a></td>
<td class="org-left"><a href="https://github.com/inaimathi/test-utils">homepage</a></td>
<td class="org-left">Leo Zovic</td>
<td class="org-left">MIT</td>
<td class="org-right">2020</td>
</tr>
</tbody>
</table>

<p>
<code>assert-p</code>, <code>assertion-error</code>, <code>check-it</code>, <code>cl-fuzz</code>, <code>cl-quickcheck</code>, <code>cover</code>, <code>hamcrest</code>, <code>protest</code>, <code>slite</code>, <code>testbild</code> and <code>test-utils</code> are not, per se, testing frameworks. They are designed to be used in conjunction with other testing frameworks.
</p>

<ul class="org-ul">
<li><code>check-it</code> and <code>cl-quickcheck</code> are randomized property-based testing libraries (Quickcheck style). See <a href="https://en.wikipedia.org/wiki/QuickCheck">https://en.wikipedia.org/wiki/QuickCheck</a></li>

<li><code>cl-fuzz</code> is another variant of testing with random data.</li>

<li><code>assert-p</code> and <code>Assertion-error</code> are collections of assertions or assertion error macros that can be used in testing frameworks or by a test runner.</li>

<li><code>cover</code> is a test coverage library, much like SBCL's <a href="http://www.sbcl.org/manual/index.html#sb_002dcover">sb-cover</a>, CCL's <a href="https://ccl.clozure.com/docs/ccl.html#code-coverage">code-cover</a>, or LispWorks <a href="http://www.lispworks.com/documentation/lw71/LW/html/lw-68.htm">Code Coverage</a></li>

<li><code>hamcrest</code> uses pattern matching for building tests.</li>

<li><code>mockingbird</code> provides stubbing and mocking macros for unit testing. These are used when specified functions in a test should not be computed but should instead return a provided constant value.</li>

<li><code>portch</code> helps organize tests written with Franz's portable ptester library</li>

<li><code>protest</code> is a wrapper around other testing libraries, currently <code>1am</code> and <code>parachute</code>. It wraps around test assertions and, in case of failure, informs the user of details of the failed test step.</li>

<li><code>rtch</code> helps organize RT tests based on their position in a directory hierarchy</li>

<li><code>slite</code> is a Slite stands for SLIme TEst runner (also works with SLY). Slite interactively runs your Common Lisp tests (currently only FiveAM and Parachute are supported). It allows you to see the summary of test failures, jump to test definitions, rerun tests with debugger all from inside Emacs.</li>

<li><code>testbild</code> provides a common interface for unit testing output, supporting TAP (versions 12 and 13) and xunit styles.</li>

<li><code>test-utils</code> provides convenience functions and macros for <code>prove</code> and <code>cl-quickcheck</code>.</li>
</ul>

<p>
<a href="#org63aa282">top</a>
</p>
</div>
</div>

<div id="outline-container-orgc946500" class="outline-3">
<h3 id="orgc946500"><span class="section-number-3">3.4.</span> Dependencies</h3>
<div class="outline-text-3" id="text-3-4">
<p>
Libraries not in the table below do not show any dependencies in their asd files.
</p>
<table border="2" rules="all" frame="border">
<caption class="t-above"><span class="table-number">Table 5:</span> Library Dependencies</caption>

<colgroup>
<col  class="org-left">

<col  class="org-left">
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Library</th>
<th scope="col" class="org-left">Dependencies</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left"><a href="#org12efa6c">cacau</a></td>
<td class="org-left">eventbus, assertion-error</td>
</tr>

<tr>
<td class="org-left"><a href="#org187eda4">checkl</a></td>
<td class="org-left">marshal</td>
</tr>

<tr>
<td class="org-left"><a href="#org53910ab">fiasco</a></td>
<td class="org-left">alexandria, trivial-gray-streams</td>
</tr>

<tr>
<td class="org-left"><a href="#org3e895a0">fiveam</a></td>
<td class="org-left">alexandria, net.didierverna.asdf-flv, trivial-backtrace</td>
</tr>

<tr>
<td class="org-left"><a href="#orgb8996ba">lisp-unit2</a></td>
<td class="org-left">alexandria, cl-interpol, iterate, symbol-munger</td>
</tr>

<tr>
<td class="org-left"><a href="#orga8cfe0a">nst</a></td>
<td class="org-left">(#+(or allegro sbcl clozure openmcl clisp) closer-mop, org-sampler)</td>
</tr>

<tr>
<td class="org-left"><a href="#orga8f69c2">parachute</a></td>
<td class="org-left">documentation-utils, form-fiddle</td>
</tr>

<tr>
<td class="org-left"><a href="#orga7f8a83">prove</a></td>
<td class="org-left">cl-ppcre, cl-ansi-text, cl-colors, alexandria, uiop</td>
</tr>

<tr>
<td class="org-left"><a href="#org3d39ad7">rove</a></td>
<td class="org-left">trivial-gray-streams, uiop</td>
</tr>

<tr>
<td class="org-left"><a href="#org5279729">should-test</a></td>
<td class="org-left">rutils, local-time, osicat, cl-ppcre</td>
</tr>
</tbody>
</table>

<p>
<a id="org9ed10b4"></a>
</p>
</div>
</div>
</div>

<div id="outline-container-orgb1fa812" class="outline-2">
<h2 id="orgb1fa812"><span class="section-number-2">4.</span> Quick Summary</h2>
<div class="outline-text-2" id="text-4">
</div>
<div id="outline-container-org67dd2da" class="outline-3">
<h3 id="org67dd2da"><span class="section-number-3">4.1.</span> Opinionated Awards</h3>
<div class="outline-text-3" id="text-4-1">
<p>
For those who want the opinionated quick summary. The awards are -
</p>
<ul class="org-ul">
<li><p>
Best General Purpose: <b>Parachute</b>
</p>

<p>
It hits almost everything on my wish list - optional progress reports and debugging, good suite setup and reporting, good default error-reporting and the ability to provide diagnostic strings with variables, the ability to skip failing test dependencies, to set time limits on tests, to report the time for each test and decent fixture capability. It does not have the built-in ability to re-run just the last failing tests, but that is a relatively easy add-on. The bigger limitation is that while fixtures are easy to setup, fixtures for parent tests (suites) do not apply to nested child tests. While it is not the fastest, it is in the pack as opposed to the also-rans.
</p>

<p>
My second pick would be <b>Fiasco</b>, but I like Parachute's fixture capability and suite setup better.
</p>

<p>
My third choice would be <b>Lisp-Unit2</b>.
</p>

<p>
<b>(Update 13 June 2021 - based on the latest update of Clunit2, it needs to be included for consideration as well)</b>
<b>(Update 16 Jan 2023 - maybe consider the two newest entries Confidence and Try)</b>
</p></li>

<li>If Only Award: <b>Lift</b> If only it reported all failing assertions and did not stop at the first one. Why? Why can't I change this?</li>

<li>If you only care about speed: <b>Lift and 2am</b> <a href="#orgf24d57d">Go to Benchmarking</a></li>

<li>Best General Purpose Fixtures (Suite/Tag and test level): <b>Lisp-Unit2 and Lift</b></li>

<li>Ability to reuse tests in multiple suites: <b>Lisp-Unit2</b> (because of composable tags)</li>

<li>If you need tests to take parameters: <b>Fiasco</b></li>

<li>If you need progress reporting to be optional: <b>Parachute, Fiasco, or Clunit2</b></li>

<li><p>
Favorite Hierarchy Setup (nestable suites): <b>Parachute</b>
</p>

<p>
Everything is a test and its <code>:parents</code> all the way up; can easily specify parents at the child level.
</p>

<p>
Honorable mentions - <b>2am and Lift</b>
</p></li>

<li>Assertions that take diagnostic comments with variables: <b>Parachute, Fiasco, 2am, Fiveam, Lift, Clunit2</b> This is something that I like for debugging purposes along with whatever reporting comes built in with the framework. See <a href="#orga8083e9">error-reporting</a></li>

<li>Values expression testing: <b>Lisp-Unit2, Lisp-Unit, Parachute</b>, (<b>Update</b> <b>Clunit2</b> as well)</li>

<li>I want to track if my functions changed results: <b>Checkl</b></li>
<li>Tests that specify suite or tags (does not rely on location in file): <b>Parachute, Lisp-Unit (tags), Lisp-Unit2(tags), Lift, Clunit2</b></li>
<li>Heavy duty complex fixtures: <b>NST</b> (but there are trade-offs in the shape of the learning curve and performance)</li>
<li>Ability to define new assertions: <b>Confidence, NST</b> (but they have their issues in other areas)</li>
<li>Ability to rerun failures only: <b>Fiasco, Lisp-Unit2</b> (you can extend Parachute and Fiveam to get this, but it is not there now)</li>

<li>Favorite Random Data Generator: <b>Check-it</b></li>
<li>Can redirect output to a different stream (a): <b>Clunit2, Confidence, Fiasco, Lift, Lisp-Unit, Lisp-Unit2 and RT</b></li>

<li>Randomized Property Tests: <b>Check-it with any framework</b></li>
<li>Choice of <a href="#org8c79edf">Interactive Debugging or Reporting</a>: Most frameworks at this point</li>
<li>Rosetta Stone Award for reading different test formats: <b>Parachute</b> (can read Fiveam, Prove and Lisp-Unit tests)</li>

<li>Code Coverage Reports: Use your compiler</li>
<li>I use it because it was included in my project skeleton generator: <b>Prove</b></li>
</ul>

<p>
(a) Most frameworks just write to <code>*standard-output*</code> so you have to redirect that to a file.
</p>

<p>
<a href="#org63aa282">top</a>
<a id="org05ff1d1"></a>
</p>
</div>
</div>

<div id="outline-container-org4743261" class="outline-3">
<h3 id="org4743261"><span class="section-number-3">4.2.</span> Features Considered</h3>
<div class="outline-text-3" id="text-4-2">
<ul class="org-ul">
<li>Ease of use and documentation: Most of the frameworks are straightforward. Some have no documentation, others have partial documentation (often documenting only one use case). The documentation may be out of sync with the code. Some get so excited about writing up the implementation details that it becomes difficult to see the forest for the trees. NST has a high learning curve. Prove and Rove will require digging into the source code if you want to do more than simple regression testing. Lift has a lot of undocumented functionality that might be just what you need but you have no way of knowing.</li>

<li>Tests
<ul class="org-ul">
<li>Tests should take multiple assertions and report ALL the assertion failures in the test (Looking at you Lift, and Xlunit - I put multiple assertions into a test for a reason, please do not lose some of the evidence.)</li>
<li>Are tests <a href="#org664eb75">functions or otherwise funcallable</a>? (Faré and others requested this in an exchange with Tapiwa, the author of Clunit, back in 2013. At the same time others want or do not want test names in the function namespace. You choose your preference. Those who want funcallable tests typically cite either the ability to program running the test or the ability to go to definion from test name.)</li>
<li>Immediate access to source code (Integration with debugger or funcallable tests?)</li>
<li>Does a failure or error throw you immediately into the debugger, never into the debugger, and is that optional?</li>
<li>Easy to test structures/classes (does the framework provide assistance in determining that all parts of a structure or class meet a test)</li>
<li>Tests can call other tests (This is not the same as funcallable tests. To be useful this does require a minimum level of test labeling in the reporting.)</li>
</ul></li>

<li>Assertions (aka <a href="#orgc754ba6">Assertion Functions</a>)
<ul class="org-ul">
<li>There are frameworks with only a few assertion test functions. There are frameworks with so many assertions that you wonder if you have to learn them all. The advantage of specialized assertions is less typing, possibly faster (or slower) performance and possibly relevant <a href="#orga8083e9">built-in error messages</a>. You will have to check for yourself whether performance is positively or negatively impacted. You have to decide for yourself how much weight to put on extra assertions like having <code>assert-symbolp</code> instead of <code>(is (symbolp x))</code>.</li>
<li>Assertions that either automatically explain why the the test failed or <a href="#orgb3ac5d2">allow a diagnostic string</a> that describes the assertion and what failed. (Have you ever seen a test fail but the report of what it should have been and what the result was look exactly the same? Maybe the test required EQL and you thought it was EQUALP? These might or might not help)</li>
<li>Can assertions can access <a href="#org5a9b325">variables in a closure containing the test</a>? (Most frameworks can, but Clunit, Clunit2, Lisp-Unit, Lisp-Unit2 and NST cannot).</li>
<li>Do the assertions have <a href="#orgba88a3c">macroexpand assertion functions</a>? (Clunit, Clunit2, Lisp-Unit, Lisp-Unit2, Prove, Rove and Tap-Unit-Test have this)</li>
<li>Do the assertions have <a href="#org841422f">floating point and rational comparisons</a> or do you have to write your own? (Confidence, Lift, Lisp-Unit, Lisp-Unit2, have these functions for you.)</li>
<li>Signal and condition testing or at least be able to validate that the right condition was signalled.</li>
<li>Definable assertions/criteria (can you easily define additional assertions?)</li>
<li>Do assertions or tests <a href="#org4dbbe4f">run on compilation</a> (C-c C-c in the source file)?</li>
<li>Do the assertions handle <a href="#org48c1db0">values expressions</a>? Most frameworks accept a values expression but compare just the first value. Fiveam complains about getting a values expression and throws an error. Parachute and NST will compare a single values expression against multiple individual values. Prove will compare a values expression against a list. Lisp-Unit and Lisp-Unit2 (<b>Update</b> Clunit2) will actually compare two values expressions value by value.</li>
</ul></li>

<li>Easy to set up understandable suites and hierarchies or tags. Many frameworks automatically add tests to the last test suite that was defined. That it makes things easy if you work very linearly or just in files for regression testing. If you are working in the REPL and switching between multiple test sub-suites that can create unexpected behavior. I like to able to specify the suite (or tags) when defining the test, but that creates more unecessary typing if you work differently.</li>

<li>Choice of <a href="#org8c79edf">Interactive</a> (drop directly into the debugger) or Reporting (run one or more tests and show which ones fail and which ones pass).</li>

<li>Data generators are nice to have, but the helper libraries <a href="#orgf730292">Check-it</a> and <a href="#org0489b8f">Cl-Quickcheck</a> can also be used and probably have more extensive facilities.</li>

<li>Easy to setup and clean up <a href="#org12e5543">Fixtures</a>
<ul class="org-ul">
<li>Composable fixtures (fixtures for multiple test suites can be composed into a single fixture)</li>
<li>Freezing existing data while a test temporarily changes it</li>
</ul></li>

<li>Compilation: Some people want the ability to compile before running tests for two reasons. First, deferred compilation can seriously slow down extensive tests. Second, getting compile errors and warnings at the test run stage can be hard to track down in the middle of a lot of test output. Other people want deferred compilation (running the test compiles it, so no pre-compilation step required) and tested functions which have changed will get picked up when running the test.</li>

<li>Reports
<ul class="org-ul">
<li>Easy to read reports with descriptive comments (this requires that each test have description or documentation support)</li>
<li>Does the framework have <a href="#orga30c9b3">progress reporting, at what level and can it be turned off</a>?</li>
<li>Report just failing tests with descriptive info</li>
<li>Composable Reports (in the sense of a single report aggregating multiple tests or test suites)</li>
<li>Reports to File. I know most developers do not care, but I have seen situations where the ability to prove that the software at date A is documented to have passed xyz tests would have been nice. See <a href="#orga246252">Dribble and Output Streams</a></li>
<li>Test Timing. See <a href="#orgbd69a48">Timing</a></li>
<li>TAP Output (some people like to pass this test results in this format on to other tools).</li>
<li>Reports of Function (and parameter) test coverage (Rove was the only framework that has something in this area and it depends on using SBCL. I would suggest looking to your compiler and did not test this.)</li>
</ul></li>

<li>Error tracking (Do test runs create a test history so that you can run only against failing tests?) As far as I can tell, no framework creates a database to allow historical analysis.</li>

<li>Test Sequencing <a href="#org0407563">Shuffling</a>
<ul class="org-ul">
<li>Can choose test sequencing or shuffle</li>
<li>Can choose consistent or random or fuzzing data</li>
<li>Can choose just the tests that failed last time (Chris Riesbeck exchange with Tapiwa in 2013)</li>
</ul></li>

<li>Ability to skip tests <a href="#org0407563">Skipping</a>
<ul class="org-ul">
<li>Skip tests</li>
<li>Skip assertions</li>
<li>Skip based on implementations</li>
<li>also skip tests that exceed a certain time period</li>
</ul></li>

<li><a href="#orgd9ad157">Benchmarks</a> In general, functionality should matter to you more than benchmarks. The timing benchmark provided here is a regression test on UAX-15 with 16 tests containing 343332 assertions run 10 times. While useful for regression tests, this is not necessarily indicative of development testing.</li>

<li>Asynchronous and parallel testing (not tested in this report)</li>
<li>Case safety (Max Mikhanosha asked for this an an exchange with Tapiwa in 2013. Not tested in this report)</li>
<li>Memory, time and resource usage reports (no one documented this and I did not dive into the source code looking for it.)</li>
</ul>

<p>
I am not covering support for asdf package-inferred systems, roswell script support and integration with travis ci, github actions, Coveralls, etc. If someone wants to do that and submit a pull request, I am open to that.
</p>

<p>
I am not including a pie chart describing which library has market share because (a) I do not like pie charts and (b) I do not believe market share is a measure of quality. That being said, because someone asked nicely, I pulled the following info out of quicklisp just based on <code>who-depends-on</code>. The actual count in the wild is completely unknown.
</p>

<table border="2" rules="all" frame="border">
<caption class="t-above"><span class="table-number">Table 6:</span> User Count on Quicklisp</caption>

<colgroup>
<col  class="org-left">

<col  class="org-right">
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Name</th>
<th scope="col" class="org-right">Count</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">1am</td>
<td class="org-right">22</td>
</tr>

<tr>
<td class="org-left">2am</td>
<td class="org-right">0</td>
</tr>

<tr>
<td class="org-left">fiveam</td>
<td class="org-right">323</td>
</tr>

<tr>
<td class="org-left">clunit</td>
<td class="org-right">11</td>
</tr>

<tr>
<td class="org-left">clunit2</td>
<td class="org-right">4</td>
</tr>

<tr>
<td class="org-left">confidence</td>
<td class="org-right">2</td>
</tr>

<tr>
<td class="org-left">fiasco</td>
<td class="org-right">24</td>
</tr>

<tr>
<td class="org-left">lift</td>
<td class="org-right">54</td>
</tr>

<tr>
<td class="org-left">lisp-unit</td>
<td class="org-right">42</td>
</tr>

<tr>
<td class="org-left">lisp-unit2</td>
<td class="org-right">21</td>
</tr>

<tr>
<td class="org-left">nst</td>
<td class="org-right">10</td>
</tr>

<tr>
<td class="org-left">parachute</td>
<td class="org-right">49</td>
</tr>

<tr>
<td class="org-left">prove</td>
<td class="org-right">163</td>
</tr>

<tr>
<td class="org-left">ptester</td>
<td class="org-right">5</td>
</tr>

<tr>
<td class="org-left">rove</td>
<td class="org-right">31</td>
</tr>

<tr>
<td class="org-left">rt</td>
<td class="org-right">29</td>
</tr>

<tr>
<td class="org-left">should-test</td>
<td class="org-right">3</td>
</tr>

<tr>
<td class="org-left">try</td>
<td class="org-right">7</td>
</tr>

<tr>
<td class="org-left">xlunit</td>
<td class="org-right">4</td>
</tr>

<tr>
<td class="org-left">xptest</td>
<td class="org-right">0</td>
</tr>
</tbody>
</table>

<p>
<a id="org8cc6270"></a> <a id="org6fd0032"></a>
</p>
</div>
</div>
</div>

<div id="outline-container-orgc9f9957" class="outline-2">
<h2 id="orgc9f9957"><span class="section-number-2">5.</span> Functionality Comparison</h2>
<div class="outline-text-2" id="text-5">
</div>
<div id="outline-container-orgab98e25" class="outline-3">
<h3 id="orgab98e25"><span class="section-number-3">5.1.</span> Hierarchy Overview</h3>
<div class="outline-text-3" id="text-5-1">
<table border="2" rules="all" frame="border">
<caption class="t-above"><span class="table-number">Table 7:</span> Overview-1</caption>

<colgroup>
<col  class="org-left">

<col  class="org-left">

<col  class="org-left">

<col  class="org-left">
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Name</th>
<th scope="col" class="org-left">Hierarchies/suites/tags/lists</th>
<th scope="col" class="org-left">Composable</th>
<th scope="col" class="org-left">Reports</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left"><a href="#orge4344cd">1am</a></td>
<td class="org-left">❌️ (2)(5)</td>
<td class="org-left">❌️</td>
<td class="org-left">❌️</td>
</tr>

<tr>
<td class="org-left"><a href="#org4a2ad7a">2am</a></td>
<td class="org-left">✅️</td>
<td class="org-left">✅️ (5)</td>
<td class="org-left">(4)</td>
</tr>

<tr>
<td class="org-left"><a href="#org12efa6c">cacau</a></td>
<td class="org-left">(6)</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">(4)</td>
</tr>

<tr>
<td class="org-left"><a href="#org5eea657">clunit</a></td>
<td class="org-left">✅️</td>
<td class="org-left">✅️</td>
<td class="org-left">(4)</td>
</tr>

<tr>
<td class="org-left"><a href="#orge473393">clunit2</a></td>
<td class="org-left">✅️</td>
<td class="org-left">✅️</td>
<td class="org-left">(4)</td>
</tr>

<tr>
<td class="org-left"><a href="#org4b0d432">confidence</a></td>
<td class="org-left">❌️ (9)</td>
<td class="org-left">✅️</td>
<td class="org-left">✅️</td>
</tr>

<tr>
<td class="org-left"><a href="#org53910ab">fiasco</a></td>
<td class="org-left">✅️</td>
<td class="org-left">✅️</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left"><a href="#org3e895a0">fiveam</a></td>
<td class="org-left">✅️</td>
<td class="org-left">✅️</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left"><a href="#org8d88b5e">gigamonkeys</a></td>
<td class="org-left">❌️</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left"><a href="#orga50a995">lift</a></td>
<td class="org-left">✅️</td>
<td class="org-left">✅️</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left"><a href="#orgc6e4266">lisp-unit</a></td>
<td class="org-left">(tags) (3)</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">(1,4)</td>
</tr>

<tr>
<td class="org-left"><a href="#orgb8996ba">lisp-unit2</a></td>
<td class="org-left">(tags) (3)(5)</td>
<td class="org-left">✅️ (5)</td>
<td class="org-left">(1,4)</td>
</tr>

<tr>
<td class="org-left"><a href="#orga8cfe0a">nst</a></td>
<td class="org-left">✅️</td>
<td class="org-left">✅️</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left"><a href="#orga8f69c2">parachute</a></td>
<td class="org-left">✅️</td>
<td class="org-left">✅️</td>
<td class="org-left">(1)</td>
</tr>

<tr>
<td class="org-left"><a href="#orga7f8a83">prove</a></td>
<td class="org-left">✅️</td>
<td class="org-left">✅️</td>
<td class="org-left">(4)</td>
</tr>

<tr>
<td class="org-left"><a href="#org52f36e5">ptester</a></td>
<td class="org-left">❌️</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left"><a href="#org3d39ad7">rove</a></td>
<td class="org-left">(7)</td>
<td class="org-left">(7)</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left"><a href="#org55cd3c7">rt</a></td>
<td class="org-left">package</td>
<td class="org-left">(8)</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left"><a href="#org5279729">should-test</a></td>
<td class="org-left">package</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left"><a href="#org209a1fe">simplet</a></td>
<td class="org-left">❌️</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left"><a href="#orgdc1cd10">tap-unit-test</a></td>
<td class="org-left">❌️</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">(4)</td>
</tr>

<tr>
<td class="org-left"><a href="#orgd9a48e8">try</a></td>
<td class="org-left">✅️</td>
<td class="org-left">✅️ (5)</td>
<td class="org-left">✅️</td>
</tr>

<tr>
<td class="org-left"><a href="#org4b187d6">unit-test</a></td>
<td class="org-left">✅️</td>
<td class="org-left">✅️</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left"><a href="#orgea91eb1">xlunit</a></td>
<td class="org-left">✅️</td>
<td class="org-left">✅️</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left"><a href="#org72de806">xptest</a></td>
<td class="org-left">✅️</td>
<td class="org-left">❌️</td>
<td class="org-left">&#xa0;</td>
</tr>
</tbody>
</table>
<ol class="org-ol">
<li>report objects are provided which are expected to be extended by the user</li>
<li>uses a flat list of tests. You can pass any list of test-names to run. See, e.g. macro provided by Phoe in the 1am <a href="#org46df3c7">discussion</a>.</li>
<li>lisp-unit and lisp-unit2 organize by packages and by tags. You can run all the tests in a package, or all the tests for a list of tags, but they do not have the strict sense of hierarchy that other libraries have.</li>
<li><a href="http://testanything.org">TAP Formatted</a> Reports are available</li>
<li>Because tests are functions, tests can call other functions so you can create ad-hoc suites or hierarchies but they are not likely to be composable.</li>
<li>Has suites but no real capacity to run them independently - all or nothing</li>
<li>Rove's <code>run-suite</code> function will run all the tests in a particular package but does not accept a style parameter and simply prints out the results of each individual test, without summarizing. Rove's <code>run</code> function does accept a style parameter but seems to handle only package-inferred systems. I confirm Rove's <a href="https://github.com/fukamachi/rove/issues/42">issue #42</a> that it will not run with non-package inferred systems.</li>
<li>RT does not have suites per se. You can run all the tests that have been defined using the DO-TESTS function. By default it prints to <code>*standard-output*</code> but accepts an optional stream parameter which would allow you to redirect the results to a file or other stream of your choice. do-tests will print the results for each individual test and then summarize with something like the following:</li>
<li>Tests are hierarchical and compose results but there is no tagging system. Each suite is a function that can directly be executed.</li>
</ol>
</div>
</div>

<div id="outline-container-org38f706c" class="outline-3">
<h3 id="org38f706c"><span class="section-number-3">5.2.</span> Run on compile, funcallable tests</h3>
<div class="outline-text-3" id="text-5-2">
<p>
<a id="org4dbbe4f"></a><a id="org664eb75"></a>
</p>
<table border="2" rules="all" frame="border">
<caption class="t-above"><span class="table-number">Table 8:</span> Run on Compile and Funcallable Tests</caption>

<colgroup>
<col  class="org-left">

<col  class="org-left">

<col  class="org-left">
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Library</th>
<th scope="col" class="org-left">Run on compile</th>
<th scope="col" class="org-left">Are Tests Funcallable?</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left"><a href="#orge4344cd">1am</a></td>
<td class="org-left">A</td>
<td class="org-left">Y</td>
</tr>

<tr>
<td class="org-left"><a href="#org4a2ad7a">2am</a> (not in quicklisp)</td>
<td class="org-left">A</td>
<td class="org-left">Y</td>
</tr>

<tr>
<td class="org-left"><a href="#org12efa6c">cacau</a></td>
<td class="org-left">N</td>
<td class="org-left">N</td>
</tr>

<tr>
<td class="org-left"><a href="#org5eea657">clunit</a></td>
<td class="org-left">A</td>
<td class="org-left">N</td>
</tr>

<tr>
<td class="org-left"><a href="#orge473393">clunit2</a></td>
<td class="org-left">A</td>
<td class="org-left">N</td>
</tr>

<tr>
<td class="org-left"><a href="#org4b0d432">confidence</a></td>
<td class="org-left">N</td>
<td class="org-left">Y</td>
</tr>

<tr>
<td class="org-left"><a href="#org53910ab">fiasco</a></td>
<td class="org-left">A</td>
<td class="org-left">Y</td>
</tr>

<tr>
<td class="org-left"><a href="#org3e895a0">fiveam</a></td>
<td class="org-left">Optional</td>
<td class="org-left">N</td>
</tr>

<tr>
<td class="org-left"><a href="#org8d88b5e">gigamonkeys</a></td>
<td class="org-left">N</td>
<td class="org-left">N</td>
</tr>

<tr>
<td class="org-left"><a href="#orga50a995">lift</a></td>
<td class="org-left">A, T(1)</td>
<td class="org-left">N</td>
</tr>

<tr>
<td class="org-left"><a href="#orgc6e4266">lisp-unit</a></td>
<td class="org-left">N</td>
<td class="org-left">N</td>
</tr>

<tr>
<td class="org-left"><a href="#orgb8996ba">lisp-unit2</a></td>
<td class="org-left">N</td>
<td class="org-left">Y</td>
</tr>

<tr>
<td class="org-left"><a href="#orga8cfe0a">nst</a></td>
<td class="org-left">N</td>
<td class="org-left">N</td>
</tr>

<tr>
<td class="org-left"><a href="#orga8f69c2">parachute</a></td>
<td class="org-left">N</td>
<td class="org-left">N</td>
</tr>

<tr>
<td class="org-left"><a href="#orga7f8a83">prove</a></td>
<td class="org-left">A</td>
<td class="org-left">N</td>
</tr>

<tr>
<td class="org-left"><a href="#org52f36e5">ptester</a></td>
<td class="org-left">N</td>
<td class="org-left">N</td>
</tr>

<tr>
<td class="org-left"><a href="#org3d39ad7">rove</a></td>
<td class="org-left">A</td>
<td class="org-left">N</td>
</tr>

<tr>
<td class="org-left"><a href="#org55cd3c7">rt</a></td>
<td class="org-left">N</td>
<td class="org-left">N</td>
</tr>

<tr>
<td class="org-left"><a href="#org5279729">should-test</a></td>
<td class="org-left">N</td>
<td class="org-left">N</td>
</tr>

<tr>
<td class="org-left"><a href="#orgdc1cd10">tap-unit-test</a></td>
<td class="org-left">N</td>
<td class="org-left">N</td>
</tr>

<tr>
<td class="org-left"><a href="#orgd9a48e8">try</a></td>
<td class="org-left">N</td>
<td class="org-left">Y</td>
</tr>

<tr>
<td class="org-left"><a href="#org4b187d6">unit-test</a></td>
<td class="org-left">N</td>
<td class="org-left">N</td>
</tr>

<tr>
<td class="org-left"><a href="#orgea91eb1">xlunit</a></td>
<td class="org-left">T(2)</td>
<td class="org-left">N</td>
</tr>

<tr>
<td class="org-left"><a href="#org72de806">xptest</a></td>
<td class="org-left">N</td>
<td class="org-left">N</td>
</tr>
</tbody>
</table>
<ul class="org-ul">
<li>A means assertions run on compile, T means tests run on compile</li>
<li>(1) if compiled at REPL</li>
<li>(2) Optional by test, specified at definition: <code>(def-test-method t1 ((test tf-xlunit) :run nil) body)</code></li>
<li>(3) <code>*run-test-when-defined*</code> controls this option</li>
</ul>
</div>
</div>

<div id="outline-container-orgc190358" class="outline-3">
<h3 id="orgc190358"><span class="section-number-3">5.3.</span> Fixtures</h3>
<div class="outline-text-3" id="text-5-3">
<p>
<a id="org12e5543"></a>
</p>
<table border="2" rules="all" frame="border">
<caption class="t-above"><span class="table-number">Table 9:</span> Fixtures</caption>

<colgroup>
<col  class="org-left">

<col  class="org-left">

<col  class="org-left">

<col  class="org-left">

<col  class="org-left">
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Library</th>
<th scope="col" class="org-left">Fixtures</th>
<th scope="col" class="org-left">Suite Fixtures</th>
<th scope="col" class="org-left">Test Fixtures</th>
<th scope="col" class="org-left">Multiple Fixtures</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left"><a href="#orge4344cd">1am</a></td>
<td class="org-left">❌️</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left"><a href="#org4a2ad7a">2am</a> (not in quicklisp)</td>
<td class="org-left">❌️</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left"><a href="#org12efa6c">cacau</a></td>
<td class="org-left">✅️</td>
<td class="org-left">✅️</td>
<td class="org-left">✅️</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left"><a href="#org5eea657">clunit</a></td>
<td class="org-left">✅️</td>
<td class="org-left">✅️</td>
<td class="org-left">✅️</td>
<td class="org-left">✅️</td>
</tr>

<tr>
<td class="org-left"><a href="#orge473393">clunit2</a></td>
<td class="org-left">✅️</td>
<td class="org-left">✅️</td>
<td class="org-left">✅️</td>
<td class="org-left">✅️</td>
</tr>

<tr>
<td class="org-left"><a href="#org4b0d432">confidence</a></td>
<td class="org-left">❌️</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left"><a href="#org53910ab">fiasco</a></td>
<td class="org-left">❌️</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left"><a href="#org3e895a0">fiveam</a>  (a)</td>
<td class="org-left">K</td>
<td class="org-left">✅️</td>
<td class="org-left">✅️</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left"><a href="#org8d88b5e">gigamonkeys</a></td>
<td class="org-left">❌️</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left"><a href="#orga50a995">lift</a></td>
<td class="org-left">✅️</td>
<td class="org-left">✅️</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">inherited from higher level suites</td>
</tr>

<tr>
<td class="org-left"><a href="#orgc6e4266">lisp-unit</a></td>
<td class="org-left">❌️</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left"><a href="#orgb8996ba">lisp-unit2</a></td>
<td class="org-left">✅️</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">✅️</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left"><a href="#orga8cfe0a">nst</a></td>
<td class="org-left">✅️</td>
<td class="org-left">✅️</td>
<td class="org-left">✅️</td>
<td class="org-left">✅️</td>
</tr>

<tr>
<td class="org-left"><a href="#orga8f69c2">parachute</a></td>
<td class="org-left">✅️</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">✅️</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left"><a href="#orga7f8a83">prove</a></td>
<td class="org-left">❌️</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left"><a href="#org52f36e5">ptester</a></td>
<td class="org-left">❌️</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left"><a href="#org3d39ad7">rove</a></td>
<td class="org-left">✅️</td>
<td class="org-left">✅️</td>
<td class="org-left">✅️</td>
<td class="org-left">✅️</td>
</tr>

<tr>
<td class="org-left"><a href="#org55cd3c7">rt</a></td>
<td class="org-left">❌️</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left"><a href="#org5279729">should-test</a></td>
<td class="org-left">❌️</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left"><a href="#orgdc1cd10">tap-unit-test</a></td>
<td class="org-left">❌️</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left"><a href="#orgd9a48e8">try</a></td>
<td class="org-left">❌️</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left"><a href="#org4b187d6">unit-test</a> (b)</td>
<td class="org-left">✅️</td>
<td class="org-left">(b)</td>
<td class="org-left">(b)</td>
<td class="org-left">(b)</td>
</tr>

<tr>
<td class="org-left"><a href="#orgea91eb1">xlunit</a></td>
<td class="org-left">✅️</td>
<td class="org-left">✅️</td>
<td class="org-left">✅️</td>
<td class="org-left">✅️</td>
</tr>

<tr>
<td class="org-left"><a href="#org72de806">xptest</a></td>
<td class="org-left">✅️</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">✅️</td>
<td class="org-left">&#xa0;</td>
</tr>
</tbody>
</table>
<p>
(a) Not really recommended, but does exist.
(b) Users are expected to create a subclass of the unit-test class using the <code>define-test-class</code> macro.
</p>

<p>
<a href="#org63aa282">top</a>
</p>
</div>
</div>

<div id="outline-container-orga36fdaf" class="outline-3">
<h3 id="orga36fdaf"><span class="section-number-3">5.4.</span> Control over debugging, and user-provided diagnostic messages</h3>
<div class="outline-text-3" id="text-5-4">
<p>
Does a failure (not error) trigger the debugger, is it optional, and do assertions allow user-provided diagnostic messages. If yes, can you further provide variables for a failure message?
<a id="org8c79edf"></a><a id="orgb3ac5d2"></a>
</p>
<table border="2" rules="all" frame="border">
<caption class="t-above"><span class="table-number">Table 10:</span> Overview Reporting v. Debugger Optionality / Diagnostic Messages</caption>

<colgroup>
<col  class="org-left">

<col  class="org-left">

<col  class="org-left">
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Library</th>
<th scope="col" class="org-left">Failure triggers debugger</th>
<th scope="col" class="org-left">Diagnostic Messags in Assertions</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left"><a href="#orge4344cd">1am</a></td>
<td class="org-left">(always)</td>
<td class="org-left">N</td>
</tr>

<tr>
<td class="org-left"><a href="#org4a2ad7a">2am</a></td>
<td class="org-left">(optional)</td>
<td class="org-left">with vars</td>
</tr>

<tr>
<td class="org-left"><a href="#org12efa6c">cacau</a></td>
<td class="org-left">(optional)</td>
<td class="org-left">N</td>
</tr>

<tr>
<td class="org-left"><a href="#org5eea657">clunit</a></td>
<td class="org-left">(optional)</td>
<td class="org-left">with vars</td>
</tr>

<tr>
<td class="org-left"><a href="#orge473393">clunit2</a></td>
<td class="org-left">(optional)</td>
<td class="org-left">with vars</td>
</tr>

<tr>
<td class="org-left"><a href="#org4b0d432">confidence</a></td>
<td class="org-left">(never)</td>
<td class="org-left">with vars</td>
</tr>

<tr>
<td class="org-left"><a href="#org8d88b5e">gigamonkeys</a></td>
<td class="org-left">(optional)</td>
<td class="org-left">N</td>
</tr>

<tr>
<td class="org-left"><a href="#org53910ab">fiasco</a></td>
<td class="org-left">(optional)</td>
<td class="org-left">with vars</td>
</tr>

<tr>
<td class="org-left"><a href="#org3e895a0">fiveam</a></td>
<td class="org-left">(optional)</td>
<td class="org-left">with vars</td>
</tr>

<tr>
<td class="org-left"><a href="#orga50a995">lift</a></td>
<td class="org-left">(optional)</td>
<td class="org-left">with vars</td>
</tr>

<tr>
<td class="org-left"><a href="#orgc6e4266">lisp-unit</a></td>
<td class="org-left">(optional)</td>
<td class="org-left">Y</td>
</tr>

<tr>
<td class="org-left"><a href="#orgb8996ba">lisp-unit2</a></td>
<td class="org-left">(optional)</td>
<td class="org-left">Y</td>
</tr>

<tr>
<td class="org-left"><a href="#orga8cfe0a">nst</a></td>
<td class="org-left">(optional)</td>
<td class="org-left">N</td>
</tr>

<tr>
<td class="org-left"><a href="#orga8f69c2">parachute</a></td>
<td class="org-left">(optional)</td>
<td class="org-left">with vars</td>
</tr>

<tr>
<td class="org-left"><a href="#orga7f8a83">prove</a></td>
<td class="org-left">(optional)</td>
<td class="org-left">Y</td>
</tr>

<tr>
<td class="org-left"><a href="#org52f36e5">ptester</a></td>
<td class="org-left">(optional)</td>
<td class="org-left">N</td>
</tr>

<tr>
<td class="org-left"><a href="#org3d39ad7">rove</a></td>
<td class="org-left">(optional)</td>
<td class="org-left">Y</td>
</tr>

<tr>
<td class="org-left"><a href="#org55cd3c7">rt</a></td>
<td class="org-left">(never)</td>
<td class="org-left">N</td>
</tr>

<tr>
<td class="org-left"><a href="#org5279729">should-test</a></td>
<td class="org-left">(never)</td>
<td class="org-left">Y</td>
</tr>

<tr>
<td class="org-left"><a href="#org209a1fe">simplet</a></td>
<td class="org-left">(never)</td>
<td class="org-left">N</td>
</tr>

<tr>
<td class="org-left"><a href="#orgdc1cd10">tap-unit-test</a></td>
<td class="org-left">(optional)</td>
<td class="org-left">Y</td>
</tr>

<tr>
<td class="org-left"><a href="#orgd9a48e8">try</a></td>
<td class="org-left">optional</td>
<td class="org-left">Y</td>
</tr>

<tr>
<td class="org-left"><a href="#org4b187d6">unit-test</a></td>
<td class="org-left">(never)</td>
<td class="org-left">Y</td>
</tr>

<tr>
<td class="org-left"><a href="#orgea91eb1">xlunit</a></td>
<td class="org-left">(never)</td>
<td class="org-left">Y</td>
</tr>

<tr>
<td class="org-left"><a href="#org72de806">xptest</a></td>
<td class="org-left">(never)</td>
<td class="org-left">N</td>
</tr>
</tbody>
</table>
<p>
Also see <a href="#orga8083e9">error-reporting</a>
</p>
</div>
</div>

<div id="outline-container-org93fbc48" class="outline-3">
<h3 id="org93fbc48"><span class="section-number-3">5.5.</span> Output of Run Functions (other than what is printed to the stream)</h3>
<div class="outline-text-3" id="text-5-5">
<table border="2" rules="all" frame="border">
<caption class="t-above"><span class="table-number">Table 11:</span> Output of Run Functions (other than what is printed to the stream)</caption>

<colgroup>
<col  class="org-left">

<col  class="org-left">

<col  class="org-left">
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Library</th>
<th scope="col" class="org-left">Function</th>
<th scope="col" class="org-left">Returns</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left"><a href="#orge4344cd">1am</a></td>
<td class="org-left">run</td>
<td class="org-left">nil</td>
</tr>

<tr>
<td class="org-left"><a href="#org4a2ad7a">2am</a> (not in quicklisp)</td>
<td class="org-left">run</td>
<td class="org-left">nil</td>
</tr>

<tr>
<td class="org-left"><a href="#org12efa6c">cacau</a></td>
<td class="org-left">run</td>
<td class="org-left">nil</td>
</tr>

<tr>
<td class="org-left"><a href="#org5eea657">clunit</a></td>
<td class="org-left">run-test, run-suite</td>
<td class="org-left">nil</td>
</tr>

<tr>
<td class="org-left"><a href="#orge473393">clunit2</a></td>
<td class="org-left">run-test, run-suite</td>
<td class="org-left">nil</td>
</tr>

<tr>
<td class="org-left"><a href="#org4b0d432">confidence</a></td>
<td class="org-left">name-of-test</td>
<td class="org-left">nil</td>
</tr>

<tr>
<td class="org-left"><a href="#org53910ab">fiasco</a></td>
<td class="org-left">run-tests</td>
<td class="org-left">test-run object</td>
</tr>

<tr>
<td class="org-left"><a href="#org3e895a0">fiveam</a></td>
<td class="org-left">run</td>
<td class="org-left">list of test-passed, test-skipped, test-failure objects</td>
</tr>

<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">run!</td>
<td class="org-left">nil</td>
</tr>

<tr>
<td class="org-left"><a href="#org8d88b5e">gigamonkeys</a></td>
<td class="org-left">test</td>
<td class="org-left">nil</td>
</tr>

<tr>
<td class="org-left"><a href="#orga50a995">lift</a></td>
<td class="org-left">run-test, run-tests</td>
<td class="org-left">results object</td>
</tr>

<tr>
<td class="org-left"><a href="#orgc6e4266">lisp-unit</a></td>
<td class="org-left">run-tests</td>
<td class="org-left">test-results-db object</td>
</tr>

<tr>
<td class="org-left"><a href="#orgb8996ba">lisp-unit2</a></td>
<td class="org-left">run-tests</td>
<td class="org-left">test-results-db object</td>
</tr>

<tr>
<td class="org-left"><a href="#orga8cfe0a">nst</a></td>
<td class="org-left">:run</td>
<td class="org-left">nil</td>
</tr>

<tr>
<td class="org-left"><a href="#orga8f69c2">parachute</a></td>
<td class="org-left">test</td>
<td class="org-left">a result object</td>
</tr>

<tr>
<td class="org-left"><a href="#orga7f8a83">prove</a></td>
<td class="org-left">run</td>
<td class="org-left">Returns 3 multiple-values, a flag if the tests passed as T or NIL, passed test files as a list and failed test files also as a list.</td>
</tr>

<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">run-test-system</td>
<td class="org-left">passed-files, failed-files</td>
</tr>

<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">run-test</td>
<td class="org-left">nil</td>
</tr>

<tr>
<td class="org-left"><a href="#org52f36e5">ptester</a></td>
<td class="org-left">with-tests</td>
<td class="org-left">nil</td>
</tr>

<tr>
<td class="org-left"><a href="#org3d39ad7">rove</a></td>
<td class="org-left">run-test, run-suite</td>
<td class="org-left">t or nil</td>
</tr>

<tr>
<td class="org-left"><a href="#org55cd3c7">rt</a></td>
<td class="org-left">do-test</td>
<td class="org-left">nil</td>
</tr>

<tr>
<td class="org-left"><a href="#org5279729">should-test</a></td>
<td class="org-left">test</td>
<td class="org-left">hash-table (1)</td>
</tr>

<tr>
<td class="org-left"><a href="#orgdc1cd10">tap-unit-test</a></td>
<td class="org-left">run-tests</td>
<td class="org-left">nil</td>
</tr>

<tr>
<td class="org-left"><a href="#orgd9a48e8">try</a></td>
<td class="org-left">try</td>
<td class="org-left">trial object</td>
</tr>

<tr>
<td class="org-left"><a href="#org4b187d6">unit-test</a></td>
<td class="org-left">run-test</td>
<td class="org-left">test-equal-result object</td>
</tr>

<tr>
<td class="org-left"><a href="#orgea91eb1">xlunit</a></td>
<td class="org-left">textui-test-run</td>
<td class="org-left">test-results-object</td>
</tr>

<tr>
<td class="org-left"><a href="#org72de806">xptest</a></td>
<td class="org-left">run-test</td>
<td class="org-left">list of test-result objects</td>
</tr>
</tbody>
</table>

<p>
(1) Should-test: at the lowest level should returns T or NIL and signals information about the failed assertion. This information is aggregated by deftest which will return aggregate information about all the failed assertions in the hash-table at the highest level test will once again aggregate information over all tests.
</p>
</div>
</div>

<div id="outline-container-org54dd870" class="outline-3">
<h3 id="org54dd870"><span class="section-number-3">5.6.</span> Progress Reports</h3>
<div class="outline-text-3" id="text-5-6">
<p>
Does the framework provide a progress report, is it optional, and does it run just at the test level or also at the asserts level?
<a id="orga30c9b3"></a>
</p>
<table border="2" rules="all" frame="border">
<caption class="t-above"><span class="table-number">Table 12:</span> Overview - Progress Reports</caption>

<colgroup>
<col  class="org-left">

<col  class="org-left">
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Library</th>
<th scope="col" class="org-left">Progress Reports</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left"><a href="#orge4344cd">1am</a></td>
<td class="org-left">Every assert</td>
</tr>

<tr>
<td class="org-left"><a href="#org4a2ad7a">2am</a></td>
<td class="org-left">Every assert</td>
</tr>

<tr>
<td class="org-left"><a href="#org12efa6c">cacau</a></td>
<td class="org-left">optional</td>
</tr>

<tr>
<td class="org-left"><a href="#org5eea657">clunit</a></td>
<td class="org-left">optional</td>
</tr>

<tr>
<td class="org-left"><a href="#orge473393">clunit2</a></td>
<td class="org-left">optional</td>
</tr>

<tr>
<td class="org-left"><a href="#org4b0d432">confidence</a></td>
<td class="org-left">never</td>
</tr>

<tr>
<td class="org-left"><a href="#org8d88b5e">gigamonkeys</a></td>
<td class="org-left">never</td>
</tr>

<tr>
<td class="org-left"><a href="#org53910ab">fiasco</a></td>
<td class="org-left">optional</td>
</tr>

<tr>
<td class="org-left"><a href="#org3e895a0">fiveam</a></td>
<td class="org-left">optional (1)</td>
</tr>

<tr>
<td class="org-left"><a href="#orga50a995">lift</a></td>
<td class="org-left">never</td>
</tr>

<tr>
<td class="org-left"><a href="#orgc6e4266">lisp-unit</a></td>
<td class="org-left">never</td>
</tr>

<tr>
<td class="org-left"><a href="#orgb8996ba">lisp-unit2</a></td>
<td class="org-left">never</td>
</tr>

<tr>
<td class="org-left"><a href="#orga8cfe0a">nst</a></td>
<td class="org-left">Every test</td>
</tr>

<tr>
<td class="org-left"><a href="#orga8f69c2">parachute</a></td>
<td class="org-left">optional</td>
</tr>

<tr>
<td class="org-left"><a href="#orga7f8a83">prove</a></td>
<td class="org-left">Every assert</td>
</tr>

<tr>
<td class="org-left"><a href="#org52f36e5">ptester</a></td>
<td class="org-left">Every assert</td>
</tr>

<tr>
<td class="org-left"><a href="#org3d39ad7">rove</a></td>
<td class="org-left">Optional</td>
</tr>

<tr>
<td class="org-left"><a href="#org55cd3c7">rt</a></td>
<td class="org-left">Every test</td>
</tr>

<tr>
<td class="org-left"><a href="#org5279729">should-test</a></td>
<td class="org-left">Every assert</td>
</tr>

<tr>
<td class="org-left"><a href="#org209a1fe">simplet</a></td>
<td class="org-left">Every test</td>
</tr>

<tr>
<td class="org-left"><a href="#orgdc1cd10">tap-unit-test</a></td>
<td class="org-left">never</td>
</tr>

<tr>
<td class="org-left"><a href="#orgd9a48e8">try</a></td>
<td class="org-left">Optional (Every assert, every assert having an unexpected result, or none)</td>
</tr>

<tr>
<td class="org-left"><a href="#org4b187d6">unit-test</a></td>
<td class="org-left">Every test</td>
</tr>

<tr>
<td class="org-left"><a href="#orgea91eb1">xlunit</a></td>
<td class="org-left">never</td>
</tr>

<tr>
<td class="org-left"><a href="#org72de806">xptest</a></td>
<td class="org-left">never</td>
</tr>
</tbody>
</table>
<p>
(1) The following will allow fiveam to run without output
</p>
<div class="org-src-container">
<pre class="src src-lisp">(<span class="org-keyword">let</span> ((fiveam:*test-dribble*
        (make-broadcast-stream)))
  (fiveam:run! &#8230;))
</pre>
</div>
<p>
<a href="#org63aa282">top</a>
</p>
</div>
</div>

<div id="outline-container-org866989f" class="outline-3">
<h3 id="org866989f"><span class="section-number-3">5.7.</span> Skipping, Shuffling and Re-running</h3>
<div class="outline-text-3" id="text-5-7">
<p>
<a id="org0407563"></a><a id="orgffa8f80"></a>
</p>
<table border="2" rules="all" frame="border">
<caption class="t-above"><span class="table-number">Table 13:</span> Overview-2 Skipping, Shuffling and Rerunning Abilities</caption>

<colgroup>
<col  class="org-left">

<col  class="org-left">

<col  class="org-left">

<col  class="org-left">
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Name</th>
<th scope="col" class="org-left">Skip failing dependencies</th>
<th scope="col" class="org-left">Shuffle</th>
<th scope="col" class="org-left">Re-run only failed tests</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left"><a href="#orge4344cd">1am</a></td>
<td class="org-left">&#xa0;</td>
<td class="org-left">Y (auto)</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left"><a href="#org4a2ad7a">2am</a></td>
<td class="org-left">&#xa0;</td>
<td class="org-left">Y (auto)</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left"><a href="#org12efa6c">cacau</a></td>
<td class="org-left">S, T</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left"><a href="#org5eea657">clunit</a></td>
<td class="org-left">D</td>
<td class="org-left">Y (auto)</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left"><a href="#orge473393">clunit2</a></td>
<td class="org-left">D</td>
<td class="org-left">Y (auto)</td>
<td class="org-left">Y</td>
</tr>

<tr>
<td class="org-left"><a href="#org4b0d432">confidence</a></td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">Y</td>
</tr>

<tr>
<td class="org-left"><a href="#org53910ab">fiasco</a></td>
<td class="org-left">P(1), A</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">Y</td>
</tr>

<tr>
<td class="org-left"><a href="#org3e895a0">fiveam</a></td>
<td class="org-left">P(2)</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">(3)</td>
</tr>

<tr>
<td class="org-left"><a href="#org8d88b5e">gigamonkeys</a></td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left"><a href="#orga50a995">lift</a></td>
<td class="org-left">T</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left"><a href="#orgc6e4266">lisp-unit</a></td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left"><a href="#orgb8996ba">lisp-unit2</a></td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">Y</td>
</tr>

<tr>
<td class="org-left"><a href="#orga8cfe0a">nst</a></td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left"><a href="#orga8f69c2">parachute</a></td>
<td class="org-left">D, C, P</td>
<td class="org-left">Y</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left"><a href="#orga7f8a83">prove</a></td>
<td class="org-left">(4)</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left"><a href="#org52f36e5">ptester</a></td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left"><a href="#org3d39ad7">rove</a></td>
<td class="org-left">A</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left"><a href="#org55cd3c7">rt</a></td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left"><a href="#org5279729">should-test</a></td>
<td class="org-left">&#xa0;</td>
<td class="org-left">N</td>
<td class="org-left">Y</td>
</tr>

<tr>
<td class="org-left"><a href="#org209a1fe">simplet</a></td>
<td class="org-left">P</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left"><a href="#orgdc1cd10">tap-unit-test</a></td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left"><a href="#orgd9a48e8">try</a></td>
<td class="org-left">S,T.A</td>
<td class="org-left">Y</td>
<td class="org-left">Y</td>
</tr>

<tr>
<td class="org-left"><a href="#org4b187d6">unit-test</a></td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left"><a href="#orgea91eb1">xlunit</a></td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left"><a href="#org72de806">xptest</a></td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>
</tbody>
</table>
<p>
D - failing dependencies, C - children, P - pending, S - suites, T - tests, A - assertions
</p>
<ol class="org-ol">
<li>skip based on conditions when and skip-unless</li>
<li>skip when specified</li>
<li>run! returns a list of failed-test-results that you could save and use for this purpose</li>
<li>Prove can skip a specified number of tests using the skip function. Unfortunately it marks them as passed rather than skipped.</li>
</ol>
<p>
<a id="orgbd69a48"></a>
</p>
</div>
</div>

<div id="outline-container-orgcfa75d2" class="outline-3">
<h3 id="orgcfa75d2"><span class="section-number-3">5.8.</span> Timing Reporting and Time Limits</h3>
<div class="outline-text-3" id="text-5-8">
<table border="2" rules="all" frame="border">
<caption class="t-above"><span class="table-number">Table 14:</span> Timing Reporting and Time Limits</caption>

<colgroup>
<col  class="org-left">

<col  class="org-left">

<col  class="org-left">
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Library</th>
<th scope="col" class="org-left">Time Reporting</th>
<th scope="col" class="org-left">Time Limits</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left"><a href="#orge4344cd">1am</a></td>
<td class="org-left">N</td>
<td class="org-left">N</td>
</tr>

<tr>
<td class="org-left"><a href="#org4a2ad7a">2am</a> (not in quicklisp)</td>
<td class="org-left">N</td>
<td class="org-left">N</td>
</tr>

<tr>
<td class="org-left"><a href="#org12efa6c">cacau</a></td>
<td class="org-left">N</td>
<td class="org-left">Y(T or S)</td>
</tr>

<tr>
<td class="org-left"><a href="#org5eea657">clunit</a></td>
<td class="org-left">N</td>
<td class="org-left">N</td>
</tr>

<tr>
<td class="org-left"><a href="#orge473393">clunit2</a></td>
<td class="org-left">N</td>
<td class="org-left">N</td>
</tr>

<tr>
<td class="org-left"><a href="#org4b0d432">confidence</a></td>
<td class="org-left">N</td>
<td class="org-left">N</td>
</tr>

<tr>
<td class="org-left"><a href="#org53910ab">fiasco</a></td>
<td class="org-left">N</td>
<td class="org-left">N</td>
</tr>

<tr>
<td class="org-left"><a href="#org3e895a0">fiveam</a> (a)</td>
<td class="org-left">?</td>
<td class="org-left">N</td>
</tr>

<tr>
<td class="org-left"><a href="#org8d88b5e">gigamonkeys</a></td>
<td class="org-left">N</td>
<td class="org-left">N</td>
</tr>

<tr>
<td class="org-left"><a href="#orga50a995">lift</a></td>
<td class="org-left">Y</td>
<td class="org-left">Y</td>
</tr>

<tr>
<td class="org-left"><a href="#orgc6e4266">lisp-unit</a></td>
<td class="org-left">Y</td>
<td class="org-left">N</td>
</tr>

<tr>
<td class="org-left"><a href="#orgb8996ba">lisp-unit2</a></td>
<td class="org-left">Y</td>
<td class="org-left">N</td>
</tr>

<tr>
<td class="org-left"><a href="#orga8cfe0a">nst</a></td>
<td class="org-left">Y</td>
<td class="org-left">Y</td>
</tr>

<tr>
<td class="org-left"><a href="#orga8f69c2">parachute</a></td>
<td class="org-left">Y</td>
<td class="org-left">Y</td>
</tr>

<tr>
<td class="org-left"><a href="#orga7f8a83">prove</a></td>
<td class="org-left">N</td>
<td class="org-left">Y</td>
</tr>

<tr>
<td class="org-left"><a href="#org52f36e5">ptester</a></td>
<td class="org-left">N</td>
<td class="org-left">N</td>
</tr>

<tr>
<td class="org-left"><a href="#org3d39ad7">rove</a></td>
<td class="org-left">N</td>
<td class="org-left">N</td>
</tr>

<tr>
<td class="org-left"><a href="#org55cd3c7">rt</a></td>
<td class="org-left">N</td>
<td class="org-left">N</td>
</tr>

<tr>
<td class="org-left"><a href="#org5279729">should-test</a></td>
<td class="org-left">N</td>
<td class="org-left">N</td>
</tr>

<tr>
<td class="org-left"><a href="#orgdc1cd10">tap-unit-test</a></td>
<td class="org-left">Y</td>
<td class="org-left">N</td>
</tr>

<tr>
<td class="org-left"><a href="#orgd9a48e8">try</a></td>
<td class="org-left">Y</td>
<td class="org-left">N</td>
</tr>

<tr>
<td class="org-left"><a href="#org4b187d6">unit-test</a></td>
<td class="org-left">N</td>
<td class="org-left">N</td>
</tr>

<tr>
<td class="org-left"><a href="#orgea91eb1">xlunit</a></td>
<td class="org-left">N</td>
<td class="org-left">N</td>
</tr>

<tr>
<td class="org-left"><a href="#org72de806">xptest</a></td>
<td class="org-left">N</td>
<td class="org-left">N</td>
</tr>
</tbody>
</table>
<p>
(a) Fiveam has some undocumented profiling capabilities that I did not look at
<a id="orga246252"></a>
</p>
</div>
</div>

<div id="outline-container-orgc23de65" class="outline-3">
<h3 id="orgc23de65"><span class="section-number-3">5.9.</span> Dribble and Output Streams</h3>
<div class="outline-text-3" id="text-5-9">
<table border="2" rules="all" frame="border">
<caption class="t-above"><span class="table-number">Table 15:</span> Dribble and Output Streams</caption>

<colgroup>
<col  class="org-left">

<col  class="org-left">

<col  class="org-left">
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Library</th>
<th scope="col" class="org-left">Dribble</th>
<th scope="col" class="org-left">output streams</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left"><a href="#orge4344cd">1am</a></td>
<td class="org-left">N</td>
<td class="org-left">S</td>
</tr>

<tr>
<td class="org-left"><a href="#org4a2ad7a">2am</a> (not in quicklisp)</td>
<td class="org-left">N</td>
<td class="org-left">S</td>
</tr>

<tr>
<td class="org-left"><a href="#org12efa6c">cacau</a></td>
<td class="org-left">N</td>
<td class="org-left">S</td>
</tr>

<tr>
<td class="org-left"><a href="#org5eea657">clunit</a></td>
<td class="org-left">N</td>
<td class="org-left">S</td>
</tr>

<tr>
<td class="org-left"><a href="#orge473393">clunit2</a></td>
<td class="org-left">N</td>
<td class="org-left"><code>*test-output-stream*</code></td>
</tr>

<tr>
<td class="org-left"><a href="#org4b0d432">confidence</a></td>
<td class="org-left">N</td>
<td class="org-left">optional parameter</td>
</tr>

<tr>
<td class="org-left"><a href="#org53910ab">fiasco</a></td>
<td class="org-left">N</td>
<td class="org-left">optional parameter</td>
</tr>

<tr>
<td class="org-left"><a href="#org3e895a0">fiveam</a></td>
<td class="org-left">Y  <code>*test-dribble*</code></td>
<td class="org-left">S</td>
</tr>

<tr>
<td class="org-left"><a href="#org8d88b5e">gigamonkeys</a></td>
<td class="org-left">N</td>
<td class="org-left">S</td>
</tr>

<tr>
<td class="org-left"><a href="#orga50a995">lift</a></td>
<td class="org-left">Y  <code>*lift-dribble-pathname*</code></td>
<td class="org-left">optional parameter</td>
</tr>

<tr>
<td class="org-left"><a href="#orgc6e4266">lisp-unit</a></td>
<td class="org-left">N</td>
<td class="org-left">optional parameter</td>
</tr>

<tr>
<td class="org-left"><a href="#orgb8996ba">lisp-unit2</a></td>
<td class="org-left">N</td>
<td class="org-left"><code>*test-stream*</code></td>
</tr>

<tr>
<td class="org-left"><a href="#orga8cfe0a">nst</a></td>
<td class="org-left">N</td>
<td class="org-left">optional parameter</td>
</tr>

<tr>
<td class="org-left"><a href="#orga8f69c2">parachute</a></td>
<td class="org-left">N</td>
<td class="org-left"><code>(setf output)</code></td>
</tr>

<tr>
<td class="org-left"><a href="#orga7f8a83">prove</a></td>
<td class="org-left">N</td>
<td class="org-left"><code>*test-result-output*</code></td>
</tr>

<tr>
<td class="org-left"><a href="#org52f36e5">ptester</a></td>
<td class="org-left">N</td>
<td class="org-left">S</td>
</tr>

<tr>
<td class="org-left"><a href="#org3d39ad7">rove</a></td>
<td class="org-left">N</td>
<td class="org-left"><code>*report-stream*</code></td>
</tr>

<tr>
<td class="org-left"><a href="#org55cd3c7">rt</a></td>
<td class="org-left">N</td>
<td class="org-left">optional parameter</td>
</tr>

<tr>
<td class="org-left"><a href="#org5279729">should-test</a></td>
<td class="org-left">N</td>
<td class="org-left"><code>*test-output*</code></td>
</tr>

<tr>
<td class="org-left"><a href="#orgdc1cd10">tap-unit-test</a></td>
<td class="org-left">N</td>
<td class="org-left">S</td>
</tr>

<tr>
<td class="org-left"><a href="#orgd9a48e8">try</a></td>
<td class="org-left">N</td>
<td class="org-left">optional parameter</td>
</tr>

<tr>
<td class="org-left"><a href="#org4b187d6">unit-test</a></td>
<td class="org-left">N</td>
<td class="org-left">S</td>
</tr>

<tr>
<td class="org-left"><a href="#orgea91eb1">xlunit</a></td>
<td class="org-left">N</td>
<td class="org-left">S</td>
</tr>

<tr>
<td class="org-left"><a href="#org72de806">xptest</a></td>
<td class="org-left">N</td>
<td class="org-left">S</td>
</tr>
</tbody>
</table>
<p>
Where S is <code>*standard-output*</code>
</p>
</div>
</div>

<div id="outline-container-orge998bf2" class="outline-3">
<h3 id="orge998bf2"><span class="section-number-3">5.10.</span> Edge Cases: Float Testing, Value Expressions and Closure Variables</h3>
<div class="outline-text-3" id="text-5-10">
<p>
<a href="#org63aa282">top</a>
<a id="org8ebbd4f"></a><a id="org841422f"></a><a id="org5a9b325"></a><a id="org48c1db0"></a>
This table is looking at whether the framework provides <a href="#org97dcb48">float equality tests</a>, looks at all the values coming from a values expression, and can access variables declared in a closure surrounding the test.
</p>
<table border="2" rules="all" frame="border">
<caption class="t-above"><span class="table-number">Table 16:</span> Edge Cases</caption>

<colgroup>
<col  class="org-left">

<col  class="org-left">

<col  class="org-left">

<col  class="org-left">
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Name</th>
<th scope="col" class="org-left">float tests</th>
<th scope="col" class="org-left">Handles value expressions</th>
<th scope="col" class="org-left">Variables in Closures</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left"><a href="#orge4344cd">1am</a></td>
<td class="org-left">&#xa0;</td>
<td class="org-left">First value only</td>
<td class="org-left">Y</td>
</tr>

<tr>
<td class="org-left"><a href="#org4a2ad7a">2am</a></td>
<td class="org-left">&#xa0;</td>
<td class="org-left">First value only</td>
<td class="org-left">Y</td>
</tr>

<tr>
<td class="org-left"><a href="#org12efa6c">cacau</a></td>
<td class="org-left">&#xa0;</td>
<td class="org-left">First value only</td>
<td class="org-left">Y</td>
</tr>

<tr>
<td class="org-left"><a href="#org5eea657">clunit</a></td>
<td class="org-left">&#xa0;</td>
<td class="org-left">First value only</td>
<td class="org-left">N</td>
</tr>

<tr>
<td class="org-left"><a href="#orge473393">clunit2</a> (a)</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">Y</td>
<td class="org-left">N</td>
</tr>

<tr>
<td class="org-left"><a href="#org4b0d432">confidence</a></td>
<td class="org-left">Y</td>
<td class="org-left">First value only</td>
<td class="org-left">Y</td>
</tr>

<tr>
<td class="org-left"><a href="#org53910ab">fiasco</a></td>
<td class="org-left">&#xa0;</td>
<td class="org-left">First value only</td>
<td class="org-left">Y</td>
</tr>

<tr>
<td class="org-left"><a href="#org3e895a0">fiveam</a></td>
<td class="org-left">&#xa0;</td>
<td class="org-left">N</td>
<td class="org-left">N</td>
</tr>

<tr>
<td class="org-left"><a href="#org8d88b5e">gigamonkeys</a></td>
<td class="org-left">&#xa0;</td>
<td class="org-left">First value only</td>
<td class="org-left">Y</td>
</tr>

<tr>
<td class="org-left"><a href="#orga50a995">lift</a></td>
<td class="org-left">&#xa0;</td>
<td class="org-left">First value only</td>
<td class="org-left">N</td>
</tr>

<tr>
<td class="org-left"><a href="#orgc6e4266">lisp-unit</a></td>
<td class="org-left">Y</td>
<td class="org-left">Y</td>
<td class="org-left">N</td>
</tr>

<tr>
<td class="org-left"><a href="#orgb8996ba">lisp-unit2</a></td>
<td class="org-left">Y</td>
<td class="org-left">Y</td>
<td class="org-left">N</td>
</tr>

<tr>
<td class="org-left"><a href="#orga8cfe0a">nst</a></td>
<td class="org-left">&#xa0;</td>
<td class="org-left">Y</td>
<td class="org-left">N</td>
</tr>

<tr>
<td class="org-left"><a href="#orga8f69c2">parachute</a></td>
<td class="org-left">&#xa0;</td>
<td class="org-left">Y</td>
<td class="org-left">Y</td>
</tr>

<tr>
<td class="org-left"><a href="#orga7f8a83">prove</a></td>
<td class="org-left">&#xa0;</td>
<td class="org-left">Y</td>
<td class="org-left">Y</td>
</tr>

<tr>
<td class="org-left"><a href="#org52f36e5">ptester</a></td>
<td class="org-left">&#xa0;</td>
<td class="org-left">First value only</td>
<td class="org-left">Y</td>
</tr>

<tr>
<td class="org-left"><a href="#org3d39ad7">rove</a></td>
<td class="org-left">&#xa0;</td>
<td class="org-left">First value only</td>
<td class="org-left">Y</td>
</tr>

<tr>
<td class="org-left"><a href="#org55cd3c7">rt</a></td>
<td class="org-left">&#xa0;</td>
<td class="org-left">N</td>
<td class="org-left">N</td>
</tr>

<tr>
<td class="org-left"><a href="#org5279729">should-test</a></td>
<td class="org-left">&#xa0;</td>
<td class="org-left">First value only</td>
<td class="org-left">N</td>
</tr>

<tr>
<td class="org-left"><a href="#orgdc1cd10">tap-unit-test</a></td>
<td class="org-left">&#xa0;</td>
<td class="org-left">Y</td>
<td class="org-left">N</td>
</tr>

<tr>
<td class="org-left"><a href="#orgd9a48e8">[try</a></td>
<td class="org-left">Y</td>
<td class="org-left">Y</td>
<td class="org-left">Y</td>
</tr>

<tr>
<td class="org-left"><a href="#org4b187d6">unit-test</a></td>
<td class="org-left">&#xa0;</td>
<td class="org-left">First value only</td>
<td class="org-left">Y</td>
</tr>

<tr>
<td class="org-left"><a href="#orgea91eb1">xlunit</a></td>
<td class="org-left">&#xa0;</td>
<td class="org-left">First value only</td>
<td class="org-left">Y</td>
</tr>

<tr>
<td class="org-left"><a href="#org72de806">xptest</a></td>
<td class="org-left">&#xa0;</td>
<td class="org-left">relies on CL predicates</td>
<td class="org-left">Y</td>
</tr>
</tbody>
</table>
<p>
(a) Updated 13 June 2021
</p>

<p>
<a href="#org63aa282">top</a>
</p>
</div>
</div>

<div id="outline-container-org3461a1e" class="outline-3">
<h3 id="org3461a1e"><span class="section-number-3">5.11.</span> Compatibility and Customizable Assertions</h3>
<div class="outline-text-3" id="text-5-11">
<table border="2" rules="all" frame="border">
<caption class="t-above"><span class="table-number">Table 17:</span> Overview-4 Misc</caption>

<colgroup>
<col  class="org-left">

<col  class="org-left">

<col  class="org-left">
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Name</th>
<th scope="col" class="org-left">compatibility layers</th>
<th scope="col" class="org-left">Customizeable Assertion Functions</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left"><a href="#org12efa6c">cacau</a></td>
<td class="org-left">&#xa0;</td>
<td class="org-left">Y</td>
</tr>

<tr>
<td class="org-left"><a href="#org4b0d432">confidence</a></td>
<td class="org-left">&#xa0;</td>
<td class="org-left">Y</td>
</tr>

<tr>
<td class="org-left"><a href="#orga8f69c2">parachute</a></td>
<td class="org-left"><a href="#org3e895a0">fiveam</a> lisp-unit prove</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left"><a href="#orga8cfe0a">nst</a></td>
<td class="org-left">&#xa0;</td>
<td class="org-left">Y</td>
</tr>
</tbody>
</table>

<p>
(a) Running suites without tests or tests without test functions will result in tests marked PENDING rather than success or fail
</p>
</div>
</div>

<div id="outline-container-orgb75a1d5" class="outline-3">
<h3 id="orgb75a1d5"><span class="section-number-3">5.12.</span> Claims Not Test</h3>
<div class="outline-text-3" id="text-5-12">
<p>
<a id="orgc7f2fa6"></a>
</p>
<table border="2" rules="all" frame="border">
<caption class="t-above"><span class="table-number">Table 18:</span> Overview-5 Claims Not Tested</caption>

<colgroup>
<col  class="org-left">

<col  class="org-left">

<col  class="org-left">

<col  class="org-left">
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Name</th>
<th scope="col" class="org-left">Async</th>
<th scope="col" class="org-left">Thread Ready</th>
<th scope="col" class="org-left">Package Inferred</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left"><a href="#orge4344cd">1am</a></td>
<td class="org-left">&#xa0;</td>
<td class="org-left">X</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left"><a href="#org4a2ad7a">2am</a></td>
<td class="org-left">&#xa0;</td>
<td class="org-left">X</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left"><a href="#org12efa6c">Cacau</a></td>
<td class="org-left">X</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left"><a href="#org3d39ad7">Rove</a></td>
<td class="org-left">&#xa0;</td>
<td class="org-left">X  (1)</td>
<td class="org-left">X</td>
</tr>
</tbody>
</table>
<p>
(1) Tycho Garen reported in February 2021 that "Rove doesn't seem to work when multi-threaded results effectively. It's listed in the readme, but I was able to write really trivial tests that crashed the test harness."
</p>

<p>
<a href="#org63aa282">top</a>
<a id="orga8083e9"></a> <a id="org7de1056"></a>
</p>
</div>
</div>
</div>

<div id="outline-container-org9ee3c43" class="outline-2">
<h2 id="org9ee3c43"><span class="section-number-2">6.</span> Assertion Failure Comments</h2>
<div class="outline-text-2" id="text-6">
<p>
There are two reasons you test. First, to pat yourself on the back when all test pass. Second, to find any bugs. Assertions in the test frameworks have different amounts of automatically generated information that they will provide on failures. The following are the automatically generated failure messages on an assertion that (= x y) where x is 1 and y is 2. We also note whether the framework also accepts diagnostic strings and variables for those strings.
</p>
</div>

<div id="outline-container-org0301039" class="outline-3">
<h3 id="org0301039"><span class="section-number-3">6.1.</span> <a href="#orge4344cd">1am</a></h3>
<div class="outline-text-3" id="text-6-1">
<p>
What, you wanted a report? Let me introduce you to the debugger.
</p>
</div>
</div>

<div id="outline-container-org01bc113" class="outline-3">
<h3 id="org01bc113"><span class="section-number-3">6.2.</span> <a href="#org4a2ad7a">2am</a></h3>
<div class="outline-text-3" id="text-6-2">
<p>
Assertions also accept diagnostic strings with variables
</p>
<div class="org-src-container">
<pre class="src src-lisp">T1-FAIL-34:
FAIL: (= X Y)
</pre>
</div>
</div>
</div>

<div id="outline-container-org2c5b923" class="outline-3">
<h3 id="org2c5b923"><span class="section-number-3">6.3.</span> <a href="#org12efa6c">cacau</a></h3>
<div class="outline-text-3" id="text-6-3">
<div class="org-src-container">
<pre class="src src-lisp">Error message:
BIT EQUAL (INTEGER 0 4611686018427387903)
Actual:
1
Expected:
2
</pre>
</div>
</div>
</div>

<div id="outline-container-org922dfa0" class="outline-3">
<h3 id="org922dfa0"><span class="section-number-3">6.4.</span> <a href="#org5eea657">clunit</a> and <a href="#orge473393">clunit2</a></h3>
<div class="outline-text-3" id="text-6-4">
<p>
Assertions also accept diagnostic strings with variables
</p>
<div class="org-src-container">
<pre class="src src-lisp">T1-FAIL-34: Expression: (= X Y)
Expected: T
Returned: NIL
</pre>
</div>
</div>
</div>

<div id="outline-container-orgff63093" class="outline-3">
<h3 id="orgff63093"><span class="section-number-3">6.5.</span> <a href="#org53910ab">fiasco</a></h3>
<div class="outline-text-3" id="text-6-5">
<p>
Assertions also accept diagnostic strings with variables
</p>
<div class="org-src-container">
<pre class="src src-lisp">Failure 1: FAILED-ASSERTION when running T1-FAIL
Binary predicate (= X Y) failed.
x: X =&gt; 1
y: Y =&gt; 2
</pre>
</div>
</div>
</div>

<div id="outline-container-orga3ff291" class="outline-3">
<h3 id="orga3ff291"><span class="section-number-3">6.6.</span> <a href="#org3e895a0">fiveam</a></h3>
<div class="outline-text-3" id="text-6-6">
<p>
Assertions also accept diagnostic strings with variables. I deleted several blank lines. Why do you waste so much screen space Fiveam?
</p>
<div class="org-src-container">
<pre class="src src-lisp">T1-FAIL-34 []:
Y
evaluated to
2
which is not
=
to
1
</pre>
</div>
</div>
</div>

<div id="outline-container-orgda57e13" class="outline-3">
<h3 id="orgda57e13"><span class="section-number-3">6.7.</span> <a href="#org8d88b5e">gigamonkeys</a></h3>
<div class="outline-text-3" id="text-6-7">
<div class="org-src-container">
<pre class="src src-lisp">FAIL ... (T1-FAIL): (= X Y)
X                 =&gt; 1
Y                 =&gt; 2
(= X Y)           =&gt; NIL
</pre>
</div>
</div>
</div>

<div id="outline-container-org873562c" class="outline-3">
<h3 id="org873562c"><span class="section-number-3">6.8.</span> <a href="#org4b0d432">confidence</a></h3>
<div class="outline-text-3" id="text-6-8">
<p>
Into the debugger you never go.
</p>
<div class="org-src-container">
<pre class="src src-lisp"> Test assertion failed:
  (<span class="org-warning">ASSERT-T</span> (= X Y))
In this call, the composed forms in argument position evaluate as:
  (= X Y) =&gt; NIL
The assertion (<span class="org-warning">ASSERT-T</span> EXPR) is true, iff EXPR is a true generalised boolean.
</pre>
</div>
</div>
</div>

<div id="outline-container-orgcb097da" class="outline-3">
<h3 id="orgcb097da"><span class="section-number-3">6.9.</span> <a href="#orga50a995">lift</a></h3>
<div class="outline-text-3" id="text-6-9">
<p>
Assertions also accept diagnostic strings with variables
</p>
<div class="org-src-container">
<pre class="src src-lisp">Failure: s0 : t1-fail-34
Documentation: NIL
Source       : NIL
Condition    : Ensure failed: (= X Y) ()
During       : (END-TEST)
Code         : (
                ((<span class="org-keyword">LET</span> ((X 1) (Y 2))
                   (ENSURE (= X Y)))))
</pre>
</div>
</div>
</div>

<div id="outline-container-org36dc64a" class="outline-3">
<h3 id="org36dc64a"><span class="section-number-3">6.10.</span> <a href="#orgc6e4266">lisp-unit</a></h3>
<div class="outline-text-3" id="text-6-10">
<p>
Assertions also accept diagnostic strings but no variables
</p>
<div class="org-src-container">
<pre class="src src-lisp">Failed Form: (= X Y)
 | Expected T but saw NIL
 | X =&gt; 1
 | Y =&gt; 2
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc88162d" class="outline-3">
<h3 id="orgc88162d"><span class="section-number-3">6.11.</span> <a href="#orgb8996ba">lisp-unit2</a></h3>
<div class="outline-text-3" id="text-6-11">
<p>
Assertions also accept diagnostic strings but no variables
</p>
<div class="org-src-container">
<pre class="src src-lisp">| FAILED (1)
 | Failed Form: (<span class="org-warning">ASSERT-TRUE</span> (= X Y))
 | Expected T
 | but saw NIL
</pre>
</div>
</div>
</div>

<div id="outline-container-org12a8da6" class="outline-3">
<h3 id="org12a8da6"><span class="section-number-3">6.12.</span> <a href="#orga8f69c2">parachute</a></h3>
<div class="outline-text-3" id="text-6-12">
<p>
Assertions also accept diagnostic strings with variables
</p>
<div class="org-src-container">
<pre class="src src-lisp">test 't1-fail-34)
        &#65311; TF-PARACHUTE::T1-FAIL-34
  0.000 &#10008;   (is = x y)
  0.010 &#10008; TF-PARACHUTE::T1-FAIL-34

<span class="org-comment-delimiter">;; </span><span class="org-comment">Failures:</span>
   1/   1 tests failed in TF-PARACHUTE::T1-FAIL-34
The test form   y
evaluated to    2
when            1
was expected to be equal under =.
</pre>
</div>
</div>
</div>

<div id="outline-container-org964cf7f" class="outline-3">
<h3 id="org964cf7f"><span class="section-number-3">6.13.</span> <a href="#org52f36e5">ptester</a></h3>
<div class="outline-text-3" id="text-6-13">
<div class="org-src-container">
<pre class="src src-lisp">Test failed: Y
  wanted: 1
     got: 2
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd019601" class="outline-3">
<h3 id="orgd019601"><span class="section-number-3">6.14.</span> <a href="#orga7f8a83">prove</a></h3>
<div class="outline-text-3" id="text-6-14">
<p>
Assertions also accept diagnostic strings but no variables
</p>
<div class="org-src-container">
<pre class="src src-lisp">&#215; NIL is expected to be T (prove)
</pre>
</div>
</div>
</div>

<div id="outline-container-orga11ce63" class="outline-3">
<h3 id="orga11ce63"><span class="section-number-3">6.15.</span> <a href="#org3d39ad7">rove</a></h3>
<div class="outline-text-3" id="text-6-15">
<p>
Assertions also accept diagnostic strings but no variables
</p>
<div class="org-src-container">
<pre class="src src-lisp">(EQUAL X Y) (rove)
X = 1
Y = 2
</pre>
</div>
</div>
</div>

<div id="outline-container-org1e62a61" class="outline-3">
<h3 id="org1e62a61"><span class="section-number-3">6.16.</span> <a href="#org55cd3c7">rt</a></h3>
<div class="outline-text-3" id="text-6-16">
<div class="org-src-container">
<pre class="src src-lisp">Form: (<span class="org-keyword">LET</span> ((X 1) (Y 2))
        (= X Y))
Expected value: T
Actual value: NIL.
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb0d56b5" class="outline-3">
<h3 id="orgb0d56b5"><span class="section-number-3">6.17.</span> <a href="#org5279729">should-test</a></h3>
<div class="outline-text-3" id="text-6-17">
<p>
Assertions also accept diagnostic strings but no variables
</p>
<div class="org-src-container">
<pre class="src src-lisp">Test T1-FAIL-34:
Y FAIL
expect: 1
actual: 2
FAILED
</pre>
</div>
</div>
</div>

<div id="outline-container-org25395ee" class="outline-3">
<h3 id="org25395ee"><span class="section-number-3">6.18.</span> <a href="#orgdc1cd10">tap-unit-test</a></h3>
<div class="outline-text-3" id="text-6-18">
<p>
Assertions also accept diagnostic strings but no variables
</p>
<div class="org-src-container">
<pre class="src src-lisp">T1-FAIL-34: (= X Y) failed:
Expected T but saw NIL
</pre>
</div>
</div>
</div>
<div id="outline-container-org33f129d" class="outline-3">
<h3 id="org33f129d"><span class="section-number-3">6.19.</span> <a href="#orgd9a48e8">try</a></h3>
<div class="outline-text-3" id="text-6-19">
<div class="org-src-container">
<pre class="src src-lisp">(deftest t1-fail ()
  (<span class="org-keyword">let</span> ((x 1) (y 2))
   (is (equal 1 2))
    (is (= x y)
        <span class="org-builtin">:msg</span> <span class="org-string">"Intentional failure x does not equal y"</span>
        <span class="org-builtin">:ctx</span> (<span class="org-string">"*PACKAGE* is ~S and *PRINT-CASE* is ~S~%"</span>
             *package* *print-case*))))

  (try 't1-fail <span class="org-builtin">:print</span> 'unexpected)
T1-FAIL
  &#8864; (IS (EQUAL 1 2))
  &#8864; Intentional failure x does not equal y
    where
      X = 1
      Y = 2
    *PACKAGE* is #&lt;PACKAGE <span class="org-string">"UAX-15-TRY-TESTS"</span>&gt; and *PRINT-CASE* is <span class="org-builtin">:UPCASE</span>

&#8864; T1-FAIL &#8864;2
#&lt;TRIAL (T1-FAIL) UNEXPECTED-FAILURE 0.000s &#8864;2&gt;

</pre>
</div>
</div>
</div>

<div id="outline-container-org86a9ea6" class="outline-3">
<h3 id="org86a9ea6"><span class="section-number-3">6.20.</span> <a href="#org4b187d6">unit-test</a></h3>
<div class="outline-text-3" id="text-6-20">
<p>
Assertions also accept diagnostic strings but no variables
</p>
<div class="org-src-container">
<pre class="src src-lisp">(#&lt;TEST-EQUAL-RESULT FORM: (= X Y) STATUS: FAIL REASON: NIL&gt;)
</pre>
</div>

<p>
<a href="#org63aa282">top</a>
</p>

<p>
<a id="orgf24d57d"></a>
</p>
</div>
</div>
</div>

<div id="outline-container-orgec20ed4" class="outline-2">
<h2 id="orgec20ed4"><span class="section-number-2">7.</span> Benchmarking</h2>
<div class="outline-text-2" id="text-7">
<p>
<a id="orgd9ad157"></a>
</p>

<p>
First some points about what I have discovered about benchmarking these frameworks:
</p>

<ol class="org-ol">
<li>In general, functionality and comfort will drive your framework decision not benchmarks.</li>

<li><p>
That said, bad benchmarks can say one of four things:
</p>

<p>
a. I did not fully understand the best way to use the framework. As an example, my first naive version of the test for <a href="#org4b0d432">confidence</a> had a runtime of 742 seconds. The author showed me how to rewrite the tests and it dropped to 24 seconds. This could very well be the explanation for the bad results of <a href="#orga8cfe0a">nst</a>. (If someone experienced with nst would like to re-write that benchmark test, please let me know.)
</p>

<p>
b. There is a problem in the framework code. The author of <a href="#orge473393">clunit2</a> cut the run time from the original runtime of 600 seconds to 14 seconds.
</p>

<p>
c. If your framework reports using what emacs thinks is long lines, run the tests in a terminal, do not run it in an emacs repl. As an example, fiveam's runtime was 10 seconds, but real-time (total time to get a result in the emacs repl was 37 minutes).
</p>

<p>
d. There might be something of interest for the SBCL and CCL developers. See, e.g. the wildly different result between the results for try and prove.
</p></li>
</ol>

<p>
The benchmarks are based on a regression test, not development or functional testing. All the benchmark times below were done in a terminal window with SBCL version 2.3.0 and CCL version 1.12.1 on a linux server. I tried to rewrite the tests for <a href="https://github.com/sabracrolleton/uax-15">UAX-15</a> for each framework. The uax-15 tests have 16 separate tests with a total of 343332 assertions (all of which pass) and the assertions are all straight-forward. The tests were stripped to the minimum. No diagnostic strings were used. For the frameworks which allowed it, the test was set to no progress reporting and overall summary only. Trivial-benchmark was used with 10 repetitions for each test. (Since Cacau does not run tests again unless they are recompiled, I have multiplied a single run by 10 to get some kind of comparable.)
</p>

<p>
Since all of the assertions pass, any real world test with failing assertions generating failure reports will be different.
</p>

<p>
Unsurprisingly, the simplest frameworks were the fastest. Your context will be important as to whether these benchmarks are at all meaningful to you.
</p>

<p>
<a id="orgaa2c5e2"></a>
</p>
</div>
<div id="outline-container-org49fcfb2" class="outline-3">
<h3 id="org49fcfb2"><span class="section-number-3">7.1.</span> Stack Ranking</h3>
<div class="outline-text-3" id="text-7-1">
<p>
Considering that the benchmark is based on 10 test runs of 16 tests with 343332 passing assertions (3433320 total assertions, 160 tests), test speed on regression tests are not going to drive your decision.  Development and functional testing will obviously have a different result.
</p>


<table border="2" rules="all" frame="border">
<caption class="t-above"><span class="table-number">Table 19:</span> Summary of Regression Test Benchmark (lower is better) (updated 16 Jan 2023</caption>

<colgroup>
<col  class="org-left">

<col  class="org-right">

<col  class="org-right">
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Library</th>
<th scope="col" class="org-right">SBCL RunTime</th>
<th scope="col" class="org-right">CCL Runtime</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left"><a href="#org72de806">xptest</a></td>
<td class="org-right">5.8903</td>
<td class="org-right">11.7284</td>
</tr>

<tr>
<td class="org-left"><a href="#orgea91eb1">xlunit</a></td>
<td class="org-right">5.9102</td>
<td class="org-right">11.7532</td>
</tr>

<tr>
<td class="org-left"><a href="#org12efa6c">cacau</a></td>
<td class="org-right">6.0173</td>
<td class="org-right">11.6543</td>
</tr>

<tr>
<td class="org-left"><a href="#orga50a995">lift</a></td>
<td class="org-right">6.0686</td>
<td class="org-right">11.9706</td>
</tr>

<tr>
<td class="org-left"><a href="#orge4344cd">1am</a></td>
<td class="org-right">6.1541</td>
<td class="org-right">13.6843</td>
</tr>

<tr>
<td class="org-left"><a href="#org52f36e5">ptester</a></td>
<td class="org-right">6.2000</td>
<td class="org-right">12.5130</td>
</tr>

<tr>
<td class="org-left"><a href="#org55cd3c7">rt</a></td>
<td class="org-right">6.2079</td>
<td class="org-right">11.9097</td>
</tr>

<tr>
<td class="org-left"><a href="#org4a2ad7a">2am</a></td>
<td class="org-right">6.2408</td>
<td class="org-right">14.0614</td>
</tr>

<tr>
<td class="org-left"><a href="#org4b187d6">unit-test</a></td>
<td class="org-right">6.3616</td>
<td class="org-right">17.6696</td>
</tr>

<tr>
<td class="org-left"><a href="#orgdc1cd10">tap-unit-test</a></td>
<td class="org-right">6.9988</td>
<td class="org-right">13.2284</td>
</tr>

<tr>
<td class="org-left"><a href="#orgc6e4266">lisp-unit</a></td>
<td class="org-right">7.1250</td>
<td class="org-right">13.4544</td>
</tr>

<tr>
<td class="org-left"><a href="#org5279729">should-test</a></td>
<td class="org-right">7.1710</td>
<td class="org-right">25.1831</td>
</tr>

<tr>
<td class="org-left"><a href="#org8d88b5e">gigamonkeys</a></td>
<td class="org-right">7.8872</td>
<td class="org-right">30.7511</td>
</tr>

<tr>
<td class="org-left"><a href="#org53910ab">fiasco</a></td>
<td class="org-right">8.8940</td>
<td class="org-right">38.4574</td>
</tr>

<tr>
<td class="org-left"><a href="#orgb8996ba">lisp-unit2</a></td>
<td class="org-right">9.2966</td>
<td class="org-right">30.2440</td>
</tr>

<tr>
<td class="org-left"><a href="#orga8f69c2">parachute</a></td>
<td class="org-right">9.9155</td>
<td class="org-right">40.3792</td>
</tr>

<tr>
<td class="org-left"><a href="#org3e895a0">fiveam</a></td>
<td class="org-right">10.1231</td>
<td class="org-right">19.1292</td>
</tr>

<tr>
<td class="org-left"><a href="#org3d39ad7">rove</a></td>
<td class="org-right">11.8615</td>
<td class="org-right">35.8269</td>
</tr>

<tr>
<td class="org-left"><a href="#org0760669">cardiogram</a></td>
<td class="org-right">13.3693</td>
<td class="org-right">29.2526</td>
</tr>

<tr>
<td class="org-left"><a href="#orge473393">clunit2</a></td>
<td class="org-right">14.3416</td>
<td class="org-right">35.9992</td>
</tr>

<tr>
<td class="org-left"><a href="#orgd9a48e8">try</a></td>
<td class="org-right">14.6188</td>
<td class="org-right">177.8841</td>
</tr>

<tr>
<td class="org-left"><a href="#org4b0d432">confidence</a></td>
<td class="org-right">24.7286</td>
<td class="org-right">56.8546</td>
</tr>

<tr>
<td class="org-left"><a href="#orga7f8a83">prove</a></td>
<td class="org-right">30.5618</td>
<td class="org-right">132.1456</td>
</tr>

<tr>
<td class="org-left"><a href="#orga8cfe0a">nst</a></td>
<td class="org-right">517.8853</td>
<td class="org-right">500.4885</td>
</tr>
</tbody>
</table>

<table border="2" rules="all" frame="border">
<caption class="t-above"><span class="table-number">Table 20:</span> Order by Benchmark Bytes Consed (lower is better)</caption>

<colgroup>
<col  class="org-left">

<col  class="org-right">
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Library</th>
<th scope="col" class="org-right">Bytes Consed</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left"><a href="#org4a2ad7a">2am</a> (not in quicklisp)</td>
<td class="org-right">3361006176</td>
</tr>

<tr>
<td class="org-left"><a href="#orge4344cd">1am</a></td>
<td class="org-right">3361283232</td>
</tr>

<tr>
<td class="org-left"><a href="#org72de806">xptest</a></td>
<td class="org-right">3363654192</td>
</tr>

<tr>
<td class="org-left"><a href="#orgea91eb1">xlunit</a></td>
<td class="org-right">3367157968</td>
</tr>

<tr>
<td class="org-left"><a href="#org12efa6c">cacau</a></td>
<td class="org-right">3383879200</td>
</tr>

<tr>
<td class="org-left"><a href="#orga50a995">lift</a></td>
<td class="org-right">3480602800</td>
</tr>

<tr>
<td class="org-left"><a href="#org55cd3c7">rt</a></td>
<td class="org-right">3586779376</td>
</tr>

<tr>
<td class="org-left"><a href="#org4b187d6">unit-test</a></td>
<td class="org-right">3668546192</td>
</tr>

<tr>
<td class="org-left"><a href="#org52f36e5">ptester</a></td>
<td class="org-right">3690505472</td>
</tr>

<tr>
<td class="org-left"><a href="#org5279729">should-test</a></td>
<td class="org-right">3859488496</td>
</tr>

<tr>
<td class="org-left"><a href="#org0760669">cardiogram</a></td>
<td class="org-right">3965584752</td>
</tr>

<tr>
<td class="org-left"><a href="#org53910ab">fiasco</a></td>
<td class="org-right">4077786880</td>
</tr>

<tr>
<td class="org-left"><a href="#orgdc1cd10">tap-unit-test</a></td>
<td class="org-right">4217541312</td>
</tr>

<tr>
<td class="org-left"><a href="#orgc6e4266">lisp-unit</a></td>
<td class="org-right">4222413456</td>
</tr>

<tr>
<td class="org-left"><a href="#org4b0d432">confidence</a></td>
<td class="org-right">4338353600</td>
</tr>

<tr>
<td class="org-left"><a href="#org3e895a0">fiveam</a></td>
<td class="org-right">4512244000</td>
</tr>

<tr>
<td class="org-left"><a href="#org742132c">com.gigamonkeys.test-framework</a></td>
<td class="org-right">4788180016</td>
</tr>

<tr>
<td class="org-left"><a href="#orgb8996ba">lisp-unit2</a></td>
<td class="org-right">4939787968</td>
</tr>

<tr>
<td class="org-left"><a href="#org5eea657">clunit</a></td>
<td class="org-right">5262303120</td>
</tr>

<tr>
<td class="org-left"><a href="#orga8f69c2">parachute</a></td>
<td class="org-right">5212345824</td>
</tr>

<tr>
<td class="org-left"><a href="#org3d39ad7">rove</a></td>
<td class="org-right">7427051216</td>
</tr>

<tr>
<td class="org-left"><a href="#orgd9a48e8">try</a></td>
<td class="org-right">9019833552</td>
</tr>

<tr>
<td class="org-left"><a href="#orge473393">clunit2</a> (a)</td>
<td class="org-right">15407395920</td>
</tr>

<tr>
<td class="org-left"><a href="#orga7f8a83">prove</a></td>
<td class="org-right">14018185696</td>
</tr>

<tr>
<td class="org-left"><a href="#orge473393">clunit2</a> (b)</td>
<td class="org-right">15377667616</td>
</tr>

<tr>
<td class="org-left"><a href="#orga8cfe0a">nst</a></td>
<td class="org-right">306684151680</td>
</tr>
</tbody>
</table>


<table border="2" rules="all" frame="border">
<caption class="t-above"><span class="table-number">Table 21:</span> Order by Benchmark Eval calls (lower is better)</caption>

<colgroup>
<col  class="org-left">

<col  class="org-right">
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Library</th>
<th scope="col" class="org-right">Eval Calls</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left"><a href="#orge4344cd">1am</a></td>
<td class="org-right">0</td>
</tr>

<tr>
<td class="org-left"><a href="#org12efa6c">cacau</a></td>
<td class="org-right">0</td>
</tr>

<tr>
<td class="org-left"><a href="#org742132c">com.gigamonkeys.test-framework</a></td>
<td class="org-right">0</td>
</tr>

<tr>
<td class="org-left"><a href="#org3e895a0">fiveam</a></td>
<td class="org-right">0</td>
</tr>

<tr>
<td class="org-left"><a href="#org4b0d432">confidence</a></td>
<td class="org-right">0</td>
</tr>

<tr>
<td class="org-left"><a href="#orga50a995">lift</a></td>
<td class="org-right">0</td>
</tr>

<tr>
<td class="org-left"><a href="#orgb8996ba">lisp-unit2</a></td>
<td class="org-right">0</td>
</tr>

<tr>
<td class="org-left"><a href="#orga8f69c2">parachute</a></td>
<td class="org-right">0</td>
</tr>

<tr>
<td class="org-left"><a href="#orga7f8a83">prove</a></td>
<td class="org-right">0</td>
</tr>

<tr>
<td class="org-left"><a href="#org52f36e5">ptester</a></td>
<td class="org-right">0</td>
</tr>

<tr>
<td class="org-left"><a href="#org3d39ad7">rove</a></td>
<td class="org-right">0</td>
</tr>

<tr>
<td class="org-left"><a href="#org5279729">should-test</a></td>
<td class="org-right">0</td>
</tr>

<tr>
<td class="org-left"><a href="#org4b187d6">unit-test</a></td>
<td class="org-right">0</td>
</tr>

<tr>
<td class="org-left"><a href="#orgea91eb1">xlunit</a></td>
<td class="org-right">0</td>
</tr>

<tr>
<td class="org-left"><a href="#org72de806">xptest</a></td>
<td class="org-right">0</td>
</tr>

<tr>
<td class="org-left"><a href="#orge473393">clunit2</a>  (a)</td>
<td class="org-right">0</td>
</tr>

<tr>
<td class="org-left"><a href="#org4a2ad7a">2am</a> (not in quicklisp)</td>
<td class="org-right">0</td>
</tr>

<tr>
<td class="org-left"><a href="#org53910ab">fiasco</a></td>
<td class="org-right">10</td>
</tr>

<tr>
<td class="org-left"><a href="#orgc6e4266">lisp-unit</a></td>
<td class="org-right">160</td>
</tr>

<tr>
<td class="org-left"><a href="#orgdc1cd10">tap-unit-test</a></td>
<td class="org-right">160</td>
</tr>

<tr>
<td class="org-left"><a href="#org5eea657">clunit</a></td>
<td class="org-right">320</td>
</tr>

<tr>
<td class="org-left"><a href="#org55cd3c7">rt</a></td>
<td class="org-right">480</td>
</tr>

<tr>
<td class="org-left"><a href="#orga8cfe0a">nst</a></td>
<td class="org-right">6860220</td>
</tr>

<tr>
<td class="org-left">&#xa0;</td>
<td class="org-right">&#xa0;</td>
</tr>
</tbody>
</table>



<p>
Now the detailed report.
</p>
</div>
</div>
<div id="outline-container-orga5a4c8e" class="outline-3">
<h3 id="orga5a4c8e"><span class="section-number-3">7.2.</span> <a href="#orge4344cd">1am</a></h3>
<div class="outline-text-3" id="text-7-2">
<p>
1am seems to have no way to turn off the progress reports. The benchmark below was done running in a terminal window. The same test running in a emacs REPL took roughly six times longer due to how emacs mishandles long lines. YMMV with other editors.
</p>
<div class="org-src-container">
<pre class="src src-lisp">(<span class="org-keyword">benchmark:with-timing</span> (10) (uax-15-1am-tests::run))

Success: 16 tests, 343332 checks.

-                SAMPLES  TOTAL       MINIMUM    MAXIMUM    MEDIAN     AVERAGE      DEVIATION
REAL-TIME        10       9.609976    0.88333    1.05333    0.943332   0.960998     0.050641
RUN-TIME         10       6.154181    0.607383   0.64799    0.610502   0.615418     0.011578
USER-RUN-TIME    10       6.117711    0.601297   0.631522   0.609088   0.611771     0.008027
SYSTEM-RUN-TIME  10       0.036479    0          0.016462   0.003285   0.003648     0.004761
PAGE-FAULTS      10       0           0          0          0          0            0.0
GC-RUN-TIME      10       99.246      6.092      39.833     6.396      9.9246       9.983065
BYTES-CONSED     10       3361283232  336076080  336267312  336108464  336128320.0  50528.4
EVAL-CALLS       10       0           0          0          0          0            0.0
</pre>
</div>
<p>
The CCL version:
</p>
<div class="org-src-container">
<pre class="src src-lisp">       SAMPLES  TOTAL      MINIMUM   MAXIMUM   MEDIAN    AVERAGE   DEVIATION
REAL-TIME  10       25.275585  2.384657  2.649059  2.491271  2.527559  0.080996
RUN-TIME   10       13.684325  1.337679  1.436498  1.360898  1.368432  0.028661

</pre>
</div>
</div>
</div>
<div id="outline-container-orgeda958d" class="outline-3">
<h3 id="orgeda958d"><span class="section-number-3">7.3.</span> <a href="#org4a2ad7a">2am</a></h3>
<div class="outline-text-3" id="text-7-3">
<p>
2am seems to have no way to turn off the progress reports. As with the 1am benchmark, the benchmark below was done running in a terminal window. The same test running in a emacs REPL took roughly six times longer due to how emacs mishandles long lines.
</p>
<div class="org-src-container">
<pre class="src src-lisp">(<span class="org-keyword">benchmark:with-timing</span> (10) (uax-15-2am-tests::run))

-                SAMPLES  TOTAL       MINIMUM    MAXIMUM    MEDIAN     AVERAGE      DEVIATION
REAL-TIME        10       9.886643    0.899998   1.073331   0.993331   0.988664     0.043823
RUN-TIME         10       6.240839    0.618159   0.648082   0.620287   0.624084     0.008487
USER-RUN-TIME    10       6.214425    0.614933   0.644856   0.618156   0.621442     0.008304
SYSTEM-RUN-TIME  10       0.026427    0          0.00694    0.003034   0.002643     0.002041
PAGE-FAULTS      10       0           0          0          0          0            0.0
GC-RUN-TIME      10       147.903     11.379     36.216     11.669     14.7903      7.227465
BYTES-CONSED     10       3361006176  336067904  336158016  336087456  336100600.0  27877.61
EVAL-CALLS       10       0           0          0          0          0            0.0
</pre>
</div>
<p>
The CCL version
</p>
<div class="org-src-container">
<pre class="src src-lisp">-      SAMPLES  TOTAL      MINIMUM   MAXIMUM   MEDIAN    AVERAGE   DEVIATION
REAL-TIME  10       29.176336  2.674119  3.128804  2.907567  2.917634  0.11941
RUN-TIME   10       14.061409  1.364417  1.471937  1.403766  1.406141  0.03288

</pre>
</div>
</div>
</div>
<div id="outline-container-org138a102" class="outline-3">
<h3 id="org138a102"><span class="section-number-3">7.4.</span> <a href="#org12efa6c">cacua</a></h3>
<div class="outline-text-3" id="text-7-4">
<p>
Since Cacau does not run tests unless they are recompiled, you need to multiply numbers below by 10 to get some kind of comparable here. Running at the minimum reporting.
</p>
<div class="org-src-container">
<pre class="src src-lisp">(<span class="org-keyword">benchmark:with-timing</span> (10) (uax-15-cacau-tests::run <span class="org-builtin">:reporter</span> <span class="org-builtin">:min</span>))
-                SAMPLES  TOTAL      MINIMUM    MAXIMUM    MEDIAN     AVERAGE    DEVIATION
REAL-TIME        1        0.603331   0.603331   0.603331   0.603331   0.603331   0.0
RUN-TIME         1        0.601739   0.601739   0.601739   0.601739   0.601739   0.0
USER-RUN-TIME    1        0.581692   0.581692   0.581692   0.581692   0.581692   0.0
SYSTEM-RUN-TIME  1        0.020046   0.020046   0.020046   0.020046   0.020046   0.0
PAGE-FAULTS      1        0          0          0          0          0          0.0
GC-RUN-TIME      1        24.25      24.25      24.25      24.25      24.25      0.0
BYTES-CONSED     1        338387920  338387920  338387920  338387920  338387920  0.0
EVAL-CALLS       1        0          0          0          0          0          0.0

</pre>
</div>
<p>
The CCL version (total multiplied by 10 get try to get a comparable)
</p>
<div class="org-src-container">
<pre class="src src-lisp">-          SAMPLES  TOTAL     MINIMUM   MAXIMUM   MEDIAN    AVERAGE   DEVIATION
REAL-TIME  1        1.168082  1.168082  1.168082  1.168082  1.168082  0
RUN-TIME   1        1.165435  1.165435  1.165435  1.165435  1.165435  0
</pre>
</div>
</div>
</div>

<div id="outline-container-org6cefd23" class="outline-3">
<h3 id="org6cefd23"><span class="section-number-3">7.5.</span> <a href="#org0760669">cardiogram</a></h3>
<div class="outline-text-3" id="text-7-5">
</div>
<ol class="org-ol">
<li><a id="orgabf090a"></a>sbcl<br>
<div class="outline-text-4" id="text-7-5-1">
<div class="org-src-container">
<pre class="src src-lisp">  -                SAMPLES  TOTAL       MINIMUM    MAXIMUM    MEDIAN     AVERAGE      DEVIATION
REAL-TIME        10       15.639978   1.529998   1.61333    1.553331   1.563998     0.025854
RUN-TIME         10       13.36939    1.289864   1.409203   1.324704   1.336939     0.03158
USER-RUN-TIME    10       9.034622    0.860167   0.933511   0.897475   0.903462     0.020972
SYSTEM-RUN-TIME  10       4.334774    0.392391   0.479334   0.426708   0.433477     0.025352
PAGE-FAULTS      10       0           0          0          0          0            0.0
GC-RUN-TIME      10       883.805     70.762     112.345    85.737     88.3805      13.442876
BYTES-CONSED     10       3965584752  396493296  396752736  396527616  396558460.0  73038.71
EVAL-CALLS       10       0           0          0          0          0            0.0
</pre>
</div>
</div>
</li>
<li><a id="org7a5e20e"></a>ccl<br>
<div class="outline-text-4" id="text-7-5-2">
<div class="org-src-container">
<pre class="src src-lisp">  -          SAMPLES  TOTAL      MINIMUM   MAXIMUM   MEDIAN    AVERAGE   DEVIATION
REAL-TIME  10       31.406332  3.098291  3.187677  3.141698  3.140633  0.02607
RUN-TIME   10       29.252617  2.900375  2.954562  2.923258  2.925262  0.017778
</pre>
</div>
</div>
</li>
</ol>
</div>

<div id="outline-container-org78bdb40" class="outline-3">
<h3 id="org78bdb40"><span class="section-number-3">7.6.</span> <a href="#org5eea657">clunit</a></h3>
<div class="outline-text-3" id="text-7-6">
<p>
Clunit has always had a concern about performance. Running this benchmark was painful. Unlike fiveam, which should not be run in a REPL in emacs on tests with lots of assertions because of emacs' issues with long lines, clunit has no one to blame but itself. But look at the CCL results compared to the SBCL results. Clunit was the only framework faster under CCL than SBCL. Still unacceptably slow, but &#x2026;
Wwith SBCL in a terminal.
</p>
<div class="org-src-container">
<pre class="src src-lisp">
-                SAMPLES  TOTAL       MINIMUM    MAXIMUM    MEDIAN     AVERAGE    DEVIATION
REAL-TIME        10       601.4108    57.19953   64.00593   59.65935   60.141087  2.303678
RUN-TIME         10       601.0652    57.161556  63.96824   59.62751   60.106518  2.301759
USER-RUN-TIME    10       600.65216   57.108273  63.941593  59.587543  60.06522   2.305383
SYSTEM-RUN-TIME  10       0.413016    0.019989   0.059948   0.043303   0.041302   0.011839
PAGE-FAULTS      10       0           0          0          0          0          0.0
GC-RUN-TIME      10       1158.426    87.246     145.034    115.57     115.8426   17.674866
BYTES-CONSED     10       5262303120  526034656  527650448  526069408  526230312  473977.47
EVAL-CALLS       10       320         32         32         32         32         0.0
NIL
</pre>
</div>
<p>
The CCL result
</p>
<div class="org-src-container">
<pre class="src src-lisp">-          SAMPLES  TOTAL     MINIMUM    MAXIMUM    MEDIAN    AVERAGE    DEVIATION
REAL-TIME  10       272.9831  27.003325  27.478271  27.37946  27.298307  0.179919
RUN-TIME   10       272.8588  26.99254   27.466413  27.36916  27.28588   0.179731
</pre>
</div>
</div>
</div>
<div id="outline-container-org6881e2a" class="outline-3">
<h3 id="org6881e2a"><span class="section-number-3">7.7.</span> <a href="#orge473393">clunit2</a></h3>
<div class="outline-text-3" id="text-7-7">
<p>
<b>Update 13 June 2021:</b> Clunit2 has had a huge performance increase, most of it apparently involving moving from using lists to using arrays. Clunit2 should now be considered a member of the pack from a performance standpoint.
</p>

<p>
I ran the new improved clunit2 two ways and there is a performance difference to be considered here.
</p>

<p>
First I let CL equal do the comparision and then clunit2 just checked whether the assertion was true (assert-true) which was how all the other frameworks were also tested.
</p>

<div class="org-src-container">
<pre class="src src-lisp">-                SAMPLES  TOTAL        MINIMUM     MAXIMUM     MEDIAN      AVERAGE     DEVIATION
REAL-TIME        10       14.846632    1.366663    1.749995    1.389997    1.484663    0.138653
RUN-TIME         10       14.341602    1.36469     1.746867    1.375746    1.43416     0.113668
USER-RUN-TIME    10       13.959459    1.327791    1.650369    1.35222     1.395946    0.095244
SYSTEM-RUN-TIME  10       0.382167     0.020135    0.096501    0.029916    0.038217    0.021336
PAGE-FAULTS      10       0            0           0           0           0           0.0
GC-RUN-TIME      10       1396.363     79.062      426.267     94.67       139.6363    102.216064
BYTES-CONSED     10       15407395920  1540473248  1542494352  1540569936  1540739592  586165.7
EVAL-CALLS       10       0            0           0           0           0           0.0

</pre>
</div>
<p>
The CCL version:
</p>
<div class="org-src-container">
<pre class="src src-lisp">-          SAMPLES  TOTAL      MINIMUM   MAXIMUM   MEDIAN    AVERAGE   DEVIATION
REAL-TIME  10       36.061737  3.571143  3.670895  3.591581  3.606174  0.031347
RUN-TIME   10       35.999214  3.565532  3.666779  3.587588  3.599922  0.031904
</pre>
</div>
</div>
</div>

<div id="outline-container-orgfd1820f" class="outline-3">
<h3 id="orgfd1820f"><span class="section-number-3">7.8.</span> <a href="#org4b0d432">confidence</a></h3>
<div class="outline-text-3" id="text-7-8">
<p>
Confidence has no built in capability for running all the tests in a suite or package, so this is based on creating a function that just runs all the tests for uax-15-confidence-tests.
</p>

<p>
There is no way to turn off the progress report.
</p>
</div>
<ol class="org-ol">
<li><a id="org90dd803"></a>sbcl<br>
<div class="outline-text-4" id="text-7-8-1">
<div class="org-src-container">
<pre class="src src-lisp">  -                SAMPLES  TOTAL       MINIMUM    MAXIMUM    MEDIAN     AVERAGE    DEVIATION
REAL-TIME        10       24.766607   2.373328   2.619993   2.449995   2.476661   0.074266
RUN-TIME         10       24.728697   2.370314   2.620167   2.44499    2.47287    0.074612
USER-RUN-TIME    10       24.206568   2.333738   2.529879   2.408485   2.420657   0.061988
SYSTEM-RUN-TIME  10       0.52216     0.033206   0.119802   0.043091   0.052216   0.025093
PAGE-FAULTS      10       0           0          0          0          0          0.0
GC-RUN-TIME      10       2399.87     157.192    422.991    199.997    239.987    77.71274
BYTES-CONSED     10       4338353600  430977312  457204272  431014240  433835360  7812895.0
EVAL-CALLS       10       0           0          0          0          0          0.0

</pre>
</div>
</div>
</li>

<li><a id="orgcf01a1c"></a>ccl<br>
<div class="outline-text-4" id="text-7-8-2">
<div class="org-src-container">
<pre class="src src-lisp">  -          SAMPLES  TOTAL      MINIMUM   MAXIMUM   MEDIAN    AVERAGE   DEVIATION
REAL-TIME  10       56.97802   4.964914  6.698658  5.584261  5.697802  0.544525
RUN-TIME   10       56.854607  4.940436  6.691704  5.57673   5.685461  0.55132
</pre>
</div>
</div>
</li>
</ol>
</div>

<div id="outline-container-org7b9028b" class="outline-3">
<h3 id="org7b9028b"><span class="section-number-3">7.9.</span> <a href="#org53910ab">fiasco</a></h3>
<div class="outline-text-3" id="text-7-9">
<p>
With progress reporting turned off
</p>
<div class="org-src-container">
<pre class="src src-lisp">(setf *print-test-run-progress* nil)
(<span class="org-keyword">in-package</span> <span class="org-builtin">:uax-15-fiasco-suite</span>)
(<span class="org-keyword">benchmark:with-timing</span> (10) (run-package-tests))
-                SAMPLES  TOTAL       MINIMUM    MAXIMUM    MEDIAN     AVERAGE    DEVIATION
REAL-TIME        10       8.906644    0.836663   1.036664   0.873331   0.890664   0.055253
RUN-TIME         10       8.894009    0.833614   1.035559   0.87176    0.889401   0.055545
USER-RUN-TIME    10       8.567723    0.821425   0.982309   0.835402   0.856772   0.046346
SYSTEM-RUN-TIME  10       0.326294    0.009906   0.05325    0.036599   0.032629   0.012558
PAGE-FAULTS      10       0           0          0          0          0          0.0
GC-RUN-TIME      10       1226.872    82.416     269.812    99.856     122.6872   54.588013
BYTES-CONSED     10       4077786880  407500144  409297696  407538304  407778688  543070.25
EVAL-CALLS       10       10          1          1          1          1          0.0
</pre>
</div>
<p>
The CCL version:
</p>
<div class="org-src-container">
<pre class="src src-lisp">-          SAMPLES  TOTAL      MINIMUM   MAXIMUM   MEDIAN    AVERAGE   DEVIATION
REAL-TIME  10       38.544464  3.658651  4.815928  3.764052  3.854446  0.323914
RUN-TIME   10       38.457424  3.651049  4.807069  3.759031  3.845742  0.3241
</pre>
</div>
</div>
</div>
<div id="outline-container-orgaf780c5" class="outline-3">
<h3 id="orgaf780c5"><span class="section-number-3">7.10.</span> <a href="#org3e895a0">fiveam</a></h3>
<div class="outline-text-3" id="text-7-10">
<p>
With progress reporting turned off:
</p>
<div class="org-src-container">
<pre class="src src-lisp">(<span class="org-keyword">benchmark:with-timing</span> (10)
                       (<span class="org-keyword">let</span> ((fiveam:*test-dribble* (make-broadcast-stream)))
                         (run 'uax-15-fiveam)))
-                SAMPLES  TOTAL       MINIMUM    MAXIMUM    MEDIAN     AVERAGE    DEVIATION
REAL-TIME        10       10.133307   0.976664   1.06333    1.006664   1.013331   0.025777
RUN-TIME         10       10.123116   0.977754   1.062285   1.005493   1.012312   0.025377
USER-RUN-TIME    10       9.826661    0.958934   1.025672   0.964349   0.982666   0.023269
SYSTEM-RUN-TIME  10       0.29648     0.013407   0.043277   0.029962   0.029648   0.008991
PAGE-FAULTS      10       0           0          0          0          0          0.0
GC-RUN-TIME      10       887.548     56.765     130.141    83.046     88.7548    21.552885
BYTES-CONSED     10       4512244000  451134320  451410384  451200752  451224400  74965.13
EVAL-CALLS       10       0           0          0          0          0          0.0

</pre>
</div>

<p>
If you do not have progress reporting turned off, besides wasting a huge amount of screen space and time, it creates interesting issues based on what you are running fiveam on. Emacs has known problems with long lines and fiveam's progress reporting in a benchmark like this creates lots of long line. It gets even worse if you set the <code>run</code> keyword parameter <code>:print-names</code> to nil.
</p>

<p>
Rule of thumb for big test systems and fiveam. Run it from a terminal, not an emacs REPL.
</p>

<p>
The CCL version
</p>
<div class="org-src-container">
<pre class="src src-lisp">-          SAMPLES  TOTAL      MINIMUM   MAXIMUM   MEDIAN    AVERAGE   DEVIATION
REAL-TIME  10       19.166885  1.904093  1.946594  1.914582  1.916688  0.011433
RUN-TIME   10       19.129244  1.90118   1.94372   1.911262  1.912924  0.011477
</pre>
</div>
</div>
</div>

<div id="outline-container-org6fa16ca" class="outline-3">
<h3 id="org6fa16ca"><span class="section-number-3">7.11.</span> <a href="#org8d88b5e">gigamonkeys</a></h3>
<div class="outline-text-3" id="text-7-11">
<p>
Gigamonkeys does not do progress reporting
</p>
<div class="org-src-container">
<pre class="src src-lisp">(<span class="org-keyword">benchmark:with-timing</span> (10) (test-package))
-                SAMPLES  TOTAL       MINIMUM    MAXIMUM    MEDIAN     AVERAGE      DEVIATION
REAL-TIME        10       7.893314    0.783331   0.813332   0.786665   0.789331     0.008406
RUN-TIME         10       7.887205    0.780954   0.816817   0.785493   0.78872      0.009683
USER-RUN-TIME    10       7.850746    0.777678   0.796806   0.785181   0.785075     0.005411
SYSTEM-RUN-TIME  10       0.036482    0          0.02001    0.000027   0.003648     0.005858
PAGE-FAULTS      10       0           0          0          0          0            0.0
GC-RUN-TIME      10       190.862     14.962     40.392     16.909     19.0862      7.12733
BYTES-CONSED     10       4788180016  478635504  479903744  478708672  478818000.0  363684.38
EVAL-CALLS       10       0           0          0          0          0            0.0
</pre>
</div>
<p>
The CCL version
</p>
<div class="org-src-container">
<pre class="src src-lisp">-          SAMPLES  TOTAL      MINIMUM   MAXIMUM   MEDIAN    AVERAGE   DEVIATION
REAL-TIME  10       19.166885  1.904093  1.946594  1.914582  1.916688  0.011433
RUN-TIME   10       19.129244  1.90118   1.94372   1.911262  1.912924  0.011477
</pre>
</div>
</div>
</div>

<div id="outline-container-org8b38c93" class="outline-3">
<h3 id="org8b38c93"><span class="section-number-3">7.12.</span> <a href="#orga50a995">lift</a></h3>
<div class="outline-text-3" id="text-7-12">
<p>
Lift says that there were 16 successful tests, but does not specify the number of successful assertions, so no progress reports..
</p>
<div class="org-src-container">
<pre class="src src-lisp">(<span class="org-keyword">benchmark:with-timing</span> (10) (run-tests <span class="org-builtin">:suite</span> 'uax-lift-15))
-                SAMPLES  TOTAL       MINIMUM    MAXIMUM    MEDIAN     AVERAGE    DEVIATION
REAL-TIME        10       6.076652    0.596666   0.666665   0.599999   0.607665   0.019779
RUN-TIME         10       6.068622    0.596521   0.664457   0.601027   0.606862   0.019258
USER-RUN-TIME    10       6.035427    0.593182   0.644546   0.599972   0.603543   0.013911
SYSTEM-RUN-TIME  10       0.03322     0          0.019911   0.000003   0.003322   0.005932
PAGE-FAULTS      10       0           0          0          0          0          0.0
GC-RUN-TIME      10       189.801     14.242     51.038     14.762     18.9801    10.741669
BYTES-CONSED     10       3480602800  347045776  356690112  347112656  348060280  2876791.8
EVAL-CALLS       10       0           0          0          0          0          0.0

</pre>
</div>
<p>
The CCL version of the benchmark resulted in this:
</p>
<div class="org-src-container">
<pre class="src src-lisp">(<span class="org-keyword">benchmark:with-timing</span> (10) (run-tests <span class="org-builtin">:suite</span> 'uax-lift-15))
-          SAMPLES  TOTAL      MINIMUM   MAXIMUM   MEDIAN    AVERAGE   DEVIATION
REAL-TIME  10       11.987319  1.186334  1.216747  1.196841  1.198732  0.008089
RUN-TIME   10       11.970636  1.185057  1.215185  1.195852  1.197064  0.008253
</pre>
</div>
</div>
</div>
<div id="outline-container-org59d5484" class="outline-3">
<h3 id="org59d5484"><span class="section-number-3">7.13.</span> <a href="#orgc6e4266">lisp-unit</a></h3>
<div class="outline-text-3" id="text-7-13">
<p>
No progress reports
</p>
<div class="org-src-container">
<pre class="src src-lisp">(<span class="org-keyword">benchmark:with-timing</span> (10) (run-tests))
-                SAMPLES  TOTAL       MINIMUM    MAXIMUM    MEDIAN     AVERAGE      DEVIATION
REAL-TIME        10       7.129982    0.699998   0.786665   0.703331   0.712998     0.025186
RUN-TIME         10       7.125096    0.699222   0.788776   0.7028     0.71251      0.026041
USER-RUN-TIME    10       7.068603    0.692563   0.765489   0.699554   0.70686      0.019895
SYSTEM-RUN-TIME  10       0.056505    0.000003   0.023286   0.003277   0.00565      0.00699
PAGE-FAULTS      10       0           0          0          0          0            0.0
GC-RUN-TIME      10       260.177     19.339     60.275     21.956     26.0177      11.598406
BYTES-CONSED     10       4222413456  421806272  425655232  421847136  422241340.0  1138669.0
EVAL-CALLS       10       160         16         16         16         16           0.0
</pre>
</div>
<p>
Now the CCL version:
</p>
<div class="org-src-container">
<pre class="src src-lisp">-          SAMPLES  TOTAL      MINIMUM   MAXIMUM   MEDIAN    AVERAGE   DEVIATION
REAL-TIME  10       13.487027  1.339966  1.362137  1.349544  1.348703  0.007266
RUN-TIME   10       13.454422  1.337902  1.359824  1.343596  1.345442  0.007124
</pre>
</div>
</div>
</div>
<div id="outline-container-orga46d621" class="outline-3">
<h3 id="orga46d621"><span class="section-number-3">7.14.</span> <a href="#orgb8996ba">list-unit2</a></h3>
<div class="outline-text-3" id="text-7-14">
<p>
No progress reports
</p>
<div class="org-src-container">
<pre class="src src-lisp">  (<span class="org-keyword">benchmark:with-timing</span> (10) (run-tests))
  -                SAMPLES  TOTAL       MINIMUM    MAXIMUM    MEDIAN     AVERAGE      DEVIATION
REAL-TIME        10       9.306638    0.899997   0.956663   0.923331   0.930664     0.019709
RUN-TIME         10       9.29662     0.90105    0.953252   0.924323   0.929662     0.018766
USER-RUN-TIME    10       9.126992    0.895342   0.93455    0.908129   0.912699     0.01386
SYSTEM-RUN-TIME  10       0.169641    0.00335    0.033231   0.016619   0.016964     0.010221
PAGE-FAULTS      10       0           0          0          0          0            0.0
GC-RUN-TIME      10       512.84      32.691     73.531     42.772     51.284       15.129883
BYTES-CONSED     10       4939787968  493387600  498633408  493461152  493978780.0  1552274.1
EVAL-CALLS       10       0           0          0          0          0            0.0
</pre>
</div>
<p>
Now the CCL version:
</p>
<div class="org-src-container">
<pre class="src src-lisp">-          SAMPLES  TOTAL      MINIMUM   MAXIMUM   MEDIAN    AVERAGE   DEVIATION
REAL-TIME  10       30.287363  2.994757  3.274799  3.001426  3.028736  0.082134
RUN-TIME   10       30.244043  2.990828  3.270884  2.996805  3.024404  0.082271
</pre>
</div>
</div>
</div>

<div id="outline-container-org0cae2ef" class="outline-3">
<h3 id="org0cae2ef"><span class="section-number-3">7.15.</span> <a href="#orga8cfe0a">nst</a></h3>
<div class="outline-text-3" id="text-7-15">
<p>
NST's results were surprisingly bad. I ran tests with and without :cache being set on each fixture and it did not seem to make much of a difference. At this point I do not know if the issue is with NST or an error between chair and keyboard.
</p>
<div class="org-src-container">
<pre class="src src-lisp">(<span class="org-keyword">benchmark:with-timing</span> (10) (nst-cmd <span class="org-builtin">:run</span> <span class="org-builtin">:uax-15-nst</span>))
-                SAMPLES  TOTAL         MINIMUM      MAXIMUM      MEDIAN       AVERAGE      DEVIATION
REAL-TIME        10       516.88855     51.526524    51.85985     51.67986     51.688854    0.105207
RUN-TIME         10       517.8853      51.65252     51.97778     51.795273    51.788532    0.090498
USER-RUN-TIME    10       515.4022      51.376358    51.718292    51.56273     51.540226    0.092005
SYSTEM-RUN-TIME  10       2.483108      0.206179     0.282712     0.258424     0.248311     0.027323
PAGE-FAULTS      10       0             0            0            0            0            0.0
GC-RUN-TIME      10       11704.455     1081.936     1224.102     1173.542     1170.4456    33.417885
BYTES-CONSED     10       306684151680  30666874416  30677103952  30667547952  30668415168  2911205.3
EVAL-CALLS       10       6860220       686022       686022       686022       686022       0.0
</pre>
</div>
<p>
The CCL version:
</p>
<div class="org-src-container">
<pre class="src src-lisp">-          SAMPLES  TOTAL     MINIMUM   MAXIMUM    MEDIAN    AVERAGE    DEVIATION
REAL-TIME  10       501.6569  49.96337  50.555893  50.08843  50.16569   0.18232
RUN-TIME   10       500.4885  49.85959  50.36908   49.97486  50.048847  0.165674
</pre>
</div>
</div>
</div>
<div id="outline-container-orge83724c" class="outline-3">
<h3 id="orge83724c"><span class="section-number-3">7.16.</span> <a href="#orga8f69c2">parachute</a></h3>
<div class="outline-text-3" id="text-7-16">
<p>
<a id="org973d7ca"></a>
Progress reporting turned off by using the quiet report.
</p>
<div class="org-src-container">
<pre class="src src-lisp">(<span class="org-keyword">benchmark:with-timing</span> (10) (test 'suite <span class="org-builtin">:report</span> 'quiet))
-                SAMPLES  TOTAL       MINIMUM    MAXIMUM    MEDIAN     AVERAGE      DEVIATION
REAL-TIME        10       9.929974    0.913331   1.089997   0.969997   0.992997     0.063411
RUN-TIME         10       9.91559     0.912637   1.089303   0.970189   0.991559     0.062786
USER-RUN-TIME    10       9.403031    0.879351   1.042706   0.916937   0.940303     0.056901
SYSTEM-RUN-TIME  10       0.512589    0.02995    0.073216   0.046596   0.051259     0.014293
PAGE-FAULTS      10       0           0          0          0          0            0.0
GC-RUN-TIME      10       1677.654    106.9      267.475    143.608    167.7654     51.604637
BYTES-CONSED     10       5212345824  512596848  598222384  512680656  521234600.0  25662644.0
EVAL-CALLS       10       0           0          0          0          0            0.0

</pre>
</div>
<p>
The same benchmark with CCL:
</p>
<div class="org-src-container">
<pre class="src src-lisp">-          SAMPLES  TOTAL      MINIMUM   MAXIMUM   MEDIAN    AVERAGE   DEVIATION
REAL-TIME  10       40.437767  4.010897  4.063527  4.042738  4.043777  0.013439
RUN-TIME   10       40.37925   4.007424  4.053993  4.037376  4.037925  0.011995
NIL
</pre>
</div>
</div>
</div>
<div id="outline-container-orge26ea41" class="outline-3">
<h3 id="orge26ea41"><span class="section-number-3">7.17.</span> <a href="#orga7f8a83">prove</a></h3>
<div class="outline-text-3" id="text-7-17">
<p>
<a id="orgfed4252"></a>
The prove tests were done with the <code>*default-reporter*</code> set to <code>:dot</code> because there is no way to turn off the progress reporting. The times were surprisingly slow (not clunit slow, but roughly five times longer than the other frameworks), with no real difference between running in a terminal window or in an emacs REPL.
</p>
<div class="org-src-container">
<pre class="src src-lisp">(<span class="org-keyword">benchmark:with-timing</span> (10) (run-all-uax-15))
-                SAMPLES  TOTAL        MINIMUM     MAXIMUM     MEDIAN      AVERAGE       DEVIATION
REAL-TIME        10       66.02316     6.323317    6.976648    6.516648    6.602316      0.192082
RUN-TIME         10       30.561893    2.896409    3.223873    3.053162    3.056189      0.099394
USER-RUN-TIME    10       29.63921     2.823159    3.153962    2.939861    2.963921      0.092085
SYSTEM-RUN-TIME  10       0.922708     0.069913    0.133064    0.079994    0.092271      0.020397
PAGE-FAULTS      10       0            0           0           0           0             0.0
GC-RUN-TIME      10       2216.068     137.512     437.243     197.665     221.6068      81.27371
BYTES-CONSED     10       14018185696  1394824144  1428527632  1395103136  1401818600.0  10494809.0
EVAL-CALLS       10       0            0           0           0           0             0.0

</pre>
</div>
<p>
The CCL version:
</p>
<div class="org-src-container">
<pre class="src src-lisp">-          SAMPLES  TOTAL      MINIMUM    MAXIMUM    MEDIAN     AVERAGE    DEVIATION
REAL-TIME  10       229.77249  12.113011  57.055473  12.571996  22.97725   16.502855
RUN-TIME   10       132.14566  12.067512  16.609463  12.487875  13.214567  1.402868
</pre>
</div>
</div>
</div>
<div id="outline-container-orgc31e447" class="outline-3">
<h3 id="orgc31e447"><span class="section-number-3">7.18.</span> <a href="#org52f36e5">ptester</a></h3>
<div class="outline-text-3" id="text-7-18">
<p>
The benchmarking was done with a single function (ptester-tests) that called all the tests. Progess reporting cannot be turned off.
</p>
<div class="org-src-container">
<pre class="src src-lisp">-                SAMPLES  TOTAL       MINIMUM    MAXIMUM    MEDIAN     AVERAGE      DEVIATION
REAL-TIME        10       6.209992    0.613333   0.663334   0.616665   0.620999     0.014303
RUN-TIME         10       6.20006     0.611543   0.660918   0.615629   0.620006     0.013763
USER-RUN-TIME    10       6.150195    0.604901   0.630972   0.614696   0.61502      0.006247
SYSTEM-RUN-TIME  10       0.049889    0          0.029945   0.003299   0.004989     0.008579
PAGE-FAULTS      10       0           0          0          0          0            0.0
GC-RUN-TIME      10       166.527     12.391     45.026     13.742     16.6527      9.467175
BYTES-CONSED     10       3690505472  369001712  369094144  369043328  369050560.0  26112.266
EVAL-CALLS       10       0           0          0          0          0            0.0

</pre>
</div>
<p>
The CCL version:
</p>
<div class="org-src-container">
<pre class="src src-lisp">-          SAMPLES  TOTAL      MINIMUM   MAXIMUM   MEDIAN    AVERAGE   DEVIATION
REAL-TIME  10       12.558413  1.240772  1.280743  1.251957  1.255841  0.010159
RUN-TIME   10       12.513009  1.239555  1.27798   1.24801   1.251301  0.009971
</pre>
</div>
</div>
</div>
<div id="outline-container-orgb5c0042" class="outline-3">
<h3 id="orgb5c0042"><span class="section-number-3">7.19.</span> <a href="#org3d39ad7">rove</a></h3>
<div class="outline-text-3" id="text-7-19">
<p>
<a id="org88d2d08"></a>
</p>

<div class="org-src-container">
<pre class="src src-lisp">(<span class="org-keyword">benchmark:with-timing</span> (10) (run <span class="org-builtin">:uax-15-rove-tests</span> <span class="org-builtin">:style</span> <span class="org-builtin">:none</span>))
-                SAMPLES  TOTAL       MINIMUM    MAXIMUM    MEDIAN     AVERAGE      DEVIATION
REAL-TIME        10       11.879972   1.139999   1.223331   1.189997   1.187997     0.025957
RUN-TIME         10       11.86156    1.138402   1.223247   1.187435   1.186156     0.026327
USER-RUN-TIME    10       11.185844   1.068141   1.144235   1.126029   1.118584     0.021292
SYSTEM-RUN-TIME  10       0.675742    0.03663    0.09343    0.06979    0.067574     0.017528
PAGE-FAULTS      10       0           0          0          0          0            0.0
GC-RUN-TIME      10       2986.486    259.002    332.193    304.989    298.6486     24.707445
BYTES-CONSED     10       7427051216  740502400  762046592  740546112  742705150.0  6447249.0
EVAL-CALLS       10       9           0          9          0          0.9          2.7
</pre>
</div>
<p>
Now the CCL versioin
</p>
<div class="org-src-container">
<pre class="src src-lisp">(<span class="org-keyword">benchmark:with-timing</span> (10) (run <span class="org-builtin">:uax-15-rove-tests</span> <span class="org-builtin">:style</span> <span class="org-builtin">:none</span>))
-          SAMPLES  TOTAL      MINIMUM   MAXIMUM   MEDIAN    AVERAGE   DEVIATION
REAL-TIME  10       35.897484  3.53852   3.666501  3.562608  3.589748  0.044875
RUN-TIME   10       35.826942  3.532155  3.660664  3.558934  3.582694  0.045938
</pre>
</div>
</div>
</div>
<div id="outline-container-org5dc6e54" class="outline-3">
<h3 id="org5dc6e54"><span class="section-number-3">7.20.</span> <a href="#org55cd3c7">rt</a></h3>
<div class="outline-text-3" id="text-7-20">
<p>
Rt reports only the tests, not the assertions.
</p>
<div class="org-src-container">
<pre class="src src-lisp">(<span class="org-keyword">benchmark:with-timing</span> (10) (<span class="org-keyword">do-tests</span>))
-                SAMPLES  TOTAL       MINIMUM    MAXIMUM    MEDIAN     AVERAGE      DEVIATION
REAL-TIME        10       6.216662    0.613332   0.643333   0.616665   0.621666     0.009689
RUN-TIME         10       6.207924    0.610565   0.640804   0.618108   0.620792     0.009539
USER-RUN-TIME    10       6.118069    0.598097   0.630868   0.610568   0.611807     0.00845
SYSTEM-RUN-TIME  10       0.089871    0          0.020013   0.003355   0.008987     0.007601
PAGE-FAULTS      10       0           0          0          0          0            0.0
GC-RUN-TIME      10       219.521     16.74      44.619     18.213     21.9521      7.871968
BYTES-CONSED     10       3586779376  358638608  358705088  358675856  358677950.0  17602.818
EVAL-CALLS       10       480         48         48         48         48           0.0

</pre>
</div>
<p>
Now CCL version:
</p>
<div class="org-src-container">
<pre class="src src-lisp">-          SAMPLES  TOTAL      MINIMUM   MAXIMUM   MEDIAN    AVERAGE   DEVIATION
REAL-TIME  10       11.99317   1.183099  1.219643  1.194585  1.199317  0.012819
RUN-TIME   10       11.909768  1.180592  1.202258  1.190041  1.190977  0.006007
</pre>
</div>
</div>
</div>
<div id="outline-container-orgbc91d29" class="outline-3">
<h3 id="orgbc91d29"><span class="section-number-3">7.21.</span> <a href="#org5279729">should-test</a></h3>
<div class="outline-text-3" id="text-7-21">
<p>
Should-test prints out the name of each test with OK.
</p>
<div class="org-src-container">
<pre class="src src-lisp">(<span class="org-keyword">benchmark:with-timing</span> (10) (test))
-                SAMPLES  TOTAL       MINIMUM    MAXIMUM    MEDIAN     AVERAGE      DEVIATION
REAL-TIME        10       7.179996    0.709999   0.766666   0.713332   0.718        0.016343
RUN-TIME         10       7.171032    0.709636   0.768002   0.711339   0.717103     0.017043
USER-RUN-TIME    10       7.12796     0.703418   0.751316   0.7081     0.712796     0.013232
SYSTEM-RUN-TIME  10       0.043095    0          0.016688   0.003242   0.00431      0.004734
PAGE-FAULTS      10       0           0          0          0          0            0.0
GC-RUN-TIME      10       167.82      12.366     53.552     12.436     16.782       12.267456
BYTES-CONSED     10       3859488496  385585888  388806016  385627600  385948860.0  952933.5
EVAL-CALLS       10       0           0          0          0          0            0.0
</pre>
</div>
<p>
The CCL version
</p>
<div class="org-src-container">
<pre class="src src-lisp">-          SAMPLES  TOTAL      MINIMUM   MAXIMUM   MEDIAN    AVERAGE   DEVIATION
REAL-TIME  10       25.263529  2.514491  2.538153  2.52439   2.526353  0.007306
RUN-TIME   10       25.18316   2.508538  2.532314  2.518607  2.518316  0.006587
</pre>
</div>
</div>
</div>
<div id="outline-container-org1eb821d" class="outline-3">
<h3 id="org1eb821d"><span class="section-number-3">7.22.</span> <a href="#orgdc1cd10">tap-unit-test</a></h3>
<div class="outline-text-3" id="text-7-22">
<p>
No progress reporting.
</p>
<div class="org-src-container">
<pre class="src src-lisp">(<span class="org-keyword">benchmark:with-timing</span> (10) (run-tests))
-                SAMPLES  TOTAL       MINIMUM    MAXIMUM    MEDIAN     AVERAGE      DEVIATION
REAL-TIME        10       7.009999    0.686666   0.736665   0.693334   0.701        0.014761
RUN-TIME         10       6.998872    0.688417   0.734644   0.694193   0.699887     0.013857
USER-RUN-TIME    10       6.949086    0.687007   0.718025   0.689829   0.694909     0.010584
SYSTEM-RUN-TIME  10       0.049802    0.000008   0.016621   0.003327   0.00498      0.004523
PAGE-FAULTS      10       0           0          0          0          0            0.0
GC-RUN-TIME      10       152.373     7.746      40.42      11.712     15.2373      9.486478
BYTES-CONSED     10       4217541312  421678080  421820960  421733744  421754140.0  41600.227
EVAL-CALLS       10       160         16         16         16         16           0.0

</pre>
</div>
<p>
The CCL version:
</p>
<div class="org-src-container">
<pre class="src src-lisp">-          SAMPLES  TOTAL      MINIMUM   MAXIMUM   MEDIAN    AVERAGE   DEVIATION
REAL-TIME  10       13.258068  1.311242  1.367641  1.322649  1.325807  0.01496
RUN-TIME   10       13.228476  1.309399  1.364858  1.319752  1.322848  0.014998
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb329fff" class="outline-3">
<h3 id="orgb329fff"><span class="section-number-3">7.23.</span> try</h3>
<div class="outline-text-3" id="text-7-23">
<p>
First the SBCL version
</p>
<div class="org-src-container">
<pre class="src src-lisp">  -                SAMPLES  TOTAL       MINIMUM    MAXIMUM    MEDIAN     AVERAGE      DEVIATION
REAL-TIME        10       14.643297   1.453329   1.529996   1.456663   1.46433      0.022113
RUN-TIME         10       14.618829   1.449815   1.530918   1.454007   1.461883     0.023133
USER-RUN-TIME    10       14.588861   1.447368   1.514259   1.452136   1.458886     0.018746
SYSTEM-RUN-TIME  10       0.030001    0          0.016658   0.000004   0.003        0.005039
PAGE-FAULTS      10       0           0          0          0          0            0.0
GC-RUN-TIME      10       208.982     16.999     54.556     17.101     20.8982      11.22053
BYTES-CONSED     10       9019833552  901957296  902012768  901979472  901983360.0  15399.991
EVAL-CALLS       10       0           0          0          0          0            0.0
</pre>
</div>
<p>
Now the CCL Version
</p>
<div class="org-src-container">
<pre class="src src-lisp">-          SAMPLES  TOTAL      MINIMUM   MAXIMUM    MEDIAN     AVERAGE    DEVIATION
REAL-TIME  10       178.21579  17.72332  17.91731   17.834017  17.82158   0.06565
RUN-TIME   10       177.88414  17.69016  17.892391  17.789274  17.788414  0.066341
</pre>
</div>
</div>
</div>

<div id="outline-container-org0794cd1" class="outline-3">
<h3 id="org0794cd1"><span class="section-number-3">7.24.</span> <a href="#org4b187d6">unit-test</a></h3>
<div class="outline-text-3" id="text-7-24">
<p>
Progress reporting on tests, not assertions
</p>
<div class="org-src-container">
<pre class="src src-lisp">(<span class="org-keyword">benchmark:with-timing</span> (10) (run-all-tests))
-                SAMPLES  TOTAL       MINIMUM    MAXIMUM    MEDIAN     AVERAGE      DEVIATION
REAL-TIME        10       6.373335    0.613332   0.710001   0.629999   0.637334     0.026658
RUN-TIME         10       6.361601    0.613024   0.708814   0.628271   0.63616      0.02653
USER-RUN-TIME    10       6.28175     0.610608   0.702157   0.618595   0.628175     0.026044
SYSTEM-RUN-TIME  10       0.079867    0.000004   0.016669   0.00665    0.007987     0.005205
PAGE-FAULTS      10       0           0          0          0          0            0.0
GC-RUN-TIME      10       327.129     18.211     57.563     28.737     32.7129      12.666767
BYTES-CONSED     10       3668546192  363377264  397349504  363448128  366854620.0  10165068.0
EVAL-CALLS       10       0           0          0          0          0            0.0

</pre>
</div>
<p>
The CCL version:
</p>
<div class="org-src-container">
<pre class="src src-lisp">-          SAMPLES  TOTAL      MINIMUM   MAXIMUM   MEDIAN    AVERAGE   DEVIATION
REAL-TIME  10       17.734257  1.730896  1.833714  1.737197  1.773426  0.045684
RUN-TIME   10       17.669695  1.724412  1.830537  1.729753  1.766969  0.045973
</pre>
</div>
</div>
</div>
<div id="outline-container-org8c4d81d" class="outline-3">
<h3 id="org8c4d81d"><span class="section-number-3">7.25.</span> <a href="#orgea91eb1">xlunit</a></h3>
<div class="outline-text-3" id="text-7-25">
<p>
Xlunit does progress reports only on the tests, not the assertions.
</p>
<div class="org-src-container">
<pre class="src src-lisp">(<span class="org-keyword">benchmark:with-timing</span> (10) (xlunit:textui-test-run (xlunit:get-suite uax-15)))
-                SAMPLES  TOTAL       MINIMUM    MAXIMUM    MEDIAN     AVERAGE      DEVIATION
REAL-TIME        10       5.916651    0.586665   0.609998   0.586666   0.591665     0.008465
RUN-TIME         10       5.910279    0.585645   0.610623   0.58654    0.591028     0.008659
USER-RUN-TIME    10       5.880327    0.582374   0.598663   0.585712   0.588033     0.005418
SYSTEM-RUN-TIME  10       0.029973    0          0.013315   0.000023   0.002997     0.004059
PAGE-FAULTS      10       0           0          0          0          0            0.0
GC-RUN-TIME      10       102.22      8.052      17.68      8.219      10.222       3.462927
BYTES-CONSED     10       3367157968  336039856  340887936  336103936  336715800.0  1445466.0
EVAL-CALLS       10       0           0          0          0          0            0.0

</pre>
</div>
<p>
The CCL version:
</p>
<div class="org-src-container">
<pre class="src src-lisp">-          SAMPLES  TOTAL      MINIMUM   MAXIMUM   MEDIAN    AVERAGE   DEVIATION
REAL-TIME  10       11.781408  1.159445  1.203044  1.176365  1.178141  0.010789
RUN-TIME   10       11.753234  1.158247  1.200881  1.171458  1.175323  0.01094
</pre>
</div>
</div>
</div>
<div id="outline-container-org38e9234" class="outline-3">
<h3 id="org38e9234"><span class="section-number-3">7.26.</span> <a href="#org72de806">xptest</a></h3>
<div class="outline-text-3" id="text-7-26">
<div class="org-src-container">
<pre class="src src-lisp">(<span class="org-keyword">benchmark:with-timing</span> (10) (report-result (run-test *uax-15-suite*)))
-                SAMPLES  TOTAL       MINIMUM    MAXIMUM    MEDIAN     AVERAGE      DEVIATION
REAL-TIME        10       5.899985    0.583332   0.629999   0.586665   0.589998     0.013499
RUN-TIME         10       5.89038     0.580846   0.626912   0.584578   0.589038     0.012844
USER-RUN-TIME    10       5.860286    0.577223   0.616916   0.582145   0.586029     0.010817
SYSTEM-RUN-TIME  10       0.030112    0.000034   0.00999    0.003309   0.003011     0.003122
PAGE-FAULTS      10       0           0          0          0          0            0.0
GC-RUN-TIME      10       111.974     7.402      41.731     7.481      11.1974      10.193354
BYTES-CONSED     10       3363654192  336079376  338668864  336105504  336365400.0  768173.25
EVAL-CALLS       10       0           0          0          0          0            0.0
</pre>
</div>
<p>
The CCL version:
</p>
<div class="org-src-container">
<pre class="src src-lisp">-          SAMPLES  TOTAL      MINIMUM   MAXIMUM   MEDIAN    AVERAGE   DEVIATION
REAL-TIME  10       11.744589  1.165611  1.195676  1.172062  1.174459  0.008469
RUN-TIME   10       11.728494  1.164599  1.192888  1.170583  1.172849  0.007959
</pre>
</div>

<p>
<a href="#org63aa282">top</a>
</p>
</div>
</div>
</div>
<div id="outline-container-orgd5873f4" class="outline-2">
<h2 id="orgd5873f4"><span class="section-number-2">8.</span> Mapping Functions Against Each Other</h2>
<div class="outline-text-2" id="text-8">
<p>
<a id="orgc754ba6"></a>
</p>
</div>
<div id="outline-container-orgf0b5685" class="outline-3">
<h3 id="orgf0b5685"><span class="section-number-3">8.1.</span> Assertion Functions</h3>
<div class="outline-text-3" id="text-8-1">
<p>
I expect all libraries to have the equivalent of is, signals and maybe finishes. This table just validates that assumption AND whether assertions accept an optional diagnostic string.
</p>
<table border="2" rules="all" frame="border">
<caption class="t-above"><span class="table-number">Table 22:</span> Assertion Functions-1a</caption>

<colgroup>
<col  class="org-left">

<col  class="org-left">

<col  class="org-left">

<col  class="org-left">

<col  class="org-left">
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Library</th>
<th scope="col" class="org-left">Optional string</th>
<th scope="col" class="org-left">Is  (a)</th>
<th scope="col" class="org-left">signals</th>
<th scope="col" class="org-left">finishes (b)</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left"><a href="#orge4344cd">1am</a></td>
<td class="org-left">N</td>
<td class="org-left">is</td>
<td class="org-left">signals</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left"><a href="#org4a2ad7a">2am</a></td>
<td class="org-left">Y (P)</td>
<td class="org-left">is</td>
<td class="org-left">signals</td>
<td class="org-left">finishes</td>
</tr>

<tr>
<td class="org-left"><a href="#orga3783aa">assert-p</a> (1)</td>
<td class="org-left">N</td>
<td class="org-left">t-p</td>
<td class="org-left">condition-error-p</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left"><a href="#org5eea657">clunit</a></td>
<td class="org-left">Y</td>
<td class="org-left">assert-true</td>
<td class="org-left">assert-condition</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left"><a href="#orge473393">clunit2</a></td>
<td class="org-left">Y</td>
<td class="org-left">assert-true</td>
<td class="org-left">assert-condition</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left"><a href="#org4b0d432">confidence</a></td>
<td class="org-left">N</td>
<td class="org-left">assert-true</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left"><a href="#org8d88b5e">gigamonkeys</a></td>
<td class="org-left">N</td>
<td class="org-left">check</td>
<td class="org-left">expect</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left"><a href="#org53910ab">fiasco</a></td>
<td class="org-left">Y (P)</td>
<td class="org-left">is</td>
<td class="org-left">signals</td>
<td class="org-left">finishes</td>
</tr>

<tr>
<td class="org-left"><a href="#org3e895a0">fiveam</a></td>
<td class="org-left">Y (P)</td>
<td class="org-left">is</td>
<td class="org-left">signals</td>
<td class="org-left">finishes</td>
</tr>

<tr>
<td class="org-left"><a href="#orga50a995">lift</a></td>
<td class="org-left">Y</td>
<td class="org-left">ensure</td>
<td class="org-left">ensure-condition</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left"><a href="#orgc6e4266">lisp-unit</a></td>
<td class="org-left">Y</td>
<td class="org-left">assert-true</td>
<td class="org-left">assert-error</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left"><a href="#orgb8996ba">lisp-unit2</a></td>
<td class="org-left">Y</td>
<td class="org-left">assert-true</td>
<td class="org-left">assert-error</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left"><a href="#orga8cfe0a">nst</a></td>
<td class="org-left">N</td>
<td class="org-left">:true</td>
<td class="org-left">:err</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left"><a href="#orga8f69c2">parachute</a></td>
<td class="org-left">Y (P)</td>
<td class="org-left">is</td>
<td class="org-left">fail</td>
<td class="org-left">finish</td>
</tr>

<tr>
<td class="org-left"><a href="#orga7f8a83">prove</a></td>
<td class="org-left">Y</td>
<td class="org-left">is, ok</td>
<td class="org-left">is-error</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left"><a href="#org52f36e5">ptester</a>  (2)</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">test</td>
<td class="org-left">test-error</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left"><a href="#org3d39ad7">rove</a></td>
<td class="org-left">Y</td>
<td class="org-left">ok</td>
<td class="org-left">signals</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left"><a href="#org55cd3c7">rt</a>       (2)</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left"><a href="#org5279729">should-test</a></td>
<td class="org-left">Y</td>
<td class="org-left">be</td>
<td class="org-left">signals</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left"><a href="#org209a1fe">simplet</a>  (2)</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left"><a href="#orgdc1cd10">tap-unit-test</a></td>
<td class="org-left">Y</td>
<td class="org-left">assert-true</td>
<td class="org-left">assert-error</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left"><a href="#orgd9a48e8">try</a></td>
<td class="org-left">Y</td>
<td class="org-left">is</td>
<td class="org-left">signals, signals-not</td>
<td class="org-left">verdict</td>
</tr>

<tr>
<td class="org-left"><a href="#org4b187d6">unit-test</a></td>
<td class="org-left">Y</td>
<td class="org-left">test-assert</td>
<td class="org-left">test-condition</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left"><a href="#orgea91eb1">xlunit</a></td>
<td class="org-left">Y</td>
<td class="org-left">assert-true</td>
<td class="org-left">assert-condition</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left"><a href="#org72de806">xptest</a>    (2)</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>
</tbody>
</table>

<p>
(a) "is" asserts that the form evaluates to not nil
(b) "finishes" asserts that the body of the test does not signal aany condition
(P) The diagnostic string accepts variables
(1) includes cacau for this purpose
(2) None - normal CL predicates resolving to T or nil
</p>

<p>
One potential advantage of other assertion functions is whether they provide built-in additional error messages. The second advantage is that you do not have to write your own if they are more complicated than normal CL predicates. The next few tables will show additional assertion functions and what frameworks have them.
</p>

<table border="2" rules="all" frame="border">
<caption class="t-above"><span class="table-number">Table 23:</span> Additional Assertion Functions-1b</caption>

<colgroup>
<col  class="org-left">

<col  class="org-left">

<col  class="org-left">

<col  class="org-left">

<col  class="org-left">

<col  class="org-left">

<col  class="org-left">

<col  class="org-left">
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Library</th>
<th scope="col" class="org-left">False</th>
<th scope="col" class="org-left">Zero</th>
<th scope="col" class="org-left">Not Zero</th>
<th scope="col" class="org-left">Nil</th>
<th scope="col" class="org-left">Not-Nil</th>
<th scope="col" class="org-left">Null*</th>
<th scope="col" class="org-left">Not Null*</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left"><a href="#orga3783aa">assert-p</a></td>
<td class="org-left">not-t-p</td>
<td class="org-left">zero-p</td>
<td class="org-left">not-zero-p</td>
<td class="org-left">nil-p</td>
<td class="org-left">not-nil-p</td>
<td class="org-left">null-p</td>
<td class="org-left">not-null-p</td>
</tr>

<tr>
<td class="org-left"><a href="#org12efa6c">cacau</a></td>
<td class="org-left">not-t-p</td>
<td class="org-left">zero-p</td>
<td class="org-left">not-zero-p</td>
<td class="org-left">nil-p</td>
<td class="org-left">not-nil-p</td>
<td class="org-left">null-p</td>
<td class="org-left">not-null-p</td>
</tr>

<tr>
<td class="org-left"><a href="#org5eea657">clunit</a></td>
<td class="org-left">assert-false</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left"><a href="#orge473393">clunit2</a></td>
<td class="org-left">assert-false</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left"><a href="#org4b0d432">confidence</a></td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">assert-nil</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left"><a href="#org3e895a0">fiveam</a></td>
<td class="org-left">is-false</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left"><a href="#orga50a995">lift</a></td>
<td class="org-left">ensure-null</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left"><a href="#orgc6e4266">lisp-unit</a></td>
<td class="org-left">assert-false</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">assert-nil</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left"><a href="#orgb8996ba">lisp-unit2</a></td>
<td class="org-left">assert-false</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left"><a href="#orga8cfe0a">nst</a></td>
<td class="org-left">&#xa0;</td>
<td class="org-left">assert-zero</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">assert-non-nil</td>
<td class="org-left">assert-null</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left"><a href="#orga8f69c2">parachute</a></td>
<td class="org-left">false</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">false</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left"><a href="#orga7f8a83">prove</a></td>
<td class="org-left">isnt</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left"><a href="#org3d39ad7">rove</a></td>
<td class="org-left">ng</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left"><a href="#orgdc1cd10">tap-unit-test</a></td>
<td class="org-left">assert-false</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">assert-null</td>
<td class="org-left">assert-not-null</td>
</tr>

<tr>
<td class="org-left"><a href="#orgea91eb1">xlunit</a></td>
<td class="org-left">assert-false</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>
</tbody>
</table>

<p>
Note to self: Per <a href="http://clhs.lisp.se/Body/f_null.htm">http://clhs.lisp.se/Body/f_null.htm</a>, null is an empty list or nil, not null in an sql sense.
</p>

<table border="2" rules="all" frame="border">
<caption class="t-above"><span class="table-number">Table 24:</span> Assertion Functions-2a Equality</caption>

<colgroup>
<col  class="org-left">

<col  class="org-left">

<col  class="org-left">

<col  class="org-left">

<col  class="org-left">

<col  class="org-left">
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Library</th>
<th scope="col" class="org-left">Eq</th>
<th scope="col" class="org-left">Eql</th>
<th scope="col" class="org-left">Equal</th>
<th scope="col" class="org-left">Equalp</th>
<th scope="col" class="org-left">Equality</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left"><a href="#orga3783aa">assert-p</a></td>
<td class="org-left">eq-p</td>
<td class="org-left">eql-p</td>
<td class="org-left">equal-p</td>
<td class="org-left">equalp-p</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left"><a href="#org12efa6c">cacau</a></td>
<td class="org-left">eq-p</td>
<td class="org-left">eql-p</td>
<td class="org-left">equal-p</td>
<td class="org-left">equalp-p</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left"><a href="#org5eea657">clunit</a></td>
<td class="org-left">assert-eq</td>
<td class="org-left">assert-eql</td>
<td class="org-left">assert-equal</td>
<td class="org-left">assert-equalp</td>
<td class="org-left">assert-equality</td>
</tr>

<tr>
<td class="org-left"><a href="#orge473393">clunit2</a></td>
<td class="org-left">assert-eq</td>
<td class="org-left">assert-eql</td>
<td class="org-left">assert-equal</td>
<td class="org-left">assert-equalp</td>
<td class="org-left">assert-equality</td>
</tr>

<tr>
<td class="org-left"><a href="#org4b0d432">confidence</a></td>
<td class="org-left">assert-eq</td>
<td class="org-left">assert-eql</td>
<td class="org-left">assert-equal</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left"><a href="#orgc6e4266">lisp-unit</a></td>
<td class="org-left">assert-eq</td>
<td class="org-left">assert-eql</td>
<td class="org-left">assert-equal</td>
<td class="org-left">assert-equalp</td>
<td class="org-left">assert-equality</td>
</tr>

<tr>
<td class="org-left"><a href="#orgb8996ba">lisp-unit2</a></td>
<td class="org-left">assert-eq</td>
<td class="org-left">assert-eql</td>
<td class="org-left">assert-equal</td>
<td class="org-left">assert-equalp</td>
<td class="org-left">assert-equality</td>
</tr>

<tr>
<td class="org-left"><a href="#orga8cfe0a">nst</a></td>
<td class="org-left">assert-eq</td>
<td class="org-left">assert-eql</td>
<td class="org-left">assert-equal</td>
<td class="org-left">assert-equalp</td>
<td class="org-left">assert-equality</td>
</tr>

<tr>
<td class="org-left"><a href="#orga8f69c2">parachute</a></td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">is</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left"><a href="#orgdc1cd10">tap-unit-test</a></td>
<td class="org-left">assert-eq</td>
<td class="org-left">assert-eql</td>
<td class="org-left">assert-equal</td>
<td class="org-left">assert-equalp</td>
<td class="org-left">assert-equality</td>
</tr>

<tr>
<td class="org-left"><a href="#org4b187d6">unit-test</a></td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">test-equal</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left"><a href="#orgea91eb1">xlunit</a></td>
<td class="org-left">&#xa0;</td>
<td class="org-left">assert-eql</td>
<td class="org-left">assert-equal</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>
</tbody>
</table>

<table border="2" rules="all" frame="border">
<caption class="t-above"><span class="table-number">Table 25:</span> Assertion Functions-2b Not-Equality</caption>

<colgroup>
<col  class="org-left">

<col  class="org-left">

<col  class="org-left">

<col  class="org-left">

<col  class="org-left">
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Library</th>
<th scope="col" class="org-left">Eq</th>
<th scope="col" class="org-left">Eql</th>
<th scope="col" class="org-left">Equal</th>
<th scope="col" class="org-left">Equalp</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left"><a href="#orga3783aa">assert-p</a></td>
<td class="org-left">not-eq-p</td>
<td class="org-left">not-eql-p</td>
<td class="org-left">not-equal-p</td>
<td class="org-left">not-equalp-p</td>
</tr>

<tr>
<td class="org-left"><a href="#org12efa6c">cacau</a></td>
<td class="org-left">not-eq-p</td>
<td class="org-left">not-eql-p</td>
<td class="org-left">not-equal-p</td>
<td class="org-left">not-equalp-p</td>
</tr>

<tr>
<td class="org-left"><a href="#orga8cfe0a">nst</a></td>
<td class="org-left">assert-not-eq</td>
<td class="org-left">assert-not-eql</td>
<td class="org-left">assert-not-equal</td>
<td class="org-left">assert-not-equalp</td>
</tr>

<tr>
<td class="org-left"><a href="#orga8f69c2">parachute</a></td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">isnt</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left"><a href="#orgea91eb1">xlunit</a></td>
<td class="org-left">&#xa0;</td>
<td class="org-left">assert-not-eql</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>
</tbody>
</table>

<p>
<a id="org97dcb48"></a>
</p>
<table border="2" rules="all" frame="border">
<caption class="t-above"><span class="table-number">Table 26:</span> Assertion Functions-2c Bounded Equality</caption>

<colgroup>
<col  class="org-left">

<col  class="org-left">
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Library</th>
<th scope="col" class="org-left">Available assertions</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left"><a href="#org5eea657">clunit</a></td>
<td class="org-left">assert-equality*</td>
</tr>

<tr>
<td class="org-left"><a href="#orge473393">clunit2</a></td>
<td class="org-left">assert-equality*</td>
</tr>

<tr>
<td class="org-left"><a href="#org4b0d432">confidence</a></td>
<td class="org-left">assert-float-is-approximately-equal, assert-float-is-definitely-greater-than, 	assert-float-is-definitely-less-than,  assert-float-is-essentially-equal</td>
</tr>

<tr>
<td class="org-left"><a href="#orgc6e4266">lisp-unit</a></td>
<td class="org-left">assert-norm-equal,  assert-float-equal,  assert-number-equal,  assert-numerical-equal,  assert-rational-equal,  assert-sigfig-equal,</td>
</tr>

<tr>
<td class="org-left"><a href="#orgb8996ba">lisp-unit2</a></td>
<td class="org-left">assert-norm-equal  assert-float-equal  assert-number-equal  assert-numerical-equal,  assert-rational-equal,  assert-sigfig-equal,</td>
</tr>

<tr>
<td class="org-left">try</td>
<td class="org-left">float-~=, float-~&lt;, float-~&gt;</td>
</tr>
</tbody>
</table>


<table border="2" rules="all" frame="border">
<caption class="t-above"><span class="table-number">Table 27:</span> Assertion Functions-2d other Equality</caption>

<colgroup>
<col  class="org-left">

<col  class="org-left">
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Library</th>
<th scope="col" class="org-left">Available assertions</th>
</tr>

<tr>
<th scope="col" class="org-left">&#xa0;</th>
<th scope="col" class="org-left">&#xa0;</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left"><a href="#org4b0d432">confidence</a></td>
<td class="org-left">assert-set-equal, assert-vector-equal</td>
</tr>

<tr>
<td class="org-left"><a href="#orgc6e4266">lisp-unit</a></td>
<td class="org-left">logically-equal, set-equal</td>
</tr>

<tr>
<td class="org-left"><a href="#orgb8996ba">lisp-unit2</a></td>
<td class="org-left">logically-equal</td>
</tr>

<tr>
<td class="org-left"><a href="#orgdc1cd10">tap-unit-test</a></td>
<td class="org-left">logically-equal, set-equal, unordered-equal</td>
</tr>

<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>
</tbody>
</table>

<table border="2" rules="all" frame="border">
<caption class="t-above"><span class="table-number">Table 28:</span> Assertion Functions-</caption>

<colgroup>
<col  class="org-left">

<col  class="org-left">
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Library</th>
<th scope="col" class="org-left">Available assertions</th>
</tr>

<tr>
<th scope="col" class="org-left">&#xa0;</th>
<th scope="col" class="org-left">&#xa0;</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left"><a href="#org4b0d432">confidence</a></td>
<td class="org-left">assert-set-equal, assert-vector-equal</td>
</tr>

<tr>
<td class="org-left"><a href="#orgc6e4266">lisp-unit</a></td>
<td class="org-left">logically-equal, set-equal</td>
</tr>

<tr>
<td class="org-left"><a href="#orgb8996ba">lisp-unit2</a></td>
<td class="org-left">logically-equal</td>
</tr>

<tr>
<td class="org-left"><a href="#orgdc1cd10">tap-unit-test</a></td>
<td class="org-left">logically-equal, set-equal, unordered-equal</td>
</tr>
</tbody>
</table>

<table border="2" rules="all" frame="border">
<caption class="t-above"><span class="table-number">Table 29:</span> Assertion Functions-3a Types</caption>

<colgroup>
<col  class="org-left">

<col  class="org-left">

<col  class="org-left">

<col  class="org-left">

<col  class="org-left">
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Library</th>
<th scope="col" class="org-left">Type</th>
<th scope="col" class="org-left">Not  Type</th>
<th scope="col" class="org-left">Values</th>
<th scope="col" class="org-left">Not-Values</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left"><a href="#orga3783aa">assert-p</a></td>
<td class="org-left">typep-p</td>
<td class="org-left">not-typep-p</td>
<td class="org-left">values-p</td>
<td class="org-left">not-values-p</td>
</tr>

<tr>
<td class="org-left"><a href="#org12efa6c">cacau</a></td>
<td class="org-left">typep-p</td>
<td class="org-left">not-typep-p</td>
<td class="org-left">values-p</td>
<td class="org-left">not-values-p</td>
</tr>

<tr>
<td class="org-left"><a href="#org4b0d432">confidence</a></td>
<td class="org-left">assert-type</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left"><a href="#orga50a995">lift</a></td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left"><a href="#orgc6e4266">lisp-unit</a></td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left"><a href="#orgb8996ba">lisp-unit2</a></td>
<td class="org-left">assert-typep</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left"><a href="#orga8cfe0a">nst</a></td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left"><a href="#orga8f69c2">parachute</a></td>
<td class="org-left">of-type</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">is-values</td>
<td class="org-left">isnt-values</td>
</tr>

<tr>
<td class="org-left"><a href="#org88667e0">protest</a></td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left"><a href="#orga7f8a83">prove</a></td>
<td class="org-left">is-type</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">is-values</td>
<td class="org-left">&#xa0;</td>
</tr>
</tbody>
</table>


<table border="2" rules="all" frame="border">
<caption class="t-above"><span class="table-number">Table 30:</span> Assertion Functions-3b Specific Value Types Cont</caption>

<colgroup>
<col  class="org-left">

<col  class="org-left">

<col  class="org-left">

<col  class="org-left">

<col  class="org-left">

<col  class="org-left">
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Library</th>
<th scope="col" class="org-left">Symbol</th>
<th scope="col" class="org-left">List</th>
<th scope="col" class="org-left">Tuple</th>
<th scope="col" class="org-left">Char</th>
<th scope="col" class="org-left">String</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left"><a href="#orga50a995">lift</a></td>
<td class="org-left">ensure-symbol</td>
<td class="org-left">ensure-list</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">ensure-string</td>
</tr>
</tbody>
</table>

<table border="2" rules="all" frame="border">
<caption class="t-above"><span class="table-number">Table 31:</span> Assertion Functions-3c Strings</caption>

<colgroup>
<col  class="org-left">

<col  class="org-left">
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Library</th>
<th scope="col" class="org-left">Functions</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left"><a href="#org4b0d432">confidence</a></td>
<td class="org-left">assert-string-equal,assert-string&lt;, assert-string&lt;=, 	assert-string=, assert-string&gt;, 	assert-string&gt;=</td>
</tr>
</tbody>
</table>

<table border="2" rules="all" frame="border">
<caption class="t-above"><span class="table-number">Table 32:</span> Assertion Functions-4 Membership</caption>

<colgroup>
<col  class="org-left">

<col  class="org-left">

<col  class="org-left">

<col  class="org-left">

<col  class="org-left">
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Library</th>
<th scope="col" class="org-left">Every</th>
<th scope="col" class="org-left">Different</th>
<th scope="col" class="org-left">Member</th>
<th scope="col" class="org-left">Contains</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left"><a href="#org0489b8f">cl-quickcheck</a></td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">a-member</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left"><a href="#org3e895a0">fiveam</a></td>
<td class="org-left">is-every</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left"><a href="#org4b0d432">confidence</a></td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">assert-subsetp</td>
</tr>

<tr>
<td class="org-left"><a href="#orga50a995">lift</a></td>
<td class="org-left">ensure-every</td>
<td class="org-left">ensure-different</td>
<td class="org-left">ensure-member</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left"><a href="#orgc6e4266">lisp-unit</a></td>
<td class="org-left">set-equal</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left"><a href="#orgb8996ba">lisp-unit2</a></td>
<td class="org-left">set-equal</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left"><a href="#orgdc1cd10">tap-unit-test</a></td>
<td class="org-left">set-equal</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left"><a href="#orgd9a48e8">try</a></td>
<td class="org-left">match-values</td>
<td class="org-left">mismatch%</td>
<td class="org-left">different-elements</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>
</tbody>
</table>

<p>
<a id="orgba88a3c"></a><a id="org24bab62"></a><a id="org8dc7223"></a>
</p>
<table border="2" rules="all" frame="border">
<caption class="t-above"><span class="table-number">Table 33:</span> Assertion Functions-4 (Prints, Macro Expansion and Custom)</caption>

<colgroup>
<col  class="org-left">

<col  class="org-left">

<col  class="org-left">

<col  class="org-left">
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Library</th>
<th scope="col" class="org-left">Prints</th>
<th scope="col" class="org-left">Expands (1)</th>
<th scope="col" class="org-left">Custom</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left"><a href="#org12efa6c">cacau</a></td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">custom-p</td>
</tr>

<tr>
<td class="org-left"><a href="#org5eea657">clunit</a></td>
<td class="org-left">&#xa0;</td>
<td class="org-left">assert-expands</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left"><a href="#orge473393">clunit2</a></td>
<td class="org-left">&#xa0;</td>
<td class="org-left">assert-expands</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left"><a href="#org4b0d432">confidence</a></td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">Yes</td>
</tr>

<tr>
<td class="org-left"><a href="#orgc6e4266">lisp-unit</a></td>
<td class="org-left">assert-prints</td>
<td class="org-left">assert-expands</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left"><a href="#orgb8996ba">lisp-unit2</a></td>
<td class="org-left">assert-prints</td>
<td class="org-left">assert-expands</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left"><a href="#orga8cfe0a">nst</a></td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">Yes</td>
</tr>

<tr>
<td class="org-left"><a href="#orga7f8a83">prove</a></td>
<td class="org-left">&#xa0;</td>
<td class="org-left">is-expand</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left"><a href="#org3d39ad7">rove</a></td>
<td class="org-left">is-print</td>
<td class="org-left">expands</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left"><a href="#org5279729">should-test</a></td>
<td class="org-left">print-to</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left"><a href="#orgdc1cd10">tap-unit-test</a></td>
<td class="org-left"><a href="#orga3783aa">assert-p</a>rints</td>
<td class="org-left">assert-expands</td>
<td class="org-left">&#xa0;</td>
</tr>
</tbody>
</table>

<ol class="org-ol">
<li>Tests macro expansion, passes if (EQUALP EXPANSION (MACROEXPAND-1 EXPRESSION)) is true</li>
</ol>

<table border="2" rules="all" frame="border">
<caption class="t-above"><span class="table-number">Table 34:</span> Assertion Functions-5 Specific Errors, Signals and Conditions</caption>

<colgroup>
<col  class="org-left">

<col  class="org-left">

<col  class="org-left">
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Library</th>
<th scope="col" class="org-left">Error/Conditions     (1)</th>
<th scope="col" class="org-left">Not  (2)</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left"><a href="#orge4344cd">1am</a></td>
<td class="org-left">signals</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left"><a href="#org4a2ad7a">2am</a></td>
<td class="org-left">signals</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left"><a href="#orga3783aa">assert-p</a></td>
<td class="org-left">condition-error-p</td>
<td class="org-left">not-error-p, not-condition-p</td>
</tr>

<tr>
<td class="org-left"><a href="#org12efa6c">cacau</a></td>
<td class="org-left">condition-error-p</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left"><a href="#org5eea657">clunit</a></td>
<td class="org-left">assert-condition</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left"><a href="#orge473393">clunit2</a></td>
<td class="org-left">assert-condition</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left"><a href="#org8d88b5e">gigamonkeys</a></td>
<td class="org-left">expect</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left"><a href="#org53910ab">fiasco</a></td>
<td class="org-left">signals</td>
<td class="org-left">not-signals</td>
</tr>

<tr>
<td class="org-left"><a href="#org3e895a0">fiveam</a></td>
<td class="org-left">signals</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left"><a href="#orga50a995">lift</a></td>
<td class="org-left">ensure-condition, ensure-error</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left"><a href="#orgc6e4266">lisp-unit</a></td>
<td class="org-left">assert-error</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left"><a href="#orgb8996ba">lisp-unit2</a></td>
<td class="org-left">assert-error</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left"><a href="#orga8cfe0a">nst</a></td>
<td class="org-left">:err</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left"><a href="#orga8f69c2">parachute</a></td>
<td class="org-left">fail</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left"><a href="#orga7f8a83">prove</a></td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left"><a href="#org52f36e5">ptester</a></td>
<td class="org-left">test-error</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left"><a href="#org3d39ad7">rove</a></td>
<td class="org-left">signals</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left"><a href="#org55cd3c7">rt</a></td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left"><a href="#org5279729">should-test</a></td>
<td class="org-left">signal</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left"><a href="#org209a1fe">simplet</a></td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left"><a href="#orgdc1cd10">tap-unit-test</a></td>
<td class="org-left">assert-error</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left"><a href="#orgd9a48e8">try</a></td>
<td class="org-left">signals</td>
<td class="org-left">signals-not</td>
</tr>

<tr>
<td class="org-left"><a href="#org4b187d6">unit-test</a></td>
<td class="org-left">test-condition</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left"><a href="#orgea91eb1">xlunit</a></td>
<td class="org-left">assert-condition</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left"><a href="#org72de806">xptest</a></td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>
</tbody>
</table>

<ol class="org-ol">
<li>Signals asserts that the body signals a condition of a specified type</li>
<li>Signals that the body does not signal a condition of a specified type. Might signal some other condition</li>
</ol>

<p>
<a href="#org63aa282">top</a>
</p>

<table border="2" rules="all" frame="border">
<caption class="t-above"><span class="table-number">Table 35:</span> Misc. Assertions</caption>

<colgroup>
<col  class="org-left">

<col  class="org-left">
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Name</th>
<th scope="col" class="org-left">Assertions</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left"><a href="#org0489b8f">cl-quickcheck</a></td>
<td class="org-left">is=, isnt=</td>
</tr>

<tr>
<td class="org-left"><a href="#org4b0d432">confidence</a></td>
<td class="org-left">assert=, assert-p:, 	assert-t</td>
</tr>

<tr>
<td class="org-left"><a href="#orga50a995">lift</a></td>
<td class="org-left">ensure-cases, ensure-cases-failure, ensure-expected-no-warning-condition, ensure-failed-error, ensure-no-warning, ensure-not-same, ensure-null-failed-error ensure-random-cases, ensure-random-cases+, ensure-random-cases-failure, ensure-same, ensure-some,	ensure-warning,ensure-expected-condition, ensure-directories-exist, ensure-directory, ensure-error, ensure-failed, 	ensure-function, ensure-generic-function, ensure-no-warning, ensure-null-failed-error</td>
</tr>

<tr>
<td class="org-left"><a href="#orgc6e4266">lisp-unit</a></td>
<td class="org-left">assert-result, assert-test, check-type</td>
</tr>

<tr>
<td class="org-left"><a href="#orgb8996ba">lisp-unit2</a></td>
<td class="org-left">assert-no-error, assert-no-signal, assert-no-warning,   assert-warning, assert-fail, assert-no-warning,	assert-passes?, assert-signal, check-type</td>
</tr>

<tr>
<td class="org-left"><a href="#orga8cfe0a">nst</a></td>
<td class="org-left">assert-criterion</td>
</tr>

<tr>
<td class="org-left"><a href="#orga7f8a83">prove</a></td>
<td class="org-left">ok, is-values, is-type, like, is-print, is-error,</td>
</tr>

<tr>
<td class="org-left"><a href="#org4b187d6">unit-test</a></td>
<td class="org-left">test-assert</td>
</tr>
</tbody>
</table>

<p>
(a) Every test succeeds iff the form produces the same number of results as the values and each result is equal to the corresponding value
</p>

<p>
<a href="#org63aa282">top</a>
</p>
</div>
</div>

<div id="outline-container-org70a877d" class="outline-3">
<h3 id="org70a877d"><span class="section-number-3">8.2.</span> Defining or Adding Tests</h3>
<div class="outline-text-3" id="text-8-2">
<table border="2" rules="all" frame="border">
<caption class="t-above"><span class="table-number">Table 36:</span> Defining or Adding Test Functions</caption>

<colgroup>
<col  class="org-left">

<col  class="org-left">
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Name</th>
<th scope="col" class="org-left">Add Tests</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left"><a href="#orge4344cd">1am</a></td>
<td class="org-left">(test test-name body)</td>
</tr>

<tr>
<td class="org-left"><a href="#org4a2ad7a">2am</a></td>
<td class="org-left">(test test-name body)</td>
</tr>

<tr>
<td class="org-left"><a href="#org12efa6c">cacau</a></td>
<td class="org-left">(deftest "test-name" (any-parameters go here) body)</td>
</tr>

<tr>
<td class="org-left"><a href="#org0760669">cardiogram</a></td>
<td class="org-left">(deftest name (&lt;options&gt;*) &lt;docstring&gt;* &lt;form&gt;*)</td>
</tr>

<tr>
<td class="org-left"><a href="#org5eea657">clunit</a></td>
<td class="org-left">(deftest test-name (suite-name-if-any) docstring body)</td>
</tr>

<tr>
<td class="org-left"><a href="#orge473393">clunit2</a></td>
<td class="org-left">(deftest test-name (suite-name-if-any) docstring body)</td>
</tr>

<tr>
<td class="org-left"><a href="#org8d88b5e">gigamonkeys</a></td>
<td class="org-left">(deftest test-name (any-parameters) body)</td>
</tr>

<tr>
<td class="org-left"><a href="#org53910ab">fiasco</a></td>
<td class="org-left">(deftest test-name (any-parameters) docstring body)</td>
</tr>

<tr>
<td class="org-left"><a href="#org3e895a0">fiveam</a></td>
<td class="org-left">(test test-name docstring body)</td>
</tr>

<tr>
<td class="org-left"><a href="#org4b0d432">confidence</a></td>
<td class="org-left">(define-testcase test-name (any-parameters) docstring body)</td>
</tr>

<tr>
<td class="org-left"><a href="#orga50a995">lift</a></td>
<td class="org-left">(addtest (test-suite-name) test-name body)</td>
</tr>

<tr>
<td class="org-left"><a href="#orgc6e4266">lisp-unit</a></td>
<td class="org-left">(define-test test-name body)</td>
</tr>

<tr>
<td class="org-left"><a href="#orgb8996ba">lisp-unit2</a></td>
<td class="org-left">(define-test test-name (tags) body)</td>
</tr>

<tr>
<td class="org-left"><a href="#orga8cfe0a">nst</a></td>
<td class="org-left">(def-test (t1 :group name :fixtures (fixture-names)) body)</td>
</tr>

<tr>
<td class="org-left"><a href="#orga8f69c2">parachute</a></td>
<td class="org-left">(define-test test-name [:parent parent-name] [(:fixture if any)] body)</td>
</tr>

<tr>
<td class="org-left"><a href="#orga7f8a83">prove</a></td>
<td class="org-left">(deftest name body)</td>
</tr>

<tr>
<td class="org-left"><a href="#org52f36e5">ptester</a></td>
<td class="org-left">(test value form) (test-error) (test-no-error) (test-warning) (test-no-warning)</td>
</tr>

<tr>
<td class="org-left"><a href="#org3d39ad7">rove</a></td>
<td class="org-left">(deftest test-name body)</td>
</tr>

<tr>
<td class="org-left"><a href="#org55cd3c7">rt</a></td>
<td class="org-left">(deftest test-name function value)</td>
</tr>

<tr>
<td class="org-left"><a href="#org5279729">should-test</a></td>
<td class="org-left">(deftest name body)</td>
</tr>

<tr>
<td class="org-left"><a href="#org209a1fe">simplet</a></td>
<td class="org-left">(test string body)</td>
</tr>

<tr>
<td class="org-left"><a href="#orgdc1cd10">tap-unit-test</a></td>
<td class="org-left">(define-test test-name docstring body)</td>
</tr>

<tr>
<td class="org-left"><a href="#orgd9a48e8">try</a></td>
<td class="org-left">(deftest test-name parameters body</td>
</tr>

<tr>
<td class="org-left"><a href="#org4b187d6">unit-test</a></td>
<td class="org-left">(deftest :unit unit-name :name test-name body)</td>
</tr>

<tr>
<td class="org-left"><a href="#orgea91eb1">xlunit</a></td>
<td class="org-left">(def-test-method method-name ((class-name) run-on-compilation) body)</td>
</tr>

<tr>
<td class="org-left"><a href="#org72de806">xptest</a></td>
<td class="org-left">(defmethod method-name ((suite-name fixture-name)) body)</td>
</tr>
</tbody>
</table>

<p>
<a href="#org63aa282">top</a>
</p>
</div>
</div>
<div id="outline-container-org483e865" class="outline-3">
<h3 id="org483e865"><span class="section-number-3">8.3.</span> Running Tests</h3>
<div class="outline-text-3" id="text-8-3">
<table border="2" rules="all" frame="border">
<caption class="t-above"><span class="table-number">Table 37:</span> Running Test Functions</caption>

<colgroup>
<col  class="org-left">

<col  class="org-left">
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Name</th>
<th scope="col" class="org-left">Running Tests</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left"><a href="#orge4344cd">1am</a>       (a)</td>
<td class="org-left">(test-name) (run) ; (run) runs all tests</td>
</tr>

<tr>
<td class="org-left"><a href="#org4a2ad7a">2am</a></td>
<td class="org-left">(run)    (run '(list of tests)  (name-of-tests)</td>
</tr>

<tr>
<td class="org-left"><a href="#org5eea657">clunit</a></td>
<td class="org-left">(run-test 'test-name) (run-suite 'suite-name)</td>
</tr>

<tr>
<td class="org-left"><a href="#orge473393">clunit2</a></td>
<td class="org-left">(run-test 'test-name) (run-suite 'suite-name)</td>
</tr>

<tr>
<td class="org-left"><a href="#org4b0d432">confidence</a></td>
<td class="org-left">(test-name)</td>
</tr>

<tr>
<td class="org-left"><a href="#org8d88b5e">gigamonkeys</a></td>
<td class="org-left">(test test-name)</td>
</tr>

<tr>
<td class="org-left"><a href="#org53910ab">fiasco</a></td>
<td class="org-left">(run-tests 'test-name) (run-package-tests :package package-name)</td>
</tr>

<tr>
<td class="org-left"><a href="#org3e895a0">fiveam</a></td>
<td class="org-left">(run 'test-name) (run! 'test-name) (run! 'suite-name)</td>
</tr>

<tr>
<td class="org-left"><a href="#orga50a995">lift</a></td>
<td class="org-left">(run-tests :name 'test-name) (run-tests :suite 'suite-name)</td>
</tr>

<tr>
<td class="org-left"><a href="#orgc6e4266">lisp-unit</a>(b)</td>
<td class="org-left">(run-tests :all) (run-tests '(name1 name2 ..) (continue-testing)(c)</td>
</tr>

<tr>
<td class="org-left"><a href="#orgb8996ba">lisp-unit2</a></td>
<td class="org-left">(run-tests :tests 'test-name) (run-tests :tags '(tag-names)) (run-tests) (run-tests :package 'package-name)</td>
</tr>

<tr>
<td class="org-left"><a href="#orga8cfe0a">nst</a></td>
<td class="org-left">(nst-cmd :run test-name)</td>
</tr>

<tr>
<td class="org-left"><a href="#orga8f69c2">parachute</a> (d)</td>
<td class="org-left">(test test-name &amp;optional :report report-type)</td>
</tr>

<tr>
<td class="org-left"><a href="#orga7f8a83">prove</a></td>
<td class="org-left">(run-test 'test-name)</td>
</tr>

<tr>
<td class="org-left"><a href="#org52f36e5">ptester</a></td>
<td class="org-left">at compilation of (with-tests (:name "test-name") )</td>
</tr>

<tr>
<td class="org-left"><a href="#org3d39ad7">rove</a></td>
<td class="org-left">(run-test 'test-name) (run-suite)</td>
</tr>

<tr>
<td class="org-left"><a href="#org55cd3c7">rt</a>        (b)</td>
<td class="org-left">(do-test test-name) (do-tests); (do-tests) runs all tests</td>
</tr>

<tr>
<td class="org-left"><a href="#org5279729">should-test</a> (b)</td>
<td class="org-left">(test) (test :test test-name)</td>
</tr>

<tr>
<td class="org-left"><a href="#org209a1fe">simplet</a></td>
<td class="org-left">(run)</td>
</tr>

<tr>
<td class="org-left"><a href="#orgdc1cd10">tap-unit-test</a></td>
<td class="org-left">(run-tests test-name1 test-name2) (run-tests)</td>
</tr>

<tr>
<td class="org-left"><a href="#orgd9a48e8">try</a></td>
<td class="org-left">(test-name), (try 'test-name), (funcall 'test-name)</td>
</tr>

<tr>
<td class="org-left"><a href="#org4b187d6">unit-test</a></td>
<td class="org-left">(run-test test-name)(run-all-tests)</td>
</tr>

<tr>
<td class="org-left"><a href="#orgea91eb1">xlunit</a></td>
<td class="org-left">(xlunit:textui-test-run (xlunit:get-suite suite-name))</td>
</tr>

<tr>
<td class="org-left"><a href="#org72de806">xptest</a></td>
<td class="org-left">(run-test test-name)(run-test suite-name)</td>
</tr>
</tbody>
</table>
<p>
(a) Shuffles tests
(b) runs tests in the order they were defined
(c) continue-testing runs tests that have been defined, but not yet run
(d) can be a quoted list of test names
</p>
</div>
</div>

<div id="outline-container-org93850a0" class="outline-3">
<h3 id="org93850a0"><span class="section-number-3">8.4.</span> Fixture Functions</h3>
<div class="outline-text-3" id="text-8-4">
<table border="2" rules="all" frame="border">
<caption class="t-above"><span class="table-number">Table 38:</span> Fixtures</caption>

<colgroup>
<col  class="org-left">

<col  class="org-left">
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Name</th>
<th scope="col" class="org-left">Fixture Functions</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left"><a href="#org12efa6c">cacau</a></td>
<td class="org-left">(defbefore-all), (defafter-all), (defbefore-each), (defafter-each)</td>
</tr>

<tr>
<td class="org-left"><a href="#org5eea657">clunit</a></td>
<td class="org-left">(defclass) and (deffixture)</td>
</tr>

<tr>
<td class="org-left"><a href="#orge473393">clunit2</a></td>
<td class="org-left">(defclass) and (deffixture)</td>
</tr>

<tr>
<td class="org-left"><a href="#org3e895a0">fiveam</a></td>
<td class="org-left">(def-fixture name-of-fixture ())</td>
</tr>

<tr>
<td class="org-left"><a href="#orga50a995">lift</a></td>
<td class="org-left">set at suite definition level, with :setup, :takedown, :run-setup</td>
</tr>

<tr>
<td class="org-left"><a href="#orgb8996ba">lisp-unit2</a></td>
<td class="org-left">:contexts are specified in test definitions</td>
</tr>

<tr>
<td class="org-left"><a href="#orga8cfe0a">nst</a></td>
<td class="org-left">(def-fixtures name () body)</td>
</tr>

<tr>
<td class="org-left"><a href="#orga8f69c2">parachute</a></td>
<td class="org-left">(def-fixture name () body)</td>
</tr>

<tr>
<td class="org-left"><a href="#org3d39ad7">rove</a></td>
<td class="org-left">(setup)(teardown) are suite fixture functions. (defhook) is a test fixture function</td>
</tr>

<tr>
<td class="org-left"><a href="#org4b187d6">unit-test</a></td>
<td class="org-left">subclass a test-class with define-test-class</td>
</tr>

<tr>
<td class="org-left"><a href="#orgea91eb1">xlunit</a></td>
<td class="org-left">(defmethod setup () body)</td>
</tr>

<tr>
<td class="org-left"><a href="#org72de806">xptest</a></td>
<td class="org-left">(deftest-fixture fixture-name ()), (defmethod setup ()), (defmethod teardown ())</td>
</tr>
</tbody>
</table>

<p>
<a href="#org63aa282">top</a>
</p>
</div>
</div>
<div id="outline-container-org111e7e2" class="outline-3">
<h3 id="org111e7e2"><span class="section-number-3">8.5.</span> Removing Tests etc</h3>
<div class="outline-text-3" id="text-8-5">
<table border="2" rules="all" frame="border">
<caption class="t-above"><span class="table-number">Table 39:</span> Removing Tests</caption>

<colgroup>
<col  class="org-left">

<col  class="org-left">
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Name</th>
<th scope="col" class="org-left">Removing tests etc</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left"><a href="#org5eea657">clunit</a></td>
<td class="org-left">(undeftest) (undeffixture) (undefsuite)</td>
</tr>

<tr>
<td class="org-left"><a href="#orge473393">clunit2</a></td>
<td class="org-left">(undeftest) (undeffixture) (undefsuite)</td>
</tr>

<tr>
<td class="org-left"><a href="#org8d88b5e">gigamonkeys</a></td>
<td class="org-left">(remove-test-function) (clear-package-tests)</td>
</tr>

<tr>
<td class="org-left"><a href="#org53910ab">fiasco</a></td>
<td class="org-left">(fiasco::delete-test)</td>
</tr>

<tr>
<td class="org-left"><a href="#org3e895a0">fiveam</a></td>
<td class="org-left">(rem-test) (rem-fixture)</td>
</tr>

<tr>
<td class="org-left"><a href="#orga50a995">lift</a></td>
<td class="org-left">(remove-test :suite x)(remove-test :test-case x)</td>
</tr>

<tr>
<td class="org-left"><a href="#orgc6e4266">lisp-unit</a></td>
<td class="org-left">(remove-tests) (remove-tags)</td>
</tr>

<tr>
<td class="org-left"><a href="#orgb8996ba">lisp-unit2</a></td>
<td class="org-left">(uninstall-test) (undefine-test)</td>
</tr>

<tr>
<td class="org-left"><a href="#orga8f69c2">parachute</a></td>
<td class="org-left">(remove-test, remove-all-tests-in-package)</td>
</tr>

<tr>
<td class="org-left"><a href="#orga7f8a83">prove</a></td>
<td class="org-left">(remove-test) (remove-test-all)</td>
</tr>

<tr>
<td class="org-left"><a href="#org55cd3c7">rt</a></td>
<td class="org-left">(rem-test) (rem-all-tests)</td>
</tr>

<tr>
<td class="org-left"><a href="#orgdc1cd10">tap-unit-test</a></td>
<td class="org-left">(remove-tests)</td>
</tr>

<tr>
<td class="org-left"><a href="#orgd9a48e8">try</a></td>
<td class="org-left">FMAKUNBOUND, UNINTERN</td>
</tr>

<tr>
<td class="org-left"><a href="#orgea91eb1">xlunit</a></td>
<td class="org-left">(remove-test)</td>
</tr>

<tr>
<td class="org-left"><a href="#org72de806">xptest</a></td>
<td class="org-left">(remove-test)</td>
</tr>
</tbody>
</table>
<p>
<a href="#org63aa282">top</a>
</p>
</div>
</div>
<div id="outline-container-org9b1461c" class="outline-3">
<h3 id="org9b1461c"><span class="section-number-3">8.6.</span> Suites</h3>
<div class="outline-text-3" id="text-8-6">
<table border="2" rules="all" frame="border">
<caption class="t-above"><span class="table-number">Table 40:</span> Suite Functions</caption>

<colgroup>
<col  class="org-left">

<col  class="org-left">
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Name</th>
<th scope="col" class="org-left">Suites</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left"><a href="#org4a2ad7a">2am</a></td>
<td class="org-left">(suite name (optional sub-suite)</td>
</tr>

<tr>
<td class="org-left"><a href="#org5eea657">clunit</a></td>
<td class="org-left">(defsuite name (parent) (undefsuite name)</td>
</tr>

<tr>
<td class="org-left"><a href="#orge473393">clunit2</a></td>
<td class="org-left">(defsuite name (parent) (undefsuite name)</td>
</tr>

<tr>
<td class="org-left"><a href="#org53910ab">fiasco</a></td>
<td class="org-left">(define-test-package package-name)  (defsuite suite-name)</td>
</tr>

<tr>
<td class="org-left"><a href="#org3e895a0">fiveam</a></td>
<td class="org-left">(def-suite :name-of-suite)</td>
</tr>

<tr>
<td class="org-left"><a href="#orga50a995">lift</a></td>
<td class="org-left">(deftestsuite name-of-suite (super-test-suite)(slots)</td>
</tr>

<tr>
<td class="org-left"><a href="#orgc6e4266">lisp-unit</a></td>
<td class="org-left">packages and tags (tags are specified in the test definition)</td>
</tr>

<tr>
<td class="org-left"><a href="#orgb8996ba">lisp-unit2</a></td>
<td class="org-left">:tags are specified in test definitions</td>
</tr>

<tr>
<td class="org-left"><a href="#orga8cfe0a">nst</a></td>
<td class="org-left">(def-test-group)</td>
</tr>

<tr>
<td class="org-left"><a href="#orga8f69c2">parachute</a></td>
<td class="org-left">(define-test suite)</td>
</tr>

<tr>
<td class="org-left"><a href="#orga7f8a83">prove</a></td>
<td class="org-left">(subtest &#x2026;)</td>
</tr>

<tr>
<td class="org-left"><a href="#org52f36e5">ptester</a></td>
<td class="org-left">just the use of =(with-tests &#x2026;)+</td>
</tr>

<tr>
<td class="org-left"><a href="#org55cd3c7">rt</a></td>
<td class="org-left">the package is the only unit above tests</td>
</tr>

<tr>
<td class="org-left"><a href="#org5279729">should-test</a></td>
<td class="org-left">the package is the only unit above tests</td>
</tr>

<tr>
<td class="org-left"><a href="#org209a1fe">simplet</a></td>
<td class="org-left">(suite string body)</td>
</tr>

<tr>
<td class="org-left"><a href="#orgdc1cd10">tap-unit-test</a></td>
<td class="org-left">the package is the only unit above tests</td>
</tr>

<tr>
<td class="org-left"><a href="#orgd9a48e8">try</a></td>
<td class="org-left">just include subtests in a deftest form</td>
</tr>

<tr>
<td class="org-left"><a href="#org4b187d6">unit-test</a></td>
<td class="org-left">[effectively tags in the deftest macro before the test-name]</td>
</tr>

<tr>
<td class="org-left"><a href="#orgea91eb1">xlunit</a></td>
<td class="org-left">(defclass test-case-name (test-case)(body))</td>
</tr>

<tr>
<td class="org-left"><a href="#org72de806">xptest</a></td>
<td class="org-left">(make-test-suite suite-name docstring body)</td>
</tr>
</tbody>
</table>

<p>
<a href="#org63aa282">top</a>
</p>
</div>
</div>

<div id="outline-container-orge438b25" class="outline-3">
<h3 id="orge438b25"><span class="section-number-3">8.7.</span> Generators</h3>
<div class="outline-text-3" id="text-8-7">
</div>
<ol class="org-ol">
<li><a id="org8ced128"></a>From Frameworks<br>
<div class="outline-text-4" id="text-8-7-1">
<table border="2" rules="all" frame="border">
<caption class="t-above"><span class="table-number">Table 41:</span> Random Data Generators from Frameworks</caption>

<colgroup>
<col  class="org-left">

<col  class="org-left">
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Name</th>
<th scope="col" class="org-left">Suites</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left"><a href="#org3e895a0">fiveam</a></td>
<td class="org-left">buffer, character, float, integer, list, one-element, string, tree</td>
</tr>

<tr>
<td class="org-left"><a href="#orga50a995">lift</a></td>
<td class="org-left">random-number, random-element</td>
</tr>

<tr>
<td class="org-left"><a href="#orgc6e4266">lisp-unit</a></td>
<td class="org-left">complex-random, make-random-2d-array, make-random-2d-list, make-random-list, make-random-state</td>
</tr>

<tr>
<td class="org-left"><a href="#orgb8996ba">lisp-unit2</a></td>
<td class="org-left">complex-random, make-random-2d-array, make-random-2d-list, make-random-list, make-random-state</td>
</tr>

<tr>
<td class="org-left"><a href="#orga8cfe0a">nst</a></td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left"><a href="#orgdc1cd10">tap-unit-test</a></td>
<td class="org-left">make-random-state</td>
</tr>
</tbody>
</table>
</div>
</li>

<li><a id="org587601a"></a>From Helper Libraries<br>
<div class="outline-text-4" id="text-8-7-2">
<p>
<a id="org6ac4b00"></a>
</p>
<table border="2" rules="all" frame="border">
<caption class="t-above"><span class="table-number">Table 42:</span> Random Data Generators from Check-it and Cl-Quickcheck</caption>

<colgroup>
<col  class="org-left">

<col  class="org-left">

<col  class="org-left">
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Check-it</th>
<th scope="col" class="org-left">Cl-quickcheck</th>
<th scope="col" class="org-left">Comments</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">character</td>
<td class="org-left">a-char</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">list</td>
<td class="org-left">a-list</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">a-member</td>
<td class="org-left">Produces a value from another generator</td>
</tr>

<tr>
<td class="org-left">string</td>
<td class="org-left">a-string</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">a-symbol</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">tuple</td>
<td class="org-left">a-tuple</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">boolean</td>
<td class="org-left">a-boolean</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">real</td>
<td class="org-left">a-real</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">an-index</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">integer</td>
<td class="org-left">an-integer</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">or</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">produces a value from another generator</td>
</tr>

<tr>
<td class="org-left">guard</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">ensures generator result within some spec</td>
</tr>

<tr>
<td class="org-left">struct</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">generates a struct with given type and slot values</td>
</tr>

<tr>
<td class="org-left">map</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">applies a transformation to output of a sub generator</td>
</tr>

<tr>
<td class="org-left">chain</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">chaining generators, e.g. to produce matrices</td>
</tr>

<tr>
<td class="org-left">user-define</td>
<td class="org-left">define</td>
<td class="org-left">create custom generators</td>
</tr>

<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">k-generator</td>
<td class="org-left">by default an index</td>
</tr>

<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">m-generator</td>
<td class="org-left">by default an integer</td>
</tr>

<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">n-generator</td>
<td class="org-left">by default an integer</td>
</tr>
</tbody>
</table>

<p>
<a href="#org63aa282">top</a>
</p>
</div>
</li>
</ol>
</div>
</div>

<div id="outline-container-orge44f059" class="outline-2">
<h2 id="orge44f059"><span class="section-number-2">9.</span> Generic Usage Example to be Followed for Each Framework Library</h2>
<div class="outline-text-2" id="text-9">
<p>
The following is <b>pseudo code</b> just trying to show the basic usage that will be demonstrated with each library.
</p>
</div>
<div id="outline-container-org2570067" class="outline-3">
<h3 id="org2570067"><span class="section-number-3">9.1.</span> Basics</h3>
<div class="outline-text-3" id="text-9-1">
<p>
Start with the real basics just to see how the framework looks, do tests accept parameters,
suite designations, documentation strings, etc.
</p>

<p>
The first passing test should have a basic "is" test and a signals test. If the libraries has macro expand tests or floating point and rational tests, those get added to flag that they exist. Then a basic failing test. Then run each test and show what the reports look like.
</p>
<div class="org-src-container">
<pre class="src src-lisp">(deftest t1
  <span class="org-string">"describe t1"</span> <span class="org-comment">; obviously only if the library allows a documentation string.</span>
  (is (=  1 1))
  (signals division-by-zero (<span class="org-warning">error</span> 'division-by-zero)))

(deftest t1-fail <span class="org-comment">; the most basic failing test</span>
  <span class="org-string">"describe t1-fail"</span>
  (is (=  1 2)))
</pre>
</div>
<p>
Check and see if you have to manually recompile a test when a function being tested is modified. This is not a problem with most frameworks.
</p>
<div class="org-src-container">
<pre class="src src-lisp">(<span class="org-keyword">defun</span> <span class="org-function-name">t1-test-function</span> ()
  1)
<span class="org-comment-delimiter">;; </span><span class="org-comment">What happens you are testing a function and you change that function?</span>
<span class="org-comment-delimiter">;; </span><span class="org-comment">Do you need to recompile the test?</span>

(deftest t1-function <span class="org-comment">;</span>
    (is (= (t1-test-function) 1)))

<span class="org-comment-delimiter">;; </span><span class="org-comment">Now redefine t1-test-function</span>
(<span class="org-keyword">defun</span> <span class="org-function-name">t1-test-function</span> ()
  2)

<span class="org-comment-delimiter">;; </span><span class="org-comment">re-run test t1-function. What happens?</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-org93d2da7" class="outline-3">
<h3 id="org93d2da7"><span class="section-number-3">9.2.</span> Multiple Values, Variables, Loops and Closures</h3>
<div class="outline-text-3" id="text-9-2">
<ul class="org-ul">
<li>Make sure the library can have tests with multiple assertions (RT cannot).</li>
<li>Does it handle values expressions? Most do but only look at the first value, fiveam does not, the lisp-units actually compare each variable in the values expressions.</li>
<li>What happens with multiple assertions where more than one fail? Lift will only report the first failing assertion if there are multiple failing assertions.</li>
<li>Ensure that tests can handle loops</li>
<li>Can tests handle being inside a closure?</li>
<li>Can tests call other tests? Most frameworks allow this, but you tend to get multiple reports rather than consolidated reports. Some frameworks do not allow this.</li>
</ul>

<div class="org-src-container">
<pre class="src src-lisp">(deftest t2
  <span class="org-string">"describe t2"</span>
  (is (= 1 1))
  (is (= 2 2))
  (is (= (values 1 2) (values 1 3))))

(<span class="org-keyword">let</span> ((l1 '(#\a #\B #\z))
      (l2 '(97 66 122)))
  (deftest t2-loop
      (<span class="org-keyword">loop</span> for x in l1 for y in l2 do
        (is (= (char-code x) y)))))

(deftest t3 <span class="org-comment">; a test that tries to call another test in its body</span>
  <span class="org-string">"describe t3"</span>
  (is (= 'a 'a))
  (test t2))
</pre>
</div>
</div>
</div>
<div id="outline-container-org004af2f" class="outline-3">
<h3 id="org004af2f"><span class="section-number-3">9.3.</span> Errors, Conditions and signal handling</h3>
<div class="outline-text-3" id="text-9-3">
<p>
Check and see if there are any surprises with respect to condition signalling tests. Some frameworks will treat an unexpected condition in a signalling test as a failure, others will treat it as an error.
</p>
<div class="org-src-container">
<pre class="src src-lisp">(deftest t7-bad-error ()
(signals division-by-zero
   (<span class="org-warning">error</span> 'floating-point-overflow)
   <span class="org-string">"testing condition assertions. This should fail"</span>))
</pre>
</div>
</div>
</div>
<div id="outline-container-orgdd31ea4" class="outline-3">
<h3 id="orgdd31ea4"><span class="section-number-3">9.4.</span> Suites, tags and other multiple test abilities</h3>
<div class="outline-text-3" id="text-9-4">
</div>
<ol class="org-ol">
<li><a id="org69c7dfc"></a>Can you run a list of tests?<br>
<div class="outline-text-4" id="text-9-4-1">
<p>
We checked with test t3 to see if tests can call other tests. Can you just call a list of test names? Some frameworks allow, others do not.
</p>
<div class="org-src-container">
<pre class="src src-lisp">(run '(t1 t2))
</pre>
</div>
</div>
</li>
<li><a id="orge46136e"></a>Suites/tags<br>
<div class="outline-text-4" id="text-9-4-2">
<p>
This section for each framework will check if you can create inherited test suites or tags
</p>
<div class="org-src-container">
<pre class="src src-lisp">(defsuite s0 ())<span class="org-comment">; Ultimate parent suite if the library provides inheritance</span>

  (deftest t4 (s0) <span class="org-comment">; a test that is a member of a suite</span>
    <span class="org-string">"describe t4"</span>
    (<span class="org-warning">assert-eq</span> 1 1))

  <span class="org-comment-delimiter">;;</span><span class="org-comment">a multiple assertion test that is a member of a suite with</span>
  <span class="org-comment-delimiter">;; </span><span class="org-comment">a passing test, an error signaled and a failing test</span>
  (deftest t4-error (s0)
    <span class="org-string">"describe t4-error"</span>
    (<span class="org-warning">assert-eq</span>  'a 'a)
    (<span class="org-warning">assert-condition</span> error (<span class="org-warning">error</span> <span class="org-string">"t4-errored out"</span>))
    (<span class="org-warning">assert-true</span> (= 1 2)))

  (deftest t4-fail (s0) <span class="org-comment">;</span>
    <span class="org-string">"describe t4-fail"</span>
    (<span class="org-warning">assert-false</span> (= 1 2)))

(defsuite s1 (s0))<span class="org-comment">; a sub-suite of suite s0 to check on inheritance</span>
  (deftest t5 (s1)
   (<span class="org-warning">assert-true</span> (= 1 1)))

</pre>
</div>
</div>
</li>
<li><a id="orgec15d5b"></a>Fixtures and Freezing Data<br>
<div class="outline-text-4" id="text-9-4-3">
<p>
Fixtures are used to create a known (or randomly generated set of data that tests will use. At the end of the test, the fixtures are removed so that the next test can start in a clean environment.
</p>

<p>
Freezing data may be considered a subset of fixtures. Freezing data is used where a test will use other existing data such as special variables, but may change it for testing purposes. You obviously want to return that special variable to its pre-existing state at the end of the test.
</p>

<p>
First checking whether we can freeze data, change it in the test, then change it back
</p>
<div class="org-src-container">
<pre class="src src-lisp">  (<span class="org-keyword">defparameter</span> <span class="org-variable-name">*keep-this-data*</span> 1)

  (deftest t-freeze-1
      <span class="org-builtin">:fix</span> (*keep-this-data*)
      (setf *keep-this-data* <span class="org-string">"new"</span>)
      (true (stringp *keep-this-data*)))

  (deftest t-freeze-2
    (is (= *keep-this-data* 1)))

(run '(t-freeze-1 t-freeze-2))
</pre>
</div>
<p>
Now the classic fixture - create a data set for the test and clean it up afterwards
</p>
<div class="org-src-container">
<pre class="src src-lisp">  <span class="org-comment-delimiter">;; </span><span class="org-comment">Create a class for data fixture purposes</span>
(<span class="org-keyword">defclass</span> <span class="org-type">fixture-data</span> ()
  ((a <span class="org-builtin">:initarg</span> <span class="org-builtin">:a</span> <span class="org-builtin">:initform</span> 0 <span class="org-builtin">:accessor</span> a)
   (b <span class="org-builtin">:initarg</span> <span class="org-builtin">:b</span> <span class="org-builtin">:initform</span> 0 <span class="org-builtin">:accessor</span> b)))

(deffixture s1 (@body)
<span class="org-comment-delimiter">;;</span><span class="org-comment">IMPORTANT Some frameworks will require a name for the fixture. Others, like CLUNIT apply a fixture to a suite (as ;; in this pseudo code) and require a suite name</span>
  (<span class="org-keyword">let</span> ((x (make-instance 'fixture-data <span class="org-builtin">:a</span> 100 <span class="org-builtin">:b</span> -100)))
    @body))

<span class="org-comment-delimiter">;; </span><span class="org-comment">create a sub suite and check fixture inheritance</span>
(defsuite s2 (s1))

(deftest t6-s1 (s1)
  (<span class="org-warning">assert-equal</span>  (a x) 100)
  (<span class="org-warning">assert-equal</span>   (b x) -100))

(deftest t6-s2 (s2)
  (<span class="org-warning">assert-equal</span>  (a x) 100)
  (<span class="org-warning">assert-equal</span>   (b x) -100)))
</pre>
</div>
</div>
</li>
<li><a id="org33ec8d1"></a>Removing tests<br>
<div class="outline-text-4" id="text-9-4-4">
<p>
How do you actually remove a test from the system
</p>
</div>
</li>
<li><a id="org1959654"></a>Skip Capability<br>
<ol class="org-ol">
<li><a id="org6b19818"></a>Assertions<br>
<div class="outline-text-5" id="text-9-4-5-1">
<p>
Can you skip an assertion?
</p>
</div>
</li>
<li><a id="orgfbf4785"></a>Tests<br>
<div class="outline-text-5" id="text-9-4-5-2">
<p>
Can you skip an entire test?
</p>
</div>
</li>
<li><a id="orgffc3f6a"></a>Implementation<br>
<div class="outline-text-5" id="text-9-4-5-3">
<p>
Can you skip something if the CL implementation is XYZ?
</p>
</div>
</li>
</ol>
</li>
</ol>
</div>
<div id="outline-container-orgdd92f30" class="outline-3">
<h3 id="orgdd92f30"><span class="section-number-3">9.5.</span> Random Data Generators</h3>
<div class="outline-text-3" id="text-9-5">
<p>
Can you generate different types of random data to feed to the testing framework? What does the framework have to help?
</p>

<p>
<a id="orge4344cd"></a>
</p>
</div>
</div>
</div>
<div id="outline-container-org588a6db" class="outline-2">
<h2 id="org588a6db"><span class="section-number-2">10.</span> 1am</h2>
<div class="outline-text-2" id="text-10">
<p>
<a href="#org63aa282">top</a>
</p>
</div>

<div id="outline-container-org1e6380c" class="outline-3">
<h3 id="org1e6380c"><span class="section-number-3">10.1.</span> Summary</h3>
<div class="outline-text-3" id="text-10-1">
<table>


<colgroup>
<col  class="org-left">

<col  class="org-left">

<col  class="org-left">

<col  class="org-right">
</colgroup>
<tbody>
<tr>
<td class="org-left"><a href="https://github.com/lmj/1am">homepage</a></td>
<td class="org-left">James Lawrence</td>
<td class="org-left">MIT</td>
<td class="org-right">2014</td>
</tr>
</tbody>
</table>
<p>
1am will thrown you into the debugger on failures or errors. There is no way to disable this, there is no reporting - in you go. There is no provision for diagnostic strings in assertions, but since it throws you into the debugger, that is probably not relevant. Tests are shuffled on each run.
</p>

<p>
On the plus side for some people, tests are functions.
</p>

<p>
On the minus side for people like me, you cannot turn off progress reports. You can create a list of tests, but there is no concept of suites or tags.
</p>
</div>
</div>

<div id="outline-container-org7e81f82" class="outline-3">
<h3 id="org7e81f82"><span class="section-number-3">10.2.</span> Assertion Functions</h3>
<div class="outline-text-3" id="text-10-2">
<p>
1am's assertion functions are limited to <code>is</code> and <code>signals</code>.
</p>
</div>
</div>

<div id="outline-container-org51d0a04" class="outline-3">
<h3 id="org51d0a04"><span class="section-number-3">10.3.</span> Usage</h3>
<div class="outline-text-3" id="text-10-3">
<ul class="org-ul">
<li><code>run</code> will run all the tests in <code>*tests*</code></li>
<li><code>(run '(foo))</code> will run the named tests in the provided parameter list.</li>
<li><code>(name-of-test)</code> will run the named test because tests are functions in their own right..</li>
</ul>
<div class="org-src-container">
<pre class="src src-lisp">(run)
FOO<span class="org-comment">; Evaluation aborted on #&lt;SIMPLE-ERROR "~@&lt;The assertion ~S failed~:[.~:; ~</span>
                                         with ~:*~{~S = ~S~^, ~}.~]~:@&gt;<span class="org-string">" {100BE70F03}&gt;.</span>
<span class="org-string">(run '(foo))</span>

<span class="org-string">FOO; Evaluation aborted on #&lt;SIMPLE-ERROR "</span>~@&lt;The assertion ~S failed~:[.~:<span class="org-comment">; ~</span>
                                         with ~:*~{~S = ~S~^, ~}.~]~:@&gt;<span class="org-string">" {100B996103}&gt;.</span>
</pre>
</div>
</div>

<ol class="org-ol">
<li><a id="org6321062"></a>Basics<br>
<div class="outline-text-4" id="text-10-3-1">
<p>
Starting with a basic test where we know everything will pass. These are all the assertion functions that 1am has. There is no provision for documentation strings or test descriptions.
</p>
<div class="org-src-container">
<pre class="src src-lisp">  (test t1
        (is (equal 1 1))
        (signals division-by-zero
                 (/ 1 0)))

  (run '(t1)) <span class="org-comment">; or just (t1)</span>
T1..
Success: 1 test, 2 checks.
<span class="org-comment-delimiter">; </span><span class="org-comment">No value</span>

</pre>
</div>
<p>
Now with a deliberately failing test. Notice how it just immediately kicks into the debugger:
</p>
<div class="org-src-container">
<pre class="src src-lisp">(test t1-fail ()<span class="org-comment">; the most basic failing test</span>
  (<span class="org-keyword">let</span> ((x 1) (y 2))
    (is (= x y))
    (signals division-by-zero (<span class="org-warning">error</span> 'floating-point-overflow))))

  (t1-fail)
The assertion (= X Y) failed with X = 1, Y = 2.
   [Condition of type SIMPLE-ERROR]

Restarts:
 0: [CONTINUE] Retry assertion.
 1: [RETRY] Retry SLIME REPL evaluation request.
 2: [*ABORT] Return to SLIME's top level.
 3: [ABORT] abort thread (#&lt;THREAD <span class="org-string">"new-repl-thread"</span> RUNNING {10035CE213}&gt;)
</pre>
</div>
<p>
As you would hope, you do not have to manually recompile a test after a tested function has been modified.
</p>
</div>
</li>

<li><a id="org408f0f5"></a>Conditions<br>
<div class="outline-text-4" id="text-10-3-2">
<p>
1am works as expected if you signal the expected error. If you signal an unexpected error, it throws you into the debugger just like every other time a test fails.
</p>
<div class="org-src-container">
<pre class="src src-lisp"> (test t7-bad-error
       (signals division-by-zero (<span class="org-warning">error</span> 'floating-point-overflow)))

(run '(t7-wrong-error))
T7-BAD-ERROR<span class="org-comment">; Evaluation aborted on #&lt;SIMPLE-ERROR "Expected to signal ~s, but got ~s:~%~a" {102EA4F423}&gt;.</span>
</pre>
</div>
</div>
</li>

<li><a id="org261d084"></a>Edge Cases: Values expressions, loops, closures and calling other tests<br>
<div class="outline-text-4" id="text-10-3-3">
<p>
1am has no special functionality for dealing with values expressions. It accepts them but merely looks at the intial value provided by each expression. So, for example, the following passes.
</p>
<div class="org-src-container">
<pre class="src src-lisp">(test t2-values-expressions ()
      (is (equal (values 1 2)
                 (values 1 3))))
</pre>
</div>
</div>

<ol class="org-ol">
<li><a id="orgff76bcd"></a>Now looping and closures.<br>
<div class="outline-text-5" id="text-10-3-3-1">
<p>
1am will handle looping through assertions using variables declared in a closure surrounding the test.
</p>
<div class="org-src-container">
<pre class="src src-lisp">(<span class="org-keyword">let</span> ((l1 '(#\a #\B #\z))
        (l2 '(97 66 122)))
  (test t2-loop
    (<span class="org-keyword">loop</span> for x in l1 for y in l2 do
      (is (= (char-code x) y)))))
</pre>
</div>
</div>
</li>

<li><a id="org7c640eb"></a>Calling a test inside another test<br>
<div class="outline-text-5" id="text-10-3-3-2">
<p>
It works but do not expect composable reports.
</p>
<div class="org-src-container">
<pre class="src src-lisp">  (test t3
      (is (= 1 1))
    (t1))

 (t3)
T3.
T1.
Success: 1 test, 1 check.
Success: 1 test, 1 check.
</pre>
</div>
</div>
</li>
</ol>
</li>

<li><a id="org99bc0c7"></a>Suites, tags and other multiple test abilities<br>
<ol class="org-ol">
<li><a id="org323d3fd"></a>Lists of tests<br>
<div class="outline-text-5" id="text-10-3-4-1">
<p>
Tests are defined using (test test-name) and pushed to a list of tests named <code>*tests*</code>. If you want to run a list of tests, you could save that out so that you continue to keep a list of all tests, then set <code>*test*</code> to whatever list of tests you want. That sounds a bit cumbersome.
</p>
</div>
</li>
<li><a id="orga5deea3"></a>Suites<br>
<div class="outline-text-5" id="text-10-3-4-2">
<p>
1am has no suite capability
</p>
</div>
</li>
</ol>
</li>

<li><a id="org6aa2a1b"></a>Fixtures and Freezing Data<br>
<div class="outline-text-4" id="text-10-3-5">
<p>
None
</p>
</div>
</li>
<li><a id="org10a38d3"></a>Removing tests<br>
<div class="outline-text-4" id="text-10-3-6">
<p>
None
</p>
</div>
</li>
<li><a id="orga11c730"></a>Sequencing, Random and Failure Only<br>
<div class="outline-text-4" id="text-10-3-7">
<p>
N/A
</p>
</div>
</li>
<li><a id="orgc53e704"></a>Skip Capability<br>
<div class="outline-text-4" id="text-10-3-8">
<p>
None
</p>
</div>
</li>
<li><a id="orgecdfb94"></a>Random Data Generators<br>
<div class="outline-text-4" id="text-10-3-9">
<p>
None
</p>
</div>
</li>
</ol>
</div>

<div id="outline-container-org92274bd" class="outline-3">
<h3 id="org92274bd"><span class="section-number-3">10.4.</span> Discussion</h3>
<div class="outline-text-3" id="text-10-4">
<p>
<a id="org46df3c7"></a>
The comments that I have seen around 1am seem to revolve around having only a single global variable to collect all compiled tests. Various people have suggested different solutions to essentially build test suites capability:
</p>

<p>
jorams suggested:
</p>
<div class="org-src-container">
<pre class="src src-lisp">(<span class="org-keyword">defmacro</span> <span class="org-function-name">define-test-framework</span> (tests-variable
                                 test-macro
                                 run-function)
  <span class="org-doc">"Define a variable to hold a list of tests, a macro to define tests and a</span>
<span class="org-doc">function to run the tests."</span>
  `(<span class="org-keyword">progn</span>
     (<span class="org-keyword">defvar</span> ,tests-variable ())
     (<span class="org-keyword">defmacro</span> ,test-macro (name <span class="org-type">&amp;body</span> body)
       `(<span class="org-keyword">let</span> ((1am:*tests* ()))
          (1am:test ,name ,@body)
          (<span class="org-keyword">dolist</span> (test 1am:*tests*)
            (pushnew test ,',tests-variable))))
     (<span class="org-keyword">defun</span> ,run-function ()
       (1am:run ,tests-variable))))
</pre>
</div>

<p>
luismbo suggested: "a simpler way might be to have 1am:test associate tests with the current <code>*package*</code> (e.g., by turning 1am:*tests* into an hash-table mapping package names to lists of tests) and add the ability for 1am:run to filter by package and perhaps default to the current <code>*package*</code>."
</p>

<p>
phoe suggested the following very simple 1AM wrapper to achieve multiple test suites.
</p>
<div class="org-src-container">
<pre class="src src-lisp">(<span class="org-keyword">defvar</span> <span class="org-variable-name">*my-tests*</span> '())

(<span class="org-keyword">defun</span> <span class="org-function-name">run</span> ()
  (1am:run *my-tests*))

(<span class="org-keyword">defmacro</span> <span class="org-function-name">define-test</span> (name <span class="org-type">&amp;body</span> body)
  `(<span class="org-keyword">let</span> ((1am:*tests* '()))
     (1am:test ,name ,@body)
     (pushnew ',name *my-tests*)))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgda71be2" class="outline-3">
<h3 id="orgda71be2"><span class="section-number-3">10.5.</span> Who Uses 1am?</h3>
<div class="outline-text-3" id="text-10-5">
<p>
("adopt/test" "authenticated-encryption-test" "beast-test" "binary-io/test"
 "bobbin/test" "chancery.test" "cl-digraph.test" "cl-netpbm/test" "cl-pcg.test"
 "cl-rdkafka/test" "cl-scsu-test" "cl-skkserv/tests" "jp-numeral-test"
 "list-named-class/test" "openid-key-test" "petri" "petri/test" "polisher.test"
 "protest/1am" "protest/test" "with-c-syntax-test" "xml-emitter/tests")
</p>

<p>
<a href="#org63aa282">top</a>
<a id="org4a2ad7a"></a>
</p>
</div>
</div>
</div>

<div id="outline-container-org07198d3" class="outline-2">
<h2 id="org07198d3"><span class="section-number-2">11.</span> 2am</h2>
<div class="outline-text-2" id="text-11">
</div>
<div id="outline-container-org1e51554" class="outline-3">
<h3 id="org1e51554"><span class="section-number-3">11.1.</span> Summary</h3>
<div class="outline-text-3" id="text-11-1">
<table>


<colgroup>
<col  class="org-left">

<col  class="org-left">

<col  class="org-left">

<col  class="org-right">
</colgroup>
<tbody>
<tr>
<td class="org-left"><a href="https://gitlab.common-lisp.net/dkochmanski/2am">homepage</a></td>
<td class="org-left">Daniel Kochmański</td>
<td class="org-left">MIT</td>
<td class="org-right">2016</td>
</tr>
</tbody>
</table>
<p>
2am is based on 1am with some features wanted for CI and hierarchical tests. As with 1am, 2am runs tests randomly - the order is shuffled on each run. There is no optionality. There is also no provision for only running the tests that failed last time. There is also no way to turn off the progress report.
</p>
</div>
</div>

<div id="outline-container-orgbf1e97e" class="outline-3">
<h3 id="orgbf1e97e"><span class="section-number-3">11.2.</span> Assertion Functions</h3>
<div class="outline-text-3" id="text-11-2">
<table>


<colgroup>
<col  class="org-left">

<col  class="org-left">

<col  class="org-left">
</colgroup>
<tbody>
<tr>
<td class="org-left">is</td>
<td class="org-left">signals</td>
<td class="org-left">finishes</td>
</tr>
</tbody>
</table>

<p>
<a href="#org63aa282">top</a>
</p>
</div>
</div>
<div id="outline-container-org79d1642" class="outline-3">
<h3 id="org79d1642"><span class="section-number-3">11.3.</span> Usage</h3>
<div class="outline-text-3" id="text-11-3">
<p>
Unlike 1am which always throws you into the debugger, 2am will only throw you into the debugger if the test crashes, not if it fails.
</p>

<p>
Note that 2am will distinguish between tests that fail and tests that crash.
</p>

<ul class="org-ul">
<li><code>(run)</code> will run the tests in the default suite.</li>
<li><code>(run 'some-suite-name)</code> will run the tests in the named suite</li>
<li><code>(run '(foo))</code> will run the named tests in the provided parameter list.</li>
</ul>

<p>
Since tests are functions in 2am, there is no need for a (run 'test-name) function.
</p>
</div>
<ol class="org-ol">
<li><a id="org98faefd"></a>Report Format<br>
<div class="outline-text-4" id="text-11-3-1">
<p>
First a basic failing test to show the reporting. Notice in the third asssertion we are passing it a string after the two tested items which can help diagnose failures, followed by the two variables being compared, and then running it to show the default failure report.
</p>
<div class="org-src-container">
<pre class="src src-lisp">(test t1-fail ()<span class="org-comment">; the most basic failing test</span>
  (<span class="org-keyword">let</span> ((x 1) (y 2))
    (is (= 1 2))
    (is (equal 1 2))
    (is (= x y) <span class="org-string">"This test was meant to fail ~a is not =  ~a"</span> x y )
        (signals floating-point-overflow
   (<span class="org-warning">error</span> 'division-by-zero))))
</pre>
</div>
<p>
Now to run it:
</p>
<div class="org-src-container">
<pre class="src src-lisp">  (t1-fail)
Running test T1-FAIL ffff
Test T1-FAIL: 4 checks.
   Pass: 0 ( 0%)
   Fail: 4 (100%)

Failure details:
--------------------------------
 T1-FAIL:
   FAIL: (= 1 2)
   FAIL: (EQUAL 1 2)
   FAIL: This test was meant to fail 1 is not =  2
   FAIL: Expected to signal FLOATING-POINT-OVERFLOW, but got DIVISION-BY-ZERO:
arithmetic error DIVISION-BY-ZERO signalled
--------------------------------
</pre>
</div>
<p>
The macro <code>(test name &amp;body body)</code> defines a test function and adds it to <code>*tests*</code>. The following just shows what the report looks like when everything passes. These are all the assertion functions that 2am has.
</p>
<div class="org-src-container">
<pre class="src src-lisp">(test t1 <span class="org-comment">; the most basic test.</span>
  (is (=  1 1))
  (signals division-by-zero
    (/ 1 0))
  (finishes (= 1 1)))

(t1)
Running test T1 ...
Running test T1 ...
Test T1: 3 checks.
Pass: 3 (100%)
Fail: 0 (0%)
</pre>
</div>

<p>
As you would hope, you do not have to manually recompile a test after a tested function has been modified.
</p>
</div>
</li>
<li><a id="org1c7d7cf"></a>Edge Cases: Value expressions, loops. closures and calling other tests<br>
<ol class="org-ol">
<li><a id="org53aa70a"></a>Value expressions<br>
<div class="outline-text-5" id="text-11-3-2-1">
<p>
2am has no special functionality for dealing with values expressions. It accepts them but merely looks at the intial value provided by each expression.
</p>
</div>
</li>
<li><a id="orgd7930fc"></a>Looping and closures.<br>
<div class="outline-text-5" id="text-11-3-2-2">
<p>
Will a test accept looping through assertions using variables from a closure? Yes.
</p>
<div class="org-src-container">
<pre class="src src-lisp">  (<span class="org-keyword">let</span> ((l1 '(#\a #\B #\z))
          (l2 '(97 66 122)))
    (test t2-loop ()
      (<span class="org-keyword">loop</span> for x in l1 for y in l2 do
        (is (= (char-code x) y)))))

(t2-loop)
Running test T2-LOOP ...
Test T2-LOOP: 3 checks.
   Pass: 3 (100%)
   Fail: 0 ( 0%)

(test t2-with-multiple-values ()
  (is (= 1 1 2)))  <span class="org-comment">; This should fail and it does</span>
</pre>
</div>
</div>
</li>
<li><a id="org1c57f09"></a>Calling another test from a test<br>
<div class="outline-text-5" id="text-11-3-2-3">
<p>
This succeeds as expected but also as expected there is no composition on the report.
</p>
<div class="org-src-container">
<pre class="src src-lisp">(test t3 ()<span class="org-comment">; a test that tries to call another test in its body</span>
          (is (eql 'a 'a))
          (t2))

(t3)
Running test T3 .
Running test T2 ...
Test T2: 3 checks.
   Pass: 3 (100%)
   Fail: 0 ( 0%)
Test T3: 1 check.
   Pass: 1 (100%)
   Fail: 0 ( 0%)
</pre>
</div>
</div>
</li>
</ol>
</li>
<li><a id="orgb484630"></a>Suites, tags and other multiple test abilities<br>
<ol class="org-ol">
<li><a id="org9090836"></a>Lists of tests<br>
<div class="outline-text-5" id="text-11-3-3-1">
<p>
2am can run lists of tests
</p>
<div class="org-src-container">
<pre class="src src-lisp">(run '(t1 t2))
Running test T2 ...
Running test T1 .
Did 2 tests (0 crashed), 4 checks.
   Pass: 4 (100%)
   Fail: 0 ( 0%)
</pre>
</div>
<p>
<a href="#org63aa282">top</a>
</p>
</div>
</li>
<li><a id="org36bb7fe"></a>Suites<br>
<div class="outline-text-5" id="text-11-3-3-2">
<p>
2am has a hash table named <code>*suites*</code>. Any tests not associated with a specific suite are assigned to the default suite. If we called the function (run) with no parameters, it would run all the tests in the default suite which in our case would mean all the tests decribed above:
</p>
<div class="org-src-container">
<pre class="src src-lisp">(run)
</pre>
</div>
<p>
Suites are defined using (suite 'some-suite-name-here &amp;optional list-of-sub-suites). If you pass  and tests are identified with suites by prepending the suite name to the test name.
</p>
<div class="org-src-container">
<pre class="src src-lisp">  (suite 's0) <span class="org-comment">; This suite has no sub-suites</span>

  (test s0.t4  <span class="org-comment">; a test that is a member of a suite</span>
    (is (= 1 1)))

   (test s0.t4-error
    (is (eql 'a 'a))
    (signals error (<span class="org-warning">error</span> <span class="org-string">"t4-errored out"</span>))
    (is (= 1 2)))

  (test s0.t4-fail
    (is (not (= 1 2))))

(suite 's1 '(s0))<span class="org-comment">; This suite includes suite s0 as a sub-suite.</span>

(test s1.t4-s1
   (is (= 1 1)))
</pre>
</div>
<p>
Calling run on 's0 will run tests s0.t4, s0.t4-error and s0.t4-fail.
</p>
<div class="org-src-container">
<pre class="src src-lisp">(run 's0)
--- Running test suite S0
Running test S0.T4 .
Running test S0.T4-FAIL .
Running test S0.T4-ERROR ..f
Did 3 tests (0 crashed), 5 checks.
   Pass: 4 (80%)
   Fail: 1 (20%)

Failure details:
--------------------------------
 S0.T4-ERROR:
   FAIL: (= 1 2)
--------------------------------
</pre>
</div>
<p>
Calling run on 's1 will run test s1.t4-s1 and all the tests in suite s0.
</p>
</div>
</li>
</ol>
</li>

<li><a id="orgc024d69"></a>Fixtures and Freezing Data<br>
<div class="outline-text-4" id="text-11-3-4">
<p>
No built-in capability.
</p>
</div>
</li>
<li><a id="orgc565e1c"></a>Removing tests<br>
<div class="outline-text-4" id="text-11-3-5">
<p>
Nothing explicit
</p>
</div>
</li>
<li><a id="org9777aaa"></a>Sequencing, Random and Failure Only<br>
<div class="outline-text-4" id="text-11-3-6">
<p>
2am runs tests randomly - the order is shuffled on each run. There is no optionality.
There is no provision for only running the tests that failed last time.
</p>
</div>
</li>
<li><a id="org3e4d752"></a>Skip Capability<br>
<div class="outline-text-4" id="text-11-3-7">
<p>
None
</p>
</div>
</li>
<li><a id="org271170d"></a>Random Data Generators<br>
<div class="outline-text-4" id="text-11-3-8">
<p>
None
</p>
</div>
</li>
</ol>
</div>
<div id="outline-container-orgb8f5746" class="outline-3">
<h3 id="orgb8f5746"><span class="section-number-3">11.4.</span> Discussion</h3>
<div class="outline-text-3" id="text-11-4">
<p>
The documentation indicates that assertions may be run inside threads. I did not validate this.
</p>

<p>
<a href="#org63aa282">top</a>
<a id="org12efa6c"></a>
</p>
</div>
</div>
</div>
<div id="outline-container-orga817fc0" class="outline-2">
<h2 id="orga817fc0"><span class="section-number-2">12.</span> cacau</h2>
<div class="outline-text-2" id="text-12">
</div>
<div id="outline-container-org3eb2c8c" class="outline-3">
<h3 id="org3eb2c8c"><span class="section-number-3">12.1.</span> Summary</h3>
<div class="outline-text-3" id="text-12-1">
<table>


<colgroup>
<col  class="org-left">

<col  class="org-left">

<col  class="org-left">

<col  class="org-right">
</colgroup>
<tbody>
<tr>
<td class="org-left"><a href="https://github.com/noloop/cacau">homepage</a></td>
<td class="org-left">Noloop</td>
<td class="org-left">GPL3</td>
<td class="org-right">2020</td>
</tr>
</tbody>
</table>
<p>
Cacau is interesting in that it uses an external library for assertions and is just a "test runner". The examples shown with Cacau will all assume that the <a href="#orga3783aa">assert-p</a> library by the same author is also loaded.
</p>

<p>
On the plus side, it has extensive hooks which can perform actions before and after a suite is run or before and after each test is run. It also has explicit async capabilities (but were not tested in this report) which do not exist in other frameworks.
</p>

<p>
At the same time, it tends to be all or nothing in what runs. The <code>(run)</code> function either runs the last defined test (if you have not defined suites) or, if you have defined suites, it runs all tests in all the suites. Or if you then define a new function, just that new function. Maybe it is just me but I would be getting lost in what <code>run</code> is supposed to be checking.
</p>

<p>
Most frameworks count the individual assertions in a test, Cacau treats the test as a whole - if one assertion fails, the entire test fails and if multiple assertions failed, it will only report the first failure, not all the failures in the test, leaving you with incomplete information.
</p>

<p>
Cacau is the only framework where, if you change a function that is being tested, you need to manually recompile the tests again.
</p>

<p>
Not recommended.
</p>
</div>
</div>
<div id="outline-container-org12e4361" class="outline-3">
<h3 id="org12e4361"><span class="section-number-3">12.2.</span> Assertion Functions</h3>
<div class="outline-text-3" id="text-12-2">
<p>
Cacau uses the assertion functions from an assertion library, currently you need to use assert-p. Those are:
</p>

<table>


<colgroup>
<col  class="org-left">

<col  class="org-left">

<col  class="org-left">

<col  class="org-left">
</colgroup>
<tbody>
<tr>
<td class="org-left">t-p</td>
<td class="org-left">not-t-p</td>
<td class="org-left">zero-p</td>
<td class="org-left">not-zero-p</td>
</tr>

<tr>
<td class="org-left">nil-p</td>
<td class="org-left">not-nil-p</td>
<td class="org-left">null-p</td>
<td class="org-left">not-null-p</td>
</tr>

<tr>
<td class="org-left">eq-p</td>
<td class="org-left">not-eq-p</td>
<td class="org-left">eql-p</td>
<td class="org-left">not-eql-p</td>
</tr>

<tr>
<td class="org-left">equal-p</td>
<td class="org-left">not-equal-p</td>
<td class="org-left">equalp-p</td>
<td class="org-left">not-equalp-p</td>
</tr>

<tr>
<td class="org-left">typep-p</td>
<td class="org-left">not-typep-p</td>
<td class="org-left">values-p</td>
<td class="org-left">not-values-p</td>
</tr>

<tr>
<td class="org-left">error-p</td>
<td class="org-left">not-error-p</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">condition-error-p</td>
<td class="org-left">not-condition-error-p</td>
<td class="org-left">custom-p</td>
<td class="org-left">&#xa0;</td>
</tr>
</tbody>
</table>

<p>
I have to say for an assertion library, I expected to see some numerical tests as well.
</p>
</div>
</div>
<div id="outline-container-orge11a1db" class="outline-3">
<h3 id="orge11a1db"><span class="section-number-3">12.3.</span> Usage</h3>
<div class="outline-text-3" id="text-12-3">
<p>
You will notice that the test names must be strings whereas the test names in the other frameworks are either quoted symbol or unquoted symbols.
</p>

<p>
Cacau only has a <code>run</code> function which accepts fixture, reporter and debugger parameters, but no provisions for telling it what tests you want to run. If you manually compile a single test, it usually runs just that test. Otherwise it runs all the tests in the package whether you want them or not. For purposes of walking through the basic capability, we will look only at the result of the specific test under consideration and not any other test which might be picked up in the report.
</p>

<p>
I do not see a way to rerun a test except by manually recompiling the test.
</p>
</div>
<ol class="org-ol">
<li><a id="org2457ff6"></a>Report Format<br>
<div class="outline-text-4" id="text-12-3-1">
<p>
Interactive mode can be enabled by passing the keyword parameter :cl-debugger to <code>(run :cl-debugger t)</code>
Cacau has a few different reporting formats. The function (run) without a reporter specification will provide the default :min level of info. There is also :list and :full which provide different levels of information. You will notice that I am actually creating multiple copies of the failing test to simulate recompiling the test.
</p>

<p>
Cacau treats tests with multiple assertions as a unit. Either everything passes or the test fails and it may be difficult to figure out which assertion was the one that failed. This is clearly shown below where both the first and second asssertions should fail, but only the first failure (the eql) gets reported.
</p>

<p>
Cacau does not allow us to pass messages in the assertion which might have allowed us to flag potential issues that would aid in debugging failures.
</p>
</div>
<ol class="org-ol">
<li><a id="orgaa14352"></a>Min<br>
<div class="outline-text-5" id="text-12-3-1-1">
<div class="org-src-container">
<pre class="src src-lisp">  (deftest <span class="org-string">"t1-fail-1"</span> ()
    (<span class="org-keyword">let</span> ((x 1) (y 2))
      (<span class="org-warning">assert-p:eql-p</span> x y)
      (<span class="org-warning">assert-p:equal-p</span> 1 2)))
  (run <span class="org-builtin">:reporter</span> <span class="org-builtin">:min</span>)
&lt;=&gt; Cacau &lt;=&gt;

From 1 running tests:

0 passed
1 failed
NIL
</pre>
</div>
</div>
</li>
<li><a id="orge8f34b9"></a>List<br>
<div class="outline-text-5" id="text-12-3-1-2">
<p>
Now the list reporting level
</p>
<div class="org-src-container">
<pre class="src src-lisp">(deftest <span class="org-string">"t1-fail-2"</span> ()
  (<span class="org-keyword">let</span> ((x 1) (y 2))
    (<span class="org-warning">assert-p:equal-p</span> x y)
    (<span class="org-warning">assert-p:equal-p</span> 1 2)))

(run <span class="org-builtin">:reporter</span> <span class="org-builtin">:list</span>)
&lt;=&gt; Cacau &lt;=&gt;

&lt;- t1-fail-2:
Error message:
BIT EQL (INTEGER 0 4611686018427387903)

Actual:
1
Expected:
2
-------------------------
From 1 running tests:

0 passed
1 failed
NIL
</pre>
</div>
</div>
</li>
<li><a id="org8e41cd4"></a>Full<br>
<div class="outline-text-5" id="text-12-3-1-3">
<p>
And finally the full reporting level
</p>
<div class="org-src-container">
<pre class="src src-lisp">(deftest <span class="org-string">"t1-fail-3"</span> ()
  (<span class="org-keyword">let</span> ((x 1) (y 2))
    (<span class="org-warning">assert-p:eql-p</span> x y)
    (<span class="org-warning">assert-p:equal-p</span> 1 2)))

(run <span class="org-builtin">:reporter</span> <span class="org-builtin">:full</span>)
&lt;=&gt; Cacau &lt;=&gt;

&lt;- t1-fail-3:
Error message:
BIT EQL (INTEGER 0 4611686018427387903)

Actual:
1
Expected:
2
Epilogue
-------------------------
0 running suites
1 running tests
0 only suites
0 only tests
0 skip suites
0 skip tests
0 total suites
1 total tests
0 passed
1 failed
1 errors
740673543 run start
740673543 run end
1/1000000 run duration
0 completed suites
1 completed tests

Errors
-------------------------
Suite: <span class="org-builtin">:SUITE-ROOT</span>
Test: t1-fail-3
Message:
BIT EQL (INTEGER 0 4611686018427387903)

Actual:
1
Expected:
2
</pre>
</div>
</div>
</li>
</ol>
</li>
<li><a id="org41a19ed"></a>Basics<br>
<div class="outline-text-4" id="text-12-3-2">
<p>
The empty form after the test name is for particular parameters such as :skip and :async.
</p>
<div class="org-src-container">
<pre class="src src-lisp">(deftest <span class="org-string">"t1"</span> ()
  (<span class="org-warning">assert-p:eql-p</span> 1 1)
  (<span class="org-warning">assert-p:condition-error-p</span>
   (<span class="org-warning">error</span> 'division-by-zero)
   division-by-zero))

(run)
&lt;=&gt; Cacau &lt;=&gt;

From 1 running tests:

1 passed
0 failed
</pre>
</div>
<p>
You can already anticipate what happens you are testing a function and you change that function. Yes, you need to manually recompile the test and the earlier versions might still be found as well as the new version when you call (run).
</p>
</div>
</li>
<li><a id="orgd92f4b2"></a>Edge Cases: Value expressions, loops, closures and calling other tests<br>
<ol class="org-ol">
<li><a id="org4af0172"></a>Value expressions<br>
<div class="outline-text-5" id="text-12-3-3-1">
<p>
Cacau (or really assert-p) has no special functionality for dealing with values expressions. It accepts them but merely looks at the intial value provided by each expression. The following passes.
</p>
<div class="org-src-container">
<pre class="src src-lisp">(deftest <span class="org-string">"t2-values-3"</span> ()
  (<span class="org-warning">assert-p:equalp-p</span> (values 1 2) (values 1 3)))
(run)
&lt;=&gt; Cacau &lt;=&gt;

From 1 running tests:

1 passed
0 failed
NIL
</pre>
</div>
<p>
Basically it accepted the values expressions but only looked at the first values.
</p>
</div>
</li>
<li><a id="orga77c676"></a>Looping and closures.<br>
<div class="outline-text-5" id="text-12-3-3-2">
<p>
Cacau will test correctly if it is looking at variables from a closure surrounding the test.
</p>
<div class="org-src-container">
<pre class="src src-lisp">    (<span class="org-keyword">let</span> ((l1 '(#\a #\B #\z))
            (l2 '(97 66 122)))
      (deftest <span class="org-string">"t2-loop"</span> ()
        (<span class="org-keyword">loop</span> for x in l1 for y in l2 do
          (<span class="org-warning">assert-p:eql-p</span> (char-code x) y))))

  (run <span class="org-builtin">:reporter</span> <span class="org-builtin">:list</span>)
&lt;=&gt; Cacau &lt;=&gt;

 -&gt; t2-loop

-------------------------
From 1 running tests:

1 passed
0 failed
</pre>
</div>
</div>
</li>
<li><a id="org8692d64"></a>Calling another test from a test<br>
<div class="outline-text-5" id="text-12-3-3-3">
<p>
I have not figured out a way for a test to call another test in cacau.
</p>
</div>
</li>
</ol>
</li>
<li><a id="orgb6b57db"></a>Redefinition Ambiguities<br>
<div class="outline-text-4" id="text-12-3-4">
<p>
Now consider the following where I mis-define a test with multiple values, then attempt to correct it. and am left not knowing where I stand.
</p>
<div class="org-src-container">
<pre class="src src-lisp">   (deftest <span class="org-string">"t2-with-multiple-values"</span> () (<span class="org-warning">assert-p:eql-p</span>  1 1 2))
   <span class="org-comment">; in: DEFTEST "t2-with-multiple-values"</span>
   <span class="org-comment">;     (NOLOOP.ASSERT-P:EQL-P 1 1 2)</span>
   <span class="org-comment">;</span>
   <span class="org-comment">; caught STYLE-WARNING:</span>
   <span class="org-comment">;   The function EQL-P is called with three arguments, but wants exactly two.</span>
   <span class="org-comment">;</span>
   <span class="org-comment">; compilation unit finished</span>
   <span class="org-comment">;   caught 1 STYLE-WARNING condition</span>
   #&lt;NOLOOP.CACAU::TEST-CLASS {1005098793}&gt;

   (deftest <span class="org-string">"t2-with-multiple-values"</span> () (<span class="org-warning">assert-p:t-p</span>  (= 1 1 2)))
   #&lt;NOLOOP.CACAU::TEST-CLASS {1005292E43}&gt;

 (run) <span class="org-comment">; the minimum level of info report, probably a mistake</span>
   &lt;=&gt; Cacau &lt;=&gt;
   From 2 running tests:

   0 passed
   2 failed
   NIL

(run <span class="org-builtin">:reporter</span> <span class="org-builtin">:list</span>) <span class="org-comment">; I try running again with a higher level of information</span>
   &lt;=&gt; Cacau &lt;=&gt;
   -------------------------
   From 0 running tests:

   0 passed
   0 failed
</pre>
</div>
<p>
Even though the test failed as expected, it is showing 2 running tests. What are the two tests? I would have expected only one test since we are using the same string name.
</p>
</div>
</li>
<li><a id="org342da91"></a>Conditions (Failing)<br>
<div class="outline-text-4" id="text-12-3-5">
<p>
The following fails as expected.
</p>
<div class="org-src-container">
<pre class="src src-lisp">(deftest <span class="org-string">"t7-bad-error"</span> ()
  (<span class="org-warning">assert-p:condition-error-p</span>
     (<span class="org-warning">error</span> 'division-by-zero)
     floating-point-overflow))
</pre>
</div>
</div>
</li>
<li><a id="org486b8d0"></a>Suites, tags and other multiple test abilities<br>
<ol class="org-ol">
<li><a id="org33186ec"></a>Lists of tests<br>
<div class="outline-text-5" id="text-12-3-6-1">
<p>
No such capability outside of suites.
</p>
</div>
</li>
<li><a id="org522a95c"></a>Suites<br>
<div class="outline-text-5" id="text-12-3-6-2">
<p>
You can have multiple suites of tests, but the (run) function will run everything that has not been run before:
</p>
<div class="org-src-container">
<pre class="src src-lisp">  (defsuite <span class="org-builtin">:s0</span> ()
    (deftest <span class="org-string">"s0-t1"</span> () (<span class="org-warning">assert-p:eql-p</span> 1 2)))

  (defsuite <span class="org-builtin">:s1</span> ()
    (<span class="org-keyword">let</span> ((x 0))
      (deftest <span class="org-string">"s1-t1"</span> () (<span class="org-warning">assert-p:eql-p</span> x 0))
       (defsuite <span class="org-builtin">:s2</span> ()
        (deftest <span class="org-string">"s2-t1"</span> () (<span class="org-warning">assert-p:eql-p</span> 1 3)))))

(run <span class="org-builtin">:reporter</span> <span class="org-builtin">:list</span>)
&lt;=&gt; Cacau &lt;=&gt;

<span class="org-builtin">:S0</span>
 &lt;- s0-t1:
Error message:
BIT EQL (INTEGER 0 4611686018427387903)

Actual:
1
Expected:
2
<span class="org-builtin">:S1</span>
 -&gt; s1-t1
 <span class="org-builtin">:S2</span>
  &lt;- s2-t1:
Error message:
BIT EQL (INTEGER 0 4611686018427387903)

Actual:
1
Expected:
3
-------------------------
From 3 running tests:

1 passed
2 failed
</pre>
</div>
<p>
What I would like to see is an ability to run the suites separately. You cannot do that. What is the value of having suites and sub-suites if you cannot run them separately?
<a href="#org63aa282">top</a>
</p>
</div>
</li>
</ol>
</li>
<li><a id="org4c169bd"></a>Fixtures and Freezing Data<br>
<div class="outline-text-4" id="text-12-3-7">
<p>
This is where cacau brings something to the table. You can use the hooks <code>defbefore-all</code>, <code>defafter-all</code>, <code>defbefore-each</code> and <code>defafter-each</code> to set up or take down data environment or contexts.
</p>
<div class="org-src-container">
<pre class="src src-lisp">      (defsuite <span class="org-builtin">:suite-1</span> ()
        (defbefore-all <span class="org-string">"Before-all"</span> () (print <span class="org-string">":Before-all"</span>))
        (defafter-each <span class="org-string">"After-each"</span> () (print <span class="org-string">":After-each"</span>))
        (defafter-all <span class="org-string">"After-all"</span> () (print <span class="org-string">":After-all"</span>))
        (defbefore-each <span class="org-string">"Before-each Suite-1"</span> ()
          (print <span class="org-string">"run Before-each Suite-1"</span>))
        (deftest <span class="org-string">"Test-1"</span> () (print <span class="org-string">"run Test-1"</span>) (t-p t))
        (deftest <span class="org-string">"Test-2"</span> () (print <span class="org-string">"run Test-2"</span>) (t-p t))
        (defsuite <span class="org-builtin">:suite-2</span> ()
          (defbefore-each <span class="org-string">"Before-each Suite-2"</span> ()
            (print <span class="org-string">"run Before-each Suite-2"</span>))
          (deftest <span class="org-string">"Test-3"</span> () (print <span class="org-string">"run Test-3"</span>) (t-p t))
          (deftest <span class="org-string">"Test-4"</span> () (print <span class="org-string">"run Test-4"</span>) (t-p t))))

      (run)

<span class="org-string">":Before-all"</span>
<span class="org-string">"run Before-each Suite-1"</span>
<span class="org-string">"run Test-1"</span>
<span class="org-string">":After-each"</span>
<span class="org-string">"run Before-each Suite-1"</span>
<span class="org-string">"run Test-2"</span>
<span class="org-string">":After-each"</span>
<span class="org-string">"run Before-each Suite-1"</span>
<span class="org-string">"run Before-each Suite-2"</span>
<span class="org-string">"run Test-3"</span>
<span class="org-string">":After-each"</span>
<span class="org-string">"run Before-each Suite-1"</span>
<span class="org-string">"run Before-each Suite-2"</span>
<span class="org-string">"run Test-4"</span>
<span class="org-string">":After-each"</span>
<span class="org-string">":After-all"</span> &lt;=&gt; Cacau &lt;=&gt;

From 4 running tests:

4 passed
0 failed
</pre>
</div>
</div>
</li>
<li><a id="org6c9fa04"></a>Removing tests<br>
<div class="outline-text-4" id="text-12-3-8">
<p>
I did not see anything here, but maybe I missed it.
</p>
</div>
</li>
<li><a id="org99786eb"></a>Sequencing, Random and Failure Only<br>
<div class="outline-text-4" id="text-12-3-9">
<p>
Sequential only.
</p>
</div>
</li>
<li><a id="org715108b"></a>Skip Capability<br>
<div class="outline-text-4" id="text-12-3-10">
<p>
You can specify to skip a test or a suite (and no, I do not consider this to be a good substitute for being able to specify which test or suite you want to run).
</p>
<div class="org-src-container">
<pre class="src src-lisp">(defsuite <span class="org-builtin">:suite-1</span> ()
  (deftest <span class="org-string">"Test-1"</span> (<span class="org-builtin">:skip</span>) (t-p t))
  (deftest <span class="org-string">"Test-2"</span> () (t-p t))) <span class="org-comment-delimiter">;; </span><span class="org-comment">run!</span>

(defsuite <span class="org-builtin">:suite-2</span> (<span class="org-builtin">:skip</span>)
  (<span class="org-keyword">let</span> ((x 0))
    (deftest <span class="org-string">"Test-1"</span> () (eql-p x 0))
    (deftest <span class="org-string">"Test-2"</span> () (t-p t))
    (defsuite <span class="org-builtin">:suite-3</span> ()
      (deftest <span class="org-string">"Test-1"</span> () (t-p t))
      (deftest <span class="org-string">"Test-2"</span> () (t-p t)))))
</pre>
</div>
</div>
</li>
<li><a id="orgb440cca"></a>Async Abilities<br>
<div class="outline-text-4" id="text-12-3-11">
<p>
I am going to have to cheat here and refer you to the author's page for the description of the async capabilities <a href="https://github.com/noloop/cacau#async-test">https://github.com/noloop/cacau#async-test</a>.
</p>
</div>
</li>
<li><a id="org394b925"></a>Time Limits for tests<br>
<div class="outline-text-4" id="text-12-3-12">
<p>
Cacau does have the ability to specify time limits for tests. The time limits can be set by suite (all tests in the suite have the same time limit), by hook or by test. See the author's discussion at <a href="https://github.com/noloop/cacau#timeout">https://github.com/noloop/cacau#timeout</a>
</p>
</div>
</li>
<li><a id="orgf2ed089"></a>Random Data Generators<br>
<div class="outline-text-4" id="text-12-3-13">
<p>
I did not see anything here with respect to data generators.
</p>
</div>
</li>
</ol>
</div>
<div id="outline-container-org9f4da4a" class="outline-3">
<h3 id="org9f4da4a"><span class="section-number-3">12.4.</span> Discussion</h3>
<div class="outline-text-3" id="text-12-4">
<p>
As I said in the summary, the fact that it does not show all the assertions that failed and does not give me the ability to specify suites or tests to run make this unsuitable for me.
</p>
</div>
</div>
<div id="outline-container-orgb53343f" class="outline-3">
<h3 id="orgb53343f"><span class="section-number-3">12.5.</span> Who Uses</h3>
<div class="outline-text-3" id="text-12-5">
<p>
cl-minify-css-test
</p>

<p>
<a href="#org63aa282">top</a>
<a id="org0760669"></a>
</p>
</div>
</div>
</div>
<div id="outline-container-org89fe890" class="outline-2">
<h2 id="org89fe890"><span class="section-number-2">13.</span> cardiogram</h2>
<div class="outline-text-2" id="text-13">
<p>
<a href="#org63aa282">top</a>
</p>
</div>
<div id="outline-container-org2776b7a" class="outline-3">
<h3 id="org2776b7a"><span class="section-number-3">13.1.</span> Summary</h3>
<div class="outline-text-3" id="text-13-1">
<table>


<colgroup>
<col  class="org-left">

<col  class="org-left">

<col  class="org-left">

<col  class="org-right">
</colgroup>
<tbody>
<tr>
<td class="org-left"><a href="https://gitlab.com/a.aguilar/cardiogram">homepage</a></td>
<td class="org-left">Abraham Aguilar</td>
<td class="org-left">MIT</td>
<td class="org-right">2020</td>
</tr>
</tbody>
</table>
<p>
Cardiogram starts off with immediate problems. The documentation does not match up with the code, even on simple things like "true" in the documentation is "is-true" in the code. I got the benchmarking to work but I am not going to try to reverse engineer all the other points discussed with other frameworks.
</p>
</div>
</div>
</div>
<div id="outline-container-org187eda4" class="outline-2">
<h2 id="org187eda4"><span class="section-number-2">14.</span> checkl</h2>
<div class="outline-text-2" id="text-14">
<p>
<a href="#org63aa282">top</a>
</p>
</div>
<div id="outline-container-org8201f4f" class="outline-3">
<h3 id="org8201f4f"><span class="section-number-3">14.1.</span> Summary</h3>
<div class="outline-text-3" id="text-14-1">
<table>


<colgroup>
<col  class="org-left">

<col  class="org-left">

<col  class="org-left">

<col  class="org-right">
</colgroup>
<tbody>
<tr>
<td class="org-left"><a href="https://github.com/rpav/CheckL">homepage</a></td>
<td class="org-left">Ryan Pavlik</td>
<td class="org-left">LLGPL, BSD</td>
<td class="org-right">2018</td>
</tr>
</tbody>
</table>
<p>
Checkl is different. As a result, this section is different from the other frameworks. Checkl assumes that you do informal checks at the REPL as you are coding and saves those results. Assuming you change your program and check the modified function or whatever with exactly the same parameters, it will let you know if the result is now different. As a result it is a bit more difficult to compare based on the wish list. It can, however, be integrated with Fiveam.
</p>
</div>
</div>
<div id="outline-container-orgf0708cc" class="outline-3">
<h3 id="orgf0708cc"><span class="section-number-3">14.2.</span> Usage</h3>
<div class="outline-text-3" id="text-14-2">
</div>
<ol class="org-ol">
<li><a id="org42dbb1a"></a>Basic Usage<br>
<div class="outline-text-4" id="text-14-2-1">
<p>
Assume you create two functions <code>foo-up</code> and <code>foo-down</code> and compile them.
</p>
<div class="org-src-container">
<pre class="src src-lisp">(<span class="org-keyword">defun</span> <span class="org-function-name">foo-up</span> (x)
  (+ x 2))

(<span class="org-keyword">defun</span> <span class="org-function-name">foo-down</span> (x)
  (- x 2))
</pre>
</div>
<p>
Now you create checks against the functions and compile them.
</p>
<div class="org-src-container">
<pre class="src src-lisp">(check () (foo-up 2))
(check () (foo-down 2))
</pre>
</div>
<p>
If you now revise <code>foo-down</code> and compile it, checkl will cause the system to throw an error immediately upon compile <code>foo-down</code> because the results were different (different as in <code>equalp</code> different.)
</p>
<div class="org-src-container">
<pre class="src src-lisp">(<span class="org-keyword">defun</span> <span class="org-function-name">foo-down</span> (x)
  (- x 3))

Result 0 has changed: -1
Previous result: 0
   [Condition of type CHECKL::RESULT-ERROR]

Restarts:
 0: [USE-NEW-VALUE] The new value is correct, use it from now on.
 1: [SKIP-TEST] Skip this, leaving the old value, but continue testing
 2: [ABORT] Abort compilation.
 3: [*ABORT] Return to SLIME's top level.
 4: [ABORT] abort thread (#&lt;THREAD <span class="org-string">"worker"</span> RUNNING {1010B73BD3}&gt;)
</pre>
</div>
<p>
Modifying and recompiling <code>foo-up</code> similarly also triggers an error.
</p>

<p>
Suppose you want to have multiple checks on function based on different parameters. You can name the <code>check</code> tests.
</p>
<div class="org-src-container">
<pre class="src src-lisp">(check (<span class="org-builtin">:name</span> <span class="org-builtin">:foo-up-integer</span>) (foo-up 4))
(check (<span class="org-builtin">:name</span> <span class="org-builtin">:foo-down-integer</span>) (foo-down 4))
(check (<span class="org-builtin">:name</span> <span class="org-builtin">:foo-up-real</span>) (foo-up 4.5))
(check (<span class="org-builtin">:name</span> <span class="org-builtin">:foo-down-real</span>) (foo-down 4.5))
</pre>
</div>
<p>
If you pass those check names to <code>run</code>, you get the following (remember that post our modifications, <code>foo-up</code> and <code>foo-down</code> are now adding and subtracting 3.:
</p>
<div class="org-src-container">
<pre class="src src-lisp">(run <span class="org-builtin">:foo-up-integer</span> <span class="org-builtin">:foo-down-integer</span> <span class="org-builtin">:foo-up-real</span> <span class="org-builtin">:foo-down-real</span>)
(7)
(1)
(7.5)
(1.5)
</pre>
</div>
<p>
Checks can also be defined checking the results of multiple functions using the results function.
</p>
<div class="org-src-container">
<pre class="src src-lisp">(check (<span class="org-builtin">:name</span> <span class="org-builtin">:foo-up-and-down</span>)
  (results (foo-up 7) (foo-down 3.2)))

(run <span class="org-builtin">:foo-up-and-down</span>)

(10 0.20000005)
</pre>
</div>
<p>
By the way, results will copy structures, sequences and marshalls standard-objects.
</p>
</div>
</li>
<li><a id="org3d184bc"></a>Suites, tags and other multiple test abilities<br>
<div class="outline-text-4" id="text-14-2-2">
<p>
The <code>run-all</code> function will return the results for all the check tests defined in the current package.
</p>
</div>
<ol class="org-ol">
<li><a id="org399f665"></a>Lists of tests<br>
<div class="outline-text-5" id="text-14-2-2-1">
<p>
As seen in the basic usage, checkl can run multiple checks.
</p>
<div class="org-src-container">
<pre class="src src-lisp">(run <span class="org-builtin">:foo-up-integer</span> <span class="org-builtin">:foo-down-integer</span> <span class="org-builtin">:foo-up-real</span> <span class="org-builtin">:foo-down-real</span>)
</pre>
</div>
</div>
</li>
<li><a id="orgc7b1b2f"></a>Suites/tags/categories<br>
<div class="outline-text-5" id="text-14-2-2-2">
<p>
When you are naming checks, you can also pass a category name to the keyword parameter category. You can then pass the category name to <code>run-all</code> and get just the values related to the checks with that category flagged.
</p>
<div class="org-src-container">
<pre class="src src-lisp">(check (<span class="org-builtin">:name</span> <span class="org-builtin">:foo</span> <span class="org-builtin">:category</span> <span class="org-builtin">:some-category</span>) ...)

(run-all <span class="org-builtin">:some-category</span> ...)
</pre>
</div>
</div>
</li>
</ol>
</li>

<li><a id="orgeed65f8"></a>Storage<br>
<div class="outline-text-4" id="text-14-2-3">
<p>
You can store these named checks by running check-store. E.g.:
</p>
<div class="org-src-container">
<pre class="src src-lisp">(checkl-store <span class="org-string">"/home/sabrac/checkl-test"</span>)
  <span class="org-comment-delimiter">;;; </span><span class="org-comment">some time later</span>
(checkl-load <span class="org-string">"/home/sabrac/checkl-test"</span>)
</pre>
</div>
</div>
</li>

<li><a id="org3342f28"></a>Integration with Fiveam<br>
<div class="outline-text-4" id="text-14-2-4">
<p>
Assuming you have already loaded fiveam, you can also send the checkl tests to fiveam by using check-formal.
</p>
<div class="org-src-container">
<pre class="src src-lisp">(checkl:check-formal (<span class="org-builtin">:name</span> <span class="org-builtin">:one-concat</span>) (tf-concat-strings-1 <span class="org-string">"John"</span> <span class="org-string">"Paul"</span>))
<span class="org-string">"JohnPaul"</span>

(fiveam:run! <span class="org-builtin">:default</span>)

Running test suite DEFAULT
 Running test ONE-CONCAT .
 Did 1 check.
    Pass: 1 (100%)
    Skip: 0 ( 0%)
    Fail: 0 ( 0%)

T
NIL
</pre>
</div>
<p>
Now, if we go back and add a space to "John", and run check-formal, not only will check-formal fail, but subsequently running fiveam will fail.
</p>
<div class="org-src-container">
<pre class="src src-lisp">(checkl:check-formal (<span class="org-builtin">:name</span> <span class="org-builtin">:one-concat</span>) (tf-concat-strings-1 <span class="org-string">"John "</span> <span class="org-string">"Paul"</span>))
<span class="org-comment-delimiter">; </span><span class="org-comment">Evaluation aborted on #&lt;CHECKL::RESULT-ERROR {1003FE1433}&gt;.</span>
TF-TEST1&gt; (fiveam:run! <span class="org-builtin">:default</span>)

Running test suite DEFAULT
 Running test ONE-CONCAT f
 Did 1 check.
    Pass: 0 ( 0%)
    Skip: 0 ( 0%)
    Fail: 1 (100%)

 Failure Details:
 --------------------------------
 ONE-CONCAT []:

CHECKL::RESULT
 evaluated to
(<span class="org-string">"John Paul"</span>)
 which is not
CHECKL:RESULT-EQUALP
 to
(<span class="org-string">"JohnPaul"</span>)
..
 --------------------------------
NIL
(#&lt;IT.BESE.FIVEAM::TEST-FAILURE {1004189053}&gt;)
</pre>
</div>

<p>
<a href="#org63aa282">top</a>
</p>
</div>
</li>
</ol>
</div>

<div id="outline-container-org5ed108f" class="outline-3">
<h3 id="org5ed108f"><span class="section-number-3">14.3.</span> Who Uses Checkl?</h3>
<div class="outline-text-3" id="text-14-3">
<p>
(<a href="https://github.com/rpav/conspath/blob/master/t/tests.lisp">conspack</a>, <a href="https://github.com/rpav/fast-io">fast-io</a>)
</p>

<p>
<a href="#org63aa282">top</a>
</p>

<p>
<a id="org5eea657"></a>
</p>
</div>
</div>
</div>
<div id="outline-container-org5a0b94a" class="outline-2">
<h2 id="org5a0b94a"><span class="section-number-2">15.</span> clunit</h2>
<div class="outline-text-2" id="text-15">
<p>
<a href="#org63aa282">top</a>
</p>
</div>
<div id="outline-container-org72772af" class="outline-3">
<h3 id="org72772af"><span class="section-number-3">15.1.</span> Summary</h3>
<div class="outline-text-3" id="text-15-1">
<table>


<colgroup>
<col  class="org-left">

<col  class="org-left">

<col  class="org-left">

<col  class="org-right">
</colgroup>
<tbody>
<tr>
<td class="org-left"><a href="http://tgutu.github.io/clunit/">homepage</a></td>
<td class="org-left">Tapiwa Gutu</td>
<td class="org-left">BSD</td>
<td class="org-right">2017</td>
</tr>
</tbody>
</table>

<p>
<b>Updated 13 June 2021</b>
Based on unresolved issues showing at github, as well as my inability to reach the author, This does not appear to be maintained and subject to bitrot. You should look at clunit2 instead. The difference between clunit2 and clunit is
</p>

<ul class="org-ul">
<li>clunit2's ability to redirect reporting output,</li>
<li>clunit2's huge performance increase (clunit is painfully slow on any sized testing target)</li>
<li>clunit2' ability to test multiple value expressions</li>
<li>clunit2's suite signaling capability and</li>
<li>the fact that clunit2 has a maintainer.</li>
</ul>
</div>
</div>

<div id="outline-container-org94c22cf" class="outline-3">
<h3 id="org94c22cf"><span class="section-number-3">15.2.</span> Assertion Functions</h3>
<div class="outline-text-3" id="text-15-2">
<p>
Clunit's assertion functions are:
</p>

<table>


<colgroup>
<col  class="org-left">

<col  class="org-left">

<col  class="org-left">
</colgroup>
<tbody>
<tr>
<td class="org-left">assert-condition</td>
<td class="org-left">assert-eq</td>
<td class="org-left">assert-eql</td>
</tr>

<tr>
<td class="org-left">assert-equal</td>
<td class="org-left">assert-equality</td>
<td class="org-left">assert-equality*</td>
</tr>

<tr>
<td class="org-left">assert-equalp</td>
<td class="org-left">assert-expands</td>
<td class="org-left">assert-fail</td>
</tr>

<tr>
<td class="org-left">assert-false</td>
<td class="org-left">assert-true</td>
<td class="org-left">assertion-condition</td>
</tr>

<tr>
<td class="org-left">assertion-conditions</td>
<td class="org-left">assertion-error</td>
<td class="org-left">assertion-expander</td>
</tr>

<tr>
<td class="org-left">assertion-fail-forced</td>
<td class="org-left">assertion-failed</td>
<td class="org-left">assertion-passed</td>
</tr>
</tbody>
</table>

<p>
The predicate used by assert-equality is determined by the setting of <code>*clunit-equality-test*</code>.
<a href="#org63aa282">top</a>
</p>
</div>
</div>
<div id="outline-container-org50c7b0e" class="outline-3">
<h3 id="org50c7b0e"><span class="section-number-3">15.3.</span> Usage</h3>
<div class="outline-text-3" id="text-15-3">
</div>
<ol class="org-ol">
<li><a id="orgcd8b158"></a>Report Format<br>
<div class="outline-text-4" id="text-15-3-1">
<p>
Report format is controlled by the variable <code>*clunit-report-format*</code>. It can be set to :default, :tap or NIL. In all the examples showing reports, we will be using the default format.
</p>

<p>
The progress report can be switched off by passing a keyword parameter to the functions run-test or run-suite.
</p>
<div class="org-src-container">
<pre class="src src-lisp">(run-test 'some-test-name <span class="org-builtin">:report-progress</span> nil)

(run-suite 'some-suite-name <span class="org-builtin">:report-progress</span> nil)
</pre>
</div>
<p>
Clunit2, unlike clunit has a <code>*test-output-stream*</code> variable which can be used to redirect the reports to file or other stream locations.
</p>

<p>
To go interactive - dropping immediately into the debugger, you would set the key word parameter :use-debugger to t.
</p>
<div class="org-src-container">
<pre class="src src-lisp">(run-test test-name <span class="org-builtin">:use-debugger</span> t)
</pre>
</div>
<p>
To give you a sense of what the failure report looks like, we take a basic failing test with multiple assertions . We will put some diagnostic strings into a few of the assertions. The first assertion not only has a diagnostic string, but it also has two variables and the second assertion which does not. Unlike some other framework diagnostic strings, the string that gets passed does not accept format-like parameters.
</p>
<div class="org-src-container">
<pre class="src src-lisp">(deftest t1-fail ()
  <span class="org-string">"describe t1-fail"</span>
  (<span class="org-keyword">let</span> ((x 1) (y 2))
    (<span class="org-warning">assert-equal</span> x y  <span class="org-string">"This assert-equal test was meant to fail"</span> x y)
    (<span class="org-warning">assert-true</span> (= 1 2) <span class="org-string">"This assert-true test was meant to fail"</span>)
    (<span class="org-warning">assert-false</span> (=  1 1))
    (<span class="org-warning">assert-eq</span> 'a 'b)
    (<span class="org-warning">assert-expands</span> (<span class="org-keyword">PROGN</span> (SETQ V1 4) (SETQ V2 3)) (setq2 v1 v2 3))
    (<span class="org-warning">assert-condition</span> division-by-zero
        (<span class="org-warning">error</span> 'floating-point-overflow)
      <span class="org-string">"testing condition assertions"</span>)
    (<span class="org-warning">assert-equalp</span> (values 1 2) (values 1 3 4))))
#&lt;CLUNIT::CLUNIT-TEST-CASE {100FB04C83}&gt;

(run-test 't1-fail)

PROGRESS:
=========
    T1-FAIL: FFFFFE.

FAILURE DETAILS:
================
    T1-FAIL: Expression: (EQUAL X Y)
             Expected: X
             Returned: 2
             This assert-equal test was meant to fail
             X =&gt; 1
             Y =&gt; 2

    T1-FAIL: Expression: (= 1 2)
             Expected: T
             Returned: NIL
             This assert-true test was meant to fail

    T1-FAIL: Expression: (= 1 1)
             Expected: NIL
             Returned: T

    T1-FAIL: Expression: (EQ 'A 'B)
             Expected: 'A
             Returned: B

    T1-FAIL: Expression: (MACROEXPAND-1 '(SETQ2 V1 V2 3))
             Expected: (<span class="org-keyword">PROGN</span> (SETQ V1 4) (SETQ V2 3))
             Returned: (<span class="org-keyword">PROGN</span> (SETQ V1 3) (SETQ V2 3))

    T1-FAIL: arithmetic error FLOATING-POINT-OVERFLOW signalled

SUMMARY:
========
    Test functions:
        Executed: 1
        Skipped:  0

    Tested 7 assertions.
        Passed: 1/7 ( 14.3%)
        Failed: 5/7 ( 71.4%)
        Errors: 1/7 ( 14.3%)
</pre>
</div>
</div>
</li>
<li><a id="orgac3f2c6"></a>Basics<br>
<div class="outline-text-4" id="text-15-3-2">
<p>
Looking a little closer at basic test where we know everything will pass. The empty form after the test name is for the name of the suite (if any). Just for fun and since clunit has it, we will define a macro and show the assert-expands assertion function as well. We also include a diagnostic string in the assertion-condition assertion with the division-by-zero error, but the same could be done for any assertion.
</p>
<div class="org-src-container">
<pre class="src src-lisp">(<span class="org-keyword">defmacro</span> <span class="org-function-name">setq2</span> (v1 v2 e)
  (list 'progn (list 'setq v1 e) (list 'setq v2 e)))

(deftest t1 ()
  <span class="org-string">"describe t1"</span>
  (<span class="org-warning">assert-true</span> (=  1 1))
  (<span class="org-warning">assert-false</span> (=  1 2))
  (<span class="org-warning">assert-eq</span> 'a 'a)
  (<span class="org-warning">assert-expands</span> (<span class="org-keyword">PROGN</span> (SETQ V1 3) (SETQ V2 3)) (setq2 v1 v2 3))
  (<span class="org-warning">assert-condition</span> division-by-zero
      (<span class="org-warning">error</span> 'division-by-zero)
    <span class="org-string">"testing condition assertions"</span>)
  (<span class="org-warning">assert-condition</span> simple-warning
      (<span class="org-warning">signal</span> 'simple-warning)))
</pre>
</div>
<p>
Running this to show the default report on a passing test. There is a progress report with dots indicating passed assertions, F indicating failed assertions and E if there is an error.
</p>
<div class="org-src-container">
<pre class="src src-lisp">(run-test 't1)

PROGRESS:
=========
    T1: ......

SUMMARY:
========
    Test functions:
        Executed: 1
        Skipped:  0

    Tested 6 assertion.
        Passed: 6/6 (100.0%)
</pre>
</div>
<p>
You do not have to manually recompile a test after a tested function has been modified.
</p>
</div>
</li>
<li><a id="orgf97ad5a"></a>Edge Cases: Values expressions, loops. closures and calling other tests<br>
<div class="outline-text-4" id="text-15-3-3">
<p>
Clunit has no special functionality for dealing with values expressions. It accepts them but merely looks at the intial value provided by each expression. The following passes.
</p>
<div class="org-src-container">
<pre class="src src-lisp">(deftest t2-values-expressions ()
  (<span class="org-warning">assert-equal</span> (values 1 2)
                (values 1 3)))
</pre>
</div>
</div>
<ol class="org-ol">
<li><a id="org636a0c4"></a>Looping and closures.<br>
<div class="outline-text-5" id="text-15-3-3-1">
<p>
Will a test accept looping through assertions with lexical variables from a closure? NO. Clunit complains that the variables l1 and l2 are never defined.
</p>
<div class="org-src-container">
<pre class="src src-lisp">(<span class="org-keyword">let</span> ((l1 '(#\a #\B #\z))
      (l2 '(97 66 122)))
(deftest t2-loop ()
  (<span class="org-keyword">loop</span> for x in l1 for y in l2 do
    (<span class="org-warning">assert-equal</span> (char-code x) y))))
</pre>
</div>
<p>
Clunit is quite happy to loop if the variables are defined within the test or, for that matter, if the closure encompassed tested functions rather than the test itself.:
</p>
<div class="org-src-container">
<pre class="src src-lisp">(deftest t2-loop ()
  (<span class="org-keyword">let</span> ((l1 '(#\a #\B #\z))
        (l2 '(97 66 122)))
    (<span class="org-keyword">loop</span> for x in l1 for y in l2 do
      (<span class="org-warning">assert-equal</span> (char-code x) y))))
</pre>
</div>
<p>
CLunit has no assertions that will handle checking more than two values in a single assertion, so you will have to use <code>assert-true</code> with the usual CL functions.
</p>
</div>
</li>
<li><a id="org97bc4d5"></a>Calling another test from a test<br>
<div class="outline-text-5" id="text-15-3-3-2">
<p>
This uses the second version of test t2 which has two failing asssertions and one passing assertion.
</p>
<div class="org-src-container">
<pre class="src src-lisp">(deftest t3 ()<span class="org-comment">; a test that tries to call another test in its body</span>
    <span class="org-string">"describe t3"</span>
          (<span class="org-warning">assert-equal</span> 'a 'a)
          (run-test 't2))

(run-test 't3)

PROGRESS:
=========
    T3: .
PROGRESS:
=========
    T2: FF.

FAILURE DETAILS:
================
    T2: Expression: (EQUAL 1 2)
        Expected: 1
        Returned: 2

    T2: Expression: (EQUAL 2 3)
        Expected: 2
        Returned: 3
SUMMARY:
========
    Test functions:
        Executed: 1
        Skipped:  0

    Tested 3 assertions.
        Passed: 1/3 some tests not passed
        Failed: 2/3 some tests failed
SUMMARY:
========
    Test functions:
        Executed: 1
        Skipped:  0

    Tested 1 assertion.
        Passed: 1/1 all tests passed
SUMMARY:
========
    Test functions:
        Executed: 1
        Skipped:  0

    Tested 1 assertion.
        Passed: 1/1 all tests passed
</pre>
</div>
<p>
It reports each test separately, but correctly, but obviously no composition..
</p>
</div>
</li>
</ol>
</li>

<li><a id="org85d4840"></a>Suites, tags and other multiple test abilities<br>
<ol class="org-ol">
<li><a id="orge805276"></a>Lists of tests<br>
<div class="outline-text-5" id="text-15-3-4-1">
<p>
clunit will not run lists of tests. You can run tests which run other tests. But otherwise you will need to set up suites.
</p>
</div>
</li>
<li><a id="orgb3e30ab"></a>Suites<br>
<div class="outline-text-5" id="text-15-3-4-2">
<p>
Tests can be associated with multiple suites. The execution of tests within a suite are unordered by default, but you can specify that a test depends on other tests passing. If those tests are not passed, then this test will be skipped. This test is put in a queue unti its dependencies are satisfied. Both suite specifications and test dependencies are set in the first parameter form that we left nil in the above tests.
</p>

<p>
Assume you wanted testC to be part of suites suiteA and suiteB and dependent on tests testA and testB passing.
</p>
<div class="org-src-container">
<pre class="src src-lips">(deftest testC ((suiteA suiteB)(testA testB))
  ...)
</pre>
</div>
<p>
Suites are tested using the run-suite function. It has the following additional parameters (besides the obvious name for the suite to be tested):
</p>

<ul class="org-ul">
<li>If REPORT-PROGRESS is non-NIL, the test progress is reported.</li>
<li>If USE-DEBUGGER is non-NIL, the debugger is invoked whenever an assertion fails.</li>
<li>If STOP-ON-FAIL is non-NIL, the rest of the unit test is cancelled when any assertion fails or an error occurs.</li>
<li>If SIGNAL-CONDITION-ON-FAIL is non-NIL, run-suite will signal a TEST-SUITE-FAILURE condition if at least either a test fails or signal an error condition.</li>
<li>if PRINT-RESULTS-SUMMARY is non nil the summary results of tests is printed on the standard output.</li>
</ul>
<div class="org-src-container">
<pre class="src src-lisp">(defsuite s0 ())<span class="org-comment">; Ultimate parent suite if the library provides inheritance</span>

  (deftest t4 (s0) <span class="org-comment">; a test that is a member of a suite</span>
    <span class="org-string">"describe t4"</span>
    (<span class="org-warning">assert-eq</span> 1 1))

  <span class="org-comment-delimiter">;;</span><span class="org-comment">a multiple assertion test that is a member of a suite with</span>
  <span class="org-comment-delimiter">;; </span><span class="org-comment">a passing test, an error signaled and a failing test</span>
  (deftest t4-error (s0)
    <span class="org-string">"describe t4-error"</span>
    (<span class="org-warning">assert-eq</span>  'a 'a)
    (<span class="org-warning">assert-condition</span> error (<span class="org-warning">error</span> <span class="org-string">"t4-errored out"</span>))
    (<span class="org-warning">assert-true</span> (= 1 2)))

  (deftest t4-fail (s0) <span class="org-comment">;</span>
    <span class="org-string">"describe t4-fail"</span>
    (<span class="org-warning">assert-false</span> (= 1 2)))

(defsuite s1 (s0))<span class="org-comment">; a sub-suite of suite s0 to check on inheritance</span>
  (deftest t4-s1 (s1)
   (<span class="org-warning">assert-true</span> (= 1 1)))

(run-suite 's0)

PROGRESS:
=========

    S0: (Test Suite)
        T4-FAIL: .
        T4-ERROR: ..F
        T4: .

        S1: (Test Suite)
            T5: .

FAILURE DETAILS:
================

    S0: (Test Suite)
        T4-ERROR: Expression: (= 1 2)
                  Expected: T
                  Returned: NIL


SUMMARY:
========
    Test functions:
        Executed: 4
        Skipped:  0

    Tested 6 assertions.
        Passed: 5/6 some tests not passed
        Failed: 1/6 some tests failed

FAILURE DETAILS:
================

    S0: (Test Suite)
        T4-ERROR: Expression: (= 1 2)
                  Expected: T
                  Returned: NIL


SUMMARY:
========
    Test functions:
        Executed: 4
        Skipped:  0

    Tested 6 assertions.
        Passed: 5/6 some tests not passed
        Failed: 1/6 some tests failed
</pre>
</div>
</div>
</li>
<li><a id="org4d8c107"></a>Early termination<br>
<div class="outline-text-5" id="text-15-3-4-3">
<p>
You stop a suite test if a test fails without dropping into the debugger.
</p>
<div class="org-src-container">
<pre class="src src-lisp">(run-suite 'suite-name <span class="org-builtin">:stop-on-fail</span> t)
</pre>
</div>

<p>
<a href="#org63aa282">top</a>
</p>
</div>
</li>
<li><a id="orgc7a89ee"></a>Fixtures and Freezing Data<br>
<div class="outline-text-5" id="text-15-3-4-4">
<div class="org-src-container">
<pre class="src src-lisp">(<span class="org-keyword">defclass</span> <span class="org-type">fixture-data</span> ()
  ((a <span class="org-builtin">:initarg</span> <span class="org-builtin">:a</span> <span class="org-builtin">:initform</span> 0 <span class="org-builtin">:accessor</span> a)
   (b <span class="org-builtin">:initarg</span> <span class="org-builtin">:b</span> <span class="org-builtin">:initform</span> 0 <span class="org-builtin">:accessor</span> b)))

(deffixture s1 (@body) <span class="org-comment-delimiter">;;</span><span class="org-comment">IMPORTANT Note that the fixture gets the name of the suite to which it will apply</span>
  (<span class="org-keyword">let</span> ((x (make-instance 'fixture-data <span class="org-builtin">:a</span> 100 <span class="org-builtin">:b</span> -100)))
    @body))

<span class="org-comment-delimiter">;; </span><span class="org-comment">create a sub suite and checking fixture inheritance</span>
(defsuite s2 (s1))

(deftest t6-s1 (s1)
  (<span class="org-warning">assert-equal</span>  (a x) 100)
  (<span class="org-warning">assert-equal</span>   (b x) -100))

(deftest t6-s2 (s2)
  (<span class="org-warning">assert-equal</span>  (a x) 100)
  (<span class="org-warning">assert-equal</span>   (b x) -100))

(run-suite 's1)

PROGRESS:
=========
    S1: (Test Suite)
        T6-S1: ..
        T5: .

        S2: (Test Suite)
            T6-S2: ..
SUMMARY:
========
    Test functions:
        Executed: 3
        Skipped:  0

    Tested 5 assertions.
        Passed: 5/5 all tests passed
SUMMARY:
========
    Test functions:
        Executed: 3
        Skipped:  0

    Tested 5 assertions.
        Passed: 5/5 all tests passed
</pre>
</div>
<p>
To go interactive - dropping immediately into the debugger, you would set the key word parameter :use-debugger to t.
</p>
<div class="org-src-container">
<pre class="src src-lisp">(run-suite suite-name <span class="org-builtin">:use-debugger</span> t)
</pre>
</div>
</div>
</li>
</ol>
</li>

<li><a id="org4d02964"></a>Removing tests<br>
<div class="outline-text-4" id="text-15-3-5">
<div class="org-src-container">
<pre class="src src-lisp">(clunit:undeftest t1)
(clunit:undeffixture fixture-name)
(clunit:undefsuite suite-name)
</pre>
</div>
</div>
</li>
<li><a id="orgb12ddb1"></a>Sequencing, Random and Failure Only<br>
<div class="outline-text-4" id="text-15-3-6">
<p>
The execution of tests within a suite are unordered by default, but you can specify that a test depends on other tests passing. If those tests are not passed, then this test will be skipped.  Clunit has a function <code>rerun-failed-tests</code> to rerun failed tests.
</p>
</div>
</li>
<li><a id="org648cf56"></a>Skip Capability<br>
<div class="outline-text-4" id="text-15-3-7">
<p>
Other than the dependency abilities previously mentioned, clunit has no additional skipping capability.
</p>
</div>
</li>
<li><a id="orgbebd1e9"></a>Random Data Generators<br>
<div class="outline-text-4" id="text-15-3-8">
<p>
Clunit has no built in data generators.
</p>
</div>
</li>
</ol>
</div>
<div id="outline-container-orge05e059" class="outline-3">
<h3 id="orge05e059"><span class="section-number-3">15.4.</span> Discussion</h3>
<div class="outline-text-3" id="text-15-4">
<p>
The difference between clunit2 and clunit is clunit2's ability to redirect reporting output, suite signaling capability and the fact that it has a maintainer. Both of them are very slow.
<a href="#org63aa282">top</a>
</p>
</div>
</div>
<div id="outline-container-org2b867f9" class="outline-3">
<h3 id="org2b867f9"><span class="section-number-3">15.5.</span> Who Uses</h3>
<div class="outline-text-3" id="text-15-5">
<p>
<a href="https://github.com/rmoritz/bt-semaphore">bt-semaphore</a>, <a href="https://github.com/Lisp-Stat/data-frame">data-frame</a>, <a href="https://notabug.org/cage/cl-kanren">cl-kanren</a>,
 "cl-random-tests" "cl-slice-tests"
 "listoflist" "lla-tests" "oe-encode-test" "trivial-tco-test")
</p>

<p>
<a href="#org63aa282">top</a>
<a id="orge473393"></a>
</p>
</div>
</div>
</div>
<div id="outline-container-org0fcec11" class="outline-2">
<h2 id="org0fcec11"><span class="section-number-2">16.</span> clunit2</h2>
<div class="outline-text-2" id="text-16">
<p>
<a href="#org63aa282">top</a>
</p>
</div>
<div id="outline-container-orga7c1620" class="outline-3">
<h3 id="orga7c1620"><span class="section-number-3">16.1.</span> Summary</h3>
<div class="outline-text-3" id="text-16-1">
<table>


<colgroup>
<col  class="org-left">

<col  class="org-left">

<col  class="org-left">

<col  class="org-right">
</colgroup>
<tbody>
<tr>
<td class="org-left"><a href="https://notabug.org/cage/clunit2">homepage</a></td>
<td class="org-left">Cage (fork of clunit)</td>
<td class="org-left">BSD</td>
<td class="org-right">2020</td>
</tr>
</tbody>
</table>
<p>
<b>Update 13 June 2021</b>
Clunit2 is a fork of Clunit. For quicklisp system loading purposes, it is clunit2, for package naming purposes it is clunit, not clunit2.
The difference between clunit2 and clunit is:
</p>

<ul class="org-ul">
<li>clunit2's ability to redirect reporting output,</li>
<li>clunit2's huge performance increase (clunit is painfully slow on any sized testing target)</li>
<li>clunit2' ability to test multiple value expressions</li>
<li>clunit2's suite signaling capability and</li>
<li>the fact that clunit2 has a maintainer.</li>
</ul>

<p>
Clunit2 does report all failing assertions within a test, has the option to turn off progress reporting and accepts user provided diagnostic strings with variables in the assertions. Going interactive with debugging is optional, fixtures are available as are suites and the ability to rerun failed tests. You can specify that a test that depends on other tests passing will be skipped if those prior tests fail.
</p>

<p>
With respect to the edge cases, as of the 13 June 2021 update, Clunit2 will accept variables declared in closures surrounding the test and does have the ability completely test all the values returned from a values expression.
</p>
</div>
</div>

<div id="outline-container-orgfbde03d" class="outline-3">
<h3 id="orgfbde03d"><span class="section-number-3">16.2.</span> Assertion Functions</h3>
<div class="outline-text-3" id="text-16-2">
<p>
Clunit2's assertion functions are:
</p>

<table>


<colgroup>
<col  class="org-left">

<col  class="org-left">

<col  class="org-left">
</colgroup>
<tbody>
<tr>
<td class="org-left">assert-condition</td>
<td class="org-left">assert-eq</td>
<td class="org-left">assert-eql</td>
</tr>

<tr>
<td class="org-left">assert-equal</td>
<td class="org-left">assert-equality</td>
<td class="org-left">assert-equality*</td>
</tr>

<tr>
<td class="org-left">assert-equalp</td>
<td class="org-left">assert-expands</td>
<td class="org-left">assert-fail</td>
</tr>

<tr>
<td class="org-left">assert-false</td>
<td class="org-left">assert-true</td>
<td class="org-left">assertion-condition</td>
</tr>

<tr>
<td class="org-left">assertion-conditions</td>
<td class="org-left">assertion-error</td>
<td class="org-left">assertion-expander</td>
</tr>

<tr>
<td class="org-left">assertion-fail-forced</td>
<td class="org-left">assertion-failed</td>
<td class="org-left">assertion-passed</td>
</tr>
</tbody>
</table>

<p>
<a href="#org63aa282">top</a>
</p>
</div>
</div>
<div id="outline-container-org1e1c7a3" class="outline-3">
<h3 id="org1e1c7a3"><span class="section-number-3">16.3.</span> Usage</h3>
<div class="outline-text-3" id="text-16-3">
</div>
<ol class="org-ol">
<li><a id="org15de211"></a>Report Format<br>
<div class="outline-text-4" id="text-16-3-1">
<p>
Report format is controlled by the variable <code>*clunit-report-format*</code>. It can be set to :default, :tap or NIL. In all the examples showing reports, we will be using the default format.
</p>

<p>
The progress report can be switched off by passing a keyword parameter to the functions run-test or run-suite.
</p>
<div class="org-src-container">
<pre class="src src-lisp">(run-test 'some-test-name <span class="org-builtin">:report-progress</span> nil)

(run-suite 'some-suite-name <span class="org-builtin">:report-progress</span> nil)
</pre>
</div>
<p>
Clunit2, unlike clunit has a <code>*test-output-stream*</code> variable which can be used to redirect the reports to file or other stream locations.
</p>

<p>
To go interactive - dropping immediately into the debugger, you would set the key word parameter :use-debugger to t.
</p>
<div class="org-src-container">
<pre class="src src-lisp">(run-test test-name <span class="org-builtin">:use-debugger</span> t)
</pre>
</div>
</div>
</li>
<li><a id="org9de77aa"></a>Basics<br>
<div class="outline-text-4" id="text-16-3-2">
<p>
The most basic test. The empty form after the test name is for the name of the suite (if any). Just for fun and since clunit has it, we will define a macro and show the assert-expands assertion function as well. We also include a diagnostic string in the assertion-condition assertion with the division-by-zero error, but the same could be done for any assertion.
</p>
<div class="org-src-container">
<pre class="src src-lisp">(<span class="org-keyword">defmacro</span> <span class="org-function-name">setq2</span> (v1 v2 e)
  (list 'progn (list 'setq v1 e) (list 'setq v2 e)))

(deftest t1 ()
  <span class="org-string">"describe t1"</span>
  (<span class="org-warning">assert-true</span> (=  1 1))
  (<span class="org-warning">assert-false</span> (=  1 2))
  (<span class="org-warning">assert-eq</span> 'a 'a)
  (<span class="org-warning">assert-expands</span> (<span class="org-keyword">PROGN</span> (SETQ V1 3) (SETQ V2 3)) (setq2 v1 v2 3))
  (<span class="org-warning">assert-condition</span> division-by-zero
      (<span class="org-warning">error</span> 'division-by-zero)
    <span class="org-string">"testing condition assertions"</span>)
  (<span class="org-warning">assert-condition</span> simple-warning
      (<span class="org-warning">signal</span> 'simple-warning)))
</pre>
</div>
<p>
Running this to show the default report on a passing test. There is a progress report with dots indicating passed assertions, F indicating failed assertions and E if there is an error.:
</p>
<div class="org-src-container">
<pre class="src src-lisp">(run-test 't1)

PROGRESS:
=========
    T1: .....

SUMMARY:
========
    Test functions:
        Executed: 1
        Skipped:  0

    Tested 6 assertion.
        Passed: 6/6 (100.0%)
</pre>
</div>
<p>
You can switch off the progress report for running tests and suites by setting the keyword parameter :report-progress to nil:
</p>
<div class="org-src-container">
<pre class="src src-lisp">(run-test 't1 <span class="org-builtin">:report-progress</span> nil)
</pre>
</div>

<p>
Now a basic failing test with multiple assertions (and also to see if the library can deal with values expressions). We will put some diagnostic strings into a few of the assertions. The first assertion not only has a diagnostic string, but it also has foll variables and the second assertion which does not. Unlike some other framework diagnostic strings, the string that gets passed does not accept format like parameters.
</p>
<div class="org-src-container">
<pre class="src src-lisp">(deftest t1-fail ()
  <span class="org-string">"describe t1-fail"</span>
  (<span class="org-keyword">let</span> ((x 1) (y 2))
    (<span class="org-warning">assert-equal</span> x y  <span class="org-string">"This assert-equal test was meant to fail"</span> x y)
    (<span class="org-warning">assert-true</span> (= 1 2) <span class="org-string">"This assert-true test was meant to fail"</span>)
    (<span class="org-warning">assert-false</span> (=  1 1))
    (<span class="org-warning">assert-eq</span> 'a 'b)
    (<span class="org-warning">assert-expands</span> (<span class="org-keyword">PROGN</span> (SETQ V1 4) (SETQ V2 3)) (setq2 v1 v2 3))
    (<span class="org-warning">assert-condition</span> division-by-zero
        (<span class="org-warning">error</span> 'floating-point-overflow)
      <span class="org-string">"testing condition assertions"</span>)
    (<span class="org-warning">assert-equalp</span> (values 1 2) (values 1 3 4))))
#&lt;CLUNIT::CLUNIT-TEST-CASE {100FB04C83}&gt;
TF-CLUNIT&gt; (run-test 't1-fail)

PROGRESS:
=========
    T1-FAIL: FFFFFE.

FAILURE DETAILS:
================
    T1-FAIL: Expression: (EQUAL X Y)
             Expected: X
             Returned: 2
             This assert-equal test was meant to fail
             X =&gt; 1
             Y =&gt; 2

    T1-FAIL: Expression: (= 1 2)
             Expected: T
             Returned: NIL
             This assert-true test was meant to fail

    T1-FAIL: Expression: (= 1 1)
             Expected: NIL
             Returned: T

    T1-FAIL: Expression: (EQ 'A 'B)
             Expected: 'A
             Returned: B

    T1-FAIL: Expression: (MACROEXPAND-1 '(SETQ2 V1 V2 3))
             Expected: (<span class="org-keyword">PROGN</span> (SETQ V1 4) (SETQ V2 3))
             Returned: (<span class="org-keyword">PROGN</span> (SETQ V1 3) (SETQ V2 3))

    T1-FAIL: arithmetic error FLOATING-POINT-OVERFLOW signalled


SUMMARY:
========
    Test functions:
        Executed: 1
        Skipped:  0

    Tested 7 assertions.
        Passed: 1/7 ( 14.3%)
        Failed: 5/7 ( 71.4%)
        Errors: 1/7 ( 14.3%)
</pre>
</div>
<p>
With respect to the values expression, we can see that it passed, proving clunit only looks at the first value in the values expression.
</p>

<p>
You do not have to manually recompile a test after a tested function has been modified.
</p>
</div>
</li>
<li><a id="org074ea1b"></a>Edge Cases: Values expressions, loops, closures and calling other tests<br>
<div class="outline-text-4" id="text-16-3-3">
<p>
<b>Update 13 June 2021</b> Clunit2 as of the date of this update report will compare all the values from two values expressions. The following now properly fails.
</p>
<div class="org-src-container">
<pre class="src src-lisp">(deftest t2-values-expressions ()
  (<span class="org-warning">assert-equal</span> (values 1 2)
                (values 1 3)))
</pre>
</div>
</div>
<ol class="org-ol">
<li><a id="orgf1eef72"></a>Looping and closures.<br>
<div class="outline-text-5" id="text-16-3-3-1">
<p>
<b>Update 13 June 2021</b> Clunit2 will accept variables declared in a closure surrounding the test. The following passes.
</p>
<div class="org-src-container">
<pre class="src src-lisp">(<span class="org-keyword">let</span> ((l1 '(#\a #\B #\z))
      (l2 '(97 66 122)))
(deftest t2-loop ()
  (<span class="org-keyword">loop</span> for x in l1 for y in l2 do
    (<span class="org-warning">assert-equal</span> (char-code x) y))))
</pre>
</div>
<p>
Clunits is quite happy to loop if the variables are defined within the test:
</p>
<div class="org-src-container">
<pre class="src src-lisp">(deftest t2-loop ()
  (<span class="org-keyword">let</span> ((l1 '(#\a #\B #\z))
        (l2 '(97 66 122)))
    (<span class="org-keyword">loop</span> for x in l1 for y in l2 do
      (<span class="org-warning">assert-equal</span> (char-code x) y))))
</pre>
</div>
</div>
</li>

<li><a id="org85ce11b"></a>Calling another test from a test<br>
<div class="outline-text-5" id="text-16-3-3-2">
<p>
We will call the second version of test t2 which has failures.
</p>
<div class="org-src-container">
<pre class="src src-lisp">(deftest t3 ()<span class="org-comment">; a test that tries to call another test in its body</span>
    <span class="org-string">"describe t3"</span>
          (<span class="org-warning">assert-equal</span> 'a 'a)
          (run-test 't2))

(run-test 't3)

PROGRESS:
=========
    T3: .
PROGRESS:
=========
    T2: FF.

FAILURE DETAILS:
================
    T2: Expression: (EQUAL 1 2)
        Expected: 1
        Returned: 2

    T2: Expression: (EQUAL 2 3)
        Expected: 2
        Returned: 3

SUMMARY:
========
    Test functions:
        Executed: 1
        Skipped:  0

    Tested 3 assertions.
        Passed: 1/3 some tests not passed
        Failed: 2/3 some tests failed

SUMMARY:
========
    Test functions:
        Executed: 1
        Skipped:  0

    Tested 1 assertion.
        Passed: 1/1 all tests passed

SUMMARY:
========
    Test functions:
        Executed: 1
        Skipped:  0

    Tested 1 assertion.
        Passed: 1/1 all tests passed
</pre>
</div>
<p>
It reports each test separately (no compostion), but correctly.
</p>
</div>
</li>
</ol>
</li>
<li><a id="org8df6241"></a>Conditions<br>
<div class="outline-text-4" id="text-16-3-4">
<p>
The following fails as expected.
</p>
<div class="org-src-container">
<pre class="src src-lisp">(deftest t7-bad-error ()
  (<span class="org-warning">assert-condition</span> floating-point-overflow
     (<span class="org-warning">error</span> 'division-by-zero)
     <span class="org-string">"testing condition assertions. This should fail"</span>))
</pre>
</div>
</div>
</li>

<li><a id="org0beb1d7"></a>Suites, tags and other multiple test abilities<br>
<ol class="org-ol">
<li><a id="orgd1f1bf9"></a>Lists of tests<br>
<div class="outline-text-5" id="text-16-3-5-1">
<p>
clunit2 will not run lists of tests. You can run tests which run other tests. But otherwise you will need to set up suites.
</p>
</div>
</li>
<li><a id="org73f2e2e"></a>Suites<br>
<div class="outline-text-5" id="text-16-3-5-2">
<p>
Tests can be associated with multiple suites. The execution of tests within a suite are unordered by default, but you can specify that a test depends on other tests passing. If those tests are not passed, then this test will be skipped. This test is put in a queue unti its dependencies are satisfied. Both suite specifications and test dependencies are set in the first parameter form that we left nil in the above tests.
</p>

<p>
Assume you wanted testC to be part of suites suiteA and suiteB and dependent on tests testA and testB passing.
</p>
<div class="org-src-container">
<pre class="src src-lips">(deftest testC ((suiteA suiteB)(testA testB))
  ...)
</pre>
</div>
<p>
Suites are tested using the run-suite function. It has the following additional parameters (besides the obvious name for the suite to be tested):
</p>

<ul class="org-ul">
<li>If REPORT-PROGRESS is non-NIL, the test progress is reported.</li>
<li>If USE-DEBUGGER is non-NIL, the debugger is invoked whenever an assertion fails.</li>
<li>If STOP-ON-FAIL is non-NIL, the rest of the unit test is cancelled when any assertion fails or an error occurs.</li>
<li>If SIGNAL-CONDITION-ON-FAIL is non-NIL, run-suite will signal a TEST-SUITE-FAILURE condition if at least either a test fails or signal an error condition.</li>
<li>if PRINT-RESULTS-SUMMARY is non nil the summary results of tests is printed on the standard output.</li>
</ul>
<div class="org-src-container">
<pre class="src src-lisp">(defsuite s0 ())<span class="org-comment">; Ultimate parent suite if the library provides inheritance</span>

  (deftest t4 (s0) <span class="org-comment">; a test that is a member of a suite</span>
    <span class="org-string">"describe t4"</span>
    (<span class="org-warning">assert-eq</span> 1 1))

  <span class="org-comment-delimiter">;;</span><span class="org-comment">a multiple assertion test that is a member of a suite with</span>
  <span class="org-comment-delimiter">;; </span><span class="org-comment">a passing test, an error signaled and a failing test</span>
  (deftest t4-error (s0)
    <span class="org-string">"describe t4-error"</span>
    (<span class="org-warning">assert-eq</span>  'a 'a)
    (<span class="org-warning">assert-condition</span> error (<span class="org-warning">error</span> <span class="org-string">"t4-errored out"</span>))
    (<span class="org-warning">assert-true</span> (= 1 2)))

  (deftest t4-fail (s0) <span class="org-comment">;</span>
    <span class="org-string">"describe t4-fail"</span>
    (<span class="org-warning">assert-false</span> (= 1 2)))

(defsuite s1 (s0))<span class="org-comment">; a sub-suite of suite s0 to check on inheritance</span>
  (deftest t4-s1 (s1)
   (<span class="org-warning">assert-true</span> (= 1 1)))

(run-suite 's0)

PROGRESS:
=========
    S0: (Test Suite)
        T4-FAIL: .
        T4-ERROR: ..F
        T4: .

        S1: (Test Suite)
            T5: .
FAILURE DETAILS:
================

    S0: (Test Suite)
        T4-ERROR: Expression: (= 1 2)
                  Expected: T
                  Returned: NIL
SUMMARY:
========
    Test functions:
        Executed: 4
        Skipped:  0

    Tested 6 assertions.
        Passed: 5/6 some tests not passed
        Failed: 1/6 some tests failed

FAILURE DETAILS:
================

    S0: (Test Suite)
        T4-ERROR: Expression: (= 1 2)
                  Expected: T
                  Returned: NIL
SUMMARY:
========
    Test functions:
        Executed: 4
        Skipped:  0

    Tested 6 assertions.
        Passed: 5/6 some tests not passed
        Failed: 1/6 some tests failed
</pre>
</div>
</div>
</li>
<li><a id="org8edcf47"></a>Early termination<br>
<div class="outline-text-5" id="text-16-3-5-3">
<p>
You stop a suite test if a test fails without dropping into the debugger.
</p>
<div class="org-src-container">
<pre class="src src-lisp">(run-suite 'suite-name <span class="org-builtin">:stop-on-fail</span> t)
</pre>
</div>

<p>
<a href="#org63aa282">top</a>
</p>
</div>
</li>
<li><a id="org7e9bee1"></a>Fixtures and Freezing Data<br>
<div class="outline-text-5" id="text-16-3-5-4">
<div class="org-src-container">
<pre class="src src-lisp">(<span class="org-keyword">defclass</span> <span class="org-type">fixture-data</span> ()
  ((a <span class="org-builtin">:initarg</span> <span class="org-builtin">:a</span> <span class="org-builtin">:initform</span> 0 <span class="org-builtin">:accessor</span> a)
   (b <span class="org-builtin">:initarg</span> <span class="org-builtin">:b</span> <span class="org-builtin">:initform</span> 0 <span class="org-builtin">:accessor</span> b)))

(deffixture s1 (@body) <span class="org-comment-delimiter">;;</span><span class="org-comment">IMPORTANT Note that the fixture gets the name of the suite to which it will apply</span>
  (<span class="org-keyword">let</span> ((x (make-instance 'fixture-data <span class="org-builtin">:a</span> 100 <span class="org-builtin">:b</span> -100)))
    @body))

<span class="org-comment-delimiter">;; </span><span class="org-comment">create a sub suite and checking fixture inheritance</span>
(defsuite s2 (s1))

(deftest t6-s1 (s1)
  (<span class="org-warning">assert-equal</span>  (a x) 100)
  (<span class="org-warning">assert-equal</span>   (b x) -100))

(deftest t6-s2 (s2)
  (<span class="org-warning">assert-equal</span>  (a x) 100)
  (<span class="org-warning">assert-equal</span>   (b x) -100))

(run-suite 's1)

PROGRESS:
=========
    S1: (Test Suite)
        T6-S1: ..
        T5: .

        S2: (Test Suite)
            T6-S2: ..
SUMMARY:
========
    Test functions:
        Executed: 3
        Skipped:  0

    Tested 5 assertions.
        Passed: 5/5 all tests passed
SUMMARY:
========
    Test functions:
        Executed: 3
        Skipped:  0

    Tested 5 assertions.
        Passed: 5/5 all tests passed
</pre>
</div>
</div>
</li>
</ol>
</li>

<li><a id="org679ca30"></a>Removing tests<br>
<div class="outline-text-4" id="text-16-3-6">
<div class="org-src-container">
<pre class="src src-lisp">(undeftest t1)
(undeffixture fixture-name)
(undefsuite suite-name)
</pre>
</div>
</div>
</li>
<li><a id="orged1e1d7"></a>Sequencing, Random and Failure Only<br>
<div class="outline-text-4" id="text-16-3-7">
<p>
The execution of tests within a suite are unordered by default, but you can specify that a test depends on other tests passing. If those tests are not passed, then this test will be skipped. Clunit2 has a function <code>rerun-failed-tests</code> to rerun failed tests.
</p>
</div>
</li>
<li><a id="org254c4f1"></a>Skip Capability<br>
<div class="outline-text-4" id="text-16-3-8">
<p>
Other than the dependency abilities previously mentioned, clunit2 has no additional skipping capability.
</p>
</div>
</li>
<li><a id="org3c60ea8"></a>Random Data Generators<br>
<div class="outline-text-4" id="text-16-3-9">
<p>
Clunit2 has no built in data generators.
</p>
</div>
</li>
</ol>
</div>
<div id="outline-container-org971a9e4" class="outline-3">
<h3 id="org971a9e4"><span class="section-number-3">16.4.</span> Discussion</h3>
<div class="outline-text-3" id="text-16-4">
<p>
Clunit2 is a substantial step forward from clunit and should be considered the successor.
</p>
</div>
</div>

<div id="outline-container-org7e8bae9" class="outline-3">
<h3 id="org7e8bae9"><span class="section-number-3">16.5.</span> Who Uses</h3>
<div class="outline-text-3" id="text-16-5">
<p>
<a href="https://github.com/bendudson/array-operations">array-operations</a>, <a href="https://notabug.org/cage/cl-colors2/">cl-colors2</a>, <a href="https://github.com/lisp-mirror/nodgui">nodgui</a>, <a href="https://notabug.org/cage/orizuru-orm">rizuru-orm</a>
</p>

<p>
<a href="#org63aa282">top</a>
<a id="org8d88b5e"></a>
</p>
</div>
</div>
</div>
<div id="outline-container-org742132c" class="outline-2">
<h2 id="org742132c"><span class="section-number-2">17.</span> com.gigamonkeys.test-framework</h2>
<div class="outline-text-2" id="text-17">
</div>
<div id="outline-container-org904b795" class="outline-3">
<h3 id="org904b795"><span class="section-number-3">17.1.</span> Summary</h3>
<div class="outline-text-3" id="text-17-1">
<table>


<colgroup>
<col  class="org-left">

<col  class="org-left">

<col  class="org-left">

<col  class="org-right">
</colgroup>
<tbody>
<tr>
<td class="org-left"><a href="https://github.com/gigamonkey/monkeylib-test-framework">homepage</a></td>
<td class="org-left">Peter Seibel</td>
<td class="org-left">BSD</td>
<td class="org-right">2010</td>
</tr>
</tbody>
</table>
<p>
This is a basic testing framework without the bells and whistles found in several of the others. For example, it lacks fixtures or suites. Nothing wrong with it but you can find a lot more functionality elsewhere.
</p>
</div>
</div>
<div id="outline-container-org8844b03" class="outline-3">
<h3 id="org8844b03"><span class="section-number-3">17.2.</span> Assertion Functions</h3>
<div class="outline-text-3" id="text-17-2">
<table>


<colgroup>
<col  class="org-left">

<col  class="org-left">
</colgroup>
<tbody>
<tr>
<td class="org-left">check</td>
<td class="org-left">expect</td>
</tr>
</tbody>
</table>
<p>
Gigamonkeys has a limited range of assertion functions. <code>expect</code> covers conditions and errors. <code>check</code> is the equivalent of is in e.g. <a href="#org3e895a0">Fiveam</a>.
</p>

<p>
<a href="#org63aa282">top</a>
</p>
</div>
</div>
<div id="outline-container-org96dc5b4" class="outline-3">
<h3 id="org96dc5b4"><span class="section-number-3">17.3.</span> Usage</h3>
<div class="outline-text-3" id="text-17-3">
<p>
One thing to note on setup. If you are using quicklisp, the quickload system name is:
</p>
<div class="org-src-container">
<pre class="src src-lisp">(ql:quickload <span class="org-builtin">:com.gigamonkeys.test-framework</span>)
</pre>
</div>
<p>
however the package name, at least in SBCL, is com.gigamonkeys.test
</p>
</div>
<ol class="org-ol">
<li><a id="orgac70d36"></a>Report Format<br>
<div class="outline-text-4" id="text-17-3-1">
<p>
Gigamonkey tests can be set to go into the debugger on errors, failures or never. this is controlled by the settings of <code>*debug*</code> (for error conditions) and <code>*debug-on-faill*</code> (for test failures).
</p>
</div>
</li>
<li><a id="orgfd2c235"></a>Basics<br>
<div class="outline-text-4" id="text-17-3-2">
<p>
The most basic passing test. Unlike most other frameworks, the empty form after the test name is for parameters which can be passed to the test. Also unlike many other frameworks calling the test using the test function uses an unquoted name of the test.
</p>
<div class="org-src-container">
<pre class="src src-lisp">(deftest t1 (x)
  (check (= 1 x))
  (expect division-by-zero (<span class="org-warning">error</span> 'division-by-zero)))
</pre>
</div>
<div class="org-src-container">
<pre class="src src-lisp">(test t1 1)
Okay: 2 passes<span class="org-comment">; 0 failures; 0 aborts.</span>
T
2
0
0
</pre>
</div>
<p>
Now a basic failing test.
</p>

<p>
To go interactive - dropping immediately into the debugger for unexpected conditions, set  <code>*debug*</code> to t.
</p>

<p>
To drop immediately into the debugger when a test fails, set <code>*debug-on-fail*</code> to t. This is the default, but we will set it to nil for these examples
</p>

<div class="org-src-container">
<pre class="src src-lisp">(deftest t1-fail ()<span class="org-comment">; the most basic failing test</span>
  (<span class="org-keyword">let</span> ((x 1) (y 2))
    (check (= x y) )))

NIL
TEST&gt; (test t1-fail)
FAIL ... (T1-FAIL): (= X Y)
  X                 =&gt; 1
  Y                 =&gt; 2
  (= X Y)           =&gt; NIL
NOT okay: 0 passes<span class="org-comment">; 1 failures; 0 aborts.</span>
NIL
0
1
0

</pre>
</div>
<p>
You do not have to manually recompile a test after a tested function has been modified.
</p>
</div>
</li>
<li><a id="orgb3abb78"></a>Edge Cases: Values expressions, loops, closures and calling other tests<br>
<div class="outline-text-4" id="text-17-3-3">
<p>
Gigamonkeys has no special functionality for dealing with values expressions. It accepts them but merely looks at the intial value provided by each expression. The following passes.
</p>
<div class="org-src-container">
<pre class="src src-lisp">(deftest t2-values-expressions ()
  (check (equal (values 1 2)
                (values 1 3))))
</pre>
</div>
</div>
<ol class="org-ol">
<li><a id="orgcdee864"></a>Closures.<br>
<div class="outline-text-5" id="text-17-3-3-1">
<p>
Gigamonkeys has no problem with variables declared in a closure encompassing the test.
</p>
</div>
</li>
<li><a id="org8cc95c3"></a>Calling another test from a test<br>
<div class="outline-text-5" id="text-17-3-3-2">
<div class="org-src-container">
<pre class="src src-lisp">(deftest t3 ()<span class="org-comment">; a test that tries to call another test in its body</span>
  (check (eql 'a 'a))
  (test t2))

(test t3)
Okay: 3 passes<span class="org-comment">; 0 failures; 0 aborts.</span>
Okay: 4 passes<span class="org-comment">; 0 failures; 0 aborts.</span>
T
4
0
0
</pre>
</div>
<p>
So far so good, but no composition.
</p>
</div>
</li>
</ol>
</li>
<li><a id="org22eb1f2"></a>Conditions<br>
<div class="outline-text-4" id="text-17-3-4">
<p>
The following immediately throws us into the debugger. If we hit PROCEED, we will get the feedback shown below.
</p>
<div class="org-src-container">
<pre class="src src-lisp">  (deftest t7-bad-error ()
    (expect division-by-zero
       (<span class="org-warning">error</span> 'floating-point-overflow)))

  (test t7-bad-error)

ABORT ... (T7-BAD-ERROR): arithmetic error FLOATING-POINT-OVERFLOW signalled
NOT okay: 0 passes<span class="org-comment">; 0 failures; 1 aborts.</span>
NIL
0
0
1
</pre>
</div>
</div>
</li>
<li><a id="org6d4f562"></a>Suites, tags and other multiple test abilities<br>
<ol class="org-ol">
<li><a id="org73645e7"></a>Lists of tests<br>
<div class="outline-text-5" id="text-17-3-5-1">
<p>
Gigamonkeys' test function will not accept a list of tests.
</p>
</div>
</li>
<li><a id="orgd83a5e8"></a>Suites<br>
<div class="outline-text-5" id="text-17-3-5-2">
<p>
Gigamonkeys can run all the tests associated with a package, but if you want to define "suites", you should write your own function that runs specific tests.
</p>
</div>
</li>
</ol>
</li>

<li><a id="orgd4e8f59"></a>Fixtures and Freezing Data<br>
<div class="outline-text-4" id="text-17-3-6">
<p>
None
</p>
</div>
</li>
<li><a id="org269c45b"></a>Removing tests<br>
<div class="outline-text-4" id="text-17-3-7">
<p>
Gigamonkeys has functions <code>remove-test-function</code> and <code>clear-package-tests</code>
</p>
</div>
</li>
<li><a id="org08c91e7"></a>Sequencing, Random and Failure Only<br>
<div class="outline-text-4" id="text-17-3-8">
<p>
None
</p>
</div>
</li>
<li><a id="orgaccadc8"></a>Skip Capability<br>
<div class="outline-text-4" id="text-17-3-9">
<p>
None
</p>
</div>
</li>
<li><a id="org4b23041"></a>Random Data Generators<br>
<div class="outline-text-4" id="text-17-3-10">
<p>
None
</p>
</div>
</li>
</ol>
</div>
<div id="outline-container-org08f4337" class="outline-3">
<h3 id="org08f4337"><span class="section-number-3">17.4.</span> Discussion</h3>
<div class="outline-text-3" id="text-17-4">
<p>
<a href="#org63aa282">top</a>
</p>
</div>
</div>

<div id="outline-container-org8bdb925" class="outline-3">
<h3 id="org8bdb925"><span class="section-number-3">17.5.</span> Who Uses com.gigamonkeys.test-framework</h3>
<div class="outline-text-3" id="text-17-5">
<p>
("monkeylib-text-output")
</p>

<p>
<a href="#org63aa282">top</a>
</p>

<p>
<a id="org4b0d432"></a>
</p>
</div>
</div>
</div>
<div id="outline-container-org57804c2" class="outline-2">
<h2 id="org57804c2"><span class="section-number-2">18.</span> Confidence</h2>
<div class="outline-text-2" id="text-18">
</div>
<div id="outline-container-org6149b7c" class="outline-3">
<h3 id="org6149b7c"><span class="section-number-3">18.1.</span> Summary</h3>
<div class="outline-text-3" id="text-18-1">
<table>


<colgroup>
<col  class="org-left">

<col  class="org-left">

<col  class="org-left">

<col  class="org-right">
</colgroup>
<tbody>
<tr>
<td class="org-left"><a href="https://github.com/melusina-org/cl-confidence">homepage</a></td>
<td class="org-left">Michaël Le Barbier</td>
<td class="org-left">MIT</td>
<td class="org-right">2023</td>
</tr>
</tbody>
</table>

<p>
Confidence is a new entry by someone who found the existing frameworks (based on his experience with Stefil and Fiveam) either too complicated, they did not provide enough debugging information to know exactly where the problem is and were not extensible in the sense of adding additional assertions. I am sure that Confidence meets his needs, but would not meet the needs of other users.
</p>

<p>
It does report all failing assertions in a test. It has suites but no fixtures and does not allow you to provide user created diagnostic strings for the assertions. On the plus side it has some really nice floating point assertions that are not found elsewhere.
</p>
</div>
</div>
<div id="outline-container-org0d15ccb" class="outline-3">
<h3 id="org0d15ccb"><span class="section-number-3">18.2.</span> Assertion Functions</h3>
<div class="outline-text-3" id="text-18-2">
<table>


<colgroup>
<col  class="org-left">

<col  class="org-left">
</colgroup>
<tbody>
<tr>
<td class="org-left">assert-char-equal</td>
<td class="org-left">assert-string-equal</td>
</tr>

<tr>
<td class="org-left">assert-char&lt;</td>
<td class="org-left">assert-string-match</td>
</tr>

<tr>
<td class="org-left">assert-char&lt;=</td>
<td class="org-left">assert-string&lt;</td>
</tr>

<tr>
<td class="org-left">assert-char=</td>
<td class="org-left">assert-string&lt;=</td>
</tr>

<tr>
<td class="org-left">assert-char&gt;</td>
<td class="org-left">assert-string=</td>
</tr>

<tr>
<td class="org-left">assert-char&gt;=</td>
<td class="org-left">assert-string&gt;</td>
</tr>

<tr>
<td class="org-left">assert-condition</td>
<td class="org-left">assert-string&gt;=</td>
</tr>

<tr>
<td class="org-left">assert-eq</td>
<td class="org-left">assert-subsetp</td>
</tr>

<tr>
<td class="org-left">assert-eql</td>
<td class="org-left">assert-t</td>
</tr>

<tr>
<td class="org-left">assert-equal</td>
<td class="org-left">assert-t*</td>
</tr>

<tr>
<td class="org-left">assert-equalp</td>
<td class="org-left">assert-type</td>
</tr>

<tr>
<td class="org-left">assert-float-is-approximately-equal</td>
<td class="org-left">assert-vector-equal</td>
</tr>

<tr>
<td class="org-left">assert-float-is-definitely-greater-than</td>
<td class="org-left">assert&lt;</td>
</tr>

<tr>
<td class="org-left">assert-float-is-definitely-less-than</td>
<td class="org-left">assert&lt;=</td>
</tr>

<tr>
<td class="org-left">assert-float-is-essentially-equal</td>
<td class="org-left">assert=</td>
</tr>

<tr>
<td class="org-left">assert-list-equal</td>
<td class="org-left">assert&gt;</td>
</tr>

<tr>
<td class="org-left">assert-nil</td>
<td class="org-left">assert&gt;=</td>
</tr>

<tr>
<td class="org-left">assert-set-equal</td>
</tr>
</tbody>
</table>

<p>
Confidence also provides a macro for defining more assertions.
</p>

<p>
<a href="#org63aa282">top</a>
</p>
</div>
</div>
<div id="outline-container-org2f2bcc5" class="outline-3">
<h3 id="org2f2bcc5"><span class="section-number-3">18.3.</span> Usage</h3>
<div class="outline-text-3" id="text-18-3">
</div>
<ol class="org-ol">
<li><a id="org3edea9c"></a>Report Format<br>
<div class="outline-text-4" id="text-18-3-1">
<p>
Test failures in Confidence create a result object. Result object are combined and produce a report.
</p>
</div>
</li>
<li><a id="orge88f790"></a>Basics<br>
<div class="outline-text-4" id="text-18-3-2">
<p>
Tests in Confidence are functions. Unless we are calling multiple tests in the following examples, we will just call the test-case function itself. The empty form after the test name is not really described in the documentation, but can be used in parameterized test cases.
</p>

<p>
The basic passing test below shows the floating point comparisons built into Confidence.
</p>
<div class="org-src-container">
<pre class="src src-lisp">(<span class="org-keyword">define-testcase</span> t1 ()
  <span class="org-string">"describe t1"</span>
  (<span class="org-warning">assert-t</span> (=  1 1))
  (<span class="org-warning">assert-string&lt;</span> <span class="org-string">"abc"</span> <span class="org-string">"def"</span>)
  (<span class="org-warning">assert-float-is-approximately-equal</span> 5.100000 5.1000001)
  (<span class="org-warning">assert-float-is-essentially-equal</span> 5.100000 5.1000001)
  (<span class="org-warning">assert-float-is-definitely-greater-than</span> 5.100001 5.100000)
  (<span class="org-warning">assert-float-is-definitely-less-than</span> 5.100000 5.100001)
  (<span class="org-warning">assert-equal</span> (values 1 2) (values 1 2)))

(t1)
Name: T1
Total: 7
Success: 7/7 (100%)
Failure: 0/7 (0%)
Condition: 0/7 (0%)
Outcome: Success
NIL
</pre>
</div>
<p>
A parameterized test case:
</p>
<div class="org-src-container">
<pre class="src src-lisp">(<span class="org-keyword">define-testcase</span> t1-p (y)<span class="org-comment">; the most basic parameterized</span>
  (<span class="org-keyword">let</span> ((x 1))
    (<span class="org-warning">assert-equal</span> x y)))

(t1-p 1)
</pre>
</div>
<p>
Now a basic failing test. This time we are using a more specific assertion (assert-equal..). Unlike some other frameworks, we cannot pass a descriptive string to the assertion.
</p>
<div class="org-src-container">
<pre class="src src-lisp">(<span class="org-keyword">define-testcase</span> t1-fail ()<span class="org-comment">; the most basic failing test</span>
  (<span class="org-keyword">let</span> ((x 1) (y 2))
    (<span class="org-warning">assert-equal</span> x y)
    (<span class="org-warning">assert-equal</span> y 3))

(t1-fail)
Name: T1-FAIL
Total: 2
Success: 0/2 (0%)
Failure: 2/2 (100%)
Condition: 0/2 (0%)
Outcome: Failure
================================================================================
#&lt;ASSERTION-FAILURE {70066055D3}&gt; is an assertion result of type ASSERTION-FAILURE.
Type: <span class="org-builtin">:FUNCTION</span>
Name: ASSERT-EQUAL
Path:
  T1-FAIL
Arguments:
 Argument #1: 1
 Argument #2: 2
Form: (<span class="org-warning">ASSERT-EQUAL</span> X Y)
Outcome: Failure
Description: Assert that A and B satisfy the EQUAL predicate.
  In this call, forms in argument position evaluate as:

  A: 1

  B: 2

================================================================================
#&lt;ASSERTION-FAILURE {7006605863}&gt; is an assertion result of type ASSERTION-FAILURE.
Type: <span class="org-builtin">:FUNCTION</span>
Name: ASSERT-EQUAL
Path:
  T1-FAIL
Arguments:
 Argument #1: 2
 Argument #2: 3
Form: (<span class="org-warning">ASSERT-EQUAL</span> Y 3)
Outcome: Failure
Description: Assert that A and B satisfy the EQUAL predicate.
  In this call, forms in argument position evaluate as:

  A: 2

  B: 3

NIL
</pre>
</div>

<p>
You do not have to manually recompile a test after a tested function has been modified.
</p>
</div>
</li>

<li><a id="org37744e1"></a>Edge Cases: Multiple assertions, loops. closures and calling other tests<br>
<div class="outline-text-4" id="text-18-3-3">
<div class="org-src-container">
<pre class="src src-lisp">  (t2)
  Name: T2
  Total: 3
  Success: 1/3 (33%)
  Failure: 2/3 (67%)
  Condition: 0/3 (0%)
  Outcome: Failure
  ================================================================================
  #&lt;ASSERTION-FAILURE {700692EF83}&gt; is an assertion result of type ASSERTION-FAILURE.
  Type: <span class="org-builtin">:FUNCTION</span>
  Name: ASSERT-EQUAL
  Path:
    T2
  Arguments:
   Argument #1: 1
   Argument #2: 2
  Form: (<span class="org-warning">ASSERT-EQUAL</span> 1 2)
  Outcome: Failure
  Description: Assert that A and B satisfy the EQUAL predicate.
    In this call, forms in argument position evaluate as:

    A: 1

    B: 2

  ================================================================================
  #&lt;ASSERTION-FAILURE {700692F1F3}&gt; is an assertion result of type ASSERTION-FAILURE.
  Type: <span class="org-builtin">:FUNCTION</span>
  Name: ASSERT-EQUAL
  Path:
    T2
  Arguments:
   Argument #1: 2
   Argument #2: 3
  Form: (<span class="org-warning">ASSERT-EQUAL</span> 2 3)
  Outcome: Failure
  Description: Assert that A and B satisfy the EQUAL predicate.
    In this call, forms in argument position evaluate as:

    A: 2

    B: 3

NIL
</pre>
</div>
<p>
Confidence had no problem with the values expression as such, but like almost all the frameworks, it only looked at the first value.
</p>
</div>
<ol class="org-ol">
<li><a id="orga845c5f"></a>Closures<br>
<div class="outline-text-5" id="text-18-3-3-1">
<p>
Confidence has no problem accessing variables defined in a closure encompassing the test.
</p>
<div class="org-src-container">
<pre class="src src-lisp">(<span class="org-keyword">let</span> ((l1 '(#\a #\B #\z))
       (l2 '(97 66 122)))
 (<span class="org-keyword">define-testcase</span> t2-loop ()
   (<span class="org-keyword">loop</span> for x in l1 for y in l2 do
     (<span class="org-warning">assert-equal</span> (char-code x) y))))

     (t2-loop)
     Name: T2-LOOP
     Total: 3
     Success: 3/3 (100%)
     Failure: 0/3 (0%)
     Condition: 0/3 (0%)
     Outcome: Success
     NIL
</pre>
</div>
<p>
Checking assert= with multiple values.
</p>
<div class="org-src-container">
<pre class="src src-lisp">(<span class="org-keyword">define-testcase</span> t2-with-multiple-values ()
      (assert= 1 1 2))
  T2-WITH-MULTIPLE-VALUES
  (t2-with-multiple-values)
(t2-with-multiple-values)
Name: T2-WITH-MULTIPLE-VALUES
Total: 1
Success: 0/1 (0%)
Failure: 0/1 (0%)
Condition: 1/1 (100%)
Outcome: Failure
================================================================================
#&lt;ASSERTION-CONDITION {70070524F3}&gt; is an assertion result of type ASSERTION-CONDITION.
Type: <span class="org-builtin">:FUNCTION</span>
Name: ASSERT=
Path:
  T2-WITH-MULTIPLE-VALUES
Arguments:
 Argument #1: 1
 Argument #2: 1
 Argument #3: 2
Form: (ASSERT= 1 1 2)
Outcome: Condition
Condition: #&lt;SB-INT:SIMPLE-PROGRAM-ERROR <span class="org-string">"invalid number of arguments: ~S"</span> {7006F4B683}&gt;
#&lt;SB-INT:SIMPLE-PROGRAM-ERROR <span class="org-string">"invalid number of arguments: ~S"</span> {7006F..
  [condition]

Slots with <span class="org-builtin">:INSTANCE</span> allocation:
  FORMAT-CONTROL                 = <span class="org-string">"invalid number of arguments: ~S"</span>
  FORMAT-ARGUMENTS               = (3)
  In this call, forms in argument position evaluate as:

  A: 1

  B: 1

NIL
</pre>
</div>
<p>
It failed. All the assertions in Confidence compare two values only.
</p>
</div>
</li>
<li><a id="orgadbf992"></a>Calling another test from a test<br>
<div class="outline-text-5" id="text-18-3-3-2">
<p>
If you call a test within a test in Most other frameworks you will effectively get two reports. Confidence actually composes the results.
</p>
<div class="org-src-container">
<pre class="src src-lisp">(<span class="org-keyword">define-testcase</span> t3 ()
  <span class="org-string">"describe t3 which is a test that tries to call another test in its body"</span>
  (<span class="org-warning">assert-equal</span> 'a 'a)
  (t1))
(t3)
Name: T3
Total: 8
Success: 8/8 (100%)
Failure: 0/8 (0%)
Condition: 0/8 (0%)
Outcome: Success
NIL
</pre>
</div>
<p>
If test t3 called test t2, we would have seen the following in the debugger which implies that the assertion failure was in t2, not t3:
</p>
<div class="org-src-container">
<pre class="src src-lisp">Name: T3
Total: 4
Success: 2/4 (50%)
Failure: 2/4 (50%)
Condition: 0/4 (0%)
Outcome: Failure
================================================================================
Name: T2
Total: 3
Success: 1/3 (33%)
Failure: 2/3 (67%)
Condition: 0/3 (0%)
Outcome: Failure
================================================================================
#&lt;ASSERTION-FAILURE {7007FEADA3}&gt; is an assertion result of type ASSERTION-FAILURE.
Type: <span class="org-builtin">:FUNCTION</span>
Name: ASSERT-EQUAL
Path:
  T3
    T2
Arguments:
 Argument #1: 1
 Argument #2: 2
Form: (<span class="org-warning">ASSERT-EQUAL</span> 1 2)
Outcome: Failure
Description: Assert that A and B satisfy the EQUAL predicate.
  In this call, forms in argument position evaluate as:

  A: 1

  B: 2

================================================================================
#&lt;ASSERTION-FAILURE {7007FEB013}&gt; is an assertion result of type ASSERTION-FAILURE.
Type: <span class="org-builtin">:FUNCTION</span>
Name: ASSERT-EQUAL
Path:
  T3
    T2
Arguments:
 Argument #1: 2
 Argument #2: 3
Form: (<span class="org-warning">ASSERT-EQUAL</span> 2 3)
Outcome: Failure
Description: Assert that A and B satisfy the EQUAL predicate.
  In this call, forms in argument position evaluate as:

  A: 2

  B: 3
</pre>
</div>
</div>
</li>
</ol>
</li>
<li><a id="org0d3641b"></a>Conditions<br>
<div class="outline-text-4" id="text-18-3-4">
<p>
Confidence has a macro assert-condition that verifies that a form signals a condition of a certain class. It can also examine the slots of the condition with assertions:
</p>
<div class="org-src-container">
<pre class="src src-lisp">(<span class="org-keyword">define-testcase</span> t4 ()
  (<span class="org-warning">assert-condition</span>
      (<span class="org-warning">error</span> 'testing-framework <span class="org-builtin">:a</span> <span class="org-string">"a"</span> <span class="org-builtin">:b</span> <span class="org-string">"b"</span> <span class="org-builtin">:c</span> <span class="org-string">"c"</span>)
      testing-framework
      (a b)
    (<span class="org-warning">assert-string=</span> <span class="org-string">"a"</span> a)
    (<span class="org-warning">assert-string=</span> <span class="org-string">"b"</span> b)))

(t4)
Name: T4
Total: 1
Success: 1/1 (100%)
Failure: 0/1 (0%)
Condition: 0/1 (0%)
Outcome: Success
NIL
</pre>
</div>
</div>
</li>
<li><a id="orgfd94e52"></a>Suites, tags and other multiple test abilities<br>
<ol class="org-ol">
<li><a id="org8033c43"></a>Lists of tests<br>
<div class="outline-text-5" id="text-18-3-5-1">
<p>
There is no "run-test" like function in Confidence. If you want to run a list of tests, you need to define a test that funcalls those tests.
</p>
</div>
</li>
<li><a id="org5de8439"></a>Suites<br>
<div class="outline-text-5" id="text-18-3-5-2">
<p>
Tests can be nested and will generate a composed summary. This might be considered a "suite" capability.
</p>
</div>
</li>
</ol>
</li>

<li><a id="org15d1648"></a>Fixtures and Freezing Data<br>
<div class="outline-text-4" id="text-18-3-6">
<p>
There is no additional capability in Confidence for fixtures or freezing data.
</p>
</div>
</li>
<li><a id="orga7cebc5"></a>Removing tests<br>
<div class="outline-text-4" id="text-18-3-7">
<p>
None
</p>
</div>
</li>
<li><a id="orgcd86e59"></a>Sequencing, Random and Failure Only<br>
<div class="outline-text-4" id="text-18-3-8">
<p>
Tests will be called in sequence and there is no random shuffling or skipping ability.
</p>
</div>
</li>
<li><a id="org161d782"></a>Skip Capability<br>
<div class="outline-text-4" id="text-18-3-9">
<p>
None other than provided in the debugger.
</p>
</div>
</li>
<li><a id="org8c0ebbc"></a>Random Data Generators<br>
<div class="outline-text-4" id="text-18-3-10">
<p>
None
</p>
</div>
</li>
</ol>
</div>
<div id="outline-container-org6130cc1" class="outline-3">
<h3 id="org6130cc1"><span class="section-number-3">18.4.</span> Discussion</h3>
<div class="outline-text-3" id="text-18-4">
<p>
Confidence does provide the ability to define more assertions.
</p>


<p>
In summary, Confidence is interesting, but it will not make me change from another framework. I do think some other frameworks might want to follow its lead in having some float comparision assertions.
</p>

<p>
<a href="#org63aa282">top</a>
</p>
</div>
</div>
<div id="outline-container-orgfff7138" class="outline-3">
<h3 id="orgfff7138"><span class="section-number-3">18.5.</span> Who Uses</h3>
</div>
</div>

<div id="outline-container-org53910ab" class="outline-2">
<h2 id="org53910ab"><span class="section-number-2">19.</span> fiasco</h2>
<div class="outline-text-2" id="text-19">
</div>
<div id="outline-container-orgc78be66" class="outline-3">
<h3 id="orgc78be66"><span class="section-number-3">19.1.</span> Summary</h3>
<div class="outline-text-3" id="text-19-1">
<table>


<colgroup>
<col  class="org-left">

<col  class="org-left">

<col  class="org-left">

<col  class="org-right">
</colgroup>
<tbody>
<tr>
<td class="org-left"><a href="https://github.com/joaotavora/fiasco">homepage</a></td>
<td class="org-left">João Távora</td>
<td class="org-left">BSD 2 Clause</td>
<td class="org-right">2020</td>
</tr>
</tbody>
</table>

<p>
In spite of the fact that Fiasco does not have its own fixture capability (unless I am missing something), it managed to hit most of the other concerns that I have. It does report all failing assertions within a test, has the option to turn off progress reporting and accepts user provided diagnostic strings with variables in the assertions. Going interactive with debugging is optional, suites are available as is the ability to rerun failed tests. It has skipping functions and, with respect to the edge cases, it handles variables declared in a closure surrounding the test. When a test calls another test it actually manages to compose the results rather than reporting two separate sets.
</p>

<p>
I found using the suite capability to be confusing (and likely would end up defining packages instead of suites, but you lose some compostion that way). It also does not have the ability some other frameworks have to deal with values expressions.
</p>
</div>
</div>
<div id="outline-container-orgd752f39" class="outline-3">
<h3 id="orgd752f39"><span class="section-number-3">19.2.</span> Assertion Functions</h3>
<div class="outline-text-3" id="text-19-2">
<table>


<colgroup>
<col  class="org-left">

<col  class="org-left">

<col  class="org-left">

<col  class="org-left">
</colgroup>
<tbody>
<tr>
<td class="org-left">is</td>
<td class="org-left">finishes</td>
<td class="org-left">not-signals</td>
<td class="org-left">signals</td>
</tr>
</tbody>
</table>

<p>
<a href="#org63aa282">top</a>
</p>
</div>
</div>
<div id="outline-container-orgdbe8dd6" class="outline-3">
<h3 id="orgdbe8dd6"><span class="section-number-3">19.3.</span> Usage</h3>
<div class="outline-text-3" id="text-19-3">
</div>
<ol class="org-ol">
<li><a id="orgcbed8a6"></a>Report Format<br>
<div class="outline-text-4" id="text-19-3-1">
<p>
Fiasco defaults to a reporting format. To go interactive run the test with :interactive t.
</p>

<p>
There are two slightly different versions of reporting format, the default and running the test with :verbose t. The verbose version simply adds the docstring for the test, so it does not really add much.
</p>

<p>
In the following example, look at the difference in reporting between the four assertions. The first assertion has an <code>=</code> predicate comparing numbers. The second has an <code>equal</code> predicate comparing numbers and the third has variables and a diagnostic string that accepts parameters followed by the variables being passed to the test variables.
</p>
<div class="org-src-container">
<pre class="src src-lisp">(deftest t1-fail ()
  <span class="org-string">"Docstring for test t1-fail"</span>
  (<span class="org-keyword">let</span> ((x 1) (y 2))
    (is (= 1 2))
    (is (equal 1 2))
    (is (= x y)
        <span class="org-string">"This test was meant to fail because we know ~a is not = to ~a"</span>
        x y )
    (signals division-by-zero
             (<span class="org-warning">error</span> 'floating-point-overflow)
             <span class="org-string">"testing condition assertions. This should fail"</span>)))

(run-tests 't1-fail)
T1-FAIL...................................................................[FAIL]

Test run had 4 failures:

Failure 1: UNEXPECTED-ERROR when running T1-FAIL
arithmetic error FLOATING-POINT-OVERFLOW signalled

Failure 2: FAILED-ASSERTION when running T1-FAIL
This test was meant to fail because we know 1 is not = to 2

Failure 3: FAILED-ASSERTION when running T1-FAIL
Binary predicate (EQUAL X Y) failed.
x: 1 =&gt; 1
y: 2 =&gt; 2

Failure 4: FAILED-ASSERTION when running T1-FAIL
Binary predicate (= X Y) failed.
x: 1 =&gt; 1
y: 2 =&gt; 2
NIL
(#&lt;test-run of T1-FAIL: 1 test, 4 assertions, 4 failures in NIL sec (3 failed assertions, 1 error, none expected)&gt;)
</pre>
</div>
<p>
The interactive version would look like this:
</p>
<div class="org-src-container">
<pre class="src src-lisp">(run-tests 't1-fail <span class="org-builtin">:interactive</span> t)
  Test assertion failed when running T1-FAIL:

  Binary predicate (= X Y) failed.
  x: 1 =&gt; 1
  y: 2 =&gt; 2
     [Condition of type FIASCO::FAILED-ASSERTION]

  Restarts:
   0: [CONTINUE] Roger, go on testing...
   1: [CONTINUE] Skip the rest of the test T1-FAIL and continue by returning (values)
   2: [RETEST] Rerun the test T1-FAIL
   3: [CONTINUE-WITHOUT-DEBUGGING] Turn off debugging for this test session and invoke the first CONTINUE restart
   4: [CONTINUE-WITHOUT-DEBUGGING-ERRORS] Do not stop at unexpected errors for the rest of this test session and continue by invoking the first CONTINUE restart
   5: [CONTINUE-WITHOUT-DEBUGGING-ASSERTIONS] Do not stop at failed assertions for the rest of this test session and continue by invoking the first CONTINUE restart
</pre>
</div>
</div>
</li>
<li><a id="orga1913ba"></a>Basics<br>
<div class="outline-text-4" id="text-19-3-2">
<p>
The empty form after the test name is for parameters to pass to the test. Calling the test using <code>run-tests</code> returns a list of <code>context</code> objects which is an internal class. Each test run is pushed to a history of test runs kept in the appropriately named <code>*test-result-history*</code>.
</p>
<div class="org-src-container">
<pre class="src src-lisp">(deftest t1 ()
  <span class="org-string">"docstring for t1"</span>
  (is (=  1 1) <span class="org-string">"first assertion"</span>)
  (is (eq 'a 'a) <span class="org-string">"second assertion"</span>)
  (signals division-by-zero (<span class="org-warning">error</span> 'division-by-zero))
  (finishes (+ 1 1)))
T1
(run-tests 't1) <span class="org-comment-delimiter">;; </span><span class="org-comment">or (run-tests '(t1))</span>
T1........................................................................[ OK ]

T
(#&lt;test-run of T1: 1 test, 4 assertions, 0 failures in 1.4e-5 sec&gt;)
</pre>
</div>
<p>
If you add the keyword parameter :verbose, you get slightly more information in that it prints the test docstring (but not the assertion docstrings) and the number of assertions, failures etc.
</p>
<div class="org-src-container">
<pre class="src src-lisp">(run-tests 't1 <span class="org-builtin">:verbose</span> t)
T1........................................................................[ OK ]
(docstring for t1)
(4 assertions, 0 failed, 0 errors, 0 expected)
</pre>
</div>
<p>
Fiasco tests are funcallable. You will note that when calling the test in this fashion returns a single test-run object rather than a list of test run objects.
</p>
<div class="org-src-container">
<pre class="src src-lisp">(t1)
.
T
#&lt;test-run of T1: 1 test, 1 assertion, 0 failures in 2.8e-5 sec&gt;

(funcall 't1)
.
T
#&lt;test-run of T1: 1 test, 4 assertion, 0 failures in 2.6e-5 sec&gt;
</pre>
</div>
<p>
Fiasco tests also take parameters as in this example:
</p>
<div class="org-src-container">
<pre class="src src-lisp">(deftest t1-param (x) (is (= 1 x)))

(t1-param 1)
#&lt;test-run of T1-PARAM: 1 test, 1 assertion, 0 failures in 2.2e-5 sec&gt;

(t1-param 2)
X<span class="org-comment">; Evaluation aborted on #&lt;FIASCO::FAILED-ASSERTION "Binary assertion function ~A failed.~%~</span>
                               x: ~S =&gt; ~S~%~
                               y: ~S =&gt; ~S<span class="org-string">" {100297EE03}&gt;.</span>
</pre>
</div>
<p>
You do not have to manually recompile a test after a tested function has been modified. We will skip the proof.
</p>
</div>
</li>
<li><a id="org392ca58"></a>Edge Cases: Values expressions, loops, closures and calling other tests<br>
<div class="outline-text-4" id="text-19-3-3">
<p>
Fiasco has no special functionality for dealing with values expressions. It accepts them but merely looks at the intial value provided by each expression. The following passes.
</p>
<div class="org-src-container">
<pre class="src src-lisp">(deftest t2-values-expressions ()
  (is (equalp (values 1 2)
                (values 1 3))))
</pre>
</div>
</div>
<ol class="org-ol">
<li><a id="org6a08612"></a>Looping and closures.<br>
<div class="outline-text-5" id="text-19-3-3-1">
<p>
Fiasco has no problems with using variables declared in a closure surrounding the test.
</p>
</div>
</li>
<li><a id="org3d78351"></a>Calling another test from a test<br>
<div class="outline-text-5" id="text-19-3-3-2">
<div class="org-src-container">
<pre class="src src-lisp">(deftest t3 ()<span class="org-comment">; a test that tries to call another test in its body</span>
    (is (eq 'a 'a))
    (t2))

(t3)
.XX.
T
#&lt;test-run of T3: 2 tests, 4 assertions, 2 failures in 0.063884 sec (2 failed assertions, 0 errors, none expected)&gt;
</pre>
</div>
<p>
As hoped, the failures in t2 kicked us into the debugger where we could select continue and correctly end up with 2 tests, 4 assertions and 2 failures. This is better than most frameworks which would present us with two reports rather than a composed report.
</p>
</div>
</li>
</ol>
</li>

<li><a id="org516a7fd"></a>Suites, tags and other multiple test abilities<br>
<ol class="org-ol">
<li><a id="org8be4bee"></a>Lists of tests<br>
<div class="outline-text-5" id="text-19-3-4-1">
<p>
Fiasco has no problem running lists of tests
</p>
<div class="org-src-container">
<pre class="src src-lisp">(run-tests '(t1 t2))
T1........................................................................[ OK ]

T2........................................................................[ OK ]

T
(#&lt;test-run of T1: 1 test, 1 assertion, 0 failures in 1.4e-5 sec&gt;
 #&lt;test-run of T2: 1 test, 3 assertions, 0 failures in 5.0e-6 sec&gt;)
</pre>
</div>
</div>
</li>
<li><a id="org32c68e7"></a>Suites<br>
<div class="outline-text-5" id="text-19-3-4-2">
<p>
Fiasco can test for suites or all tests associated with a fiasco defined package.
</p>

<p>
Let's start with packages.
</p>
</div>
<ol class="org-ol">
<li><a id="org8e94698"></a>Packages<br>
<div class="outline-text-6" id="text-19-3-4-2-1">
<p>
You will need to use fiasco's  <code>define-test-package</code> macro rather than  <code>define-package</code> in order to use the <code>run-package-tests</code> function. Inside the new package, the function <code>run-package-tests</code> is the preferred way to execute the suite. To run the tests from outside, use <code>run-tests</code>.
</p>

<p>
The function <code>run-package-tests</code> will print a report and returns two values. It accepts a :stream keyword parameter, making it easy to redirect the output to a file if so desired.
</p>

<p>
The first value returned will be t if all tests passed, nil otherwise. The second value will be a list of context objects which contain various information about the test run. See the following example, modified slightly from <a href="https://github.com/joaotavora/fiasco/blob/master/test/suite-tests.lisp">https://github.com/joaotavora/fiasco/blob/master/test/suite-tests.lisp</a>.
</p>


<div class="org-src-container">
<pre class="src src-lisp">(<span class="org-keyword">fiasco:define-test-package</span> <span class="org-builtin">#:tf-fiasco-examples</span>)

(<span class="org-keyword">in-package</span> <span class="org-builtin">:tf-fiasco-examples</span>)

(<span class="org-keyword">defun</span> <span class="org-function-name">seconds</span> (hours-and-minutes)
  (+ (* 3600 (first hours-and-minutes))
     (* 60 (second hours-and-minutes))))

(<span class="org-keyword">defun</span> <span class="org-function-name">hours-and-minutes</span> (seconds)
  (list (truncate seconds 3600)
        (truncate seconds 60)))

(deftest test-conversion-to-hours-and-minutes ()
  (is (equal (hours-and-minutes 180) '(0 3)))
  (is (equal (hours-and-minutes 4500) '(1 15))))

(deftest test-conversion-to-seconds ()
  (is (= 60 (seconds '(0 1))))
  (is (= 4500 (seconds '(1 15)))))

(deftest double-conversion ()
  (is (= 3600 (seconds (hours-and-minutes 3600))))
  (is (= 1234 (seconds (hours-and-minutes 1234)))))

(deftest test-skip-test ()
  (skip)
  <span class="org-comment-delimiter">;; </span><span class="org-comment">These should not affect the test statistics below.</span>
  (is (= 1 1))
  (is (= 1 2)))

(run-package-tests <span class="org-builtin">:package</span> <span class="org-builtin">:tf-fiasco-examples</span>)
TF-FIASCO-EXAMPLES (Suite)
  TEST-CONVERSION-TO-HOURS-AND-MINUTES....................................[FAIL]
  TEST-CONVERSION-TO-SECONDS..............................................[ OK ]
  DOUBLE-CONVERSION.......................................................[FAIL]
  TEST-SKIP-TEST..........................................................[SKIP]

Test run had 3 failures:

  Failure 1: FAILED-ASSERTION when running DOUBLE-CONVERSION
    Binary assertion function (= X Y) failed.
    x: 1234 =&gt; 1234
    y: (SECONDS (HOURS-AND-MINUTES 1234)) =&gt; 1200

  Failure 2: FAILED-ASSERTION when running DOUBLE-CONVERSION
    Binary assertion function (= X Y) failed.
    x: 3600 =&gt; 3600
    y: (SECONDS (HOURS-AND-MINUTES 3600)) =&gt; 7200

  Failure 3: FAILED-ASSERTION when running TEST-CONVERSION-TO-HOURS-AND-MINUTES
    Binary assertion function (EQUAL X Y) failed.
    x: (HOURS-AND-MINUTES 4500) =&gt; (1 75)
    y: '(1 15) =&gt; (1 15)
NIL
(#&lt;test-run of TF-FIASCO-EXAMPLES: 5 tests, 6 assertions, 3 failures in 5.5e-4 sec (3 failed assertions, 0 errors, none expected)&gt;)
</pre>
</div>
<p>
You can drop the explanations of the failures by passing nil to <code>:describe-failures</code>
</p>
<div class="org-src-container">
<pre class="src src-lisp">(run-package-tests <span class="org-builtin">:package</span> <span class="org-builtin">:tf-fiasco-examples</span> <span class="org-builtin">:describe-failures</span> nil)
</pre>
</div>
<p>
There is  an undocumented function <code>run-failed-tests</code> which looks at the last test run. My issue with this function is that it seems to need <code>*debug-on-assertion-failure*</code> and <code>*debug-on-unexpected-error*</code> set to T in order to work, which means that it forces me into the debugger whether I want it to or not.
</p>
</div>
</li>
<li><a id="orgd0de140"></a>Suites<br>
<div class="outline-text-6" id="text-19-3-4-2-2">
<p>
Suites are created by the (defsuite) macro, but they are really just tests that call other tests. Phil Gold's original <a href="http://aperiodic.net/phil/archives/Geekery/notes-on-lisp-testing-frameworks.html">concern about suites in Stefil</a> was "My only problem with the setup is that I don't see a way to explicitly assign tests to suites, aside from dynamically binding stefil::*suite*. Normally, the current suite is set by in-suite, which requires careful attention if you're jumping between different suites often. (A somewhat mitigating factor is that tests remember which suite they were created in, so the current suite only matters for newly-defined tests.)" I think that concern is just as valid in fiasco.
</p>

<p>
I find using suites in fiasco very confusing. Everything I looked at in quicklisp that used fiasco used run-package-tests rather than run-suite-tests. YMMV.
</p>

<p>
<a href="#org63aa282">top</a>
</p>
</div>
</li>
</ol>
</li>
</ol>
</li>
<li><a id="org717860f"></a>Fixtures and Freezing Data<br>
<div class="outline-text-4" id="text-19-3-5">
<p>
None that I am aware of.
</p>
</div>
</li>
<li><a id="org14198eb"></a>Removing tests<br>
<div class="outline-text-4" id="text-19-3-6">
<p>
Fiasco has the ability to delete tests, but it is not an exported function:
</p>
<div class="org-src-container">
<pre class="src src-lisp">(fiasco::delete-test 't1)
</pre>
</div>
</div>
</li>
<li><a id="org5e05c7c"></a>Sequencing, Random and Failure Only<br>
<div class="outline-text-4" id="text-19-3-7">
<p>
Fiasco has a function <code>run-failed-tests</code> to run the tests that failed last time.
</p>
</div>
</li>
<li><a id="orgb9e6565"></a>Skip Capability<br>
<ol class="org-ol">
<li><a id="org797b0d8"></a>Assertions<br>
<div class="outline-text-5" id="text-19-3-8-1">
<p>
Fiasco has skip functions <code>skip</code> and <code>skip-unless</code>. The following will cause the test to skip the second assertion.
</p>
<div class="org-src-container">
<pre class="src src-lisp">(deftest test-skip-test ()
   (is (= 1 1))
   (skip)
   (is (= 1 2)))
</pre>
</div>
</div>
</li>
</ol>
</li>

<li><a id="org7dceb91"></a>Random Data Generators<br>
<div class="outline-text-4" id="text-19-3-9">
<p>
None
</p>
</div>
</li>
</ol>
</div>
<div id="outline-container-org38b8837" class="outline-3">
<h3 id="org38b8837"><span class="section-number-3">19.4.</span> Additional Discussion</h3>
<div class="outline-text-3" id="text-19-4">
<p>
While Fiasco has a function to re-run failed tests, if I wanted to collect the names of the failing tests so that I could save them for some other purpose, I might do something like:
</p>
<div class="org-src-container">
<pre class="src src-lisp">(<span class="org-keyword">defun</span> <span class="org-function-name">collect-test-failure-names</span> (package-name)
  <span class="org-doc">"Runs a package test on the package and returns the names of the failing tests"</span>
  (<span class="org-keyword">multiple-value-bind</span> (x results)
      (run-package-tests <span class="org-builtin">:package</span> package-name <span class="org-builtin">:describe-failures</span> nil)
    (<span class="org-keyword">declare</span> (ignore x))
    (<span class="org-keyword">let</span> ((result (first results)))
      (<span class="org-keyword">when</span> (typep result 'fiasco::context)
        (<span class="org-keyword">loop</span> for test-result in (fiasco::children-contexts-of result)
              when (fiasco::failures-of test-result)
                collect (fiasco::name-of (fiasco::test-of test-result)))))))
</pre>
</div>

<p>
<a href="#org63aa282">top</a>
</p>
</div>
</div>

<div id="outline-container-org5ea5188" class="outline-3">
<h3 id="org5ea5188"><span class="section-number-3">19.5.</span> Who Uses Fiasco</h3>
<div class="outline-text-3" id="text-19-5">
<p>
At last count 24 libraries on quicklisp use Fiasco. If you have quicklisp, you can get a list of those with:
</p>
<div class="org-src-container">
<pre class="src src-lisp">(ql:who-depends-on <span class="org-builtin">:fiasco</span>)
</pre>
</div>

<p>
<a href="#org63aa282">top</a>
<a id="org3e895a0"></a>
</p>
</div>
</div>
</div>
<div id="outline-container-orgfbcc16c" class="outline-2">
<h2 id="orgfbcc16c"><span class="section-number-2">20.</span> fiveam</h2>
<div class="outline-text-2" id="text-20">
</div>
<div id="outline-container-orgcab0d2d" class="outline-3">
<h3 id="orgcab0d2d"><span class="section-number-3">20.1.</span> Summary</h3>
<div class="outline-text-3" id="text-20-1">
<table>


<colgroup>
<col  class="org-left">

<col  class="org-left">

<col  class="org-left">

<col  class="org-right">
</colgroup>
<tbody>
<tr>
<td class="org-left"><a href="https://github.com/lispci/fiveam">homepage</a></td>
<td class="org-left">Edward Marco Baringer</td>
<td class="org-left">BSD</td>
<td class="org-right">2020</td>
</tr>
</tbody>
</table>

<p>
Fiveam has a lot of market share. At the time of writing, it has 10 issues and 9 pull requests with no responses. The README at the github page is lacking but good documentation exists at <a href="https://common-lisp.net/project/fiveam/docs/index.html">common-lisp.net</a> or the <a href="http://turtleware.eu/posts/Tutorial-Working-with-FiveAM.html">turtleware tutorial</a>. There are also examples at <a href="https://lispcookbook.github.io/cl-cookbook/testing.html">Common Lisp Cookbook</a>
</p>

<p>
Obviously with its market share there is a lot to like. It does report all the assertion failures in a test, allows user defined diagnostic messages with variables, interactive debugging is optional, it has suites and it runs lists of tests.
</p>

<p>
From a speed standpoint, it is either middle of the pack or, on a big test package and running in an emacs repl, vying with clunit for painfully slow. In such a case, if you are deciding between more tests with fewer assertions or fewer tests with more assertions, go with more tests and fewer assertions (but this is an emacs problem more than a fiveam problem). I do not know what using other editors would be like.
</p>

<p>
My wishlist for Fiveam is better fixture capability, the edge case ability to handle value expressions and variables declared in closures surrounding the test and get rid of all those blank lines in the failure reports.
</p>
</div>
</div>

<div id="outline-container-org72ca438" class="outline-3">
<h3 id="org72ca438"><span class="section-number-3">20.2.</span> Assertion Functions</h3>
<div class="outline-text-3" id="text-20-2">
<table>


<colgroup>
<col  class="org-left">

<col  class="org-left">

<col  class="org-left">

<col  class="org-left">

<col  class="org-left">

<col  class="org-left">

<col  class="org-left">
</colgroup>
<tbody>
<tr>
<td class="org-left">is</td>
<td class="org-left">is-false</td>
<td class="org-left">finishes</td>
<td class="org-left">signals</td>
<td class="org-left">fail</td>
<td class="org-left">pass</td>
<td class="org-left">skip</td>
</tr>
</tbody>
</table>
</div>
</div>

<div id="outline-container-org194b378" class="outline-3">
<h3 id="org194b378"><span class="section-number-3">20.3.</span> Usage</h3>
<div class="outline-text-3" id="text-20-3">
<p>
Generally speaking tests are called using the <code>run</code> and <code>run!</code> functions. If you set <code>*run-test-when-defined*</code> to T, tests will be run as soon as they are defined (which includes hitting C-c C-c in the source code (assuming you are doing this in an editor with slime or sly or some such.
</p>
</div>
<ol class="org-ol">
<li><a id="org70740d5"></a>Report Format<br>
<div class="outline-text-4" id="text-20-3-1">
<p>
Fiveam will default to a reporting format. The format you get will depend on whether you call <code>run</code> or <code>run!</code>.
</p>

<ul class="org-ul">
<li><code>run</code> provides a progress report using the typical dot/f/e format and which returns a list of the assertion result objects.</li>
<li><code>run!</code> provides the progress report, more details on failure and does not return a list of the passing assertion result objects.</li>
</ul>

<p>
The following will allow you to turn off the progress report:
</p>
<div class="org-src-container">
<pre class="src src-lisp">(<span class="org-keyword">let</span> ((fiveam:*test-dribble* (make-broadcast-stream)))
  (fiveam:run! &#8230;))
</pre>
</div>

<p>
To demonstrate the difference in the reports assume the following test that has a couple of passes and a couple of failures. We will insert a diagnostic string in the second assertion with a couple of variables to use in the string.
</p>
<div class="org-src-container">
<pre class="src src-lisp">(test t1-fail
  <span class="org-string">"describe t1-fail"</span>
  (<span class="org-keyword">let</span> ((x 1) (y 2))
    (is (eql 1 2))
    (is (equal x y)
        <span class="org-string">"We deliberately ensured that the first parameters ~a is not equal to the second parameter ~a"</span> x y)
    (is-false (eq 'b 'b))
    (pass <span class="org-string">"I do not want to run this test of ~a but will say it passes anyway"</span> '(= 1 1))
    (skip <span class="org-string">"Skip the next test because reasons"</span>)
    (finishes (+ 1 2))
    (signals division-by-zero (<span class="org-warning">error</span> 'floating-point-overflow))))
</pre>
</div>
<p>
Now using the simple <code>run</code>, we get:
</p>
<div class="org-src-container">
<pre class="src src-lisp">(run 't1-fail)

Running test T1-FAIL fff.ss.X
(#&lt;IT.BESE.FIVEAM::UNEXPECTED-TEST-FAILURE {10023556C3}&gt;
 #&lt;IT.BESE.FIVEAM::TEST-PASSED {10023550B3}&gt;
 #&lt;IT.BESE.FIVEAM::TEST-SKIPPED {1002354F43}&gt;
 #&lt;IT.BESE.FIVEAM::TEST-PASSED {1002354CF3}&gt;
 #&lt;IT.BESE.FIVEAM::TEST-FAILURE {1002354043}&gt;
 #&lt;IT.BESE.FIVEAM::TEST-FAILURE {1002353463}&gt;
 #&lt;IT.BESE.FIVEAM::TEST-FAILURE {1002352D03}&gt;)
</pre>
</div>
<p>
We can immediately see that <code>(run)</code> gives us a progress report showing f for failure, . for pass, s for skip and X for an error and a list of test-result objects. We can get more details, including the diagnostic messages using <code>(run!)</code>.
</p>
<div class="org-src-container">
<pre class="src src-lisp">  (run! 't1-fail)


Running test T1-FAIL fff.ss.X
 Did 7 checks.
    Pass: 2 (28%)
    Skip: 1 (14%)
    Fail: 4 (57%)

 Failure Details:
 --------------------------------
 T1-FAIL in S0 [describe t1-fail]:

2

 evaluated to

2

 which is not

EQL

 to

1


 --------------------------------
 --------------------------------
 T1-FAIL in S0 []:
      We deliberately ensured that the first parameters 1 is not equal to the second parameter 2
 --------------------------------
 --------------------------------
 T1-FAIL in S0 []:
      (EQ 'B 'B) returned the value T, which is true
 --------------------------------
 --------------------------------
 T1-FAIL in S0 []:
      Unexpected Error: #&lt;FLOATING-POINT-OVERFLOW {100236BE63}&gt;
arithmetic error FLOATING-POINT-OVERFLOW signalled.
 --------------------------------

 Skip Details:
 T1-FAIL []:
     Skip the next test because reasons

NIL
(#&lt;IT.BESE.FIVEAM::UNEXPECTED-TEST-FAILURE {100236C3C3}&gt;
 #&lt;IT.BESE.FIVEAM::TEST-FAILURE {100236AD43}&gt;
 #&lt;IT.BESE.FIVEAM::TEST-FAILURE {100236A163}&gt;
 #&lt;IT.BESE.FIVEAM::TEST-FAILURE {1002369D33}&gt;)
(#&lt;IT.BESE.FIVEAM::TEST-SKIPPED {100236BC43}&gt;)
</pre>
</div>
<p>
Did you notice anything about the test results returned using <code>run</code> compared to <code>run!</code>? <code>run!</code> did not return any test-passed results
</p>

<p>
Personally I hate the immense amount of wasted space fiveam generates using <code>run!</code>.
</p>

<p>
By the way, if we set <code>*verbose-failures*</code> to T, it will add the failing expression to the failure details.
</p>

<p>
Fiveam does have optionality to drop into the debugger on errors or failures. You can set those individually:
</p>
<ul class="org-ul">
<li><code>(setf *on-error* :debug)</code> if we should drop into the debugger on error, :backtrace for backtrace or nil  otherwise.</li>
<li><code>(setf *on-failure* :debug)</code> if we should drop into the debugger on error, :backtrace for backtrace or nil otherwise.</li>
</ul>
</div>
</li>

<li><a id="org9d13622"></a>Basics<br>
<div class="outline-text-4" id="text-20-3-2">
<p>
We already saw a test using Fiveam's testing functions above with some passes and fails above, so we will skip repeating ourselves.
</p>

<p>
As expected, you do not have to manually recompile a test after a tested function has been modified.
</p>
</div>
</li>

<li><a id="org3a0ee22"></a>Edge Cases: Values expressions, loops, closures and calling other tests<br>
<div class="outline-text-4" id="text-20-3-3">
<p>
Now let's try a test with values expressions:
</p>
<div class="org-src-container">
<pre class="src src-lisp">(test t2 <span class="org-comment">; the most basic named test with multiple assertions and values expressions</span>
  <span class="org-string">"describe t2"</span>
  (<span class="org-keyword">let</span> ((x 1) (y 2))
    (is (equal 1 2))
    (is (equal x y))
    (is (equal (values 1 2) (values 1 2)))))
<span class="org-comment-delimiter">; </span><span class="org-comment">in: ALEXANDRIA:NAMED-LAMBDA %TEST-T2</span>
<span class="org-comment-delimiter">;     </span><span class="org-comment">(IT.BESE.FIVEAM:IS (EQUAL (VALUES 1 2) (VALUES 1 2)))</span>
<span class="org-comment-delimiter">;</span>
<span class="org-comment-delimiter">; </span><span class="org-comment">caught ERROR:</span>
<span class="org-comment-delimiter">;   </span><span class="org-comment">during macroexpansion of (IS (EQUAL # #)). Use *BREAK-ON-SIGNALS* to intercept.</span>
<span class="org-comment-delimiter">;</span>
<span class="org-comment-delimiter">;    </span><span class="org-comment">Both the expected and actual part is a values expression.</span>
<span class="org-comment-delimiter">;</span>
<span class="org-comment-delimiter">; </span><span class="org-comment">compilation unit finished</span>
<span class="org-comment-delimiter">;   </span><span class="org-comment">caught 1 ERROR condition</span>
</pre>
</div>
<p>
Fiveam threw an error on the values expression on compilation, but continued with the compiliation.
</p>

<p>
Now to run the failing test.
</p>
<div class="org-src-container">
<pre class="src src-lisp">(run! 't2)

Running test T2 ffX
 Did 3 checks.
    Pass: 0 ( 0%)
    Skip: 0 ( 0%)
    Fail: 3 (100%)
 Failure Details:
 --------------------------------
 T2 [describe t2]:
2
 evaluated to
2
 which is not
EQUAL
 to
1
 --------------------------------
 --------------------------------
 T2 [describe t2]:
Y
 evaluated to
2
 which is not
EQUAL
 to
1
 --------------------------------
 --------------------------------
 T2 [describe t2]:
      Unexpected Error: #&lt;SB-INT:COMPILED-PROGRAM-ERROR {102D38B283}&gt;
Execution of a form compiled with errors.
Form:
  (IS (EQUAL (VALUES 1 2) (VALUES 1 2)))
Compile-time error:
  during macroexpansion of (IS (EQUAL # #)). Use *BREAK-ON-SIGNALS* to intercept.

 Both the expected and actual part is a values expression..
 --------------------------------
NIL
(#&lt;IT.BESE.FIVEAM::UNEXPECTED-TEST-FAILURE {102D38BB73}&gt;
 #&lt;IT.BESE.FIVEAM::TEST-FAILURE {102D38B1B3}&gt;
 #&lt;IT.BESE.FIVEAM::TEST-FAILURE {102D38AD93}&gt;)
NIL
</pre>
</div>
<p>
Notice the ffX in the report. The f indicate failing assertions. The X indicates that the assertion threw an error instead of failing. No, fiveam does not like value expressions.
</p>

<p>
What happens if we try to call a test inside a test?
</p>
<div class="org-src-container">
<pre class="src src-lisp">(test t3
    <span class="org-string">"a test that tries to call another test in its body"</span>
    (is (equal 'a 'a))
    (run! t2))

(run! 't3)

Running test T3 .
Running test T2 ..X
 Did 3 checks.
    Pass: 2 (66%)
    Skip: 0 ( 0%)
    Fail: 1 (33%)

 Failure Details:
 --------------------------------
 T2 in S1 [describe t2]:
      Unexpected Error: #&lt;SB-INT:COMPILED-PROGRAM-ERROR {1008EE35A3}&gt;
Execution of a form compiled with errors.
Form:
  (IS (EQUAL (VALUES 1 2) (VALUES 1 2)))
Compile-time error:
  during macroexpansion of (IS (EQUAL # #)). Use *BREAK-ON-SIGNALS* to intercept.

 Both the expected and actual part is a values expression..
 --------------------------------

 Did 1 check.
    Pass: 1 (100%)
    Skip: 0 ( 0%)
    Fail: 0 ( 0%)

T
</pre>
</div>
<p>
So we can run tests within tests.
</p>
</div>
<ol class="org-ol">
<li><a id="org77249b6"></a>Closures Variables<br>
<div class="outline-text-5" id="text-20-3-3-1">
<p>
Fiveam cannot find variables declared in a closure surrounding the test. For example, the following fails.
</p>
<div class="org-src-container">
<pre class="src src-lisp">(<span class="org-keyword">let</span> ((l1 '(#\a #\B #\z))
      (l2 '(97 66 122)))
(test t2-loop
  (<span class="org-keyword">loop</span> for x in l1 for y in l2 do
    (is (= (char-code x) y)))))
</pre>
</div>
</div>
</li>
</ol>
</li>

<li><a id="org6e0809c"></a>Suites, tags and other multiple test abilities<br>
<ol class="org-ol">
<li><a id="orga19ad44"></a>Lists of tests<br>
<div class="outline-text-5" id="text-20-3-4-1">
<p>
Fiveam can run lists of tests
</p>
<div class="org-src-container">
<pre class="src src-lisp">(run! '(t1 t2))
</pre>
</div>
</div>
</li>
<li><a id="orgf6252b9"></a>Suites<br>
<div class="outline-text-5" id="text-20-3-4-2">
<p>
Suites are relatively straight forward in fiveam so long as you remember that you need to define yourself as being in a suite and any test defined after that will be placed in that suite. I surprised myself once after compiling a test file and then defining some tests in the REPL. As far as fiveam was concerned I was still in the suite defined in the test file, so the the tests defined in the REPL had been added to the suite.
</p>
<div class="org-src-container">
<pre class="src src-lisp">  (def-suite <span class="org-builtin">:s0</span> <span class="org-comment">; Ultimate parent suite</span>
    <span class="org-builtin">:description</span> <span class="org-string">"describe suite 0"</span>)

 (in-suite <span class="org-builtin">:s0</span>)
<span class="org-comment-delimiter">;; </span><span class="org-comment">Any test defined after this will be in suite s0 until a new suite is specified</span>

  (test t4  <span class="org-comment">; a test that is a member of a suite</span>
    <span class="org-string">"describe t4"</span>
    (is (equal 1 1)))

(run! <span class="org-builtin">:s0</span>)
</pre>
</div>
<p>
Suites can be nested. Here we have suite :s1 that is nested in suite :s0
</p>
<div class="org-src-container">
<pre class="src src-lisp">(def-suite <span class="org-builtin">:s1</span>
  <span class="org-builtin">:in</span> <span class="org-builtin">:s0</span>)
</pre>
</div>
</div>
</li>
</ol>
</li>
<li><a id="org3ceeef2"></a>Fixtures and Freezing Data<br>
<div class="outline-text-4" id="text-20-3-5">
<p>
As far as I can tell, fixtures and freezing data are basically the same for Fiveam.
The fiveam maintainer admits <a href="https://github.com/lispci/fiveam/issues/31">that maybe it's fixture capability is not "the best designed feature".</a>
</p>
<div class="org-src-container">
<pre class="src src-lisp"><span class="org-comment-delimiter">;; </span><span class="org-comment">Create a class for data fixture purposes</span>
(<span class="org-keyword">defclass</span> <span class="org-type">class-A</span> ()
  ((a <span class="org-builtin">:initarg</span> <span class="org-builtin">:a</span> <span class="org-builtin">:initform</span> 0 <span class="org-builtin">:accessor</span> a)
   (b <span class="org-builtin">:initarg</span> <span class="org-builtin">:b</span> <span class="org-builtin">:initform</span> 0 <span class="org-builtin">:accessor</span> b)))

(<span class="org-keyword">defparameter</span> <span class="org-variable-name">*some-existing-data-parameter*</span>
  (make-instance 'class-A <span class="org-builtin">:a</span> 17.3 <span class="org-builtin">:b</span> -12))

(def-fixture f1 ()
  (<span class="org-keyword">let</span> ((old-parameter *some-existing-data-parameter*))
    (setf *some-existing-data-parameter*
        (make-instance 'class-A <span class="org-builtin">:a</span> 100 <span class="org-builtin">:b</span> -100))
    (<span class="org-type">&amp;body</span>)
    (setf *some-existing-data-parameter* old-parameter)))

(def-test t6-f1 (<span class="org-builtin">:fixture</span> f1)
  (is (equal (a *some-existing-data-parameter*) 100))
  (is (equal (b *some-existing-data-parameter*) -100)))

<span class="org-comment-delimiter">;; </span><span class="org-comment">now you can check (a *some-existing-data-parameter*) to ensure defining the test has not changed *some-existing-data-parameter*</span>

(run! 't6-f1)

Running test T6-F1 ..
 Did 2 checks.
    Pass: 2 (100%)
    Skip: 0 ( 0%)
    Fail: 0 ( 0%)
</pre>
</div>

<p>
<a href="#org63aa282">top</a>
</p>
</div>
</li>
<li><a id="orgc63b6a9"></a>Removing tests<br>
<div class="outline-text-4" id="text-20-3-6">
<p>
Fiveam has the functions <code>rem-test</code> and <code>rem-fixture</code>
</p>
</div>
</li>
<li><a id="org84e3f8c"></a>Sequencing, Random and Failure Only<br>
<div class="outline-text-4" id="text-20-3-7">
<p>
The tests are randomly shuffled. The <code>run!</code> function will return a list of failed-test objects (the <code>run</code> function does not).
</p>
</div>
</li>
<li><a id="orga3fb5b3"></a>Skip Capability<br>
<div class="outline-text-4" id="text-20-3-8">
<p>
Fiveam does some skip capability
</p>
</div>
</li>
<li><a id="org2c8fe12"></a>Random Testing and Data Generators<br>
<div class="outline-text-4" id="text-20-3-9">
<p>
Fiveam Generates lambda functions for buffers, character, float, integer, list, one-element, string and tree character, string and lists. Some examples:
</p>
<div class="org-src-container">
<pre class="src src-lisp">(funcall (gen-float))
1.3259344e38

(funcall (gen-buffer))
#(115 238 129 72 84 40 230)

(funcall (gen-character <span class="org-builtin">:code-limit</span> 256))
#\Etx

(funcall (gen-integer <span class="org-builtin">:max</span> 27 <span class="org-builtin">:min</span> -16))
-4

(funcall (gen-list ))
(-1 4)

(funcall (gen-string))
<span class="org-string">"&#547228;&#1079858;&#701314;&#147176;&#572866;&#308647;&#1101638;&#881512;&#175945;&#217019;&#977440;&#891037;&#38784;&#1029480;&#591098;&#34879;&#181949;&#180332;&#450033;&#591284;&#13160;&#788260;&#886475;&#562823;&#602715;&#133884;&#651051;&#492829;&#238444;&#477936;&#16200;&#1038100;&#817200;&#283251;&#37444;&#920212;"</span>

(funcall (gen-string <span class="org-builtin">:elements</span> (gen-character <span class="org-builtin">:code-limit</span> 122 <span class="org-builtin">:alphanumericp</span> t)))
<span class="org-string">"exAarlUllrgsQZQAnUYeKIbZQuPYAKNLvTyMcIYlLoYS"</span>

(funcall (gen-tree <span class="org-builtin">:size</span> 10))
((((-2 ((-3 6) (2 ((3 (6 (10 10))) ((10 4) -9))))) (-8 -8))
  (((-7 8) -3) (-10 ((((1 -5) (6 ((-9 -6) 4))) ((5 -9) (0 (-4 -8)))) -2))))
 (((((9 (5 ((3 -1) ((0 -10) -5)))) (((4 (7 -8)) (-5 (6 7))) -4)) -3)
   (6 (2 ((-5 6) (2 (((9 -1) -5) -5))))))
  6))
</pre>
</div>
</div>
</li>
</ol>
</div>
<div id="outline-container-orgac37614" class="outline-3">
<h3 id="orgac37614"><span class="section-number-3">20.4.</span> Discussion</h3>
<div class="outline-text-3" id="text-20-4">
<p>
If you recall, <code>run</code> returns a list of all test-result objects, but <code>run!</code> returns just the failing test-result objects. If you wanted to use <code>run</code>, but just wanted a list of the failing test names, you can do something like the following:
</p>
<div class="org-src-container">
<pre class="src src-lisp">(<span class="org-keyword">defun</span> <span class="org-function-name">collect-failing-test-case-names</span> (suite)
  <span class="org-doc">"Takes a suite, calls the run function and returns a list of the test names that failed."</span>
  (<span class="org-keyword">loop</span> for x in (run suite)
        when (typep x 'fiveam::test-failure)
          collect (fiveam::name (fiveam::test-case x))))

(collect-failing-test-case-names <span class="org-builtin">:s0</span>)

Running test suite S0
Running test T4 .
Running test T4-ERROR ..f
Running test T4-FAIL f
Running test T6-F1 ..
Running test T5 f
Running test T4-FAIL-2 f
(T4-ERROR T4-FAIL T5 T4-FAIL-2)
</pre>
</div>
<p>
Fiveam does not have a time limit threshold that you can set like Parachute or Prove, but you can set a <code>*max-trials*</code> variable to prevent infinite loops. It also has undocumented profiling capability that I did not look at.
</p>
</div>
</div>

<div id="outline-container-orgda7d0cd" class="outline-3">
<h3 id="orgda7d0cd"><span class="section-number-3">20.5.</span> Who Uses Fiveam</h3>
<div class="outline-text-3" id="text-20-5">
<p>
Many libraries on quicklisp use fiveam. If you have quicklisp, you can get a list of those with:
</p>
<div class="org-src-container">
<pre class="src src-lisp">(ql:who-depends-on <span class="org-builtin">:fiveam</span>)
</pre>
</div>

<p>
<a href="#org63aa282">top</a>
</p>

<p>
<a href="#org63aa282">top</a>
<a id="orga50a995"></a>
</p>
</div>
</div>
</div>
<div id="outline-container-orgb50a770" class="outline-2">
<h2 id="orgb50a770"><span class="section-number-2">21.</span> lift</h2>
<div class="outline-text-2" id="text-21">
<p>
<a href="#org63aa282">top</a>
</p>
</div>
<div id="outline-container-org5c5b94d" class="outline-3">
<h3 id="org5c5b94d"><span class="section-number-3">21.1.</span> Summary</h3>
<div class="outline-text-3" id="text-21-1">
<table>


<colgroup>
<col  class="org-left">

<col  class="org-left">

<col  class="org-left">

<col  class="org-left">
</colgroup>
<tbody>
<tr>
<td class="org-left"><a href="https://github.com/gwkkwg/lift">homepage</a></td>
<td class="org-left">Gary Warren King</td>
<td class="org-left">MIT</td>
<td class="org-left">2019 (c)</td>
</tr>
</tbody>
</table>
<p>
Documentation for Lift can be found <a href="https://common-lisp.net/project/lift/user-guide.html">here</a>, but a lot of sections are "To be written".
</p>

<p>
The original Phil Gold <a href="http://aperiodic.net/phil/archives/Geekery/notes-on-lisp-testing-frameworks.html">review</a> noted his concerns about speed and memory footprint: "The larger problem, though, was its speed and memory footprint. Defining tests is very slow; when using LIFT, the time necessary to compile and load all of my Project Euler code jumped from the other frameworks' average of about 1.5 minutes to over nine minutes. Redefining tests felt even slower than defining them initially, but I don't have solid numbers on that. After loading everything, memory usage was more than twice that of other frameworks. Running all of the tests took more than a minute longer than other frameworks, though that seems mostly to be a result of swapping induced by LIFT's greater memory requirements."
</p>

<p>
I did not benchmark compiling tests, just running the tests and as you can see from the benchmarks, lift is one of the fastest frameworks. His concern on runtime was not borne out in my benchmark, but uax-15 is also very different from Project Euler. YMMV.
</p>

<p>
There is a lot I like about Lift and there are undocumented features that you could spent a few days exploring.
</p>

<p>
There are two annoyances.
</p>
<ul class="org-ul">
<li>Multiple assertion problem:. If you have multiple assertions in a test, the tests stop at the first assertion failure. I can understand that if the intent is to get thrown into the debugger and fix the failure immediately, but not when you are running reports. There are reasons why I would put multiple assertions into a test. The obvious work around is only one assertion per test. You then have to create possibly hundreds of suites and then use <code>addtest</code> to add the test to your suite.</li>
<li>Clumsy failure reporting</li>
</ul>

<p>
Lift has both hierarchical suites and tags, what it calls categories.
</p>
</div>
</div>

<div id="outline-container-orga950b40" class="outline-3">
<h3 id="orga950b40"><span class="section-number-3">21.2.</span> Assertion Functions</h3>
<div class="outline-text-3" id="text-21-2">
<table>


<colgroup>
<col  class="org-left">

<col  class="org-left">
</colgroup>
<tbody>
<tr>
<td class="org-left">ensure</td>
<td class="org-left">ensure-cases</td>
</tr>

<tr>
<td class="org-left">ensure-cases-failure</td>
<td class="org-left">ensure-condition</td>
</tr>

<tr>
<td class="org-left">ensure-different</td>
<td class="org-left">ensure-directories-exist</td>
</tr>

<tr>
<td class="org-left">ensure-directory</td>
<td class="org-left">ensure-error</td>
</tr>

<tr>
<td class="org-left">ensure-every</td>
<td class="org-left">ensure-expected-condition</td>
</tr>

<tr>
<td class="org-left">ensure-expected-no-warning-condition</td>
<td class="org-left">ensure-failed</td>
</tr>

<tr>
<td class="org-left">ensure-failed-error</td>
<td class="org-left">ensure-function</td>
</tr>

<tr>
<td class="org-left">ensure-generic-function</td>
<td class="org-left">ensure-list</td>
</tr>

<tr>
<td class="org-left">ensure-member</td>
<td class="org-left">ensure-no-warning</td>
</tr>

<tr>
<td class="org-left">ensure-not-same</td>
<td class="org-left">ensure-null</td>
</tr>

<tr>
<td class="org-left">ensure-null-failed-error</td>
<td class="org-left">ensure-random-cases</td>
</tr>

<tr>
<td class="org-left">ensure-random-cases+</td>
<td class="org-left">ensure-random-cases-failure</td>
</tr>

<tr>
<td class="org-left">ensure-same</td>
<td class="org-left">ensure-some</td>
</tr>

<tr>
<td class="org-left">ensure-string</td>
<td class="org-left">ensure-symbol</td>
</tr>

<tr>
<td class="org-left">ensure-warning</td>
<td class="org-left">&#xa0;</td>
</tr>
</tbody>
</table>

<p>
<a href="#org63aa282">top</a>
</p>
</div>
</div>
<div id="outline-container-orgebe4fcf" class="outline-3">
<h3 id="orgebe4fcf"><span class="section-number-3">21.3.</span> Usage</h3>
<div class="outline-text-3" id="text-21-3">
<p>
Unlike most frameworks, lift provides variables for <code>*test-maximum-error-count*</code>, <code>*test-maximum-failure-count*</code> and <code>*test-maximum-time*</code> which can be set so that large sets of failing tests can be shutdown down early without wasting time.
</p>

<p>
Lift has a lot of undocumented functionality. For example, you can generate log-entries which seems to have something to do with sample counts and profiling, but those have no documentation either.
</p>
</div>
<ol class="org-ol">
<li><a id="orgac58b5f"></a>Report Format<br>
<div class="outline-text-4" id="text-21-3-1">
<p>
Like some other frameworks, Lift will run tests as you compile them. If you use <code>run-test</code> (singular) or <code>run-tests</code> (plural), you get a very limited amount of information that will look something like this:
</p>
<div class="org-src-container">
<pre class="src src-lisp"> (run-test <span class="org-builtin">:name</span> 't4-s1-1)
#&lt;S1.T4-S1-1 failed&gt;

  (run-tests)
  Start: S0
  #&lt;Results for S0 1 Tests, 1 Failure&gt;
</pre>
</div>
<p>
If you <code>(setf *test-describe-if-not-successful?* t)</code> you get a lot more information, but you are really just running <code>(describe)</code> on the test result object. We run only the single test version this time:
</p>
<div class="org-src-container">
<pre class="src src-lisp">(run-test <span class="org-builtin">:name</span> 't4-s1-1)
#&lt;S1.T4-S1-1 failed
Failure: s1 : t4-s1-1
  Documentation: NIL
  Source       : /tmp/slimeBSclUz
  Condition    : Ensure failed: (= 2 3) ()
  During       : (END-TEST)
  Code         : (
  ((ENSURE (= 2 3)) (ENSURE (= 4 4)) (ENSURE (EQL 'B 'C))))
  &gt;
</pre>
</div>

<p>
Lift can print also test result details. The first parameter is the stream to which to direct the output, the second parameter is getting the test result. The third parameter is show-expected-p and the fourth is show-code-p. All parameters must be provided.
</p>
<div class="org-src-container">
<pre class="src src-lisp">(print-test-result-details *standard-output* (run-test <span class="org-builtin">:name</span> 't1-fail) t t)
Failure: tf-lift : t1-fail
  Documentation: NIL
  Source       : NIL
  Condition    : Ensure failed: (= X
                                   Y) <span class="org-warning">(This test was meant to fail because 1 is not = 2)</span>
  During       : (END-TEST)
  Code         : (
  ((<span class="org-keyword">LET</span> ((X 1) (Y 2))
     (ENSURE (= X Y) <span class="org-builtin">:REPORT</span> <span class="org-string">"This test was meant to fail because ~a is not = ~a"</span>
             <span class="org-builtin">:ARGUMENTS</span> (X Y)))))
</pre>
</div>

<p>
The function <code>run-tests</code> takes a keyword parameter <code>:report-pathname</code> which will direct a substantial amount of information to the designated file. The following example runs all the tests associated with suite s0 (either directly or indirectly). You can also set the variable <code>*lift-report-pathname*</code> to a pathname. Any subsequent failure reports will be printed there. Lift does not have progress reports if that is important to you.
</p>
<div class="org-src-container">
<pre class="src src-lisp">(run-tests <span class="org-builtin">:suite</span> 's0 <span class="org-builtin">:report-pathname</span> #P <span class="org-string">"/tmp/lift-1.txt"</span>)
</pre>
</div>
<p>
Opening that file may show results looking something like:
</p>
<div class="org-src-container">
<pre class="src src-lisp">((<span class="org-builtin">:RESULTS-FOR</span> . S0)
(<span class="org-builtin">:ARGUMENTS</span> . (<span class="org-builtin">:SUITE</span> (<span class="org-string">"S0"</span> . <span class="org-string">"TF-LIFT"</span>) <span class="org-builtin">:REPORT-PATHNAME</span> #P<span class="org-string">"/tmp/lift-1.txt"</span>))
(<span class="org-builtin">:FEATURES</span> . (<span class="org-builtin">:HUNCHENTOOT-SBCL-DEBUG-PRINT-VARIABLE-ALIST</span> <span class="org-builtin">:5AM</span>
              <span class="org-builtin">:OSICAT-FD-STREAMS</span> <span class="org-builtin">:ITER</span> <span class="org-builtin">:NAMED-READTABLES</span> <span class="org-builtin">:UTF-32</span> <span class="org-builtin">:TOOT</span>
              <span class="org-builtin">:SBCL-DEBUG-PRINT-VARIABLE-ALIST</span> <span class="org-builtin">:SPLIT-SEQUENCE</span>
              CFFI-FEATURES:FLAT-NAMESPACE CFFI-FEATURES:X86-64
              CFFI-FEATURES:UNIX <span class="org-builtin">:CFFI</span> CFFI-SYS::FLAT-NAMESPACE <span class="org-builtin">:FLEXI-STREAMS</span>
              <span class="org-builtin">:CL-FAD</span> <span class="org-builtin">:CHUNGA</span> <span class="org-builtin">:LISP-UNIT</span> <span class="org-builtin">:CLOSER-MOP</span> <span class="org-builtin">:CL-PPCRE</span>
              <span class="org-builtin">:BORDEAUX-THREADS</span> ALEXANDRIA::SEQUENCE-EMPTYP <span class="org-builtin">:THREAD-SUPPORT</span>
              <span class="org-builtin">:SWANK</span> <span class="org-builtin">:QUICKLISP</span> <span class="org-builtin">:ASDF3.3</span> <span class="org-builtin">:ASDF3.2</span> <span class="org-builtin">:ASDF3.1</span> <span class="org-builtin">:ASDF3</span> <span class="org-builtin">:ASDF2</span> <span class="org-builtin">:ASDF</span>
              <span class="org-builtin">:OS-UNIX</span> <span class="org-builtin">:NON-BASE-CHARS-EXIST-P</span> <span class="org-builtin">:ASDF-UNICODE</span> <span class="org-builtin">:X86-64</span> <span class="org-builtin">:GENCGC</span>
              <span class="org-builtin">:64-BIT</span> <span class="org-builtin">:ANSI-CL</span> <span class="org-builtin">:COMMON-LISP</span> <span class="org-builtin">:ELF</span> <span class="org-builtin">:IEEE-FLOATING-POINT</span> <span class="org-builtin">:LINUX</span>
              <span class="org-builtin">:LITTLE-ENDIAN</span> <span class="org-builtin">:PACKAGE-LOCAL-NICKNAMES</span> <span class="org-builtin">:SB-LDB</span> <span class="org-builtin">:SB-PACKAGE-LOCKS</span>
              <span class="org-builtin">:SB-THREAD</span> <span class="org-builtin">:SB-UNICODE</span> <span class="org-builtin">:SBCL</span> <span class="org-builtin">:UNIX</span>))
(<span class="org-builtin">:DATETIME</span> . 3831119803)
)
(
(<span class="org-builtin">:SUITE</span> . (<span class="org-string">"S0"</span> . <span class="org-string">"TF-LIFT"</span>))
(<span class="org-builtin">:NAME</span> . (<span class="org-string">"T4-S0-1"</span> . <span class="org-string">"TF-LIFT"</span>))
(<span class="org-builtin">:START-TIME</span> . 3831119803000)
(<span class="org-builtin">:END-TIME</span> . 3831119803000)
(<span class="org-builtin">:SECONDS</span> . 0.0d0)
(<span class="org-builtin">:CONSES</span> . 0)
(<span class="org-builtin">:RESULT</span> . T)
)
(
(<span class="org-builtin">:SUITE</span> . (<span class="org-string">"S0"</span> . <span class="org-string">"TF-LIFT"</span>))
(<span class="org-builtin">:NAME</span> . (<span class="org-string">"T4-S0-2"</span> . <span class="org-string">"TF-LIFT"</span>))
(<span class="org-builtin">:START-TIME</span> . 3831119803000)
(<span class="org-builtin">:END-TIME</span> . 3831119803000)
(<span class="org-builtin">:PROBLEM-KIND</span> . <span class="org-string">"failure"</span>)
(<span class="org-builtin">:PROBLEM-STEP</span> . <span class="org-builtin">:END-TEST</span>)
(<span class="org-builtin">:PROBLEM-CONDITION</span> . <span class="org-string">"#&lt;ENSURE-FAILED-ERROR {100DA7E143}&gt;"</span>)
(<span class="org-builtin">:PROBLEM-CONDITION-DESCRIPTION</span> . <span class="org-string">"Ensure failed: (= 1 2) ()"</span>)
)
(
(<span class="org-builtin">:TEST-CASE-COUNT</span> . 2)
(<span class="org-builtin">:TEST-SUITE-COUNT</span> . 1)
(<span class="org-builtin">:FAILURE-COUNT</span> . 1)
(<span class="org-builtin">:ERROR-COUNT</span> . 0)
(<span class="org-builtin">:EXPECTED-FAILURE-COUNT</span> . 0)
(<span class="org-builtin">:EXPECTED-ERROR-COUNT</span> . 0)
(<span class="org-builtin">:SKIPPED-TESTSUITES-COUNT</span> . 0)
(<span class="org-builtin">:SKIPPED-TEST-CASES-COUNT</span> . 0)
(<span class="org-builtin">:START-TIME-UNIVERSAL</span> . 3831119803)
(<span class="org-builtin">:END-TIME-UNIVERSAL</span> . 3831119803)
(<span class="org-builtin">:FAILURES</span> . (((<span class="org-string">"S0"</span> . <span class="org-string">"TF-LIFT"</span>) (<span class="org-string">"T4-S0-2"</span> . <span class="org-string">"TF-LIFT"</span>)))))
</pre>
</div>
<p>
Adding a test and compiling it will, as noted, cause it to be run immediately, but all you get is pass or fail. Let's try to get a little more information by using <code>describe *</code>.
</p>
<div class="org-src-container">
<pre class="src src-lisp">  (addtest (s1) t4-s1-4
      (ensure (= 3 4)))
  #&lt;Test failed&gt;

(describe *)
Test Report for S1: 1 test run, 1 Failure.

Failure: s1 : t4-s1-4
  Documentation: NIL
  Source       : NIL
  Condition    : Ensure failed: (= 3 4) ()
  During       : (END-TEST)
  Code         : (
  ((ENSURE (= 3 4))))

Test Report for S1: 1 test run, 1 Failure.
</pre>
</div>
<p>
I would note that in tests with multiple assertions, Lift only shows the first failure, not all failures. That is a real problem for me because I want the results of multiple assertions if I am tracking down one of my many bugs.
</p>

<p>
To go interactive - dropping immediately into the debugger, you would set one or more key word parameter based on what condition should throw you into the debugger. The following will throw you into the debugger on failures but not on errors.
</p>
<div class="org-src-container">
<pre class="src src-lisp">(run-test <span class="org-builtin">:name</span> 't1-function <span class="org-builtin">:break-on-errors?</span> nil <span class="org-builtin">:break-on-failures?</span> t)
</pre>
</div>
</div>
</li>
<li><a id="orgc81c664"></a>Basics<br>
<div class="outline-text-4" id="text-21-3-2">
<p>
Lift really wants a suite to be defined first before any tests are defined. The first form after the suite name would contain the name of a parent suite (if any). The second form would be used for suite slot specifications which are used with fixtures and will be discussed below.
</p>
<div class="org-src-container">
<pre class="src src-lisp">(deftestsuite tf-lift () ())
</pre>
</div>
<p>
Starting with the most basic named test. This adds a test to the most recently defined suite or you can insert a form before the test name which specifies which suite for the test
</p>
<div class="org-src-container">
<pre class="src src-lisp">(addtest t1
    (ensure (equal 1 1))
    (ensure-condition division-by-zero
      (<span class="org-warning">error</span> 'division-by-zero))
    (ensure-same 1 1)
    (ensure-different '(1 2 3) '(1 3 4)))
</pre>
</div>
<p>
Besides running the test on compilation, we can also run the test using the (run-test function), specifying the test name with the keyword parameter :name.
</p>
<div class="org-src-container">
<pre class="src src-lisp">  (run-test <span class="org-builtin">:name</span> 't1)

#&lt;TF-LIFT.T1 passed&gt;
</pre>
</div>
<p>
Now adding a basic failing test. Let's make sure we get a bit more information on failing tests by inserting a report keyword with a descriptive string with format like parameters and an arguments keyword with parameters to pass to the report keyword. Then we use <code>describe</code> against the results of running the test.
</p>
<div class="org-src-container">
<pre class="src src-lisp">(addtest t1-fail
         (<span class="org-keyword">let</span> ((x 1) (y 2))
           (ensure (= x y)
                   <span class="org-builtin">:report</span> <span class="org-string">"This test was meant to fail because ~a is not = ~a"</span>
                   <span class="org-builtin">:arguments</span> (x y))))

(describe (run-test <span class="org-builtin">:name</span> 't1-fail)))
Test Report for TF-LIFT: 1 test run, 1 Failure.

Failure: tf-lift : t1-fail
Documentation: NIL
Source       : NIL
Condition    : Ensure failed: (= X
                                 Y) <span class="org-warning">(This test was meant to fail because 1 is not = 2)</span>
During       : (END-TEST)
Code         : (
                ((<span class="org-keyword">LET</span> ((X 1) (Y 2))
                      (ENSURE (= X Y) <span class="org-builtin">:REPORT</span>
                              <span class="org-string">"This test was meant to fail because ~a is not = ~a"</span>
                              <span class="org-builtin">:ARGUMENTS</span> (X Y)))))

Test Report for TF-LIFT: 1 test run, 1 Failure.
</pre>
</div>

<p>
As one would hope, you do not need to manually recompile a test just because a tested function is modified.
</p>
</div>
</li>
<li><a id="org00b4b42"></a>Edge Cases: Multiple failing assertions, Values expressions, loops, closures and calling other tests<br>
<ol class="org-ol">
<li><a id="orga1c489a"></a>Multiple assertions and Value expressions<br>
<div class="outline-text-5" id="text-21-3-3-1">
<p>
First checking a test with multiple assertions. The answer is yes and no, which surprised me.
</p>
<div class="org-src-container">
<pre class="src src-lisp">  (addtest t2
    (ensure (= 1 2))
    (ensure (= 2 3)))

(print-test-result-details *standard-output* (run-test <span class="org-builtin">:name</span> 't2) t t)
Failure: tf-lift : t2
  Documentation: NIL
  Source       : NIL
  Condition    : Ensure failed: (= 1 2) ()
  During       : (END-TEST)
  Code         : (
  ((ENSURE (= 1 2)) (ENSURE (= 2 3))))
</pre>
</div>
<p>
Obviously we expected the test to fail. But I expected two assertions to be shown as failing, not only the first one.	I can understand that if the intent is to just throw me into the debugger on the first failure, but not in a reporting situation.
</p>

<p>
Lift has no special functionality for dealing with values expressions. It accepts them but merely looks at the intial value provided by each expression.
</p>
</div>
</li>
<li><a id="org4ac5801"></a>Now looping and closures.<br>
<div class="outline-text-5" id="text-21-3-3-2">
<p>
Checking whether Lift can run tests using variables declared in a closure encompassing the test. Yes.
</p>
<div class="org-src-container">
<pre class="src src-lisp">  (<span class="org-keyword">let</span> ((l1 '(#\a #\B #\z))
          (l2 '(97 66 122)))
    (addtest t2-loop
      (<span class="org-keyword">loop</span> for x in l1 for y in l2 do
        (ensure (= (char-code x) y)))))
#&lt;Test passed&gt;
</pre>
</div>
</div>
</li>
<li><a id="org7fb051c"></a>Calling another test from a test<br>
<div class="outline-text-5" id="text-21-3-3-3">
<p>
We know tests are not functions in Lift, but can a test call another test in its body? We know test t2 should fail.
</p>
<div class="org-src-container">
<pre class="src src-lisp">  (addtest t3
    (ensure (eql 'a 'a))
    (run-test <span class="org-builtin">:name</span> 't2))

(run-test <span class="org-builtin">:name</span> 't3)
#&lt;TF-LIFT.T3 passed&gt;
</pre>
</div>
<p>
It does not look like t3 actually called t2.
</p>
</div>
</li>
</ol>
</li>

<li><a id="org27b9a46"></a>Suites, tags and other multiple test abilities<br>
<ol class="org-ol">
<li><a id="org20549b1"></a>Lists of tests<br>
<div class="outline-text-5" id="text-21-3-4-1">
<p>
Lift cannot run lists of tests outside the suite functionality.
</p>
</div>
</li>
<li><a id="orgfd05b61"></a>Suites<br>
<div class="outline-text-5" id="text-21-3-4-2">
<p>
We already know that we had to set up a suite for tests, in our case a suite named tf-lift
(print-tests)
</p>

<p>
Unlike most test frameworks, lift actually provides a function which will print out the names of the tests included in the suite.
</p>
<div class="org-src-container">
<pre class="src src-lisp">(print-tests <span class="org-builtin">:start-at</span> 'tf-lift)
TF-LIFT (10)
  T1
  T1-FAIL
  T1-FUNCTION
  T2
  T2-VALUES
  T2-LOOP
  T2-WITH-MULTIPLE-VALUES
  T3
  T7-ERROR
  T7-BAD-ERROR
</pre>
</div>
<p>
Let's start with the same simple inheritance structure we have been using with other frameworks.
</p>
<div class="org-src-container">
<pre class="src src-lisp">(deftestsuite s0 () ())
<span class="org-comment-delimiter">;; </span><span class="org-comment">a test that is a member of a suite because it is defined after a defsuite</span>
(addtest t4-s0-1
  (ensure-same 1 1))

<span class="org-comment-delimiter">;; </span><span class="org-comment">Add another test suite</span>
(deftestsuite s1 () ())

<span class="org-comment-delimiter">;; </span><span class="org-comment">add another test, but preface the name with s0 in the form, making this test part of suite s0</span>
(addtest (s0) t4-s0-2
  (ensure (= 1 2)))

<span class="org-comment-delimiter">;; </span><span class="org-comment">add a test, specifying that this one is part of suite s1</span>
(addtest (s1) t4-s1-1
  (ensure (= 2 3)))

<span class="org-comment-delimiter">;; </span><span class="org-comment">Now run tests for suite s0 and s1 respectively and we see that s0 does indeed have two tests and suite s1 has one test.</span>
(run-tests <span class="org-builtin">:suite</span> 's0)
Start: S0
#&lt;Results for S0 2 Tests, 1 Failure&gt;

(run-tests <span class="org-builtin">:suite</span> 's1)
Start: S1
#&lt;Results for S1 1 Test, 1 Failure&gt;
</pre>
</div>
<p>
We now define suite s2 which is a child suite of s0 and add a test
</p>
<div class="org-src-container">
<pre class="src src-lisp">(deftestsuite s2 (s0) ())

(addtest (s2) t4-s2-1
    (ensure (= 1 1))
  (ensure (eq 'a 'a)))
</pre>
</div>
<p>
If we now apply RUN-TESTS to suite s0, we see that it runs both s2 and s0
</p>
<div class="org-src-container">
<pre class="src src-lisp">(run-tests <span class="org-builtin">:suite</span> 's0)
Start: S0
Start: S2
#&lt;Results for S0 3 Tests, 1 Failure&gt;
</pre>
</div>
<p>
If we run it with a :report-pathname keyword parameter set, we can get a lot more information sent to a file:
</p>
<div class="org-src-container">
<pre class="src src-lisp">(run-tests <span class="org-builtin">:suite</span> 's0 <span class="org-builtin">:report-pathname</span> #P <span class="org-string">"/tmp/lift-1.txt"</span>)
</pre>
</div>

<p>
<a href="#org63aa282">top</a>
</p>
</div>
</li>
</ol>
</li>
<li><a id="org140b9d6"></a>Fixtures and Freezing Data<br>
<div class="outline-text-4" id="text-21-3-5">
<p>
Variables can be created and set at the suite level, making those variables available down the suite inheritance chain.
</p>
<div class="org-src-container">
<pre class="src src-lisp">(deftestsuite s3 ()
  ((a 1) (b 2) (c 3)))

(addtest t4-s3-1
         (ensure-same 1 a))

(deftestsuite s4 (s3)
  ((d 4)))

(addtest t4-s4-1
         (ensure-same 2 b)
         (ensure-same 4 d))

(addtest (s3) t4-s3-2
         (ensure-same 2 b))
</pre>
</div>
<p>
These all pass because the tests can see the variables creates in their suite and the parent suites. If we created a test in suite s3 that tried to reference the variable d creates in suite s4 (a lower level suite), we would get an undefined variable error.
</p>

<p>
Suites also have :setup and :takedown keyword parameters and an additional :run-setup parameter that controls when the setup provisions are performed. The default is :once-per-test-case (setup again for each and every test in the suite). The other alternatives are :once-per-suite and :never.
</p>
<div class="org-src-container">
<pre class="src src-lisp">(deftestsuite s5 ()()
  (<span class="org-builtin">:setup</span>
    (setf db (open-data <span class="org-string">"bar"</span> <span class="org-builtin">:if-exists</span> <span class="org-builtin">:supersede</span>)))
  (<span class="org-builtin">:teardown</span>
    (setf db nil))
  (<span class="org-builtin">:run-setup</span> <span class="org-builtin">:once-per-test-case</span>))
</pre>
</div>
</div>
</li>
<li><a id="org6b51bd9"></a>Removing tests<br>
<div class="outline-text-4" id="text-21-3-6">
<p>
Tests and suites can be removed using <code>remove-tests</code>
</p>
<div class="org-src-container">
<pre class="src src-lisp">(remove-test <span class="org-builtin">:suite</span> 's2)

(remove-test <span class="org-builtin">:test-case</span> 't1)
</pre>
</div>
</div>
</li>
<li><a id="org9830c9e"></a>Sequencing, Random and Failure Only<br>
<div class="outline-text-4" id="text-21-3-7">
<p>
Do the tests in a suite run in sequential order, randomly or is it optional? Failure only testing (just running all the tests that failed last time) is nice to have, but of course you still need to be able to run everything at the end to ensure that fixing one bug did not create another.
</p>
</div>
</li>
<li><a id="org2252d6a"></a>Skip Capability<br>
<ol class="org-ol">
<li><a id="org5e9e8a3"></a>Tests<br>
<div class="outline-text-5" id="text-21-3-8-1">
<p>
The <code>run-tests</code> function takes a :skip-tests keyword parameter which accepts a list of test names to skip.
</p>

<p>
The variable =*test-maximum-time* controls the number of seconds that a test can take before lift gives up. It defaults to 2 seconds.
</p>
</div>
</li>
</ol>
</li>
<li><a id="org45165c8"></a>Random Data Generators<br>
<div class="outline-text-4" id="text-21-3-9">
<p>
Lift has various random data generators:
</p>
<div class="org-src-container">
<pre class="src src-lisp"><span class="org-comment-delimiter">;; </span><span class="org-comment">(random-number suite min max)</span>
(random-number 's4 1 100)

<span class="org-comment-delimiter">;; </span><span class="org-comment">(random-element suite sequence)</span>
(random-element 's4 '(a b c 23))
</pre>
</div>
<p>
If anyone can give a good example of the use of the <code>DEFRANDOM-INSTANCE</code> macro besides what is in the random-testing file, feel free to submit a pull request.
</p>
</div>
</li>
</ol>
</div>

<div id="outline-container-org5b27c79" class="outline-3">
<h3 id="org5b27c79"><span class="section-number-3">21.4.</span> Discussion</h3>
<div class="outline-text-3" id="text-21-4">
<p>
I really want to like lift, but I really have a hard time getting over the fact that it stops at the first assertion failure.
</p>
</div>
</div>
<div id="outline-container-orgac4db1e" class="outline-3">
<h3 id="orgac4db1e"><span class="section-number-3">21.5.</span> Who Uses Lift</h3>
<div class="outline-text-3" id="text-21-5">
<p>
Many libraries on quicklisp use Lift. If you have quicklisp, you can get a list of those with:
</p>
<div class="org-src-container">
<pre class="src src-lisp">(ql:who-depends-on <span class="org-builtin">:lift</span>)
</pre>
</div>

<p>
<a href="#org63aa282">top</a>
<a id="orgc6e4266"></a>
</p>
</div>
</div>
</div>
<div id="outline-container-org8383655" class="outline-2">
<h2 id="org8383655"><span class="section-number-2">22.</span> lisp-unit</h2>
<div class="outline-text-2" id="text-22">
<p>
<a href="#org63aa282">top</a>
</p>
</div>
<div id="outline-container-orga92aaff" class="outline-3">
<h3 id="orga92aaff"><span class="section-number-3">22.1.</span> Summary</h3>
<div class="outline-text-3" id="text-22-1">
<table>


<colgroup>
<col  class="org-left">

<col  class="org-left">

<col  class="org-left">

<col  class="org-right">
</colgroup>
<tbody>
<tr>
<td class="org-left"><a href="https://github.com/OdonataResearchLLC/lisp-unit">homepage</a></td>
<td class="org-left">Thomas M. Hermann</td>
<td class="org-left">MIT</td>
<td class="org-right">2017</td>
</tr>
</tbody>
</table>

<p>
Phil Gold's original concerns about lisp-unit back in 2007 was its failure to scale. Specifically he pointed to non-composable test reports, the fact that you could not get just failure reports, so the failures were lost in the reporting of successful reports, and there is no count of failed tests. I think those have been addressed with the tags capabilities. Lisp-unit still focuses on counting assertions rather than tests, but you can now collect information on just the failing tests.
</p>

<p>
I generally like lisp-unit. It does not have progress reports which might bother some people. My bigger concern is its lack of fixtures and you can turn on debugging only for errors, not for failures. If you need floating point tests, those are built-in. Documentation can be found at the <a href="https://github.com/OdonataResearchLLC/lisp-unit/wiki">wiki</a>.
<a href="#org63aa282">top</a>
</p>
</div>
</div>
<div id="outline-container-orgc7f65f0" class="outline-3">
<h3 id="orgc7f65f0"><span class="section-number-3">22.2.</span> Assertion Functions</h3>
<div class="outline-text-3" id="text-22-2">
<table>


<colgroup>
<col  class="org-left">

<col  class="org-left">

<col  class="org-left">
</colgroup>
<tbody>
<tr>
<td class="org-left">assert-eq</td>
<td class="org-left">assert-eql</td>
<td class="org-left">assert-equal</td>
</tr>

<tr>
<td class="org-left">assert-equality</td>
<td class="org-left">assert-equalp</td>
<td class="org-left">assert-error</td>
</tr>

<tr>
<td class="org-left">assert-expands</td>
<td class="org-left">assert-false</td>
<td class="org-left">assert-float-equal</td>
</tr>

<tr>
<td class="org-left">assert-nil</td>
<td class="org-left">assert-norm-equal</td>
<td class="org-left">assert-number-equal</td>
</tr>

<tr>
<td class="org-left">assert-numerical-equal</td>
<td class="org-left">assert-prints</td>
<td class="org-left">assert-rational-equal</td>
</tr>

<tr>
<td class="org-left">assert-result</td>
<td class="org-left">assert-sigfig-equal</td>
<td class="org-left">assert-test</td>
</tr>

<tr>
<td class="org-left">assert-true</td>
<td class="org-left">check-type</td>
<td class="org-left">logically-equal</td>
</tr>

<tr>
<td class="org-left">set-equal</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>
</tbody>
</table>

<p>
<a href="#org63aa282">top</a>
</p>
</div>
</div>
<div id="outline-container-orge8b47a8" class="outline-3">
<h3 id="orge8b47a8"><span class="section-number-3">22.3.</span> Usage</h3>
<div class="outline-text-3" id="text-22-3">
</div>
<ol class="org-ol">
<li><a id="orgaa21efc"></a>Report Format<br>
<div class="outline-text-4" id="text-22-3-1">
<p>
Lisp-unit defaults to a reporting format shown below. You can do <code>(setf *use-debugger* :ask)</code> or <code>(setf *use-debugger* t)</code>, but that will only throw you into the debugger if there is an actual error generated, not a failure (or failure to see the correct error). So, not complete debugger optionality.
</p>

<p>
Lisp-unit will normally just count assertions passed, failed, and execution errors and report those. You will see in the first failing test examples how to get more information. You can hav also have it kick you into the debugger on errors by calling <code>use-debugger</code>. This only applies to errors and not failures.
</p>

<p>
Calling <code>run-tests</code> will return an instance of a test-results-db object. You can get a list of failed test objects with the <code>failed-tests</code> function which also accepts an optional stream, allowing easy printing to a file:
</p>
<div class="org-src-container">
<pre class="src src-lisp">(failed-tests (run-tests <span class="org-builtin">:all</span>) optional-stream)
</pre>
</div>
<p>
You can print the detailed failure information using the <code>print-failures</code> function:
</p>
<div class="org-src-container">
<pre class="src src-lisp">(print-failures (run-tests <span class="org-builtin">:all</span>))
</pre>
</div>
<p>
Lisp-unit also has <code>print</code> and <code>print-errors</code> which also take an optional stream.
</p>

<p>
If you like the TAP format, Lisp-unit also has <code>(write-tap-to-file test-results path)</code> and <code>(write-tap test-results [stream])</code>.
</p>
</div>
</li>
<li><a id="org38894bf"></a>Basics<br>
<div class="outline-text-4" id="text-22-3-2">
<p>
First, the basic test where we know everything is going to pass. Since Lisp-unit has macro expand and floating point assertion functions, we will show those in this example (so we need a macro just for the macroexpand test). See <a href="https://github.com/OdonataResearchLLC/lisp-unit/blob/master/extensions/floating-point.lisp">https://github.com/OdonataResearchLLC/lisp-unit/blob/master/extensions/floating-point.lisp</a> and <a href="https://github.com/OdonataResearchLLC/lisp-unit/blob/master/extensions/rational.lisp">https://github.com/OdonataResearchLLC/lisp-unit/blob/master/extensions/rational.lisp</a> for more information on the floating point and rational tests.
</p>
<div class="org-src-container">
<pre class="src src-lisp">  (<span class="org-keyword">defmacro</span> <span class="org-function-name">my-macro</span> (arg1 arg2)
    (<span class="org-keyword">let</span> ((g1 (gensym))
          (g2 (gensym)))
      `(<span class="org-keyword">let</span> ((,g1 ,arg1)
             (,g2 ,arg2))
         <span class="org-string">"Start"</span>
         (+ ,g1 ,g2 3))))

(<span class="org-keyword">define-test</span> t1
  <span class="org-string">"describe t1"</span>
  (<span class="org-warning">assert-true</span> (= 1 1))
  (<span class="org-warning">assert-equal</span> 1 1)
  (<span class="org-warning">assert-float-equal</span> 17 17.0000d0)
  (<span class="org-warning">assert-rational-equal</span> 3/2 3/2)
  (<span class="org-warning">assert-true</span> (set-equal '(a b c) '(b a c))) <span class="org-comment">;every element in both sets needs to be in the other</span>
  (<span class="org-warning">assert-true</span> (logically-equal t t)) <span class="org-comment">; both true or both false</span>
  (<span class="org-warning">assert-true</span> (logically-equal nil nil)) <span class="org-comment">; both true or both false</span>
  (<span class="org-warning">assert-expands</span>
      (<span class="org-keyword">let</span> ((<span class="org-builtin">#:G1</span> A) (<span class="org-builtin">#:G2</span> B)) <span class="org-string">"Start"</span> (+ <span class="org-builtin">#:G1</span> <span class="org-builtin">#:G2</span> 3))
      (my-macro a b))
  (<span class="org-warning">assert-prints</span> <span class="org-string">"12"</span> (format t <span class="org-string">"~a"</span> 12))
  (<span class="org-warning">assert-error</span> 'division-by-zero
                (<span class="org-warning">error</span> 'division-by-zero)
                <span class="org-string">"testing condition assertions"</span>))
</pre>
</div>
<p>
Now run this test:
</p>
<div class="org-src-container">
<pre class="src src-lisp">(run-tests '(t1))
Unit Test Summary
 | 10 assertions total
 | 10 passed
 | 0 failed
 | 0 execution errors
 | 0 missing tests

#&lt;TEST-RESULTS-DB Total(6) Passed(6) Failed(0) Errors(0)&gt;
</pre>
</div>
<p>
Now a basic failing test.
</p>
<div class="org-src-container">
<pre class="src src-lisp">(<span class="org-keyword">define-test</span> t1-fail
  <span class="org-string">"describe t1-fail"</span>
  (<span class="org-keyword">let</span> ((x 1) (y 2))
    (<span class="org-warning">assert-true</span> (= x y))
    (<span class="org-warning">assert-equal</span> x y)
    (<span class="org-warning">assert-expands</span>
        (<span class="org-keyword">let</span> ((<span class="org-builtin">#:G1</span> D) (<span class="org-builtin">#:G2</span> B)) <span class="org-string">"Start"</span> (+ <span class="org-builtin">#:G1</span> <span class="org-builtin">#:G2</span> 3))
        (my-macro a b))
    (<span class="org-warning">assert-prints</span> <span class="org-string">"12"</span> (format nil <span class="org-string">"~a"</span> 12))
    (<span class="org-warning">assert-error</span> 'division-by-zero
                  (<span class="org-warning">error</span> 'floating-point-overflow)
                  <span class="org-string">"testing condition assertions"</span>)))

(run-tests '(t1-fail))
Unit Test Summary
 | 5 assertions total
 | 0 passed
 | 5 failed
 | 0 execution errors
 | 0 missing tests
</pre>
</div>
<p>
That told us assertions failed, but did not give a lot of information. Let's change the setup slightly, setting <code>*PRINT-FAILURES*</code> to t. (You can also print info just on errors by setting <code>*PRINT-FAILURES*</code> to nil and <code>*PRINT-ERRORS*</code> to t.)
</p>
<div class="org-src-container">
<pre class="src src-lisp">(setf *print-failures* t)

(run-tests '(t1-fail))
 | Failed Form: (<span class="org-warning">ERROR</span> 'FLOATING-POINT-OVERFLOW)
 | Should have signalled DIVISION-BY-ZERO but saw #&lt;FLOATING-POINT-OVERFLOW {100E6D4D13}&gt;
 | "testing condition assertions" =&gt; "testing condition assertions"
 |
 | Failed Form: (FORMAT NIL "~a" 12)
 | Should have printed <span class="org-string">"12"</span> but saw <span class="org-string">""</span>
 |
 | Failed Form: (MY-MACRO A B)
 | Should have expanded to (<span class="org-keyword">LET</span> ((<span class="org-builtin">#:G1</span> D) (<span class="org-builtin">#:G2</span> B))
                             "Start"
                             (+ <span class="org-builtin">#:G1</span> <span class="org-builtin">#:G2</span> 3))
but saw (<span class="org-keyword">LET</span> ((<span class="org-builtin">#:G1</span> A) (<span class="org-builtin">#:G2</span> B))
          "Start"
          (+ <span class="org-builtin">#:G1</span> <span class="org-builtin">#:G2</span> 3)); T
 |
 | Failed Form: Y
 | Expected 1 but saw 2
 |
 | Failed Form: (= X Y)
 | Expected T but saw NIL
 | X =&gt; 1
 | Y =&gt; 2
 |
T1-FAIL: 0 assertions passed, 5 failed.

Unit Test Summary
 | 5 assertions total
 | 0 passed
 | 5 failed
 | 0 execution errors
 | 0 missing tests

#&lt;TEST-RESULTS-DB Total(5) Passed(0) Failed(5) Errors(0)&gt;
</pre>
</div>
<p>
That gives more information, but notice the slight difference between the information provided for assert-equal - Failed Form: Y and the information provided for assert-true - Failed Form: (= X Y).
</p>

<p>
We can get still more if we pass more info to the assertion clause. While the assertions compares the following two items, we can pass more information that it will print on failures. Unlike some other frameworks, we cannot pass a diagnostic string which accepts interpolated variables, but we can pass a string and variables. This time we will reduce the test to just the assert-equal clause.
</p>
<div class="org-src-container">
<pre class="src src-lisp">  (<span class="org-keyword">define-test</span> t1-fail-short
      (<span class="org-keyword">let</span> ((x 1) (y 2))
        (<span class="org-warning">assert-equal</span> x y <span class="org-string">"Diagnostic Message: X ~a should equal Y ~a"</span> x y)))

(run-tests '(t1-fail-short))
 | Failed Form: Y
 | Expected 1 but saw 2
 | "Diagnostic Message: X should equal Y" =&gt; "Diagnostic Message: X should equal Y"
 | X =&gt; 1
 | Y =&gt; 2
 |
T1-FAIL: 0 assertions passed, 1 failed.

Unit Test Summary
 | 1 assertions total
 | 0 passed
 | 1 failed
 | 0 execution errors
 | 0 missing tests
</pre>
</div>
<p>
Of course, the usefulness of the diagnostic message will depend on the context.
</p>

<p>
You do not have to manually recompile a test after a tested function has been modified.
</p>
</div>
</li>
<li><a id="orga83fd4d"></a>Edge Cases: Loops. closures and calling other tests<br>
<ol class="org-ol">
<li><a id="org13d360e"></a>Value expressions<br>
<div class="outline-text-5" id="text-22-3-3-1">
<p>
Lisp-Unit has a pleasant surprise with respect to values expressions. Unlike almost all the other frameworks Lisp-unit and Lisp-unit2 actually look at all the values in the values expressions:
</p>

<div class="org-src-container">
<pre class="src src-lisp">  (<span class="org-keyword">define-test</span> t2-values-expressions
    (<span class="org-warning">assert-equal</span> (values 1 2) (values 1 3))
    (<span class="org-warning">assert-equal</span> (values 1 2 3) (values 1 3 2)))

(print-failures (run-tests '(t2-values-expressions)))
Unit Test Summary
 | 2 assertions total
 | 0 passed
 | 2 failed
 | 0 execution errors
 | 0 missing tests

 | Failed Form: (VALUES 1 3 2)
 | Expected 1; 2; 3 but saw 1; 3; 2
 |
 | Failed Form: (VALUES 1 3)
 | Expected 1<span class="org-comment">; 2 but saw 1; 3</span>
 |
T2-VALUES-EXPRESSIONS: 0 assertions passed, 2 failed.
</pre>
</div>
</div>
</li>

<li><a id="orgad7435f"></a>Closure Variables<br>
<div class="outline-text-5" id="text-22-3-3-2">
<p>
Lisp-Unit will not see the variables declared in a closure surrounding the test function, so the following would fail.
</p>
<div class="org-src-container">
<pre class="src src-lisp">(<span class="org-keyword">let</span> ((l1 '(#\a #\B #\z))
      (l2 '(97 66 122)))
(<span class="org-keyword">define-test</span> t2-loop
  (<span class="org-keyword">loop</span> for x in l1 for y in l2 do
    (<span class="org-warning">assert-equal</span> (char-code x) y))))
</pre>
</div>
</div>
</li>
<li><a id="orgea4768d"></a>Calling another test from a test<br>
<div class="outline-text-5" id="text-22-3-3-3">
<p>
While tests are not functions in lisp-unit, they can call other tests.
</p>
<div class="org-src-container">
<pre class="src src-lisp">(<span class="org-keyword">define-test</span> t3 ()<span class="org-comment">; a test that tries to call another test in its body</span>
    <span class="org-string">"describe t3"</span>
          (<span class="org-warning">assert-equal</span> 'a 'a)
          (run-tests '(t2)))
T3
LISP-UNIT-EXAMPLES&gt; (run-tests '(t3))
 | Failed Form: 3
 | Expected 2 but saw 3
 |
 | Failed Form: 2
 | Expected 1 but saw 2
 |
T2: 1 assertions passed, 2 failed.

Unit Test Summary
 | 3 assertions total
 | 1 passed
 | 2 failed
 | 0 execution errors
 | 0 missing tests

T3: 0 assertions passed, 0 failed.

Unit Test Summary
 | 0 assertions total
 | 0 passed
 | 0 failed
 | 0 execution errors
 | 0 missing tests
</pre>
</div>
<p>
A bit of a surprise here. Test t3 does call test t2 but does not track its own assertion. If you reverse the order so that t3's assertions come after the call to run-tests on t2, then it does work properly. In neither case are the situations composed.
</p>
</div>
</li>
</ol>
</li>

<li><a id="org26795d5"></a>Suites, tags and other multiple test abilities<br>
<div class="outline-text-4" id="text-22-3-4">
<p>
Lisp-unit uses both packages and tags rather than suites. That provides a bit more flexibility in terms of reusing tests in different situations, but does not create the automatic inheritance that some people like.
</p>
</div>

<ol class="org-ol">
<li><a id="org5588661"></a>Lists of tests<br>
<div class="outline-text-5" id="text-22-3-4-1">
<p>
Lisp-unit can run lists of tests
</p>
<div class="org-src-container">
<pre class="src src-lisp">(run-tests '(t1 t2))
</pre>
</div>
<p>
Lisp-unit makes it easy to get a list of the names of the failing tests which you can then save and <code>run-tests</code> against. <code>Run-tests</code> returns a <code>test-results-db</code> object. Just call <code>failed-tests</code> on that to get a list of the names of the tests that failed in that run. Then <code>run-tests</code> against that smaller list.
</p>
</div>
</li>
<li><a id="orgc6f16da"></a>Packages<br>
<div class="outline-text-5" id="text-22-3-4-2">
<p>
Assuming you have set up your tests in a separate package (that package can cover many application packages) and that test package is the current package, you can run all the tests in the current package with:
</p>
<div class="org-src-container">
<pre class="src src-lisp">(run-tests <span class="org-builtin">:all</span>)
</pre>
</div>
<p>
The reporting can get confusing as in this sample run with <code>*print-failures*</code> set to nil:
</p>
<div class="org-src-container">
<pre class="src src-lisp">(run-tests <span class="org-builtin">:all</span>)
Diagnostic Message: X 1 should equal Y 2
Unit Test Summary
 | 3 assertions total
 | 1 passed
 | 2 failed
 | 0 execution errors
 | 0 missing tests

Unit Test Summary
 | 13 assertions total
 | 6 passed
 | 7 failed
 | 0 execution errors
 | 0 missing tests

#&lt;TEST-RESULTS-DB Total(13) Passed(6) Failed(7) Errors(0)&gt;
</pre>
</div>
<p>
Why do we have two Unit Test Summaries having different numbers of tests and assertions? If you recall, test t3 calls test t2 and that first summary is a secondary summary from that call.
</p>

<p>
To run all the tests in a non-current package, add the name of the package after the keyword parameter :all
</p>
<div class="org-src-container">
<pre class="src src-lisp">(lisp-unit:run-tests <span class="org-builtin">:all</span> <span class="org-builtin">:date-tests</span>)
</pre>
</div>
<p>
You can list the names of all the tests in a package
</p>
<div class="org-src-container">
<pre class="src src-lisp">(list-tests [package])
</pre>
</div>
</div>
</li>
<li><a id="org9d39cc7"></a>Tags<br>
<div class="outline-text-5" id="text-22-3-4-3">
<p>
As noted, lisp-unit provides the ability to define tests with multiple tags:
</p>
<div class="org-src-container">
<pre class="src src-lisp">(<span class="org-keyword">define-test</span> foo
  <span class="org-string">"This is the documentation."</span>
  (<span class="org-builtin">:tag</span> <span class="org-builtin">:tag1</span> <span class="org-builtin">:tag2</span> symtag)
  exp1 exp2 ...)
</pre>
</div>
<p>
So assume three tests that we want tagged differently:
</p>
<div class="org-src-container">
<pre class="src src-lisp">(<span class="org-keyword">define-test</span> t6-1
  <span class="org-string">"Test t6-1 tagged simple and complex"</span>
  (<span class="org-builtin">:tag</span> <span class="org-builtin">:simple</span> <span class="org-builtin">:complex</span>)
  (<span class="org-warning">assert-true</span> (= 1 1 1)))

  (<span class="org-keyword">define-test</span> t6-2
  <span class="org-string">"Test t6-2 tagged simple only"</span>
  (<span class="org-builtin">:tag</span> <span class="org-builtin">:simple</span>)
  (<span class="org-warning">assert-equal</span> 1 1))

  (<span class="org-keyword">define-test</span> t6-3
  <span class="org-string">"Test t6-2 tagged simple only"</span>
  (<span class="org-builtin">:tag</span> <span class="org-builtin">:complex</span>)
  (<span class="org-warning">assert-equal</span> 'a 'a))
</pre>
</div>
<p>
Then using <code>run-tages</code> does what we expect. We will set <code>*print-summary*</code> t for simplicity.
</p>
<div class="org-src-container">
<pre class="src src-lisp">(setf *print-summary* t)

(run-tags '(<span class="org-builtin">:simple</span>))
T6-2: 1 assertions passed, 0 failed.

T6-1: 1 assertions passed, 0 failed.

Unit Test Summary
 | 2 assertions total
 | 2 passed
 | 0 failed
 | 0 execution errors
 | 0 missing tests

#&lt;TEST-RESULTS-DB Total(2) Passed(2) Failed(0) Errors(0)&gt;

LISP-UNIT&gt; (run-tags '(<span class="org-builtin">:complex</span>))
T6-3: 1 assertions passed, 0 failed.

T6-1: 1 assertions passed, 0 failed.

Unit Test Summary
 | 2 assertions total
 | 2 passed
 | 0 failed
 | 0 execution errors
 | 0 missing tests
</pre>
</div>

<p>
Tags can be listed with <code>(LIST-TAGS [PACKAGE])</code>. <code>TAGGED-TESTS</code> returns the tests associated with the listed tags. All tagged tests are returned with no arguments or if the keyword :all is provided instead of a list of tags. Use <code>*package*</code> if package is not specified.
</p>
<div class="org-src-container">
<pre class="src src-lisp">(tagged-tests '(tag1 tag2 ...) [package])
(tagged-tests <span class="org-builtin">:all</span> [package])
(tagged-tests)
</pre>
</div>

<p>
<a href="#org63aa282">top</a>
</p>
</div>
</li>
</ol>
</li>
<li><a id="org5dbfcba"></a>Fixtures and Freezing Data<br>
<div class="outline-text-4" id="text-22-3-5">
<p>
None
</p>
</div>
</li>
<li><a id="org9419af3"></a>Removing tests<br>
<div class="outline-text-4" id="text-22-3-6">
<p>
Lisp-unit has both <code>remove-tests</code> and <code>remove-tags</code> functions.
</p>
</div>
</li>
<li><a id="org8b0474f"></a>Sequencing, Random and Failure Only<br></li>

<li><a id="orgcef5b9c"></a>Skip Capability<br>
<div class="outline-text-4" id="text-22-3-8">
<p>
None
</p>
</div>
</li>
<li><a id="org230c371"></a>Random Data Generators<br>
<div class="outline-text-4" id="text-22-3-9">
<p>
Lisp-unit2 has various functions for generating random data. See examples below:
</p>
<div class="org-src-container">
<pre class="src src-lisp">(complex-random #C(5 3))
#C(4 1)

(make-random-2d-array 2 3)
#2A((0.03395796 0.55509293 0.34209597) (0.5823394 0.8771157 0.29430425))

(make-random-2d-list 2 3)
((0.18096626 0.916595 0.88126934) (0.45945048 0.8838378 0.57314146))

(make-random-list 3)
(0.5449568 0.32319236 0.7780224)

(make-random-state)
#S(RANDOM-STATE <span class="org-builtin">:STATE</span> #.(MAKE-ARRAY 627 <span class="org-builtin">:ELEMENT-TYPE</span> '(UNSIGNED-BYTE 32)
                                     <span class="org-builtin">:INITIAL-CONTENTS</span>
                                     '(0 2567483615 454 2531281407 4203062579
                                       3352536227 284404050 622556438
                                       ...)))
</pre>
</div>
</div>
</li>
</ol>
</div>


<div id="outline-container-org34e1193" class="outline-3">
<h3 id="org34e1193"><span class="section-number-3">22.4.</span> Who Uses Lisp-Unit</h3>
<div class="outline-text-3" id="text-22-4">
<p>
Many libraries on quicklisp use Lisp-Unit. If you have quicklisp, you can get a list of those with:
</p>
<div class="org-src-container">
<pre class="src src-lisp">(ql:who-depends-on <span class="org-builtin">:lisp-unit</span>)
</pre>
</div>

<p>
<a href="#org63aa282">top</a>
<a id="orgb8996ba"></a>
</p>
</div>
</div>
</div>
<div id="outline-container-org770701c" class="outline-2">
<h2 id="org770701c"><span class="section-number-2">23.</span> lisp-unit2</h2>
<div class="outline-text-2" id="text-23">
<p>
<a href="#org63aa282">top</a>
</p>
</div>
<div id="outline-container-org7fdbd6a" class="outline-3">
<h3 id="org7fdbd6a"><span class="section-number-3">23.1.</span> Summary</h3>
<div class="outline-text-3" id="text-23-1">
<table>


<colgroup>
<col  class="org-left">

<col  class="org-left">

<col  class="org-left">

<col  class="org-right">
</colgroup>
<tbody>
<tr>
<td class="org-left"><a href="https://github.com/AccelerationNet/lisp-unit2">homepage</a></td>
<td class="org-left">Russ Tyndall</td>
<td class="org-left">MIT</td>
<td class="org-right">2018</td>
</tr>
</tbody>
</table>

<p>
I generally like Lisp-Unit2. Phil Gold's original concerns about Lisp-Unit back in 2007 was its failure to scale. Specifically he pointed to non-composable test reports, the fact that you could not get just failure reports, so the failures were lost in the reporting of successful reports, and there is no count of failed tests. I think those have been addressed with the tags capabilities.
</p>

<p>
Unlike the situation with Clunit and Clunit2 which are almost identical, Lisp-Unit and Lisp-Unit2 have definitely diverged over the years.
Lisp-unit2 has fixtures and can run just the previously failing tests and you can turn on debugging for failures as well as errors.
It does not have progress reports which might bother some people.  If you need floating point tests, those are built-in.
</p>

<p>
It will report all the assertion failures in a test, gives the opportunity to provide user generated diagnostic messages in assertions and has a tags system that allows different ways to re-use tests not found in the typical hierarchical setup. It can re-run failed tests and interactive debugging is optional. I did find the fixture structure to be confusing and it does not have progress reporting which some people really like. I did have an issue compiling it with CCL but have not tracked it down sufficiently to see if it is a bug to be reported.
</p>
</div>
</div>
<div id="outline-container-orgea750ea" class="outline-3">
<h3 id="orgea750ea"><span class="section-number-3">23.2.</span> Assertion Functions</h3>
<div class="outline-text-3" id="text-23-2">
<table>


<colgroup>
<col  class="org-left">

<col  class="org-left">

<col  class="org-left">
</colgroup>
<tbody>
<tr>
<td class="org-left">assert-eq</td>
<td class="org-left">assert-eql</td>
<td class="org-left">assert-equal</td>
</tr>

<tr>
<td class="org-left">assert-equality</td>
<td class="org-left">assert-equalp</td>
<td class="org-left">assert-error</td>
</tr>

<tr>
<td class="org-left">assert-expands</td>
<td class="org-left">assert-fail</td>
<td class="org-left">assert-false</td>
</tr>

<tr>
<td class="org-left">assert-float-equal</td>
<td class="org-left">assert-no-error</td>
<td class="org-left">assert-no-signal</td>
</tr>

<tr>
<td class="org-left">assert-no-warning</td>
<td class="org-left">assert-norm-equal</td>
<td class="org-left">assert-number-equal</td>
</tr>

<tr>
<td class="org-left">assert-numerical-equal</td>
<td class="org-left">assert-passes?</td>
<td class="org-left">assert-prints</td>
</tr>

<tr>
<td class="org-left">assert-rational-equal</td>
<td class="org-left">assert-sigfig-equal</td>
<td class="org-left">assert-signal</td>
</tr>

<tr>
<td class="org-left">assert-true</td>
<td class="org-left">assert-typep</td>
<td class="org-left">assert-warning</td>
</tr>

<tr>
<td class="org-left">assertion-fail</td>
<td class="org-left">assertion-pass</td>
<td class="org-left">check-type</td>
</tr>

<tr>
<td class="org-left">logically-equal</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>
</tbody>
</table>

<p>
<a href="#org63aa282">top</a>
</p>
</div>
</div>
<div id="outline-container-org76e1df2" class="outline-3">
<h3 id="org76e1df2"><span class="section-number-3">23.3.</span> Usage</h3>
<div class="outline-text-3" id="text-23-3">
<p>
If you store the results of a test run, you can call <code>rerun-failures</code> on those results to just rerun the failing tests rather than go through all the tests again.
</p>
</div>
<ol class="org-ol">
<li><a id="org94dd35f"></a>Report Format<br>
<div class="outline-text-4" id="text-23-3-1">
<p>
The variable <code>*debugger-hook*</code> is set by default to <code>#&lt;FUNCTION SWANK:SWANK-DEBUGGER-HOOK&gt;</code>. If you want to stay out of interactive debugging, set <code>*debugger-hook*</code> to nil.
</p>

<p>
You could allow the system to put you in the debugger using the <code>with-failure-debugging</code> wrapper or provide that wrapper to the keyword parameter <code>:run-contexts</code> when call <code>run-tests</code> as in the following two examples
</p>
<div class="org-src-container">
<pre class="src src-lisp">(<span class="org-keyword">with-failure-debugging</span> ()
  (run-tests <span class="org-builtin">:tests</span> '(t7-bad-error)))

(run-tests <span class="org-builtin">:tests</span> 'tf-lisp-unit2::tf-find-str-in-list-t
           <span class="org-builtin">:run-contexts</span> #'with-failure-debugging-context)
</pre>
</div>
</div>
</li>
<li><a id="orged8e312"></a>Basics<br>
<div class="outline-text-4" id="text-23-3-2">
<p>
Tests in lisp-unit2 are functions. They are also compiled at the time of definition (so that any compile warnings or errors are immediately noticeable) and also before every run of the test (so that macro expansions are never out of date).
</p>

<p>
The define-test macro takes a name parameter and a form specifying :tags, :contexts or :package before you get to the assertions.
</p>

<p>
First, the basic test where we know everything is going to pass. Since Lisp-unit2 has macro expand and floating point assertion functions, we will show those in this example (so we need a macro just for the macroexpand test). See <a href="https://github.com/AccelerationNet/lisp-unit2/blob/master/floating-point.lisp">https://github.com/AccelerationNet/lisp-unit2/blob/master/floating-point.lisp</a> and <a href="https://github.com/AccelerationNet/lisp-unit2/blob/master/rational.lisp">https://github.com/AccelerationNet/lisp-unit2/blob/master/rational.lisp</a> for more information on the floating point and rational tests including setting the epsilon values etc.
</p>

<div class="org-src-container">
<pre class="src src-lisp">(<span class="org-keyword">defmacro</span> <span class="org-function-name">my-macro</span> (arg1 arg2)
  (<span class="org-keyword">let</span> ((g1 (gensym))
        (g2 (gensym)))
    `(<span class="org-keyword">let</span> ((,g1 ,arg1)
           (,g2 ,arg2))
       <span class="org-string">"Start"</span>
       (+ ,g1 ,g2 3))))

(<span class="org-keyword">define-test</span> t1
    (<span class="org-builtin">:tags</span> '(tf-basic))
  (<span class="org-warning">assert-true</span> (=  1 1))
  (<span class="org-warning">assert-eq</span> 'a 'a)
  (<span class="org-warning">assert-rational-equal</span> 3/2 3/2)
  (<span class="org-warning">assert-float-equal</span> 17 17.0000d0)
  (<span class="org-warning">assert-true</span> (logically-equal t t)) <span class="org-comment">; both true or both false</span>
  (<span class="org-warning">assert-true</span> (logically-equal nil nil)) <span class="org-comment">; both true or both false</span>
  (<span class="org-warning">assert-expands</span>
      (<span class="org-keyword">let</span> ((<span class="org-builtin">#:G1</span> A) (<span class="org-builtin">#:G2</span> B)) <span class="org-string">"Start"</span> (+ <span class="org-builtin">#:G1</span> <span class="org-builtin">#:G2</span> 3))
      (my-macro a b))
  (<span class="org-warning">assert-error</span> 'division-by-zero
                (<span class="org-warning">error</span> 'division-by-zero)
                <span class="org-string">"testing condition assertions"</span>))
</pre>
</div>
<p>
Now run this test. The keyword parameter :tests will accept a single test symbol or a list of tests. E.g.
</p>
<div class="org-src-container">
<pre class="src src-lisp">  (run-tests <span class="org-builtin">:tests</span> 't1)

  (run-tests <span class="org-builtin">:tests</span> '(t1))

#&lt;TEST-RESULTS-DB Tests:(1) Passed:(8) Failed:(0) Errors:(0) Warnings:(0) {1006A22CE3}&gt;
</pre>
</div>
<p>
Short and to the point. For a slightly different format you can use any of the following:
</p>
<div class="org-src-container">
<pre class="src src-lisp">(<span class="org-keyword">with-summary</span> ()
  (run-tests <span class="org-builtin">:tests</span> '(t1)))

(print-summary
 (run-tests <span class="org-builtin">:tests</span> '(t1)))

(run-tests <span class="org-builtin">:run-contexts</span> #'with-summary-context <span class="org-builtin">:tests</span> '(t1))
</pre>
</div>
<p>
Both will provide something like the following:
</p>
<div class="org-src-container">
<pre class="src src-lisp">TF-LISP-UNIT2::T1 - PASSED (0.01s) : 6 assertions passed

Test Summary for <span class="org-builtin">:TF-LISP-UNIT2</span> (1 tests 0.01 sec)
  | 8 assertions total
  | 8 passed
  | 0 failed
  | 0 execution errors
  | 0 warnings
  | 0 empty
  | 0 missing tests
#&lt;TEST-RESULTS-DB Tests:(1) Passed:(8) Failed:(0) Errors:(0) Warnings:(0) {1006E6EE53}&gt;
</pre>
</div>
<p>
Now with a basic failing test. This time we will give the test a description string and first assertion gets a diagnostic string and the variables in question.
</p>
<div class="org-src-container">
<pre class="src src-lisp">(<span class="org-keyword">define-test</span> t1-fail
                   (<span class="org-builtin">:tags</span> '(tf-basic))
  <span class="org-string">"describe t1-fail"</span>
  (<span class="org-keyword">let</span> ((x 1))
  (<span class="org-warning">assert-true</span> (= x 2) )
  (<span class="org-warning">assert-equal</span> x 3)
  (<span class="org-warning">assert-error</span> 'division-by-zero
                (<span class="org-warning">error</span> 'floating-point-overflow)
                <span class="org-string">"testing condition assertions"</span>)
  (<span class="org-warning">assert-true</span> (logically-equal t nil)) <span class="org-comment">; both true or both false</span>
  (<span class="org-warning">assert-true</span> (logically-equal nil t))))
</pre>
</div>
<p>
Now if we simply run the basic test, we get thrown into the debugger on the error assertion. If we hit continue, we are handed a <code>test-results-db</code> object. Why did we get thrown into the debugger rather than just fail? Because the variable <code>*debugger-hook*</code> is set by default to #&lt;FUNCTION SWANK:SWANK-DEBUGGER-HOOK&gt;. If you want to stay out of interactive debugging when errors get thrown, set <code>*debugger-hook*</code> to nil.
</p>
<pre class="example">
(run-tests :tests '(t1-fail))
#&lt;TEST-RESULTS-DB Tests:(1) Passed:(0) Failed:(2) Errors:(1) Warnings:(0) {10063359D3}&gt;
</pre>
<p>
If we use the print-summary wrapper, we still get through into the debugger on the error assertion, but assuming we hit continue, we get the report below and a <code>test-results-db</code> object.
</p>
<pre class="example">
(print-summary (run-tests :tests '(t1-fail)))
TF-LISP-UNIT2::T1-FAIL - ERRORS (5.33s) : 0 assertions passed
  | ERRORS (1)
  | ERROR: arithmetic error FLOATING-POINT-OVERFLOW signalled
  | #&lt;FLOATING-POINT-OVERFLOW {100619DEE3}&gt;
  |
  | FAILED (2)
  | Failed Form: (ASSERT-TRUE (= X 2)
  |                           "deliberate failure here because we know ~a is not equal to ~a"
  |                           X 2)
  | Expected T
  | but saw NIL
  | "deliberate failure here because we know ~a is not equal to ~a"
  | X =&gt; 1
  | 2
  | Failed Form: (ASSERT-EQUAL X 3)
  | Expected 1
  | but saw 3
  |
  |
Test Summary for :TF-LISP-UNIT2 (1 tests 5.33 sec)
  | 2 assertions total
  | 0 passed
  | 2 failed
  | 1 execution errors
  | 0 warnings
  | 0 empty
  | 0 missing tests
#&lt;TEST-RESULTS-DB Tests:(1) Passed:(0) Failed:(2) Errors:(1) Warnings:(0) {1005F7D0E3}&gt;
</pre>
<p>
You do not have to manually recompile a test after a tested function has been modified.
</p>
</div>
</li>
<li><a id="org12ec78c"></a>Edge Cases: Value Expressions, loops. closures and calling other tests<br>
<ol class="org-ol">
<li><a id="orgb083bbf"></a>Value expressions<br>
<div class="outline-text-5" id="text-23-3-3-1">
<p>
Unlike almost all the other frameworks Lisp-unit and Lisp-unit2 actually look at all the values in the values expressions:
</p>
<div class="org-src-container">
<pre class="src src-lisp">(<span class="org-keyword">define-test</span> t2-values-expressions
  (<span class="org-builtin">:tags</span> '(tf-multiple))
  (<span class="org-warning">assert-equal</span> (values 1 2) (values 1 2 3))
  (<span class="org-warning">assert-equal</span> (values 1 2) (values 1 3))
  (<span class="org-warning">assert-equal</span> (values 1 2 3) (values 1 3 2)))
#&lt;FUNCTION T2-VALUES-EXPRESSIONS&gt;
LISP-UNIT2&gt; (print-summary (run-tests <span class="org-builtin">:tests</span> '(t2-values-expressions)))
LISP-UNIT2::T2-VALUES-EXPRESSIONS - FAILED (0.00s) : 1 assertions passed
  | FAILED (2)
  | Failed Form: (<span class="org-warning">ASSERT-EQUAL</span> (VALUES 1 2) (VALUES 1 3))
  | Expected 1; 2
  | but saw 1<span class="org-comment">; 3</span>
  | Failed Form: (<span class="org-warning">ASSERT-EQUAL</span> (VALUES 1 2 3) (VALUES 1 3 2))
  | Expected 1<span class="org-comment">; 2; 3</span>
  | but saw 1; 3; 2
  |
  |
Test Summary for <span class="org-builtin">:LISP-UNIT2</span> (1 tests 0.00 sec)
  | 3 assertions total
  | 1 passed
  | 2 failed
  | 0 execution errors
  | 0 warnings
  | 0 empty
  | 0 missing tests
#&lt;TEST-RESULTS-DB Tests:(1) Passed:(1) Failed:(2) Errors:(0) Warnings:(0) {10263B53C3}&gt;
</pre>
</div>
</div>
</li>
<li><a id="orgc2d2aa0"></a>Closures.<br>
<div class="outline-text-5" id="text-23-3-3-2">
<p>
Lisp-Unit2 will not see variables declared in a closure encompassing the test.The following will throw an error and drop you into the debugger.
</p>
<div class="org-src-container">
<pre class="src src-lisp">(<span class="org-keyword">let</span> ((l1 '(#\a #\B #\z))
      (l2 '(97 66 122)))
  (<span class="org-keyword">define-test</span> t2-loop-closure
    (<span class="org-builtin">:tags</span> '(tf-multiple tf-basic))
  (<span class="org-keyword">loop</span> for x in l1 for y in l2 do
    (<span class="org-warning">assert-equal</span> (char-code x) y))))
</pre>
</div>
</div>
</li>

<li><a id="orge12cf6b"></a>Calling another test from a test<br>
<div class="outline-text-5" id="text-23-3-3-3">
<p>
Since we know that tests are functions in lisp-unit2, we can just have test t3 call test t2 directly rather than indirectly running through the RUN-TESTS function.
</p>
<div class="org-src-container">
<pre class="src src-lisp">(<span class="org-keyword">define-test</span> t3 <span class="org-comment">; a test that tries to call another test in its body</span>
    (<span class="org-builtin">:tags</span> '(tf-calling-other-tests))
          (<span class="org-warning">assert-equal</span> 'a 'a)
          (t2))

(print-summary (run-tests <span class="org-builtin">:tests</span> '(t3)))
LISP-UNIT2-EXAMPLES::T3 - FAILED (0.00s) : 2 assertions passed
  | FAILED (2)
  | Failed Form: (<span class="org-warning">ASSERT-EQUAL</span> 1 2)
  | Expected 1
  | but saw 2
  | Failed Form: (<span class="org-warning">ASSERT-EQUAL</span> 2 3)
  | Expected 2
  | but saw 3
  |
  Test Summary for <span class="org-builtin">:LISP-UNIT2-EXAMPLES</span> (1 tests 0.00 sec)
  | 4 assertions total
  | 2 passed
  | 2 failed
  | 0 execution errors
  | 0 warnings
  | 0 empty
  | 0 missing tests
#&lt;TEST-RESULTS-DB Tests:(1) Passed:(2) Failed:(2) Errors:(0) Warnings:(0) {1009F73183}&gt;
</pre>
</div>
<p>
Unlike lisp-unit, everything works as expected and we actually got composed results.
</p>
</div>
</li>
</ol>
</li>

<li><a id="orgb193f1b"></a>Suites, Tags, Packages and other multiple test abilities<br>
<div class="outline-text-4" id="text-23-3-4">
<p>
If <code>run-tests</code> is called without any keyword parameters, it will run all the tests in the current package. It accepts keyword parameters for :tests, :tags and :package.
</p>
<div class="org-src-container">
<pre class="src src-lisp">(lisp-unit2:run-tests <span class="org-type">&amp;key</span> tests tags package reintern-package)
</pre>
</div>
</div>
<ol class="org-ol">
<li><a id="orgfe0de9d"></a>Lists of tests<br>
<div class="outline-text-5" id="text-23-3-4-1">
<p>
As previously stated, Lisp-unit2 can run lists of tests.
</p>
<div class="org-src-container">
<pre class="src src-lisp">(run-tests <span class="org-builtin">:tests</span>  '(t1 t2))
</pre>
</div>
</div>
</li>
<li><a id="org889c011"></a>Tags<br>
<div class="outline-text-5" id="text-23-3-4-2">
<p>
As you would expect, you can run all the tests having a specific tag. In the following example we wrap <code>run-tests</code> in a call to <code>print-summary</code> in order to get useful results:
</p>
<div class="org-src-container">
<pre class="src src-lisp">(print-summary (run-tests <span class="org-builtin">:tags</span> '(tf-basic)))
</pre>
</div>
<div class="org-src-container">
<pre class="src src-lisp">(<span class="org-keyword">with-summary</span> ()
              (t1-fail)) <span class="org-comment-delimiter">;; </span><span class="org-comment">here we just call t1 as a function. We need WITH-SUMMARY or PRINT-SUMMARY to get results printed</span>

Starting: LISP-UNIT2::T1-FAIL
LISP-UNIT2::T1-FAIL - FAILED (0.00s) : 0 assertions passed
  | FAILED (1)
  | Failed Form: (<span class="org-warning">ASSERT-EQL</span> 1 2)
  | Expected 1
  | but saw 2
  |
</pre>
</div>
<p>
Tags can be listed using LIST-TAGS.
</p>
</div>
</li>
</ol>
</li>
<li><a id="org7c3fffa"></a>Fixtures and Contexts<br>
<div class="outline-text-4" id="text-23-3-5">
<p>
What we have been referring to as fixtures is called contexts in Lisp-Unit2.
</p>
</div>
</li>
<li><a id="org93f5602"></a>Writing Summary to file<br>
<div class="outline-text-4" id="text-23-3-6">
<p>
The (write-tap-to-file) macro takes input that will generate a report and writes it to a file in TAP format.
</p>

<p>
We show the results in the TAP format for the successful t1 test and the deliberately failing t1-fail test.
</p>
<div class="org-src-container">
<pre class="src src-lisp">(write-tap-to-file (run-tests <span class="org-builtin">:tests</span> 't1) #P <span class="org-string">"/tmp/lisp-unit2.tap"</span>)

cat /tmp/lisp-unit2.tap
TAP version 13
1..1
ok 1 LISP-UNIT2::T1 (0.00 s)

(write-tap-to-file (run-tests <span class="org-builtin">:tests</span> 't1-fail) #P <span class="org-string">"/tmp/lisp-unit2.tap"</span>)

cat /tmp/lisp-unit2.tap
TAP version 13
1..1
not ok 1 LISP-UNIT2::T1-FAIL (0.00 s)
    ---
     # FAILED (1)
     # Failed Form: (<span class="org-warning">ASSERT-EQL</span> 1 2)
     # Expected 1
     # but saw 2
     #
     #
    ...
</pre>
</div>
<p>
Or we can wrap a (with-open-file macro targetting lisp-unit2::*test-stream* to write any of the other formats to file.
</p>
<div class="org-src-container">
<pre class="src src-lisp">(<span class="org-keyword">with-open-file</span> (*test-stream* #P <span class="org-string">"/tmp/lisp-unit2.summary"</span>  <span class="org-builtin">:direction</span> <span class="org-builtin">:output</span>
                                               <span class="org-builtin">:if-exists</span> <span class="org-builtin">:supersede</span>
                                               <span class="org-builtin">:external-format</span> <span class="org-builtin">:utf-8</span>
                                               <span class="org-builtin">:element-type</span> <span class="org-builtin">:default</span>)
  (print-summary (run-tests <span class="org-builtin">:tests</span> 't1-fail)))

cat /tmp/lisp-unit2.summary
LISP-UNIT2::T1-FAIL - FAILED (0.00s) : 0 assertions passed
  | FAILED (1)
  | Failed Form: (<span class="org-warning">ASSERT-EQL</span> 1 2)
  | Expected 1
  | but saw 2
  |
  |
Test Summary for <span class="org-builtin">:LISP-UNIT2</span> (1 tests 0.00 sec)
  | 1 assertions total
  | 0 passed
  | 1 failed
  | 0 execution errors
  | 0 warnings
  | 0 empty
  | 0 missing tests
</pre>
</div>

<p>
<a href="#org63aa282">No description for this link</a>
</p>
</div>

<ol class="org-ol">
<li><a id="org81f0e0f"></a>Fixtures and Freezing Data<br>
<div class="outline-text-6" id="text-23-3-6-0-1">
<p>
Lisp-unit2 refers to fixtures as "context". The following is an example from the source files of how to build up a context that can be used in a test.
</p>
<div class="org-src-container">
<pre class="src src-lisp">(<span class="org-keyword">defun</span> <span class="org-function-name">meta-test-context</span> (body-fn)
  (<span class="org-keyword">let</span> ((lisp-unit2::*test-db* *example-db*)
        *debugger-hook*
        (lisp-unit2::*test-stream* (make-broadcast-stream)))
    (<span class="org-keyword">handler-bind</span>
        ((warning #'muffle-warning))
      (funcall body-fn))))

(<span class="org-keyword">defmacro</span> <span class="org-function-name">with-meta-test-context</span> (() <span class="org-type">&amp;body</span> body)
  `(meta-test-context
    (<span class="org-keyword">lambda</span> () ,@body)))

(<span class="org-keyword">define-test</span> test-with-test-results (<span class="org-builtin">:tags</span> '(meta-tests)
                                     <span class="org-builtin">:contexts</span> #'meta-test-context)
  (<span class="org-keyword">let</span> ( results )
    (<span class="org-keyword">lisp-unit2:with-test-signals-muffled</span> ()
      (<span class="org-keyword">lisp-unit2:with-test-results</span> (<span class="org-builtin">:collection-place</span> results)
        (lisp-unit2:run-tests <span class="org-builtin">:tags</span> 'warnings)
        (lisp-unit2:run-tests <span class="org-builtin">:tags</span> 'examples)))
    <span class="org-comment-delimiter">;; </span><span class="org-comment">subtract-integer-test calls run-tests</span>
    (<span class="org-warning">assert-eql</span> 3 (len results))
    (<span class="org-warning">assert-typep</span> 'lisp-unit2::test-results-db (first results))))
</pre>
</div>
</div>
</li>
</ol>
</li>

<li><a id="orgc4f4ea1"></a>Removing tests<br>
<div class="outline-text-4" id="text-23-3-7">
<p>
Lisp-unit2 has a <code>uninstall-test</code> function and a <code>undefine-test</code> macro.
</p>
</div>
</li>
<li><a id="orgd5cd48a"></a>Sequencing, Random and Failure Only<br>
<div class="outline-text-4" id="text-23-3-8">
<p>
Tests are run in sequential order. There does not appear to be provision for only running the tests that failed last time.
</p>
</div>
</li>
<li><a id="org8b36ce6"></a>Skip Capability<br>
<div class="outline-text-4" id="text-23-3-9">
<p>
None noted
</p>
</div>
</li>
<li><a id="org914fa61"></a>Random Data Generators<br>
<div class="outline-text-4" id="text-23-3-10">
<p>
Lisp-unit2 has various functions for generating random data. See examples below:
</p>
<div class="org-src-container">
<pre class="src src-lisp">(complex-random #C(5 3))
#C(4 1)

(make-random-2d-array 2 3)
#2A((0.03395796 0.55509293 0.34209597) (0.5823394 0.8771157 0.29430425))

(make-random-2d-list 2 3)
((0.18096626 0.916595 0.88126934) (0.45945048 0.8838378 0.57314146))

(make-random-list 3)
(0.5449568 0.32319236 0.7780224)

(make-random-state)
#S(RANDOM-STATE <span class="org-builtin">:STATE</span> #.(MAKE-ARRAY 627 <span class="org-builtin">:ELEMENT-TYPE</span> '(UNSIGNED-BYTE 32)
                                     <span class="org-builtin">:INITIAL-CONTENTS</span>
                                     '(0 2567483615 454 2531281407 4203062579
                                       3352536227 284404050 622556438
                                       ...)))
</pre>
</div>
</div>
</li>
</ol>
</div>

<div id="outline-container-orgb369304" class="outline-3">
<h3 id="orgb369304"><span class="section-number-3">23.4.</span> Discussion</h3>
<div class="outline-text-3" id="text-23-4">
<p>
Hmm. My CCL version 1.12 LinuxX8664 decided not to compile Lisp-Unit2 with the following error:
</p>
<div class="org-src-container">
<pre class="src src-lisp">Read error between positions 2071 and 2506 in /home/sabra/quicklisp/dists/quicklisp/software/lisp-unit2-20180131-git/interop.lisp.
&gt; Error: Reader error: No external symbol named <span class="org-string">"*SYSTEMS-BEING-OPERATED*"</span> in package #&lt;Package <span class="org-string">"ASDF/OPERATE"</span>&gt; .
&gt; While executing: CCL::%PARSE-TOKEN, in process listener(1).
</pre>
</div>
<p>
<a href="#org63aa282">top</a>
</p>
</div>
</div>
<div id="outline-container-orgcad40fa" class="outline-3">
<h3 id="orgcad40fa"><span class="section-number-3">23.5.</span> Who Uses Lift-Unit2</h3>
<div class="outline-text-3" id="text-23-5">
<p>
Many libraries on quicklisp use Lisp-Unit2. If you have quicklisp, you can get a list of those with:
</p>
<div class="org-src-container">
<pre class="src src-lisp">(ql:who-depends-on <span class="org-builtin">:lisp-unit2</span>)
</pre>
</div>

<p>
<a href="#org63aa282">top</a>
<a id="orga8cfe0a"></a>
</p>
</div>
</div>
</div>
<div id="outline-container-org4763117" class="outline-2">
<h2 id="org4763117"><span class="section-number-2">24.</span> nst</h2>
<div class="outline-text-2" id="text-24">
</div>
<div id="outline-container-org1092b9d" class="outline-3">
<h3 id="org1092b9d"><span class="section-number-3">24.1.</span> Summary</h3>
<div class="outline-text-3" id="text-24-1">
<table>


<colgroup>
<col  class="org-left">

<col  class="org-left">

<col  class="org-left">

<col  class="org-right">
</colgroup>
<tbody>
<tr>
<td class="org-left"><a href="https://github.com/jphmrst/cl-nst">homepage</a></td>
<td class="org-left">John Maraist</td>
<td class="org-left">LLGPL3 latest</td>
<td class="org-right">2021</td>
</tr>
</tbody>
</table>
<p>
You get a sense of what NST is focused on when the README starts with fixtures and states that the criterion testing has its own DSL.
</p>

<p>
This focus on fixtures is further reinforced by the definition of a test (what I have been calling an assertion in the context of the other frameworks).:
</p>
<div class="org-src-container">
<pre class="src src-lisp">(def-test NAME ( [ <span class="org-builtin">:group</span> GROUP-NAME ]
                  [ <span class="org-builtin">:setup</span> FORM ]
                  [ <span class="org-builtin">:cleanup</span> FORM ]
                  [ <span class="org-builtin">:startup</span> FORM ]
                  [ <span class="org-builtin">:finish</span> FORM ]
                  [ <span class="org-builtin">:fixtures</span> (FIXTURE FIXTURE ... FIXTURE) ]
                  [ <span class="org-builtin">:aspirational</span> FLAG ]
                  [ <span class="org-builtin">:documentation</span> STRING ] )
    criterion
 FORM ... FORM)
</pre>
</div>
<p>
Obviously this is a framework intended for complexity. That brings two problems. The first is the learning curve for the DSL. The second is the overhead that the infrastructure brings with it. Look at the <a href="#orgaa2c5e2">stacked-ranking-benchmarks</a>. It is almost as bad as clunit in runtime and multiple orders of magnitude worse than anything is bytes consed and eval-calls.
</p>

<p>
If you do not require the ability to handle serious complexity in your tests, look elsewhere.
</p>
</div>
</div>

<div id="outline-container-org7b86e1f" class="outline-3">
<h3 id="org7b86e1f"><span class="section-number-3">24.2.</span> Assertion Functions</h3>
<div class="outline-text-3" id="text-24-2">
<table>


<colgroup>
<col  class="org-left">

<col  class="org-left">

<col  class="org-left">
</colgroup>
<tbody>
<tr>
<td class="org-left">assert-criterion</td>
<td class="org-left">assert-eq</td>
<td class="org-left">assert-eql</td>
</tr>

<tr>
<td class="org-left">assert-equal</td>
<td class="org-left">assert-equalp</td>
<td class="org-left">assert-non-nil</td>
</tr>

<tr>
<td class="org-left">assert-not-eq</td>
<td class="org-left">assert-not-eql</td>
<td class="org-left">assert-not-equal</td>
</tr>

<tr>
<td class="org-left">assert-not-equalp</td>
<td class="org-left">assert-null</td>
<td class="org-left">assert-zero</td>
</tr>
</tbody>
</table>

<p>
<a href="#org63aa282">top</a>
</p>
</div>
</div>
<div id="outline-container-org13bd9a4" class="outline-3">
<h3 id="org13bd9a4"><span class="section-number-3">24.3.</span> Usage</h3>
<div class="outline-text-3" id="text-24-3">
<p>
First some terminology. What I have been referring to as assertions, NST refers to as a test. What I have been referring to as a test, NST refers to as a test-group.
</p>

<p>
Second, NST has its own DSL that you need to understand in order to use it. It can obviously handle complex systems, but that comes at a learning curve cost and some things that I find easy in CL I do not find as easy in NST's criterion language (probably speaks to my limitations).
</p>
</div>

<ol class="org-ol">
<li><a id="org0d0321a"></a>Report Format<br>
<div class="outline-text-4" id="text-24-3-1">
<p>
The level of detail from reports is dependent on the verbosity setting. Valid commands are:
</p>
<div class="org-src-container">
<pre class="src src-lisp">(nst-cmd <span class="org-builtin">:set</span> <span class="org-builtin">:verbose</span> <span class="org-builtin">:silent</span>)
(nst-cmd <span class="org-builtin">:set</span> <span class="org-builtin">:verbose</span> <span class="org-builtin">:quiet</span>)
(nst-cmd <span class="org-builtin">:set</span> <span class="org-builtin">:verbose</span> <span class="org-builtin">:verbose</span>)
(nst-cmd <span class="org-builtin">:set</span> <span class="org-builtin">:verbose</span> <span class="org-builtin">:vverbose</span>)
(nst-cmd <span class="org-builtin">:set</span> <span class="org-builtin">:verbose</span> <span class="org-builtin">:trace</span>)
</pre>
</div>
<p>
You can get a little more detail using the :detail parameter.
</p>
<div class="org-src-container">
<pre class="src src-lisp">(nst-cmd <span class="org-builtin">:detail</span> [blank, package-name, group-name, or group-name *and* test-tname])
</pre>
</div>
<p>
To switch to interactive debug behavior the following commands are necessary:
</p>
<div class="org-src-container">
<pre class="src src-lisp">(nst-cmd <span class="org-builtin">:debug-on-error</span> t)
(nst-cmd <span class="org-builtin">:debug-on-fail</span> t)

(nst-cmd <span class="org-builtin">:debug</span>) <span class="org-comment-delimiter">;; </span><span class="org-comment">will set both to t</span>
</pre>
</div>
<p>
The README contains the following warning: "This behavior is less useful than it may seem; by the time the results of the test are examined for failure, the stack from the actual form evaluation will usually have been released. Still, this switch is useful for inspecting the environment in which a failing test was run."
</p>

<p>
We will show the different reporting levels with the first two groups of examples.
</p>
</div>
</li>
<li><a id="org732219e"></a>Basics<br>
<div class="outline-text-4" id="text-24-3-2">
<p>
NST requires that you have groups defined and each test must belong to a group. If you are defining the tests within the definition of a group, you do not need to specify the group. The empty form after the group name in the following example is used for fixtures
</p>
</div>
<ol class="org-ol">
<li><a id="org8c91260"></a>All Passing Basic Test<br>
<div class="outline-text-5" id="text-24-3-2-1">
<div class="org-src-container">
<pre class="src src-lisp">(def-test-group tf-basic-pass ()
  (def-test t1-1
    <span class="org-builtin">:true</span> (= 1 1))
  (def-test t1-2
    <span class="org-builtin">:true</span> (not (= 1 2)))
  (def-test t1-3
      (<span class="org-builtin">:eq</span> 'a) 'a)
  (def-test t1-4
    <span class="org-builtin">:forms-eq</span> (cadr '(a b c))
    (caddr '(a c b)))
  (def-test t1-5
      (<span class="org-builtin">:err</span> <span class="org-builtin">:type</span> division-by-zero)
    (<span class="org-warning">error</span> 'division-by-zero)))
</pre>
</div>
<p>
Now you need to run a mini command line to run tests and get a report. We will go from least verbose to most verbose.
</p>
</div>
<ol class="org-ol">
<li><a id="org76f3b12"></a>Silent<br>
<div class="outline-text-6" id="text-24-3-2-1-1">
<div class="org-src-container">
<pre class="src src-lisp">(nst-cmd <span class="org-builtin">:set</span> <span class="org-builtin">:verbose</span> <span class="org-builtin">:silent</span>)

(nst-cmd <span class="org-builtin">:run</span> tf-basic-pass)
Running group TF-BASIC-PASS
Group TF-BASIC-PASS: 5 of 5 passed
TOTAL: 5 of 5 passed (0 failed, 0 errors, 0 warnings)
(nst-cmd <span class="org-builtin">:run</span> t1)
Check T1 (group TF-BASIC) passed
TOTAL: 1 of 1 passed (0 failed, 0 errors, 0 warnings)
</pre>
</div>
</div>
</li>
<li><a id="org8907be1"></a>Quiet<br>
<div class="outline-text-6" id="text-24-3-2-1-2">
<div class="org-src-container">
<pre class="src src-lisp">(nst-cmd <span class="org-builtin">:set</span> <span class="org-builtin">:verbose</span> <span class="org-builtin">:quiet</span>)

(nst-cmd <span class="org-builtin">:run</span> tf-basic-pass)
Running group TF-BASIC-PASS
- Executing test T1-1
Check T1-1 (group TF-BASIC-PASS) passed.
- Executing test T1-2
Check T1-2 (group TF-BASIC-PASS) passed.
- Executing test T1-3
Check T1-3 (group TF-BASIC-PASS) passed.
- Executing test T1-4
Check T1-4 (group TF-BASIC-PASS) passed.
- Executing test T1-5
Check T1-5 (group TF-BASIC-PASS) passed.
Group TF-BASIC-PASS: 5 of 5 passed
TOTAL: 5 of 5 passed (0 failed, 0 errors, 0 warnings)
</pre>
</div>
</div>
</li>
<li><a id="orgb3a8308"></a>VVerbose (verbose is generally the same as quiet)<br>
<div class="outline-text-6" id="text-24-3-2-1-3">
<div class="org-src-container">
<pre class="src src-lisp">(nst-cmd <span class="org-builtin">:set</span> <span class="org-builtin">:verbose</span> <span class="org-builtin">:vverbose</span>)
(nst-cmd <span class="org-builtin">:run</span> tf-basic-pass)
Running group TF-BASIC-PASS
Starting run loop for #S(NST::GROUP-RECORD
                         <span class="org-builtin">:NAME</span> TF-BASIC-PASS
                         <span class="org-builtin">:ANON-FIXTURE-FORMS</span> NIL
                         <span class="org-builtin">:ASPIRATIONAL</span> NIL
                         <span class="org-builtin">:GIVEN-FIXTURES</span> NIL
                         <span class="org-builtin">:DOCUMENTATION</span> NIL
                         <span class="org-builtin">:TESTS</span> #&lt;HASH-TABLE <span class="org-builtin">:TEST</span> EQ <span class="org-builtin">:COUNT</span> 5 {1008848E43}&gt;
                         <span class="org-builtin">:FIXTURES-SETUP-THUNK</span> NIL
                         <span class="org-builtin">:FIXTURES-CLEANUP-THUNK</span> NIL
                         <span class="org-builtin">:WITHFIXTURES-SETUP-THUNK</span> NIL
                         <span class="org-builtin">:WITHFIXTURES-CLEANUP-THUNK</span> NIL
                         <span class="org-builtin">:EACHTEST-SETUP-THUNK</span> NIL
                         <span class="org-builtin">:EACHTEST-CLEANUP-THUNK</span> NIL
                         <span class="org-builtin">:INCLUDE-GROUPS</span> NIL)
- Executing test T1-1
Applying criterion <span class="org-builtin">:TRUE</span>
to (MULTIPLE-VALUE-LIST (= 1 1))
Result at <span class="org-builtin">:TRUE</span> is Check T1-1 (group TF-BASIC-PASS) passed.
Check T1-1 (group TF-BASIC-PASS) passed.
- Executing test T1-2
Applying criterion <span class="org-builtin">:TRUE</span>
to (MULTIPLE-VALUE-LIST (NOT (= 1 2)))
Result at <span class="org-builtin">:TRUE</span> is Check T1-2 (group TF-BASIC-PASS) passed.
Check T1-2 (group TF-BASIC-PASS) passed.
- Executing test T1-3
Applying criterion <span class="org-builtin">:EQ</span> 'A
to (MULTIPLE-VALUE-LIST 'A)
Result at <span class="org-builtin">:EQ</span> is Check T1-3 (group TF-BASIC-PASS) passed.
Check T1-3 (group TF-BASIC-PASS) passed.
- Executing test T1-4
Applying criterion <span class="org-builtin">:FORMS-EQ</span>
to (LIST (CADR '(A B C)) (CADDR '(A C B)))
Applying criterion <span class="org-builtin">:PREDICATE</span> EQ
to (LIST (CADR '(A B C)) (CADDR '(A C B)))
Result at <span class="org-builtin">:PREDICATE</span> is Check T1-4 (group TF-BASIC-PASS) passed.
Result at <span class="org-builtin">:FORMS-EQ</span> is Check T1-4 (group TF-BASIC-PASS) passed.
Check T1-4 (group TF-BASIC-PASS) passed.
- Executing test T1-5
Applying criterion <span class="org-builtin">:ERR</span> <span class="org-builtin">:TYPE</span> DIVISION-BY-ZERO
to (MULTIPLE-VALUE-LIST (<span class="org-warning">ERROR</span> 'DIVISION-BY-ZERO))
Result at <span class="org-builtin">:ERR</span> is Check T1-5 (group TF-BASIC-PASS) passed.
Check T1-5 (group TF-BASIC-PASS) passed.
Group TF-BASIC-PASS: 5 of 5 passed
TOTAL: 5 of 5 passed (0 failed, 0 errors, 0 warnings)
</pre>
</div>
</div>
</li>
</ol>
</li>
<li><a id="org41db401"></a>All Failing Basic Test<br>
<div class="outline-text-5" id="text-24-3-2-2">
<p>
Now a test where everything fails or creates an error. This time we define the test-group separately, then each test separately. As a result we will need to define the group in the test definition. You can insert a <code>:documentation string</code> into a test but it only gets printed at the vverbose level of verbosity.
</p>
<div class="org-src-container">
<pre class="src src-lisp">(def-test-group tf-basic-fail ())

(def-test (t1-1 <span class="org-builtin">:group</span> tf-basic-fail)
  <span class="org-builtin">:true</span> (= 1 2))
(def-test (t1-2 <span class="org-builtin">:group</span> tf-basic-fail)
  <span class="org-builtin">:true</span> (not (= 2 2)))
(def-test (t1-3 <span class="org-builtin">:group</span> tf-basic-fail)
    (<span class="org-builtin">:eq</span> 'a) 'b)
(def-test (t1-4 <span class="org-builtin">:group</span> tf-basic-fail)
  <span class="org-builtin">:forms-eq</span> (cadr '(a d c))
  (caddr '(a c b)))
(def-test (t1-5 <span class="org-builtin">:group</span> tf-basic-fail)
    (<span class="org-builtin">:err</span> <span class="org-builtin">:type</span> division-by-zero)
  (<span class="org-warning">error</span> 'floating-point-overflow))
</pre>
</div>
<p>
Again, going from least verbose to most verbose.
</p>
</div>
<ol class="org-ol">
<li><a id="orga0ef205"></a>Silent<br>
<div class="outline-text-6" id="text-24-3-2-2-1">
<div class="org-src-container">
<pre class="src src-lisp">(nst-cmd <span class="org-builtin">:set</span> <span class="org-builtin">:verbose</span> <span class="org-builtin">:silent</span>)

(nst-cmd <span class="org-builtin">:run</span> tf-basic-fail)
Running group TF-BASIC-FAIL
Group TF-BASIC-FAIL: 0 of 5 passed
- Check T1-1 failed
- Expected non-null, got: NIL
- Check T1-2 failed
- Expected non-null, got: NIL
- Check T1-3 failed
- Value B not eq to value of A
- Check T1-4 failed
- Predicate EQ fails for (D B)
- Check T1-5 raised an error
TOTAL: 0 of 5 passed (4 failed, 1 error, 0 warnings)
</pre>
</div>
</div>
</li>
<li><a id="org67c1b4d"></a>Quiet<br>
<div class="outline-text-6" id="text-24-3-2-2-2">
<div class="org-src-container">
<pre class="src src-lisp">(nst-cmd <span class="org-builtin">:set</span> <span class="org-builtin">:verbose</span> <span class="org-builtin">:quiet</span>)

(nst-cmd <span class="org-builtin">:run</span> tf-basic-fail)
Running group TF-BASIC-FAIL
- Executing test T1-1
Check T1-1 (group TF-BASIC-FAIL) failed
- Expected non-null, got: NIL
- Executing test T1-2
Check T1-2 (group TF-BASIC-FAIL) failed
- Expected non-null, got: NIL
- Executing test T1-3
Check T1-3 (group TF-BASIC-FAIL) failed
- Value B not eq to value of A
- Executing test T1-4
Check T1-4 (group TF-BASIC-FAIL) failed
- Predicate EQ fails for (D B)
- Executing test T1-5
Check T1-5 (group TF-BASIC-FAIL) raised an error
Group TF-BASIC-FAIL: 0 of 5 passed
- Check T1-1 failed
- Expected non-null, got: NIL
- Check T1-2 failed
- Expected non-null, got: NIL
- Check T1-3 failed
- Value B not eq to value of A
- Check T1-4 failed
- Predicate EQ fails for (D B)
- Check T1-5 raised an error
TOTAL: 0 of 5 passed (4 failed, 1 error, 0 warnings)
</pre>
</div>
<p>
For the sake of brevity, we will skip verbose and vverbose and trace. You get the picture.
</p>
</div>
</li>
</ol>
</li>
</ol>
</li>

<li><a id="orgba01cdf"></a>Edge Cases: Value expressions, loops, closures and calling other tests<br>
<ol class="org-ol">
<li><a id="org582ce58"></a>Value expressions<br>
<div class="outline-text-5" id="text-24-3-3-1">
<p>
NST has a values criterion that looks at the results coming from a values expression individually. Otherwise it will only look at the first value. The following two versions pass.
</p>
<div class="org-src-container">
<pre class="src src-lisp">(def-test-group tf-basic-values ()
  (def-test (t1-1 <span class="org-builtin">:group</span> tf-basic-values)
      (<span class="org-builtin">:equalp</span> (values 1 2)) 1)

  (def-test (t1-2 <span class="org-builtin">:group</span> tf-basic-values)
      (<span class="org-builtin">:values</span> (<span class="org-builtin">:eql</span> 1) (<span class="org-builtin">:eql</span> 2)) (values 1 2)))
</pre>
</div>
</div>
</li>
<li><a id="org3bf192f"></a>Looping and closures.<br>
<div class="outline-text-5" id="text-24-3-3-2">
<p>
NST does not have a loop construct. What it does have is <code>:each</code>, which takes an optional item and a comparision test and applies it to a list. In the following examples, we
</p>
<div class="org-src-container">
<pre class="src src-lisp">(def-test-group tf-basic-each ())

(def-test (each1 <span class="org-builtin">:group</span> tf-basic-each)
    (<span class="org-builtin">:each</span> (<span class="org-builtin">:symbol</span> a))
  '(a a a a a))

(def-test (each2 <span class="org-builtin">:group</span> tf-basic-each)
    (<span class="org-builtin">:each</span> (<span class="org-builtin">:apply</span> write-to-string (<span class="org-builtin">:equal</span> <span class="org-string">"A"</span>)))
  '(a a a a a))
</pre>
</div>
<p>
Like the clunits and lisp-units, nst does not look for variables in a closure surrounding the test defintion. The following will not work.
</p>
<div class="org-src-container">
<pre class="src src-lisp">(<span class="org-keyword">let</span> ((lst '(a a a a a)))
  (def-test (each3 <span class="org-builtin">:group</span> tf-basic-each)
      (<span class="org-builtin">:each</span> (<span class="org-builtin">:apply</span> write-to-string (<span class="org-builtin">:equal</span> <span class="org-string">"A"</span>)))
    lst))
</pre>
</div>
<p>
When I tried calling other tests from inside an NST test, I triggered stack exhaustion errors. So probably do not do that.
</p>
</div>
</li>
</ol>
</li>
<li><a id="org6d793dc"></a>Suites, tags and other multiple test abilities<br>
<div class="outline-text-4" id="text-24-3-4">
<p>
You can define an <code>nst-package</code> which can contain <code>nst-groups</code> which can contain <code>nst-tests</code>. That seems to be the limit of nestability. So an <code>nst-package</code> is what I have been calling a suite when talking about other frameworks.
</p>

<p>
<a href="#org63aa282">top</a>
</p>
</div>
</li>
<li><a id="orgbdd70bd"></a>Fixtures and Freezing Data<br>
<div class="outline-text-4" id="text-24-3-5">
<p>
NST has fixtures. And fixtures. and&#x2026; The following is just a simple example, please look at the documentation for more details. First we define three groups of fixtures. We intend to use the first one at the test-group level (all tests in that group have access) and the next two at individual test level (just the tests specifying that will have access). We will pretend the first two groups have an expensive calculation that we want to cache to avoid doing the calculation every time the fixture is called. The empty form after the fixtures group name takes a lot of different options and you will have to read the documentation for that..
</p>
<div class="org-src-container">
<pre class="src src-lisp">(def-fixtures suite-fix-1 ()
  (sf1-a '(1 2 3 4))
  ((<span class="org-builtin">:cache</span> t) sf1-b (* 23 47)))

(def-fixtures test-fix-1 ()
  (tf1-a '(<span class="org-string">"a"</span> <span class="org-string">"b"</span> <span class="org-string">"c"</span> <span class="org-string">"d"</span>))
  ((<span class="org-builtin">:cache</span> t) tf1-b (- 2 1)))

(def-fixtures test-fix-2 ()
  (tf2-a <span class="org-string">"some boring string here"</span>))
</pre>
</div>
<p>
Now we define a test-group that uses those fixtures. In test t3, we do not need to call out the suite level fixture in the list of fixtures to be accessed by that test.
</p>
<div class="org-src-container">
<pre class="src src-lisp">(nst:def-test-group tf-nst-fix (suite-fix-1)
  (def-test (t1 <span class="org-builtin">:group</span> tf-nst-fix <span class="org-builtin">:fixtures</span> (test-fix-1))
      (<span class="org-builtin">:eql</span> b) 1)
  (def-test (t2 <span class="org-builtin">:group</span> tf-nst-fix <span class="org-builtin">:fixtures</span> (test-fix-1))
    (<span class="org-builtin">:each</span> (<span class="org-builtin">:apply</span> length (<span class="org-builtin">:equal</span> 1)))
    a)
  (def-test (t3 <span class="org-builtin">:group</span> tf-nst-fix <span class="org-builtin">:fixtures</span> (test-fix-1 test-fix-2))
     (<span class="org-builtin">:equal</span> <span class="org-string">"some boring string here-a1-1081"</span>)
     (format nil <span class="org-string">"~a-~a~a-~a"</span> tf2-a (first tf1-a) tf1-b sf1-a)))
</pre>
</div>
</div>
</li>
<li><a id="orgc4211db"></a>Removing tests<br>
<div class="outline-text-4" id="text-24-3-6">
<p>
I do not see a function for removing tests.
</p>
</div>
</li>
<li><a id="org777c212"></a>Sequencing, Random and Failure Only<br>
<div class="outline-text-4" id="text-24-3-7">
<p>
I did not see any shuffle functionality and the tests seem to run only in sequential order.
</p>

<p>
There is a <code>make-failure-report</code> function, but I did not see something that looked like the ability to rerun just failing tests.
</p>
</div>
</li>
<li><a id="orge60507a"></a>Skip Capability<br>
<div class="outline-text-4" id="text-24-3-8">
<p>
NST seems to offer skips only in the context of running interactively and letting a condition handler in the debugger ask you if you want to skip the test-group or remaining tests.
</p>
</div>
</li>
<li><a id="org2e3a334"></a>Random Data Generators<br>
<div class="outline-text-4" id="text-24-3-9">
<p>
NST has extensive random data generators. Please see the documentation for details.
</p>
</div>
</li>
</ol>
</div>
<div id="outline-container-org61b8a49" class="outline-3">
<h3 id="org61b8a49"><span class="section-number-3">24.4.</span> Discussion</h3>
<div class="outline-text-3" id="text-24-4">
<p>
We have already seen in the benchmarking session that either I am doing something wrong with NST or it's infrastructure overhead creates speed issues. It can obviously handle very complex systems. That comes, however, at the cost of having to learn a new DSL and I found the criterion learning curve much steeper than I expected.
</p>

<p>
Take something as simple as a list of characters and integers and validating that the integer is the char-code for the character. First a plain CL version. There are a lot of different ways to do this in CL using <code>every</code> or <code>loop</code> or <code>mapcar</code>. Below is just one of those ways.
</p>
<div class="org-src-container">
<pre class="src src-lisp">(<span class="org-keyword">defparameter</span> <span class="org-variable-name">*test-lst*</span> '((#\a 97) (#\b 98) (#\c 99) (#\d 100)))

(every #'(<span class="org-keyword">lambda</span> (x)
           (eq (char-code (first x)) (second x)))
       *test-lst*)
</pre>
</div>
<p>
Now an NST version. There may be better ways to write this but as far as I can tell <code>:apply</code> does not accept a lambda function.
</p>
<div class="org-src-container">
<pre class="src src-lisp">(<span class="org-keyword">defparameter</span> <span class="org-variable-name">*test-lst*</span> '((#\a 97) (#\b 98) (#\c 99) (#\d 100)))

(<span class="org-keyword">defun</span> <span class="org-function-name">test-char-code-sublist</span> (lst)
  (eq (char-code (first lst))
      (second lst)))

(def-fixtures fixture1 ()
  (lst *test-lst*))

(nst:def-test-group tf-nst ()
  (def-test (t-char-codes <span class="org-builtin">:group</span> tf-nst <span class="org-builtin">:fixtures</span> (lst))
    (<span class="org-builtin">:each</span> (<span class="org-builtin">:apply</span> test-char-code-sublist (<span class="org-builtin">:eq</span> t)))
    lst))
</pre>
</div>
<p>
I find myself writing a lot more than I feel necessary in what seems like simple situations. A large part may be simply because I am not going to get far enough up the learning curve for NST given my needs. An article introducing <a href="http://maraist.org/static/work/ILC2010-maraist.pdf">NST</a> claims:
</p>

<p>
[For simple examples] "the overhead of a separate criteria language seems hardly justifiable. In fact, the criteria bring two primary advantages over Lisp forms. First, criteria can report more detailed information than just pass or fail. In a larger application where the tested values are more complicated objects and structures, the reason for a test's failure may be more subtle. More informative reports can significantly assist the programmer, especially when validating changes to less familiar older or others' code. Moreover, NST's criteria can report multiple reasons for failure. Such more complicated analyses can reduce the boilerplate involved in writing tests; one test against a conjunctive criterion can provide as informative a result as a series of sep-arate tests on the same form. As a project grows larger and more complex, and as a team of programmers and testers becomes less intimately familiar with all of the components of a system, criteria can both reduce tests’ overall verbosity, while at the same time raising the usefulness of their results."
</p>

<p>
Unfortunately for me, many times in trying to learn the DSL, NST reported that it raised an error but refused to tell me what the error was, regardless of the level of verbosity I set.
</p>

<p>
Maybe it is just me, but every time I tried to redefine a test, I triggered a hash table error and needed to define a test with a new name.
</p>
</div>
</div>
<div id="outline-container-orga26515e" class="outline-3">
<h3 id="orga26515e"><span class="section-number-3">24.5.</span> Who Uses NST</h3>
<div class="outline-text-3" id="text-24-5">
<p>
<a href="https://github.com/nklein/track-best">track-best</a>, <a href="https://github.com/nklein/userial">userial</a>
</p>

<p>
<a href="#org63aa282">top</a>
<a id="orga8f69c2"></a>
</p>
</div>
</div>
</div>
<div id="outline-container-org03e88aa" class="outline-2">
<h2 id="org03e88aa"><span class="section-number-2">25.</span> parachute</h2>
<div class="outline-text-2" id="text-25">
<p>
<a href="#org63aa282">top</a>
</p>
</div>
<div id="outline-container-org938c836" class="outline-3">
<h3 id="org938c836"><span class="section-number-3">25.1.</span> Summary</h3>
<div class="outline-text-3" id="text-25-1">
<table border="2" rules="all" frame="border">


<colgroup>
<col  class="org-left">

<col  class="org-left">

<col  class="org-left">

<col  class="org-right">
</colgroup>
<tbody>
<tr>
<td class="org-left"><a href="https://github.com/Shinmera/parachute">homepage</a></td>
<td class="org-left">Nicolas Hafner</td>
<td class="org-left">zlib</td>
<td class="org-right">2021</td>
</tr>
</tbody>
</table>

<p>
It hits almost everything on my wish list - optionality on progress reports and debugging, good suite setup and reporting, good default error-reporting and the ability to provide diagnostic strings with variables, skip failing dependencies, set time limits on long running tests and has decent fixture capability. It does not have the built-in ability to re-run just the last failing tests, but that is a relatively easy add-on. (see <a href="#orgc4d8785">Discussion</a>) The bigger limitation is that fixtures at a parent test level (suite level) do not apply to nested child tests. While it is not the fastest, it is in the pack as opposed to the also-rans.
</p>

<p>
The name of a test is coerced into a string internally, so test names are not functions that can be called on their own.
</p>

<p>
There are three types of reports: quiet, plain (the default) and interactive (throwing you into the debugger).
</p>

<p>
Parachute does allow you to set time limits for tests and will report the times for tests.
</p>

<p>
My wish list would be for (1) the ability of fixtures to apply down the list of nested child tests and (2) for there to be a built-in ability for tests to keep a list of the last tests that failed so that you could just run those over again after you think you have fixed all your bugs.
</p>
</div>
</div>

<div id="outline-container-org05cb8f1" class="outline-3">
<h3 id="org05cb8f1"><span class="section-number-3">25.2.</span> Assertion Functions</h3>
<div class="outline-text-3" id="text-25-2">
<table>


<colgroup>
<col  class="org-left">

<col  class="org-left">

<col  class="org-left">

<col  class="org-left">

<col  class="org-left">
</colgroup>
<tbody>
<tr>
<td class="org-left">true</td>
<td class="org-left">false</td>
<td class="org-left">fail</td>
<td class="org-left">is</td>
<td class="org-left">isnt</td>
</tr>

<tr>
<td class="org-left">is-values</td>
<td class="org-left">isnt-values</td>
<td class="org-left">of-type</td>
<td class="org-left">finish</td>
<td class="org-left">&#xa0;</td>
</tr>
</tbody>
</table>
<p>
As with other frameworks, finish simply indicates that the test does not produce an error.
</p>

<p>
<a href="#org63aa282">top</a>
</p>
</div>
</div>
<div id="outline-container-org6b8e8cf" class="outline-3">
<h3 id="org6b8e8cf"><span class="section-number-3">25.3.</span> Usage</h3>
<div class="outline-text-3" id="text-25-3">
</div>
<ol class="org-ol">
<li><a id="org0fe07ae"></a>Report Format<br>
<div class="outline-text-4" id="text-25-3-1">
<p>
Parachute provides three types of reports at the moment. Each returns a test-result object as well as printing a report to stream.
</p>

<ul class="org-ul">
<li>Quiet for when you just want the summary</li>
<li>Interactive for when you want to go into the debugger on failures, and</li>
<li>Plain (the default) for the nice progress report with checks and timing and &#x2026;</li>
</ul>

<p>
So a basic failing test to show the differences in reporting. We are passing the third assertion a string after the two tested items which can help diagnose failures, followed by the two variables being compared, and then running it to show the default failure report.
</p>
<div class="org-src-container">
<pre class="src src-lisp">(<span class="org-keyword">define-test</span> t1-fail
  (<span class="org-keyword">let</span> ((x 1) (y 2))
    (is = 1 2)
    (is equal 1 2)
    (is =  x y <span class="org-string">"Intentional failure ~a does not equal ~a"</span> x y)
     (fail (<span class="org-warning">error</span> 'floating-point-overflow)
       'division-by-zero)))
</pre>
</div>
<p>
Now the quiet report version:
</p>
</div>
<ol class="org-ol">
<li><a id="org1a5d291"></a>Quiet<br>
<div class="outline-text-5" id="text-25-3-1-1">
<div class="org-src-container">
<pre class="src src-lisp">(test 't1-fail <span class="org-builtin">:report</span> 'quiet)
#&lt;QUIET 5, FAILED results&gt;
</pre>
</div>
</div>
</li>
<li><a id="orgf49a444"></a>Default "Plain" Report<br>
<div class="outline-text-5" id="text-25-3-1-2">
<div class="org-src-container">
<pre class="src src-lisp">(test 't1-fail)
        &#65311; TF-PARACHUTE::T1-FAIL
  0.000 &#10008;   (is = 1 2)
  0.000 &#10008;   (is equal 1 2)
  0.000 &#10008;   (is = x y)
  0.000 &#10008;   (fail (<span class="org-warning">error</span> 'floating-point-overflow) 'division-by-zero)
  0.010 &#10008; TF-PARACHUTE::T1-FAIL

<span class="org-comment-delimiter">;; </span><span class="org-comment">Summary:</span>
Passed:     0
Failed:     4
Skipped:    0

<span class="org-comment-delimiter">;; </span><span class="org-comment">Failures:</span>
   4/   4 tests failed in TF-PARACHUTE::T1-FAIL
The test form   2
evaluated to    2
when            1
was expected to be equal under =.

The test form   2
evaluated to    2
when            1
was expected to be equal under EQUAL.

The test form   y
evaluated to    2
when            1
was expected to be equal under =.
Intentional failure 1 does not equal 2

The test form   (capture-error (<span class="org-warning">error</span> 'floating-point-overflow))
evaluated to    [floating-point-overflow] arithmetic error floating-point-overflow signalled
when            division-by-zero
was expected to be equal under TYPEP.

#&lt;PLAIN 5, FAILED results&gt;
</pre>
</div>
<p>
If you start looking at summary reports for nested tests and notice that the number of test results is not greater than the number of assertions, just remember that a nested test is itself considered an assertion and will pass if all its assertions pass or fail if any of its assertions fail.
</p>
</div>
</li>
<li><a id="org3653538"></a>Interactive<br>
<div class="outline-text-5" id="text-25-3-1-3">
<p>
The interactive report which throws you into the debugger:
</p>
<div class="org-src-container">
<pre class="src src-lisp">(test 't1-fail <span class="org-builtin">:report</span> 'interactive)
  Test (is = 1 2) failed:
  The test form   2
  evaluated to    2
  when            1
  was expected to be equal under =.
     [Condition of type SIMPLE-ERROR]

  Restarts:
   0: [RETRY] Retry testing (is = 1 2)
   1: [ABORT] Continue, failing (is = 1 2)
   2: [CONTINUE] Continue, skipping (is = 1 2)
   3: [PASS] Continue, passing (is = 1 2)
   4: [RETRY] Retry testing TF-PARACHUTE::T1-FAIL
   5: [ABORT] Continue, failing TF-PARACHUTE::T1-FAIL
</pre>
</div>
</div>
</li>
</ol>
</li>

<li><a id="orgd93bda9"></a>Basics<br>
<div class="outline-text-4" id="text-25-3-2">
<p>
So lets look at a test where we know everything will pass, using the default report. This will give us a view of the syntax for various types of assertions.
</p>
<div class="org-src-container">
<pre class="src src-lisp">(<span class="org-keyword">define-test</span> t1
  (true (= 1 1))
  (true <span class="org-string">"happy"</span>)
  (false (numberp <span class="org-string">"no"</span>))
  (of-type integer 5)
  (of-type character #\space)
  (is = 1 1)
  (is equal <span class="org-string">"abc"</span> <span class="org-string">"abc"</span>)
  (isnt equal <span class="org-string">"abc"</span> <span class="org-string">"d"</span>)
  (is-values (values 1 2)
    (= (values 1 2)))
  (is-values (values 1 <span class="org-string">"a"</span>)
    (= 1)
    (string= <span class="org-string">"a"</span>))
  (fail (<span class="org-warning">error</span> 'division-by-zero)
      'division-by-zero))

(test 't1)

        &#65311; TF-PARACHUTE::T1
  0.000 &#10004;   (true (= 1 1))
  0.000 &#10004;   (true <span class="org-string">"happy"</span>)
  0.000 &#10004;   (false (numberp <span class="org-string">"no"</span>))
  0.000 &#10004;   (of-type integer 5)
  0.000 &#10004;   (of-type character #\ )
  0.000 &#10004;   (is = 1 1)
  0.000 &#10004;   (is equal <span class="org-string">"abc"</span> <span class="org-string">"abc"</span>)
  0.000 &#10004;   (isnt equal <span class="org-string">"abc"</span> <span class="org-string">"d"</span>)
  0.000 &#10004;   (is-values (values 1 2) (= (values 1 2)))
  0.000 &#10004;   (is-values (values 1 <span class="org-string">"a"</span>) (= 1) (string= <span class="org-string">"a"</span>))
  0.000 &#10004;   (fail (<span class="org-warning">error</span> 'division-by-zero) 'division-by-zero)
  0.030 &#10004; TF-PARACHUTE::T1

<span class="org-comment-delimiter">;; </span><span class="org-comment">Summary:</span>
Passed:    11
Failed:     0
Skipped:    0
#&lt;PLAIN 12, PASSED results&gt;
</pre>
</div>
<p>
As you would hope, changing tested functions does not require manually recompiling parachute tests. We will skip the proof.
</p>
</div>
</li>
<li><a id="org053dcd7"></a>Edge Cases: Values expressions, loops. closures and calling other tests<br>
<ol class="org-ol">
<li><a id="org8a1d842"></a>Values expressions<br>
<div class="outline-text-5" id="text-25-3-3-1">
<p>
Parachute has special functionality for dealing with values expressions with its <code>is-values</code> testing function as we saw just above. If you used another testing function and passed values expressions to it, they would be accepted but, as expected, Parachute would only look at the first value in the values expression.
</p>
</div>
</li>
<li><a id="org4f80013"></a>Now looping and closures<br>
<div class="outline-text-5" id="text-25-3-3-2">
<p>
Parachute has no problem with loops or finding variables that have been set in a closure containing the test.
</p>
<div class="org-src-container">
<pre class="src src-lisp">  (<span class="org-keyword">let</span> ((l1 '(#\a #\B #\z))
        (l2 '(97 66 122)))
  (<span class="org-keyword">define-test</span> t2-loop
    (<span class="org-keyword">loop</span> for x in l1 for y in l2 do
      (true (= (char-code x) y)))))

(test 't2-loop <span class="org-builtin">:report</span> 'quiet)
#&lt;QUIET 4, PASSED results&gt;
</pre>
</div>
</div>
</li>
<li><a id="org49d6ae2"></a>Calling a test inside another test<br>
<div class="outline-text-5" id="text-25-3-3-3">
<div class="org-src-container">
<pre class="src src-lisp">(<span class="org-keyword">define-test</span> t3 <span class="org-comment">; a test that tries to call another test in its body</span>
    (true (eql 'a 'a))
    (test 't2))

(test 't3)
        &#65311; TF-PARACHUTE::T3
  0.000 &#10004;   (true (eql 'a 'a))
        &#65311;   TF-PARACHUTE::T2
  0.000 &#10004;     (true (= 1 1))
  0.000 &#10008;     (true (= 2 1))
  0.000 &#10004;     (is-values (values 1 2) (= (values 1 2)))
  0.000 &#10004;     (is-values (values 1 <span class="org-string">"a"</span>) (= 1) (string= <span class="org-string">"a"</span>))
  0.000 &#10008;   TF-PARACHUTE::T2

<span class="org-comment-delimiter">;; </span><span class="org-comment">Summary:</span>
Passed:     3
Failed:     1
Skipped:    0

<span class="org-comment-delimiter">;; </span><span class="org-comment">Failures:</span>
   1/   4 tests failed in TF-PARACHUTE::T2
t2 description here
The test form   (= 2 1)
evaluated to    ()
when            t
was expected to be equal under GEQ.

  0.003 &#10008; TF-PARACHUTE::T3

<span class="org-comment-delimiter">;; </span><span class="org-comment">Summary:</span>
Passed:     1
Failed:     1
Skipped:    0

<span class="org-comment-delimiter">;; </span><span class="org-comment">Failures:</span>
   2/   3 tests failed in TF-PARACHUTE::T3
Test for T2 failed.
#&lt;PLAIN 3, FAILED results&gt;
</pre>
</div>
</div>
</li>
</ol>
</li>
<li><a id="org94f9df6"></a>Suites, tags and other multiple test abilities<br>
<ol class="org-ol">
<li><a id="org2244141"></a>Lists of tests<br>
<div class="outline-text-5" id="text-25-3-4-1">
<p>
Parachute can handle lists of tests.
</p>
<div class="org-src-container">
<pre class="src src-lisp">(test '(t1 t2))
</pre>
</div>
</div>
</li>
<li><a id="org55376f4"></a>Suites<br>
<div class="outline-text-5" id="text-25-3-4-2">
<p>
Everything is a test in parachute and tests can have parent tests just by adding a :parent &lt;insert-name-here&gt;. This makes suite inheritance easy as demonstrated below..
</p>
<div class="org-src-container">
<pre class="src src-lisp">  (<span class="org-keyword">define-test</span> s0)

  (<span class="org-keyword">define-test</span> t4
    <span class="org-builtin">:parent</span> s0
    (true (= 1 1))
    (false (= 1 2)))

(<span class="org-keyword">define-test</span> t4-1
  <span class="org-builtin">:parent</span> t4
  (true (= 1 1))
  (false (= 1 2)))
</pre>
</div>
<p>
Now we can test 's0 and we will get the results for 't4 and t4-1
</p>
<div class="org-src-container">
<pre class="src src-lisp">(test 's0)
        &#65311; TF-PARACHUTE::S0
        &#65311;   TF-PARACHUTE::T4
  0.000 &#10004;     (true (= 1 1))
  0.000 &#10004;     (false (= 1 2))
        &#65311;     TF-PARACHUTE::T4-1
  0.000 &#10004;       (true (= 1 1))
  0.000 &#10004;       (false (= 1 2))
  0.003 &#10004;     TF-PARACHUTE::T4-1
  0.010 &#10004;   TF-PARACHUTE::T4
  0.010 &#10004; TF-PARACHUTE::S0

<span class="org-comment-delimiter">;; </span><span class="org-comment">Summary:</span>
Passed:     4
Failed:     0
Skipped:    0
#&lt;PLAIN 7, PASSED results&gt;
</pre>
</div>

<p>
<a href="#org63aa282">top</a>
</p>
</div>
</li>
</ol>
</li>
<li><a id="orgd7013b6"></a>Fixtures and Freezing Data<br>
<div class="outline-text-4" id="text-25-3-5">
<p>
First checking whether we can freeze data, change it in the test, then change it back
</p>
<div class="org-src-container">
<pre class="src src-lisp">(<span class="org-keyword">defparameter</span> <span class="org-variable-name">*keep-this-data*</span> 1)
(<span class="org-keyword">define-test</span> t-freeze-1
  <span class="org-builtin">:fix</span> (*keep-this-data*)
  (setf *keep-this-data* <span class="org-string">"new"</span>)
  (true (stringp *keep-this-data*)))

(<span class="org-keyword">define-test</span> t-freeze-2
  (is = *keep-this-data* 1))

(test '(t-freeze-1 t-freeze-2))
</pre>
</div>
<p>
Now the classic fixture - create a data set for some series of tests and clean it up afterwards
</p>
<div class="org-src-container">
<pre class="src src-lisp"><span class="org-comment-delimiter">;; </span><span class="org-comment">Create a class for data fixture purposes</span>
(<span class="org-keyword">defclass</span> <span class="org-type">class-A</span> ()
  ((a <span class="org-builtin">:initarg</span> <span class="org-builtin">:a</span> <span class="org-builtin">:initform</span> 0 <span class="org-builtin">:accessor</span> a)
   (b <span class="org-builtin">:initarg</span> <span class="org-builtin">:b</span> <span class="org-builtin">:initform</span> 0 <span class="org-builtin">:accessor</span> b)))

(<span class="org-keyword">defparameter</span> <span class="org-variable-name">*some-existing-data-parameter*</span>
  (make-instance 'class-A <span class="org-builtin">:a</span> 17.3 <span class="org-builtin">:b</span> -12))

(def-fixture f1 ()
  (<span class="org-keyword">let</span> ((old-parameter *some-existing-data-parameter*))
    (setf *some-existing-data-parameter*
        (make-instance 'class-A <span class="org-builtin">:a</span> 100 <span class="org-builtin">:b</span> -100))
    (<span class="org-type">&amp;body</span>)
    (setf *some-existing-data-parameter* old-parameter)))

(def-test t6-f1 (<span class="org-builtin">:fixture</span> f1)
  (is (equal (a *some-existing-data-parameter*) 100))
  (is (equal (b *some-existing-data-parameter*) -100)))

<span class="org-comment-delimiter">;; </span><span class="org-comment">now you can check (a *some-existing-data-parameter*) to ensure defining the test has not changed *some-existing-data-parameter*</span>

(run! 't6-f1)

Running test T6-F1 ..
 Did 2 checks.
    Pass: 2 (100%)
    Skip: 0 ( 0%)
    Fail: 0 ( 0%)
</pre>
</div>
<p>
Unfortunately, fixtures are not visible at the child test level. This is shown in the following example.
</p>
<div class="org-src-container">
<pre class="src src-lisp">  (<span class="org-keyword">defparameter</span> <span class="org-variable-name">*my-param*</span> 1)
  (<span class="org-keyword">define-test</span> parent-test-1
      (<span class="org-keyword">with-fixtures</span> '(*my-param*)
        (setf *my-param* 2)
        (is = 2 *my-param*)))
  (<span class="org-keyword">define-test</span> child-test-1 <span class="org-builtin">:parent</span> parent-test-1
    (is = 2 *my-param*)
    (is eq 'a 'a))

(test 'parent-test-1)
        &#65311; TF-PARACHUTE::PARENT-TEST-1
  0.000 &#10004;   (is = 2 *my-param*)
        &#65311;   TF-PARACHUTE::CHILD-TEST-1
  0.000 &#10008;     (is = 2 *my-param*)
  0.000 &#10004;     (is eq 'a 'a)
  0.000 &#10008;   TF-PARACHUTE::CHILD-TEST-1
  0.003 &#10008; TF-PARACHUTE::PARENT-TEST-1

<span class="org-comment-delimiter">;; </span><span class="org-comment">Summary:</span>
Passed:     2
Failed:     1
Skipped:    0

<span class="org-comment-delimiter">;; </span><span class="org-comment">Failures:</span>
   1/   2 tests failed in TF-PARACHUTE::PARENT-TEST-1
   1/   2 tests failed in TF-PARACHUTE::CHILD-TEST-1
The test form   *my-param*
evaluated to    1
when            2
was expected to be equal under =.
</pre>
</div>
<p>
So effectively you cannot set suite level fixtures with Parachute. In case you were trying to reconcile the failure counts, there was only 1 assertion that failed. However two tests failed at the child-test-1 level - the assertion on <code>*my-param*</code> and, therefore, child-test-1 itself. Two tests failed at the parent-test-1 level - child-test-1 and, therefore, parent-test-1 itself.
</p>
</div>
</li>
<li><a id="orge5f9fcd"></a>Removing tests<br>
<div class="outline-text-4" id="text-25-3-6">
<p>
Parachute can remove specific tests with <code>remove-test</code> or all the tests in a package with <code>remove-all-tests-in-package</code>.
</p>
<div class="org-src-container">
<pre class="src src-lisp">(remove-test 't1)

(remove-all-tests-in-package optional-package-name)
</pre>
</div>
</div>
</li>
<li><a id="org87c7268"></a>Sequencing, Random and Failure Only<br>
<div class="outline-text-4" id="text-25-3-7">
<p>
While tests normally follow a sequential order, parachute allows you to specify to either shuffle the assertions in a test or shuffle the tests within a suite.
</p>

<div class="org-src-container">
<pre class="src src-lisp">  (<span class="org-keyword">define-test</span> shuffle
    <span class="org-builtin">:serial</span> NIL
    ...)

(<span class="org-keyword">define-test</span> shuffle-suite <span class="org-builtin">:serial</span> NIL)
</pre>
</div>
</div>
</li>
<li><a id="orga56d2a0"></a>Skip Capability<br>
<div class="outline-text-4" id="text-25-3-8">
<p>
Parachute has multiple skip abilities including skipping based on assertions, tests or implementations.
</p>
</div>
<ol class="org-ol">
<li><a id="orgf2cbb57"></a>Assertions<br>
<div class="outline-text-5" id="text-25-3-8-1">
<div class="org-src-container">
<pre class="src src-lisp">(<span class="org-keyword">define-test</span> stuff
  (true <span class="org-builtin">:pass</span>)
  (skip <span class="org-string">"Not ready yet"</span>
    (is = 5 (some-unimplemented-function 10))))
</pre>
</div>
</div>
</li>
<li><a id="org59a8591"></a>Tests<br>
<div class="outline-text-5" id="text-25-3-8-2">
<div class="org-src-container">
<pre class="src src-lisp">(<span class="org-keyword">define-test</span> suite
  <span class="org-builtin">:skip</span> (test-a))
</pre>
</div>
</div>
</li>
<li><a id="org4d3240c"></a>Implementation<br>
<div class="outline-text-5" id="text-25-3-8-3">
<div class="org-src-container">
<pre class="src src-lisp">(<span class="org-keyword">define-test</span> stuff
  (skip-on (clisp) <span class="org-string">"Not supported on clisp."</span>
    (is equal #p<span class="org-string">"a/b/"</span> (merge-pathnames <span class="org-string">"b/"</span> <span class="org-string">"a/"</span>))))
</pre>
</div>
</div>
</li>
</ol>
</li>
<li><a id="orge1569b1"></a>Random Data Generators<br>
<div class="outline-text-4" id="text-25-3-9">
<p>
None, but the helper libraries can fullfill this well.
<a id="orgc4d8785"></a>
</p>
</div>
</li>
</ol>
</div>
<div id="outline-container-org4f59d24" class="outline-3">
<h3 id="org4f59d24"><span class="section-number-3">25.4.</span> Discussion</h3>
<div class="outline-text-3" id="text-25-4">
<p>
It is certainly possible to extend parachute to retest just the tests that failed last time. Since parachute can run against a list of tests, all you  need is a function to save a list of the names of the tests that fail. The following might be one way to do that.
</p>
<div class="org-src-container">
<pre class="src src-lisp">(<span class="org-keyword">defun</span> <span class="org-function-name">collect-test-failure-names</span> (test-results)
  <span class="org-doc">"This function takes the report output of a parachute test and returns a list of the</span>
<span class="org-doc">   names of the tests that failed."</span>
  (<span class="org-keyword">when</span> (typep test-results 'parachute:report)
    (<span class="org-keyword">loop</span> for test-result across (results test-results)
          when (and (typep test-result 'parachute::test-result)
                    (eq (status test-result) <span class="org-builtin">:failed</span>))
            collect (name (expression test-result)))))
</pre>
</div>
<p>
You might also consider whether the helper library <a href="#org88667e0">Protest</a> would be a good add-on as it has a Parachute module.
</p>

<p>
Since I questioned what is meant by extensibility at the very beginning of this report, allow me to quote the Parachute documentation:
</p>

<p>
"<b>Extending Parachute</b>
<b>Test and Result Evaluation</b>
</p>

<p>
"Parachute follows its own evaluation semantics in order to run tests. Primarily this means that most everything goes through one central function called eval-in-context. This functions allows you to customise evaluation based on both what the context is, and what the object being "evaluated" is.
</p>

<p>
Usually the context is a report object, but other situations might also be conceived. Either way, it is your responsibility to add methods to this function when you add a new result type, some kind of test subclass, or a new report type that you want to customise according to your desired behaviour.
</p>

<p>
The evaluation of results is decoupled from the context and reports in the sense that their behaviour does not, by default, depend on it. At the most basic, the result class defines a single :around method that takes care of recording the duration of the test evaluation, setting a default status after finishing without errors, and skipping evaluation if the status is already set to something other than :unknown.
</p>

<p>
Next we have a result object that is interesting for anything that actually produces direct test results&#x2013; value-result. Upon evaluation, if the value slot is not yet bound, it calls its body function and stores the return value thereof in the value slot.
</p>

<p>
However, the result type that is actually used for all standard test forms is the comparison-result. This also takes a comparator function and an expected result to compare against upon completion of the test. If the results match, then the test status is set to :passed, otherwise to :failed.
</p>

<p>
Since Parachute allows for a hierarchy in your tests, there have to be aggregate results as well, and indeed there are. Two of them, actually. First is the base case, namely parent-result which does two things on evaluation: one, it binds <code>*parent*</code> to itself to allow other results to register themselves upon construction, and two it sets its status to :failed if any of the children have failed.
</p>

<p>
Finally we have the test-result which takes care of properly evaluating an actual test object. What this means is to evaluate all dependencies before anything else happens, and to check the time limit after everything else has happened. If the time limit has exceeded, set the description accordingly and mark the result as :failed. For its main eval-in-context method however it checks whether any of the dependencies have failed, and if so, mark itself as :skipped. Otherwise it calls eval-in-context on the actual test object.
</p>

<p>
The default evaluation procedure for a test itself is to simply call all the functions in the tests list in a with-fixtures environment.
</p>

<p>
And that describes the semantics of default test procedures. Actual test forms like is are created through macros that emit an (eval-in-context <b>context</b> (make-instance 'comparison-result #|&#x2026;|#)) form. The <code>*context*</code> object is automatically bound to the context object on call of eval-in-context and thus always refers to the current context object. This allows results to be evaluated even from within opaque parts like user-defined functions.
</p>

<p>
<b>Report Generation</b>
</p>

<p>
"It should be possible to get any kind of reporting behaviour you want by adding methods that specialise on your report object to eval-in-context. For the simple case where you want something that prints to the REPL but has a different style than the preset plain report, you can simply subclass that and specialise on the report-on and summarize functions that then produce the output you want.
</p>

<p>
Since you can control pretty much every aspect of evaluation rather closely, very different behaviours and recovery mechanisms are also possible to achieve. One final aspect to note is result-for-testable, which should return an appropriate result object for the given testable. This should only return fresh result objects if no result is already known for the testable in the given context. The standard tests provide for this, however they only ever return a standard test-result instance. If you need to customise the behaviour of the evaluation for that part, it would be a wise idea to subclass test-result and make sure to return instances thereof from result-for-testable for your report.
</p>

<p>
Finally it should be noted that if you happen to create new result types that you might want to run using the default reports, you should add methods to format-result that specialise on the keywords :oneline and :extensive for the type. These should return a string containing an appropriate description of the test in one line or extensively, respectively. This will allow you to customise how things look to some degree without having to create a new report object entirely."
<a href="#org63aa282">top</a>
</p>
</div>
</div>

<div id="outline-container-org892018d" class="outline-3">
<h3 id="org892018d"><span class="section-number-3">25.5.</span> Who uses parachute</h3>
<div class="outline-text-3" id="text-25-5">
<p>
The following list is just pulling the results <code>(ql:who-depends-on :parachute)</code> and adding urls to a few of them.
("3b-hdr" <a href="https://github.com/Shinmera/3d-matrices">3d-matrices</a> "3d-vectors" <a href="https://github.com/Shinmera/array-utils">array-utils</a>
 <a href="https://github.com/shinmera/atomics">atomics</a>  "binpack"
 "canonicalized-initargs" <a href="https://github.com/Hexstream/cesdi/blob/master/tests/tests.lisp">cesdi</a> "cl-elastic"
 "cl-markless" "class-options" "classowary" <a href="https://github.com/Shinmera/colored">colored</a>
 <a href="https://github.com/Shinmera/com-on">com-on</a> "compatible-metaclasses" "definitions-systems"
 "enhanced-boolean" "enhanced-defclass" "enhanced-find-class"
 "enhanced-typep" "evaled-when" "fakenil"
 "first-time-value" <a href="https://github.com/Shinmera/float-features">float-features</a> "inheriting-readers"
 "its" "method-hooks" <a href="https://github.com/Shinmera/mmap">mmap</a> "nyaml/test" "object-class"
 "origin.test"
 <a href="https://github.com/Shinmera/pathname-utils">pathname-utils</a> "protest/parachute" "radiance"
 "shared-preferences" "shasht/test" "simple-guess"
 "slot-extra-options" "trivial-custom-debugger/test"
 "trivial-jumptables" <a href="https://github.com/Shinmera/uax-14">uax-14</a> <a href="https://github.com/Shinmera/uax-9">uax-9</a>
 "with-output-to-stream" "with-shadowed-bindings")
</p>


<p>
<a id="orga7f8a83"></a>
</p>
</div>
</div>
</div>
<div id="outline-container-orgbe12c22" class="outline-2">
<h2 id="orgbe12c22"><span class="section-number-2">26.</span> prove</h2>
<div class="outline-text-2" id="text-26">
<p>
<a href="#org63aa282">top</a>
</p>
</div>
<div id="outline-container-orgd76b7c1" class="outline-3">
<h3 id="orgd76b7c1"><span class="section-number-3">26.1.</span> Summary</h3>
<div class="outline-text-3" id="text-26-1">
<table>


<colgroup>
<col  class="org-left">

<col  class="org-left">

<col  class="org-left">

<col  class="org-right">
</colgroup>
<tbody>
<tr>
<td class="org-left"><a href="https://github.com/fukamachi/prove">homepage</a></td>
<td class="org-left">Eitaro Fukamachi</td>
<td class="org-left">MIT</td>
<td class="org-right">2020</td>
</tr>
</tbody>
</table>

<p>
As most readers will know, the author has archived Prove in favor of Rove. Compared to Prove, Rove does have better failure reporting, is faster (but still not even in the middle of the pack) and has added fixtures. It is still missing some of the capabilities that that Prove has such as time limits on tests as well as test functions such as is-type, likes and is-values expression capabilities.
</p>

<p>
Prove does report all assertion failures in a test and allows user generated diagnostic messages, albeit without the ability to provide variables. Interactive debugging is optional and it does have a <code>*default-slow-threshold*</code> parameter which defaults to 150 milleconds to handle slow tests.
</p>

<p>
On the downside, it does not have fixtures and I find the situation with suites and tags to be confusing. I really want to be able to turn off progress reports. Finally, it is somewhat slower than most of the frameworks, but not the orders of magnitude slower that you are faced with using clunit, clunit2 or nst.
</p>
</div>
</div>

<div id="outline-container-orgce5dfa9" class="outline-3">
<h3 id="orgce5dfa9"><span class="section-number-3">26.2.</span> Assertion Functions</h3>
<div class="outline-text-3" id="text-26-2">
<table>


<colgroup>
<col  class="org-left">

<col  class="org-left">

<col  class="org-left">

<col  class="org-left">

<col  class="org-left">

<col  class="org-left">
</colgroup>
<tbody>
<tr>
<td class="org-left">ok</td>
<td class="org-left">is</td>
<td class="org-left">isnt</td>
<td class="org-left">is-values</td>
<td class="org-left">is-type</td>
<td class="org-left">like</td>
</tr>

<tr>
<td class="org-left">is-print</td>
<td class="org-left">is-error</td>
<td class="org-left">is-expand</td>
<td class="org-left">pass</td>
<td class="org-left">fail</td>
<td class="org-left">skip</td>
</tr>
</tbody>
</table>

<p>
<a href="#org63aa282">top</a>
</p>
</div>
</div>
<div id="outline-container-orgbd19419" class="outline-3">
<h3 id="orgbd19419"><span class="section-number-3">26.3.</span> Usage</h3>
<div class="outline-text-3" id="text-26-3">
</div>
<ol class="org-ol">
<li><a id="orgda95cb6"></a>Report Format<br>
<div class="outline-text-4" id="text-26-3-1">
<p>
Set prove:*debug-on-error* T for invoking CL debugger whenever getting an error during running tests.
</p>

<p>
Prove has four different reporters (:list, :dot, :tap or :fiveam) with :list being the default) for different formatting. Set <code>prove:*default-reporter*</code> to the desired reporter to change the format. Lets take a very basic failing test just to see what the syntax and  output looks like.
</p>

<p>
We have inserted diagnostic strings into the first two assertions. The second string has a format directive just to show that prove does not use them in these tests.
</p>
<div class="org-src-container">
<pre class="src src-lisp">(deftest t1-fail
  (<span class="org-keyword">let</span> ((x 1) (y 2))
   (ok (= 1 2) <span class="org-string">"We know 1 is not = 2"</span>)
   (is 3 4 <span class="org-string">"We know 3 is not ~a"</span> 4)
   (ok (equal 1 2))
   (ok (equal x y))))
</pre>
</div>
<p>
If we now use <code>run-test</code>:
</p>
</div>
<ol class="org-ol">
<li><a id="org9b409c2"></a>List Reporter<br>
<div class="outline-text-5" id="text-26-3-1-1">
<div class="org-src-container">
<pre class="src src-lisp">(run-test 't1-fail)
 T1-FAIL
    &#215; We know 1 is not  = 2
      NIL is expected to be T

    &#215; We know 3 is not ~a
      3 is expected to be 4

    &#215; NIL is expected to be T

    &#215; NIL is expected to be T
</pre>
</div>
</div>
</li>
<li><a id="orgd35abe3"></a>TAP Reporter<br>
<div class="outline-text-5" id="text-26-3-1-2">
<div class="org-src-container">
<pre class="src src-lisp">(setf *default-reporter* <span class="org-builtin">:tap</span>)
 (run-test 't1-fail)
# T1-FAIL
    not ok 1 - We know 1 is not  = 2
    #    got: NIL
    #    expected: T
    not ok 2 - We know 3 is not ~a
    #    got: 3
    #    expected: 4
    not ok 3
    #    got: NIL
    #    expected: T
    not ok 4
    #    got: NIL
    #    expected: T
not ok 4 - T1-FAIL
NIL
</pre>
</div>
</div>
</li>
<li><a id="orgc28b47b"></a>DOT Reporter<br>
<div class="outline-text-5" id="text-26-3-1-3">
<div class="org-src-container">
<pre class="src src-lisp">(setf *default-reporter* <span class="org-builtin">:dot</span>)
(run-test 't1-fail)
.
NIL
</pre>
</div>
</div>
</li>
<li><a id="orgaf8e78a"></a>Fiveam Reporter<br>
<div class="outline-text-5" id="text-26-3-1-4">
<div class="org-src-container">
<pre class="src src-lisp">(setf *default-reporter* <span class="org-builtin">:fiveam</span>)
(run-test 't1-fail)
f
#\f
</pre>
</div>
<p>
We will stick with the default reporter for the rest of this section.
</p>
</div>
</li>
</ol>
</li>
<li><a id="org97cd41e"></a>Basics<br>
<div class="outline-text-4" id="text-26-3-2">
<p>
Prove has a limited number of test functions so we can check them all out in a single test that we know will pass. We will skip the diagnostic strings except for the <code>like</code> function since we know everything will pass.
</p>
<div class="org-src-container">
<pre class="src src-lisp">(deftest t1
  (<span class="org-keyword">let</span> ((x 1) (y 2))
    (ok (= x 1))
    (is #(1 2 3) #(1 2 3) <span class="org-builtin">:test</span> #'equalp)
    (isnt y 3)
    (is-values (values 1 2) '(1 2))
    (is-type #(1 2 3) 'simple-vector)
    (like <span class="org-string">"su9"</span> <span class="org-string">"\\d"</span> <span class="org-string">"Do we have a digit in the tested string?"</span>)
    (is-print (princ <span class="org-string">"jabberwok"</span>) <span class="org-string">"jabberwok"</span>)
    (is-error (<span class="org-warning">error</span> 'division-by-zero) 'division-by-zero)))
</pre>
</div>
<p>
The <code>like</code> test function uses regex for cl-ppcre. The default list reporter will turn this around as:
</p>
<div class="org-src-container">
<pre class="src src-lisp">(run-test 't1)
 T1
    &#10003; T is expected to be T

    &#10003; #(1 2 3) is expected to be #(1 2 3)

    &#10003; 2 is not expected to be 3

    &#10003; (1 2) is expected to be (1 2)

    &#10003; #(1 2 3) is expected to be a type of SIMPLE-VECTOR

    &#10003; Do we have a digit in the tested string?

    &#10003; (PRINC <span class="org-string">"jabberwok"</span>) is expected to output <span class="org-string">"jabberwok"</span> (got <span class="org-string">"jabberwok"</span>)

    &#10003; (<span class="org-warning">ERROR</span> 'DIVISION-BY-ZERO) is expected to raise a condition DIVISION-BY-ZERO (got #&lt;DIVISION-BY-ZERO {10027D1673}&gt;)
NIL
</pre>
</div>

<p>
As you would hope, changing tested functions does not require manually recompiling prove tests. We will skip the proof.
</p>
</div>
</li>
<li><a id="org44c9e7f"></a>Edge Cases: Values expressions, loops. closures and calling other tests<br>
<ol class="org-ol">
<li><a id="org7922538"></a>Value expressions<br>
<div class="outline-text-5" id="text-26-3-3-1">
<p>
Similar to NST and Parachute, Prove does have special functionality with respect to values expressions and can look at the individual values coming from a values expression.
</p>
<div class="org-src-container">
<pre class="src src-lisp">(deftest t2-values
  (is-values (values 1 2) '(1 2)) <span class="org-comment">; passes</span>
  (is-values (values 1 2) '(1 3)) <span class="org-comment">; fails</span>
  (ok (equalp (values 1 2) (values 1 3)))) <span class="org-comment">; passes</span>
</pre>
</div>
</div>
</li>
<li><a id="orgb5e09e7"></a>Looping and closures.<br>
<div class="outline-text-5" id="text-26-3-3-2">
<p>
Prove has no problems with looping and taking variables declared in a closure surrounding the test. The following passes.
</p>
<div class="org-src-container">
<pre class="src src-lisp">(<span class="org-keyword">let</span> ((l1 '(#\a #\B #\z))
      (l2 '(97 66 122)))
  (deftest t2-loop
    (<span class="org-keyword">loop</span> for x in l1 for y in l2 do
      (ok (= (char-code x) y)))))
</pre>
</div>
</div>
</li>
<li><a id="org9808bbc"></a>Calling other tests<br>
<div class="outline-text-5" id="text-26-3-3-3">
<p>
Prove has a subtest macro which is intended to allow tests to be nested. So, for example, I compile the following and I get a nice indented report.
</p>
<div class="org-src-container">
<pre class="src src-lisp">(subtest <span class="org-string">"sub-1"</span>
  (is 1 1)
  (is 1 2)
  (subtest <span class="org-string">"sub-2"</span>
  (is 'a 'a)
  (is 'a 'b)))
 sub-1
    &#10003; 1 is expected to be 1

    &#215; 1 is expected to be 2

   sub-2
      &#10003; A is expected to be A

      &#215; A is expected to be B

NIL

</pre>
</div>
</div>
</li>
</ol>
</li>
<li><a id="org71a73a0"></a>Suites, tags and other multiple test abilities<br>
<ol class="org-ol">
<li><a id="org573f855"></a>Lists of tests<br>
<div class="outline-text-5" id="text-26-3-4-1">
<p>
Prove does not provide a way to run against lists of tests.
</p>
</div>
</li>
<li><a id="org73aa329"></a>Suites<br>
<div class="outline-text-5" id="text-26-3-4-2">
<p>
In spite of the fact that all my examples above are really done in the REPL, prove is at heart based on files of tests. So even without looking for "suite" functions or classes, each file is effectively a suite. Each package is also considered a suite and the macro <code>subtest</code> also creates a suite.
</p>

<p>
Prove provides multiple functions to run different sets of tests.
</p>

<ul class="org-ul">
<li><code>run</code> runs a test which can be a file pathname, a directory pathname or an asdf system name.</li>
<li><code>run-test</code> runs a single test as we have been using above.</li>
<li><code>run-test-all</code> runs all the tests in the current package</li>
<li><code>run-test-package</code> runs all the tests in a specific package</li>
<li><code>run-test-system</code> runs a testing ASDF system.</li>
</ul>
<p>
<a href="#org63aa282">top</a>
</p>
</div>
</li>
</ol>
</li>
<li><a id="orgf37fb8f"></a>Fixtures and Freezing Data<br>
<div class="outline-text-4" id="text-26-3-5">
<p>
None
</p>
</div>
</li>
<li><a id="orgb97f541"></a>Removing tests<br>
<div class="outline-text-4" id="text-26-3-6">
<p>
Prove has <code>remove-test</code> and <code>remove-test-all</code>
</p>
</div>
</li>
<li><a id="org027da21"></a>Sequencing, Random and Failure Only<br>
<div class="outline-text-4" id="text-26-3-7">
<p>
Prove tests run sequentially and I do not see any shuffle or random order functionality. I also do not see a way to collect just the failing tests to be able to rerun just those.
</p>
</div>
</li>
<li><a id="org95c9cd6"></a>Skip Capability<br>
<div class="outline-text-4" id="text-26-3-8">
<p>
Prove can skip a specified number of tests using the skip function. Unfortunately it marks them as passed rather than skipped. You can provide a string as to why they were skipped, but why mark them as passed? In fact, why do you need to be counting tests? You should be able to mark particular tests as skip.
</p>
<div class="org-src-container">
<pre class="src src-lips">(skip 3 "No need to test these on Mac OS X")
;-&gt;  ✓ No need to test these on Mac OS X (Skipped)
;    ✓ No need to test these on Mac OS X (Skipped)
;    ✓ No need to test these on Mac OS X (Skipped)
</pre>
</div>
</div>
</li>
<li><a id="org8281c7e"></a>Random Data Generators<br></li>
</ol>
</div>

<div id="outline-container-org6204ea8" class="outline-3">
<h3 id="org6204ea8"><span class="section-number-3">26.4.</span> Discussion</h3>
<div class="outline-text-3" id="text-26-4">
<p>
Prove has a lot of "market share", but I am not sure how much of that is due to <a href="https://github.com/fukamachi/cl-project">cl-project</a> and some of the other libraries by Eitaro Fukamachi like caveman2 and clack that hard code prove into what you are building. Whether you like prove or not, at least it was an attempt to get people to actually test their code.
</p>

<p>
In spite of the fact that the author has archived prove and stated that rove is now the successor, his libraries have not moved over to rove and prove still has functionality lacking in rove (and vice versa).
</p>

<p>
If I were to use prove, I would write another test reporter that did not have progress reports and would return a list of just failing tests. I would still have to write my own fixture macros. Or I could just use a framework that does that.
</p>

<p>
<a href="#org63aa282">top</a>
</p>
</div>
</div>
<div id="outline-container-orgf499830" class="outline-3">
<h3 id="orgf499830"><span class="section-number-3">26.5.</span> Who Uses Prove?</h3>
<div class="outline-text-3" id="text-26-5">
<p>
Many libraries on quicklisp use prove. If you have quicklisp, you can get a list of those with:
</p>
<div class="org-src-container">
<pre class="src src-lisp">(ql:who-depends-on <span class="org-builtin">:prove</span>)
</pre>
</div>

<p>
<a href="#org63aa282">top</a>
<a id="org52f36e5"></a>
</p>
</div>
</div>
</div>
<div id="outline-container-org997a28b" class="outline-2">
<h2 id="org997a28b"><span class="section-number-2">27.</span> ptester</h2>
<div class="outline-text-2" id="text-27">
<p>
<a href="#org63aa282">top</a>
</p>
</div>
<div id="outline-container-orgbd8c8ac" class="outline-3">
<h3 id="orgbd8c8ac"><span class="section-number-3">27.1.</span> Summary</h3>
<div class="outline-text-3" id="text-27-1">
<table>


<colgroup>
<col  class="org-left">

<col  class="org-left">

<col  class="org-left">

<col  class="org-right">
</colgroup>
<tbody>
<tr>
<td class="org-left"><a href="http://git.kpe.io/?p=ptester.git;a=summary">homepage</a></td>
<td class="org-left">Kevin Layer</td>
<td class="org-left">LLGPL</td>
<td class="org-right">2016</td>
</tr>
</tbody>
</table>
<p>
Ptester was released by Allegro. Phil Gold's commentary on ptester in his 2007 blog is still relevant today. "Ptester is barely a test framework. It has no test suites and no test functions. All it provides is a set of macros for checking function results (test (analogous to lisp-unit:assert-equal), test-error, test-no-error, test-warning, and test-no-warning) and a wrapper macro designed to enclose the test clauses which merely provides a count of success and failures at the end. ptester expects that all testing is done in predefined functions and lacks the dynamic approach present in other frameworks."
</p>

<p>
Yes, you can do testing with it, but you can do much better with other frameworks.
</p>
</div>
</div>

<div id="outline-container-org57b511f" class="outline-3">
<h3 id="org57b511f"><span class="section-number-3">27.2.</span> Assertion Functions</h3>
<div class="outline-text-3" id="text-27-2">
<p>
None - normal CL predicates resolving to T or nil
</p>

<p>
<a href="#org63aa282">top</a>
</p>
</div>
</div>
<div id="outline-container-org4905d34" class="outline-3">
<h3 id="org4905d34"><span class="section-number-3">27.3.</span> Usage</h3>
<div class="outline-text-3" id="text-27-3">
</div>
<ol class="org-ol">
<li><a id="org2d4c4d3"></a>Report Format<br>
<div class="outline-text-4" id="text-27-3-1">
<p>
Reporting or interactivity is optional. Set <code>*break-on-test-failures*</code> if you want to go into interactive debugging when a test failure occurs.
</p>
</div>
</li>
<li><a id="org4ed32ab"></a>Basics<br>
<div class="outline-text-4" id="text-27-3-2">
<p>
The <code>test</code> macro by default applies <code>eql</code> to the subsequent arguments. This can be changed by specifying the actual test to use. The following including assertions about errors and warnings.
The one item that might need a little explanation is the values test where we can explicitly flag to the test that it needs to be looking at multiple values.
</p>
<div class="org-src-container">
<pre class="src src-lisp">  (<span class="org-keyword">with-tests</span> (<span class="org-builtin">:name</span> <span class="org-string">"t1"</span>)
    (test 1 1)
    (test 'a 'a)
    (test <span class="org-string">"ptester"</span> <span class="org-string">"ptester"</span> <span class="org-builtin">:test</span> 'equal)
    (test  '(a b c) (values 'a 'b 'c) <span class="org-builtin">:multiple-values</span> t)
    (test-error (<span class="org-warning">error</span> 'division-by-zero) <span class="org-builtin">:condition-type</span> 'division-by-zero)
    (test-warning (<span class="org-warning">warn</span> <span class="org-string">"foo"</span>)))

Begin t1 test
**********************************
End t1 test
Errors detected in this test: 0
Successes this test:6
</pre>
</div>
<p>
Now with a deliberately failing test. No, you cannot compare two values expressions with each other.
</p>
<div class="org-src-container">
<pre class="src src-lisp">  (<span class="org-keyword">with-tests</span> (<span class="org-builtin">:name</span> <span class="org-string">"t2"</span>)
    (<span class="org-keyword">let</span> ((x 2) (y 'd))
      (test x 1)
      (test y 'a)
      (test <span class="org-string">"ptester"</span> <span class="org-string">"ptester"</span> <span class="org-builtin">:test</span> 'equal)
      (test  '(values 'a 'b 'c) (values 'a 'b 'c) <span class="org-builtin">:multiple-values</span> t)
      (test-error (<span class="org-warning">error</span> 'division-by-zero) <span class="org-builtin">:condition-type</span> 'floating-point-overflow)
      (test-warning (<span class="org-warning">warn</span> <span class="org-string">"foo"</span>))))
Begin t2 test
 * * * UNEXPECTED TEST FAILURE * * *
Test failed: 1
  wanted: 2
     got: 1
 * * * UNEXPECTED TEST FAILURE * * *
Test failed: 'A
  wanted: D
     got: A
 * * * UNEXPECTED TEST FAILURE * * *
Test failed: (VALUES 'A 'B 'C)
  wanted values: VALUES, 'A, 'B, 'C
     got values: A, B, C
 * * * UNEXPECTED TEST FAILURE * * *
Test failed: (<span class="org-warning">ERROR</span> 'DIVISION-BY-ZERO)
Reason: detected an incorrect condition type.
  wanted: FLOATING-POINT-OVERFLOW
     got: #&lt;SB-PCL::CONDITION-CLASS COMMON-LISP:DIVISION-BY-ZERO&gt;
**********************************
End t2 test
Errors detected in this test: 4 UNEXPECTED: 4
Successes this test:2
</pre>
</div>
</div>
</li>

<li><a id="orge62b7e8"></a>Edge Cases: Closures and calling other tests<br>
<div class="outline-text-4" id="text-27-3-3">
<p>
Ptester has no problem dealing with variables declared in a closure encompassing the test or with loops..
</p>

<p>
Since ptester does not have a callable test "instance", a ptester test cannot call another test.
</p>
</div>
</li>
<li><a id="org566afbe"></a>Suites, tags and other multiple test abilities<br>
<ol class="org-ol">
<li><a id="orgc5d5ac7"></a>Lists of tests<br>
<div class="outline-text-5" id="text-27-3-4-1">
<p>
None except using <code>with-tests</code>
</p>
</div>
</li>
<li><a id="orgd4ba114"></a>Suites<br>
<div class="outline-text-5" id="text-27-3-4-2">
<p>
None except using <code>with-tests</code>
</p>
</div>
</li>
</ol>
</li>
<li><a id="orgc997ac6"></a>Fixtures and Freezing Data<br>
<div class="outline-text-4" id="text-27-3-5">
<p>
None
</p>
</div>
</li>
<li><a id="org74041f0"></a>Removing tests<br>
<div class="outline-text-4" id="text-27-3-6">
<p>
None
</p>
</div>
</li>
<li><a id="org55b38b4"></a>Sequencing, Random and Failure Only<br>
<div class="outline-text-4" id="text-27-3-7">
<p>
None
</p>
</div>
</li>
<li><a id="org2128334"></a>Skip Capability<br>
<div class="outline-text-4" id="text-27-3-8">
<p>
None
</p>
</div>
</li>
<li><a id="org744b5cd"></a>Random Data Generators<br>
<div class="outline-text-4" id="text-27-3-9">
<p>
None
</p>
</div>
</li>
</ol>
</div>
<div id="outline-container-org5d5569f" class="outline-3">
<h3 id="org5d5569f"><span class="section-number-3">27.4.</span> Discussion</h3>
<div class="outline-text-3" id="text-27-4">
<p>
You can do better with other frameworks.
</p>

<p>
<a href="#org63aa282">top</a>
</p>
</div>
</div>
<div id="outline-container-org4b9af06" class="outline-3">
<h3 id="org4b9af06"><span class="section-number-3">27.5.</span> Who depends on ptester?</h3>
<div class="outline-text-3" id="text-27-5">
<p>
("cl-base64-tests" "getopt-tests" "puri-tests")
</p>

<p>
<a href="#org63aa282">top</a>
<a id="org3d39ad7"></a>
</p>
</div>
</div>
</div>
<div id="outline-container-orgd6685a1" class="outline-2">
<h2 id="orgd6685a1"><span class="section-number-2">28.</span> rove</h2>
<div class="outline-text-2" id="text-28">
</div>
<div id="outline-container-org89a492d" class="outline-3">
<h3 id="org89a492d"><span class="section-number-3">28.1.</span> Summary</h3>
<div class="outline-text-3" id="text-28-1">
<table>


<colgroup>
<col  class="org-left">

<col  class="org-left">

<col  class="org-left">

<col  class="org-right">
</colgroup>
<tbody>
<tr>
<td class="org-left"><a href="https://github.com/fukamachi/rove">homepage</a></td>
<td class="org-left">Eitaro Fukamachi</td>
<td class="org-left">BSD 3 Clause</td>
<td class="org-right">2020</td>
</tr>
</tbody>
</table>

<p>
If you use package-inferred systems, there may be more capabilities than if you do not. Without a package-inferred system, you get no consolidated summary of all the tests and you may have to write your tests differently than if you have a package-inferred system. It does have fixtures that can be used once per package or once per test, but there is no ability to use different fixtures with respect to different tests and no composable fixtures. In addition,signal testing seems incomplete compared to other frameworks.
</p>

<p>
As noted in the functionality tables, there have been reports that rove crashes with multithreaded results. See <a href="https://tychoish.com/post/programming-in-the-common-lisp-ecosystem/">https://tychoish.com/post/programming-in-the-common-lisp-ecosystem/</a>: "rove doesn't seem to work when multi-threaded results effectively. It's listed in the readme, but I was able to write really trivial tests that crashed the test harness."
</p>

<p>
Rove is sensitive to how you write the tests, at least if compiled with BSCL. The first way I wrote the tests triggered memory errors I could not recover from (but only in SBCL, not with CCL). The second way I wrote the tests worked perfectly fine. Your mileage may vary.
</p>

<p>
Compared to Prove, Rove does have better failure reporting, is faster (but still not even in the middle of the pack)  and has added fixtures. It is still missing some of the capabilities that that Prove has such as time limits on tests as well as test functions such as is-type, likes and is-values expression capabilities.
</p>

<p>
Given the multithreaded concerns, the issue I had with benchmarking and the missing functionality both with respect to non-package-inferred systems and in comparison to Prove,  I cannot recommend Rove.
</p>
</div>
</div>

<div id="outline-container-org74443af" class="outline-3">
<h3 id="org74443af"><span class="section-number-3">28.2.</span> Assertion Functions</h3>
<div class="outline-text-3" id="text-28-2">
<p>
As mentioned above, Rove does not have as many assertion functions as Prove, the library it is supposed to be replacing. The assertion functions are limited to:
</p>
<table>


<colgroup>
<col  class="org-left">

<col  class="org-left">

<col  class="org-left">

<col  class="org-left">

<col  class="org-left">

<col  class="org-left">

<col  class="org-left">
</colgroup>
<tbody>
<tr>
<td class="org-left">ok</td>
<td class="org-left">ng (not-good?)</td>
<td class="org-left">signals</td>
<td class="org-left">outputs</td>
<td class="org-left">expands</td>
<td class="org-left">pass</td>
<td class="org-left">fail</td>
</tr>
</tbody>
</table>
</div>
</div>

<div id="outline-container-orgb5032cf" class="outline-3">
<h3 id="orgb5032cf"><span class="section-number-3">28.3.</span> Usage</h3>
<div class="outline-text-3" id="text-28-3">
</div>
<ol class="org-ol">
<li><a id="org4d65382"></a>Report Format<br>
<div class="outline-text-4" id="text-28-3-1">
<p>
It has three different styles of reporting. The default style is the detailed :spec style. A simpler style that just shows dot progression is :dot and a style that just reports the result is :none. Turning off progress reporting is using the :none style. We show them all in the first basic passing test.
</p>

<p>
To go interactive rather than reporting (setf rove:*debug-on-error* t).
</p>
</div>
</li>
<li><a id="org868af1f"></a>Basics<br>
<div class="outline-text-4" id="text-28-3-2">
<p>
Starting off with a basic multiple passing assertion test. We have added a macro and an assertion that uses the <code>expands</code> capability provided by Rove. I admit to not being entirely clear why <code>deftest</code> and <code>testing</code> are separate macros. Adding the testing macro allows a description string, but I am not seeing other additional functionality. Can anyone hit me with a clue stick?
</p>
<div class="org-src-container">
<pre class="src src-lisp">(<span class="org-keyword">defmacro</span> <span class="org-function-name">defun-addn</span> (n)
  (<span class="org-keyword">let</span> ((m (gensym <span class="org-string">"m"</span>)))
    `(<span class="org-keyword">defun</span> ,(intern (format nil <span class="org-string">"ADD~A"</span> n)) (,m)
       (+ ,m ,n))))

(deftest t1
  (testing <span class="org-string">"Basic passing test"</span>
    (ok (equal 1 1))
    (ok (signals (<span class="org-warning">error</span> 'division-by-zero) 'division-by-zero))
    (ng (equal 1 2))
    (ok (expands '(defun-addn 10)
             `(<span class="org-keyword">defun</span> <span class="org-function-name">add10</span> (<span class="org-builtin">#:m</span>)
                (+ <span class="org-builtin">#:m</span> 10))))))

(rove:run-test 't1)
t1
  Basic passing test
    &#10003; Expect (EQUAL 1 1) to be true.
    &#10003; Expect (<span class="org-warning">ERROR</span> 'DIVISION-BY-ZERO) to signal DIVISION-BY-ZERO.
    &#10003; Expect (EQUAL 1 2) to be false.
    &#10003; Expect '(DEFUN-ADDN 10) to be expanded to `(<span class="org-keyword">DEFUN</span> <span class="org-function-name">ADD10</span> (<span class="org-builtin">#:M</span>) (+ <span class="org-builtin">#:M</span> 10)).

&#10003; 1 test completed
T
</pre>
</div>
<p>
You can add a :compile-at keyword parameter to deftest. The available options are :definition-time (the default) or :run-time.
</p>

<p>
You can add a :style keyword parameter to <code>run-test</code> to get different formats. The above was the default :spec style. Below we show the :dot and :none styles.
</p>
<div class="org-src-container">
<pre class="src src-lisp">(rove:run-test 't1 <span class="org-builtin">:style</span> <span class="org-builtin">:dot</span>)
....

&#10003; 1 test completed
T
(rove:run-test 't1 <span class="org-builtin">:style</span> <span class="org-builtin">:none</span>)
T
</pre>
</div>
<p>
On to a failing test. In this case we pass a diagnostic string on to the first two assertions. Rove does not allow variables to be passed to the diagnostic string. In the :spec style, Rove will show the parameters were that were provided to the second assertion that failed.
</p>
<div class="org-src-container">
<pre class="src src-lisp">(deftest t2
  (testing <span class="org-string">"Basic failing test"</span>
    (<span class="org-keyword">let</span> ((x 1) (y 2))
      (ok (equal 1 2) <span class="org-string">"we know 1 is not equal to 2"</span>)
      (ok (equal x y) <span class="org-string">"we know ~a is not equal to ~a"</span>)
      (ok (equal (values 1 2) (values 1 2))))))
T2
ROVE&gt; (run-test 't2)
t2
  Basic failing test
    &#215; 0) <span class="org-warning">we know 1 is not equal to 2</span>
    &#215; 1) <span class="org-warning">we know ~a is not equal to ~a</span>
    &#10003; Expect (EQUAL (VALUES 1 2) (VALUES 1 2)) to be true.

&#215; 1 of 1 test failed

0) <span class="org-warning">t2</span>
     &#8250; Basic failing test
   we know 1 is not equal to 2
     (EQUAL 1 2)

1) <span class="org-warning">t2</span>
     &#8250; Basic failing test
   we know ~a is not equal to ~a
     (EQUAL X Y)
         X = 1
         Y = 2
</pre>
</div>
<p>
Rove does not require you to manually recompile a test after a tested function has been modified.
</p>
</div>
</li>
<li><a id="org0a93e18"></a>Edge Cases: Values Expressions, loops. closures and calling other tests<br>
<ol class="org-ol">
<li><a id="org845a253"></a>Values Expressions<br>
<div class="outline-text-5" id="text-28-3-3-1">
<p>
Unlike Prove (or Lift or Parachute) Rove has no special functionality for dealing with values expressions. It accepts values expressions but only compares the first value in each. Thus the following passes:
</p>
<div class="org-src-container">
<pre class="src src-lisp">(deftest t2-values-expressions
    (testing <span class="org-string">"values expressions"</span>
      (ok (equalp (values 1 2) (values 1 3)))
      (ok  (equalp (values 1 2 3) (values 1 3 2 7)))))
</pre>
</div>
</div>
</li>
<li><a id="org28d44d1"></a>Looping and closures<br>
<div class="outline-text-5" id="text-28-3-3-2">
<p>
Rove has no problem looping through assertions pulling the variables from a closure.
</p>
<div class="org-src-container">
<pre class="src src-lisp">(<span class="org-keyword">let</span> ((l1 '(#\a #\B #\z))
      (l2 '(97 66 122)))
  (deftest t2-loop
    (<span class="org-keyword">loop</span> for x in l1 for y in l2 do
      (ok (= (char-code x) y)))))
</pre>
</div>
</div>
</li>
<li><a id="orgd429cb4"></a>Tests calling tests<br>
<div class="outline-text-5" id="text-28-3-3-3">
<p>
Rove tests can call other Rove tests. As with most frameworks, this results in two test results rather than a combined test result.
</p>
</div>
</li>
</ol>
</li>
<li><a id="orgb5d9a0d"></a>Conditions<br>
<div class="outline-text-4" id="text-28-3-4">
<p>
We saw in the first basic passing test Rove checking an error condition. I want to show what happens when an error condition fails because the result is different depending on whether the assertion function is <code>ok</code> or <code>ng</code>. It does not throw you into the debugger because we have <code>*debug-on-error*</code> set to nil, but shows the typical debugger output.
</p>
<div class="org-src-container">
<pre class="src src-lisp">(deftest t7-wrong-error
  (ok (signals (<span class="org-warning">error</span> 'floating-point-overflow)
          'division-by-zero)))

(rove:run-test 't7-wrong-error)
t7-wrong-error
  &#215; 0) <span class="org-warning">Expect (</span><span class="org-warning"><span class="org-warning">ERROR</span></span><span class="org-warning"> 'FLOATING-POINT-OVERFLOW) to signal DIVISION-BY-ZERO. (3333ms)</span>

&#215; 1 of 1 test failed

0) <span class="org-warning">t7-wrong-error</span>
   Expect (<span class="org-warning">ERROR</span> 'FLOATING-POINT-OVERFLOW) to signal DIVISION-BY-ZERO.
   FLOATING-POINT-OVERFLOW: arithmetic error FLOATING-POINT-OVERFLOW signalled
     (SIGNALS (<span class="org-warning">ERROR</span> 'FLOATING-POINT-OVERFLOW) 'DIVISION-BY-ZERO)

     1: ((<span class="org-keyword">FLET</span> <span class="org-string">"H0"</span> <span class="org-builtin">:IN</span> <span class="org-builtin">#:DROP-THRU-TAG-2</span>) arithmetic error FLOATING-POINT-OVERFLOW signalled)
     2: (SB-KERNEL::%SIGNAL arithmetic error FLOATING-POINT-OVERFLOW signalled)
     3: (<span class="org-warning">ERROR</span> FLOATING-POINT-OVERFLOW)
     4: ((<span class="org-keyword">LABELS</span> ROVE/CORE/ASSERTION::MAIN <span class="org-builtin">:IN</span> <span class="org-builtin">#:DROP-THRU-TAG-2</span>))
     5: ((<span class="org-keyword">FLET</span> <span class="org-string">"MAIN0"</span> <span class="org-builtin">:IN</span> <span class="org-builtin">#:DROP-THRU-TAG-2</span>))
     6: ((<span class="org-keyword">LAMBDA</span> NIL))
     7: ((<span class="org-keyword">LAMBDA</span> NIL <span class="org-builtin">:IN</span> RUN-TEST))
     8: ((<span class="org-builtin">:METHOD</span> ROVE/REPORTER:INVOKE-REPORTER (T T)) #&lt;SPEC-REPORTER PASSED=0, FAILED=1&gt; #&lt;FUNCTION (<span class="org-keyword">LAMBDA</span> NIL <span class="org-builtin">:IN</span> RUN-TEST) {102D9E34FB}&gt;)
     9: (SB-INT:SIMPLE-EVAL-IN-LEXENV (RUN-TEST (QUOTE T7-WRONG-ERROR)) #&lt;NULL-LEXENV&gt;)
     10: (EVAL (RUN-TEST (QUOTE T7-WRONG-ERROR)))
     11: (SWANK::EVAL-REGION (rove:run-test 't7-wrong-error)
     )
     12: ((<span class="org-keyword">LAMBDA</span> NIL <span class="org-builtin">:IN</span> SWANK-REPL::REPL-EVAL))
     13: (SWANK-REPL::TRACK-PACKAGE #&lt;FUNCTION (<span class="org-keyword">LAMBDA</span> NIL <span class="org-builtin">:IN</span> SWANK-REPL::REPL-EVAL) {102D9E317B}&gt;)
     14: (SWANK::CALL-WITH-RETRY-RESTART Retry SLIME REPL evaluation request. #&lt;FUNCTION (<span class="org-keyword">LAMBDA</span> NIL <span class="org-builtin">:IN</span> SWANK-REPL::REPL-EVAL) {102D9E311B}&gt;)
     15: (SWANK::CALL-WITH-BUFFER-SYNTAX NIL #&lt;FUNCTION (<span class="org-keyword">LAMBDA</span> NIL <span class="org-builtin">:IN</span> SWANK-REPL::REPL-EVAL) {102D9E30FB}&gt;)
</pre>
</div>
<p>
I am surprised, however, at the results if we change the assertion from <code>ok</code> to <code>ng</code>. We know it is going to be the wrong error, so I would have expected the <code>ng</code> assertion function to return a pass. But it does not.
</p>
<div class="org-src-container">
<pre class="src src-lisp">(deftest t7-wrong-error-NG
  (ng (signals (<span class="org-warning">error</span> 'floating-point-overflow)
          'division-by-zero)))

  &#215; 0) <span class="org-warning">Expect (</span><span class="org-warning"><span class="org-warning">ERROR</span></span><span class="org-warning"> 'FLOATING-POINT-OVERFLOW) not to signal DIVISION-BY-ZERO.</span>

&#215; 1 of 1 test failed

0) <span class="org-warning">t7-wrong-error-ng</span>
   Expect (<span class="org-warning">ERROR</span> 'FLOATING-POINT-OVERFLOW) not to signal DIVISION-BY-ZERO.
   FLOATING-POINT-OVERFLOW: arithmetic error FLOATING-POINT-OVERFLOW signalled
     (SIGNALS (<span class="org-warning">ERROR</span> 'FLOATING-POINT-OVERFLOW) 'DIVISION-BY-ZERO)
...
</pre>
</div>
<p>
<code>signals</code> returns true or an error. <code>ng</code> accepts T or nil and getting back an error triggers an error rather than a failure.
</p>
</div>
</li>

<li><a id="org5cb91fc"></a>Suites, tags and other multiple test abilities<br>
<ol class="org-ol">
<li><a id="org3e52999"></a>Lists of tests<br>
<div class="outline-text-5" id="text-28-3-5-1">
<p>
Rove does not run lists of tests.
</p>
</div>
</li>
<li><a id="orga5e9a92"></a>Suites<br>
<div class="outline-text-5" id="text-28-3-5-2">
<p>
Rove's RUN-SUITE function will run all the tests in a particular package but does not accept a style parameter and simply prints out the results of each individual test, without summarizing.
</p>

<p>
Rove's RUN function does accept a style parameter but seems to handle only package-inferred systems. I confirm issue #42 that it will not run with non-package inferred systems.
</p>

<p>
Since the author really likes the lots of packages style of structuring CL programs, I would not be surprised if he recommends having lots of test packages as the equivalent of how other testing frameworks treat suites of tests.
</p>
<div class="org-src-container">
<pre class="src src-lisp">(run-suite <span class="org-builtin">:tf-rove</span>)
</pre>
</div>

<p>
<a href="#org63aa282">top</a>
</p>
</div>
</li>
</ol>
</li>
<li><a id="org0a1a140"></a>Fixtures and Freezing Data<br>
<div class="outline-text-4" id="text-28-3-6">
<p>
Rove provides SETUP for fixtures that are done once only in a package and TEARDOWN for cleanup. For a fixture that should be run before and after every test, Rove provides DEFHOOK.
</p>
<div class="org-src-container">
<pre class="src src-lisp">(<span class="org-keyword">defparameter</span> <span class="org-variable-name">*my-var-suite*</span> 0)
(<span class="org-keyword">defparameter</span> <span class="org-variable-name">*my-var-hook*</span> 0)
(setup
  (incf *my-var-suite*))

(teardown
  (format t <span class="org-string">"Myvar ~a~%"</span> *my-var-suite*))

(defhook
    <span class="org-builtin">:before</span> (incf *my-var-hook*)
    <span class="org-builtin">:after</span> (format t <span class="org-string">"My-var-hook ~a~%"</span> *my-var-hook*))
</pre>
</div>
</div>
</li>
<li><a id="org19b0a05"></a>Removing tests<br>
<div class="outline-text-4" id="text-28-3-7">
<p>
None apparently
</p>
</div>
</li>
<li><a id="orga4bbd3c"></a>Sequencing, Random and Failure Only<br>
<div class="outline-text-4" id="text-28-3-8">
<p>
Everything is just done in sequential order. There is no obvious way to collect and run just failed tests.
</p>
</div>
</li>
<li><a id="org22c258a"></a>Skip Capability<br>
<ol class="org-ol">
<li><a id="orgafe914c"></a>Assertions<br>
<div class="outline-text-5" id="text-28-3-9-1">
<p>
Yes
</p>
</div>
</li>
<li><a id="org03bc1f7"></a>Tests<br>
<div class="outline-text-5" id="text-28-3-9-2">
<p>
No
</p>
</div>
</li>
<li><a id="org00a64de"></a>Implementation<br>
<div class="outline-text-5" id="text-28-3-9-3">
<p>
No
</p>
</div>
</li>
</ol>
</li>
<li><a id="orge3efa01"></a>Random Data Generators<br>
<div class="outline-text-4" id="text-28-3-10">
<p>
None
</p>
</div>
</li>
</ol>
</div>
<div id="outline-container-org884db10" class="outline-3">
<h3 id="org884db10"><span class="section-number-3">28.4.</span> Additional Discussion Points</h3>
<div class="outline-text-3" id="text-28-4">
<p>
The author claims rove is the successor to prove and cites the following differences. Rove supports package-inferred systems, has fewer dependencies, reports details of failure tests, has thread support and has fixtures.
</p>

<p>
Rove is clearly targetted at package-inferred systems. In fact some of the functionality doesn't work unless your system is package-inferred. Personally I do not like package-inferred systems. Other people have the completely opposite view. In any event I did not test any of the frameworks with a package inferred system so I cannot comment on whether they work or do not work in that circumstance.
</p>

<p>
To show that Rove actually is improved over Prove with respect to reporting details on failure, the following shows first prove, then rove on a simple
</p>
<div class="org-src-container">
<pre class="src src-lisp">(<span class="org-keyword">let</span> ((x 1) (y 2))
  (deftest t35
      (ok (= x y))))
</pre>
</div>
<p>
Running with Prove
</p>
<div class="org-src-container">
<pre class="src src-lisp">(run-test 't35)
T34-PROVE
&#215; NIL is expected to be T
</pre>
</div>
<p>
Now Rove:
</p>
<div class="org-src-container">
<pre class="src src-lisp">  (run-test 't35)
  t35
  &#215; 0) <span class="org-warning">Expect (= X Y) to be true.</span>

&#215; 1 of 1 test failed

0) <span class="org-warning">t34-rove</span>
   Expect (= X Y) to be true.
     (= X Y)
         X = 1
         Y = 2
NIL
</pre>
</div>
<p>
Both prove and rove would have accepted diagnostic message strings in the assertion.
</p>

<p>
On the whole, my concerns expressed in the summary still stand. There are better frameworks out there.
</p>
</div>
</div>
<div id="outline-container-org97c09c8" class="outline-3">
<h3 id="org97c09c8"><span class="section-number-3">28.5.</span> Who Uses</h3>
<div class="outline-text-3" id="text-28-5">
<p>
Many libraries on quicklisp use rove. If you have quicklisp, you can get a list of those with:
</p>
<div class="org-src-container">
<pre class="src src-lisp">(ql:who-depends-on <span class="org-builtin">:rove</span>)
</pre>
</div>

<p>
<a href="#org63aa282">top</a>
<a id="org55cd3c7"></a>
</p>
</div>
</div>
</div>
<div id="outline-container-orgaeb7141" class="outline-2">
<h2 id="orgaeb7141"><span class="section-number-2">29.</span> rt</h2>
<div class="outline-text-2" id="text-29">
</div>
<div id="outline-container-org9ce1118" class="outline-3">
<h3 id="org9ce1118"><span class="section-number-3">29.1.</span> Summary</h3>
<div class="outline-text-3" id="text-29-1">
<table>


<colgroup>
<col  class="org-left">

<col  class="org-left">

<col  class="org-left">

<col  class="org-right">
</colgroup>
<tbody>
<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">Kevin M. Rosenberg</td>
<td class="org-left">MIT</td>
<td class="org-right">2010</td>
</tr>
</tbody>
</table>
<p>
RT reminds me of Ptester (I wonder why) and is a part of CL history. See, e.g. <a href="https://www.merl.com/publications/docs/TR91-04.pdf">Supporting the Regression Testing of Lisp Programs</a> in 1991. Tests are limited to a single assertion and everything seems to be an A-B comparison using EQUAL. While you might think it is just of historical significance, there are still a surprising number of packages in quicklisp (29 at last count) that use it including major packages like ironclad, cffi, usocket, clsql and anaphora.
</p>
</div>
</div>

<div id="outline-container-org8b25cb7" class="outline-3">
<h3 id="org8b25cb7"><span class="section-number-3">29.2.</span> Assertion Functions</h3>
<div class="outline-text-3" id="text-29-2">
<p>
RT's tests do not accept multiple assertions. The test itself acts as an assertion that the included form is true or nil.
</p>

<p>
<a href="#org63aa282">top</a>
</p>
</div>
</div>
<div id="outline-container-org7690ebe" class="outline-3">
<h3 id="org7690ebe"><span class="section-number-3">29.3.</span> Usage</h3>
<div class="outline-text-3" id="text-29-3">
</div>
<ol class="org-ol">
<li><a id="orgbecfb4e"></a>Report Format and Basics<br>
<div class="outline-text-4" id="text-29-3-1">
<p>
We start with a basic passing test just to show the reporting.
</p>
<div class="org-src-container">
<pre class="src src-lisp">(deftest t1
  (= 1 1)
  t)

(<span class="org-keyword">do-test</span> 't1)
T1
<span class="org-comment-delimiter">; </span><span class="org-comment">processing (DEFTEST T4 ...)</span>
</pre>
</div>
<p>
Now a deliberately failing test:
</p>
<div class="org-src-container">
<pre class="src src-lisp">(deftest t1-fail
  (= 1 2)
  t)

(<span class="org-keyword">do-test</span> 't1-fail)

Test T1-FAIL failed
Form: (= 1 2)
Expected value: T
Actual value: NIL.
</pre>
</div>
</div>
</li>

<li><a id="org363ee93"></a>Multiple assertions, loops. closures and calling other tests<br>
<div class="outline-text-4" id="text-29-3-2">
<p>
RT tests do not handle multiple assertions, loops, closures or calling other tests
</p>
</div>
</li>
<li><a id="org22aadc1"></a>Suites, tags and other multiple test abilities<br>
<ol class="org-ol">
<li><a id="org52d45dd"></a>Lists of tests<br>
<div class="outline-text-5" id="text-29-3-3-1">
<p>
RT cannot directly handle lists of tests (although you could loop through list, the results would not be composable)
</p>
</div>
</li>
<li><a id="orgb51c675"></a>Suites<br>
<div class="outline-text-5" id="text-29-3-3-2">
<p>
RT does not have suites per se. You can run all the tests that have been defined using the <code>DO-TESTS</code> function. By default it prints to <code>*standard-output*</code> but accepts an optional stream parameter which would allow you to redirect the results to a file or other stream of your choice. <code>do-tests</code> will print the results for each individual test and then summarize with something like the following:
</p>
<div class="org-src-container">
<pre class="src src-lisp">5 out of 8 total tests failed: T4, T1-FAIL, T1-FUNCTION, T2-LOOP,
   T2-LOOP-CLOSURE.
</pre>
</div>
</div>
</li>
</ol>
</li>

<li><a id="org0a7bf84"></a>Fixtures and Freezing Data<br>
<div class="outline-text-4" id="text-29-3-4">
<p>
None, although rt's package which tests rt has a setup macro that could have been placed in the rt package to use for fixtures. You could use it for reference in writing your own.
</p>
</div>
</li>
<li><a id="org49034bc"></a>Removing tests<br>
<div class="outline-text-4" id="text-29-3-5">
<p>
RT has functions for <code>rem-test</code> and <code>rem-all-tests</code>.
</p>
</div>
</li>
<li><a id="org193cbb8"></a>Sequencing, Random and Failure Only<br>
<div class="outline-text-4" id="text-29-3-6">
<p>
RT runs tests in their order of original definition.
</p>
</div>
</li>
<li><a id="org4f9f3f0"></a>Skip Capability<br>
<div class="outline-text-4" id="text-29-3-7">
<p>
None
</p>
</div>
</li>
<li><a id="orga37565d"></a>Random Data Generators<br>
<div class="outline-text-4" id="text-29-3-8">
<p>
None
</p>
</div>
</li>
</ol>
</div>
<div id="outline-container-orgd13f531" class="outline-3">
<h3 id="orgd13f531"><span class="section-number-3">29.4.</span> Discussion</h3>
<div class="outline-text-3" id="text-29-4">
<p>
While it is still used in major projects, I think Parachute or Fiasco would be better if you are starting a new project.
</p>

<p>
<a href="#org63aa282">top</a>
</p>
</div>
</div>

<div id="outline-container-org0d60b22" class="outline-3">
<h3 id="org0d60b22"><span class="section-number-3">29.5.</span> Who depends on rt?</h3>
<div class="outline-text-3" id="text-29-5">
<p>
("anaphora" "cffi" "cl-azure" "cl-cont" "cl-irc"
 "cl-performance-tuning-helper" "cl-photo" "cl-sentiment"
 "cl-store" "clsql" "cxml-stp/" "hyperobject"
 "infix-dollar-reader" "ironclad" "kmrcl" "lapack"
 "lml" "lml2" "narrowed-types" "nibbles/s" "osicat"
 "petit.string-utils" "qt" "quadpack" "trivial-features"
 "trivial-garbage" "umlisp" "usocket" "xhtmlgen")
</p>

<p>
<a href="#org63aa282">top</a>
</p>
</div>
</div>
</div>

<div id="outline-container-org5279729" class="outline-2">
<h2 id="org5279729"><span class="section-number-2">30.</span> should-test</h2>
<div class="outline-text-2" id="text-30">
</div>
<div id="outline-container-org9498618" class="outline-3">
<h3 id="org9498618"><span class="section-number-3">30.1.</span> Summary</h3>
<div class="outline-text-3" id="text-30-1">
<table>


<colgroup>
<col  class="org-left">

<col  class="org-left">

<col  class="org-left">

<col  class="org-right">
</colgroup>
<tbody>
<tr>
<td class="org-left"><a href="https://github.com/vseloved/should-test">homepage</a></td>
<td class="org-left">Vsevolod Dyomkin</td>
<td class="org-left">MIT</td>
<td class="org-right">2019</td>
</tr>
</tbody>
</table>
<p>
Should test is pretty basic. It will report all the failing assertions in a test and does offer the opportunity to provide diagnostic strings to assertions, albeit without variables. It does offer the opportunity to just run the tests that failed last time, so you do not have to run through all the tests in the package every time. Unfortunately you cannot turn off progress reporting, you cannot go interactive into the debugger, it has no fixture capacity and cannot run lists of tests. Its suite capability are limited to you creating separate packages.
</p>
</div>
</div>
<div id="outline-container-org8e42191" class="outline-3">
<h3 id="org8e42191"><span class="section-number-3">30.2.</span> Assertion Functions</h3>
<div class="outline-text-3" id="text-30-2">
<p>
Assertion types are the minimal
</p>
<table>


<colgroup>
<col  class="org-left">

<col  class="org-left">

<col  class="org-left">
</colgroup>
<tbody>
<tr>
<td class="org-left">be</td>
<td class="org-left">signal</td>
<td class="org-left">print-to</td>
</tr>
</tbody>
</table>

<p>
<a href="#org63aa282">top</a>
</p>
</div>
</div>
<div id="outline-container-org8ef12a0" class="outline-3">
<h3 id="org8ef12a0"><span class="section-number-3">30.3.</span> Usage</h3>
<div class="outline-text-3" id="text-30-3">
</div>
<ol class="org-ol">
<li><a id="org5922c50"></a>Report Format<br>
<div class="outline-text-4" id="text-30-3-1">
<p>
The summary report will contain full failure reports if <code>*verbose*</code> is set to T (the default) or just test names otherwise.
</p>

<p>
There is no optionality with respect to reporting or interactive. It is all reporting.
</p>
</div>
</li>
<li><a id="org2fee492"></a>Basics<br>
<div class="outline-text-4" id="text-30-3-2">
<p>
The basic all assertions passing test showing use of both <code>be</code> and <code>signal</code>. Calling <code>test</code> with the keyword parameter <code>:test</code> enables us to specify the test to be run. One item that is not clear is function of the empty form following the test name.
</p>
<div class="org-src-container">
<pre class="src src-lisp">(deftest t1 ()
  (should be = 1 1)
  (should signal division-by-zero (<span class="org-warning">error</span> 'division-by-zero)))

(test <span class="org-builtin">:test</span> 't1)
Test T1:   OK
T
</pre>
</div>
<p>
It just reported that the entire test passed.
</p>

<p>
Now a basic failing test. This should have two failing assertions and one passing assertion. We put a diagnostic string in the first test which shows in the result but it does not allow us to insert variables into the string.
</p>
<div class="org-src-container">
<pre class="src src-lisp">(deftest t1-fail ()
  <span class="org-string">"describe t1-fail"</span>
  (<span class="org-keyword">let</span> ((x 1)(y 2))
    (should be = x y <span class="org-string">"intentional failure x ~a y ~a"</span> x y)
    (should be = (+ x 2) (+ x 3))
    (should be equal (values 1 2) (values 1 2))
    (should signal division-by-zero (<span class="org-warning">error</span> 'floating-point-overflow))))

(test <span class="org-builtin">:test</span> 't1-fail)
Test T1-FAIL:
Y FAIL
expect: 1 2 <span class="org-string">"intentional failure x ~a y ~a"</span> 1
actual: 2
(+ X 3) FAIL
expect: 3
actual: 4
(<span class="org-warning">ERROR</span> 'FLOATING-POINT-OVERFLOW) FAIL
expect: DIVISION-BY-ZERO
actual: #&lt;FLOATING-POINT-OVERFLOW {1009B89F63}&gt;
  FAILED
NIL
(#&lt;FLOATING-POINT-OVERFLOW {1009B89F63}&gt; (4) (2))
NIL
</pre>
</div>
<p>
Should-test has no special functionality for dealing with values expressions. It does accept them but as you would expect only looks at the first value in each values epxression. The following will pass.
</p>
<div class="org-src-container">
<pre class="src src-lisp">(deftest t1-unequal-values ()
  (should be equal (values 1 2) (values 1 3)))
</pre>
</div>
<p>
We get the expected and actual values without the extra blank lines that annoy me in fiveam. The list at the end shows the specific actual assertion values that failed.
</p>

<p>
If we had set <code>*verbose*</code> to nil we would have just gotten the last three lines of the report.
</p>
<div class="org-src-container">
<pre class="src src-lisp">Test T1-FAIL:   FAILED
NIL
((4) (2))
NIL
</pre>
</div>

<p>
Should-test handles redefinitions of tested functions without forcing you to manually recompile the test. We will skip the proof.
</p>
</div>
</li>

<li><a id="org5b2afe7"></a>Edge Cases: Closures and calling other tests<br>
<ol class="org-ol">
<li><a id="org6cbf6fa"></a>Looping and closures.<br>
<div class="outline-text-5" id="text-30-3-3-1">
<p>
Should-test cannot access the variables declared in a closure encompassing the test. This does not work:
</p>
<div class="org-src-container">
<pre class="src src-lisp">(<span class="org-keyword">let</span> ((l1 '(#\a #\B #\z))
      (l2 '(97 66 122)))
  (deftest t2-loop-closure ()
    (<span class="org-keyword">loop</span> for x in l1 for y in l2 do
      (should be = (char-code x) y))))
</pre>
</div>
</div>
</li>
<li><a id="org2f1d55b"></a>Calling other tests<br>
<div class="outline-text-5" id="text-30-3-3-2">
<p>
Suppose you defined a test which also calls another test.
</p>
<div class="org-src-container">
<pre class="src src-lisp">(deftest t3 ()
  (should be = 1 1)
  (test <span class="org-builtin">:test</span> 't1-fail))
</pre>
</div>
<p>
We know that t1-fail will fail. Will embedding it in test t3 cause t3 to fail as well? Yes.
</p>
<div class="org-src-container">
<pre class="src src-lisp">Test T3: Test T1-FAIL:
Y FAIL
expect: 1 2 <span class="org-string">"intentional failure x ~a y ~a"</span> 1
actual: 2
(+ X 3) FAIL
expect: 3
actual: 4
(<span class="org-warning">ERROR</span> 'FLOATING-POINT-OVERFLOW) FAIL
expect: DIVISION-BY-ZERO
actual: #&lt;FLOATING-POINT-OVERFLOW {100A218BC3}&gt;
  FAILED
  FAILED
NIL
(#&lt;FLOATING-POINT-OVERFLOW {100A218BC3}&gt; (4) (2))
NIL
</pre>
</div>
</div>
</li>
</ol>
</li>

<li><a id="orge99192b"></a>Suites, tags and other multiple test abilities<br>
<ol class="org-ol">
<li><a id="orgddd7887"></a>Lists of tests<br>
<div class="outline-text-5" id="text-30-3-4-1">
<p>
Should-test does not handle lists of tests.
</p>
</div>
</li>
<li><a id="org008d1b1"></a>Suites<br>
<div class="outline-text-5" id="text-30-3-4-2">
<p>
The <code>test</code> function for Should-test runs all the tests in the current package by default. As you have seen above, giving it a :test keyword parameter will trigger just the named test. Giving it a :package keyword parameter will cause it to run all the tests in the specified package. The :failed key to <code>test</code> will re-test only the tests which failed at their last run. All in all, there are better frameworks.
</p>
<div class="org-src-container">
<pre class="src src-lisp">(test <span class="org-builtin">:failed</span> t)
</pre>
</div>
<p>
<a href="#org63aa282">top</a>
</p>
</div>
</li>
</ol>
</li>
<li><a id="org9bbfc79"></a>Fixtures and Freezing Data<br>
<div class="outline-text-4" id="text-30-3-5">
<p>
None
</p>
</div>
</li>
<li><a id="orge0d13b3"></a>Removing tests<br>
<div class="outline-text-4" id="text-30-3-6">
<p>
None
</p>
</div>
</li>
<li><a id="orgef0a65c"></a>Sequencing or Random<br>
<div class="outline-text-4" id="text-30-3-7">
<p>
Should-test will run tests in the same order each time (no shuffle capability). As noted in the suite discussion, it is one of the few frameworks to have failure only functionality built in.
</p>
<div class="org-src-container">
<pre class="src src-lisp">(test <span class="org-builtin">:failed</span> t)
</pre>
</div>
</div>
</li>
<li><a id="org1395f86"></a>Skip Capability<br>
<div class="outline-text-4" id="text-30-3-8">
<p>
None
</p>
</div>
</li>
<li><a id="org77db941"></a>Random Data Generators<br>
<div class="outline-text-4" id="text-30-3-9">
<p>
None
</p>

<p>
<a href="#org63aa282">top</a>
</p>
</div>
</li>
</ol>
</div>

<div id="outline-container-orgdf5ddbe" class="outline-3">
<h3 id="orgdf5ddbe"><span class="section-number-3">30.4.</span> Who Depends on Should-test</h3>
<div class="outline-text-3" id="text-30-4">
<p>
("cl-redis-test" "mexpr-tests" "rutils-test)
</p>

<p>
<a href="#org63aa282">top</a>
<a id="org209a1fe"></a>
</p>
</div>
</div>
</div>
<div id="outline-container-org481b762" class="outline-2">
<h2 id="org481b762"><span class="section-number-2">31.</span> simplet</h2>
<div class="outline-text-2" id="text-31">
</div>
<div id="outline-container-org42db8f3" class="outline-3">
<h3 id="org42db8f3"><span class="section-number-3">31.1.</span> Summary</h3>
<div class="outline-text-3" id="text-31-1">
<table>


<colgroup>
<col  class="org-left">

<col  class="org-left">

<col  class="org-left">

<col  class="org-right">
</colgroup>
<tbody>
<tr>
<td class="org-left"><a href="https://github.com/noloop/simplet">homepage</a></td>
<td class="org-left">Noloop</td>
<td class="org-left">GPLv3</td>
<td class="org-right">2019</td>
</tr>
</tbody>
</table>

<p>
In simplet, tests can have only one assertion that they get from some function and suites can take multiple tests. From the standpoint of other frameworks, simplet "tests" are the assertion clauses and simplet "suites" are the way to package multiple assertions. If a suite has no tests, or a test has no function returning T or NIL, they are marked "PENDING".
</p>

<p>
Simplet's <code>run</code> function takes only an optional parameter to return a string rather than printing to the REPL.
</p>

<p>
I am just going to show one example of usage and leave it at that. Given all the functionality in other frameworks, I cannot recommend.
</p>

<div class="org-src-container">
<pre class="src src-lisp">(suite <span class="org-string">"suite 2"</span>
       (test <span class="org-string">"one"</span>
         #'(<span class="org-keyword">lambda</span> ()
             (<span class="org-keyword">let</span> ((x 1))
               (= x 1))))
       (test <span class="org-string">"two"</span>
         #'(<span class="org-keyword">lambda</span> ()(eq 'a 'a)))
       (test <span class="org-string">"three"</span> #'(<span class="org-keyword">lambda</span> ()(= 2 1)))
       (test <span class="org-string">"four"</span> #'(<span class="org-keyword">lambda</span> ()(= 1 1))))
(#&lt;FUNCTION (<span class="org-keyword">LAMBDA</span> () <span class="org-builtin">:IN</span> NOLOOP.SIMPLET::CREATE-SUITE) {100A391A6B}&gt;)

(run)
#...Simplet...#

one: T
two: T
three: NIL
four: T
-----------------------------------
suite 2: NIL

Runner result: NIL

NIL
</pre>
</div>
<p>
The author uses simplet in testing <a href="https://github.com/noloop/assert-p">assert-p</a>, <a href="https://github.com/noloop/eventbus">eventbus</a> and <a href="https://github.com/noloop/skeleton-creator">skeleton-creator</a>
</p>
</div>
</div>
</div>

<div id="outline-container-orgdc1cd10" class="outline-2">
<h2 id="orgdc1cd10"><span class="section-number-2">32.</span> tap-unit-test</h2>
<div class="outline-text-2" id="text-32">
</div>
<div id="outline-container-org543cba8" class="outline-3">
<h3 id="org543cba8"><span class="section-number-3">32.1.</span> Summary</h3>
<div class="outline-text-3" id="text-32-1">
<table>


<colgroup>
<col  class="org-left">

<col  class="org-left">

<col  class="org-left">

<col  class="org-right">
</colgroup>
<tbody>
<tr>
<td class="org-left"><a href="https://github.com/jhanley634/tap-unit-test">homepage</a></td>
<td class="org-left">Christopher K. Riesbeck, John Hanley</td>
<td class="org-left">MIT</td>
<td class="org-right">2017</td>
</tr>
</tbody>
</table>

<p>
Tap-unit-test is a version of a slightly older version of lisp-unit with TAP reporting. There have not been any real updates since 2011 and I cannot find anyone using it, so I would simply look to either lisp-unit or lisp-unit2 if you like their approach to things.
</p>
</div>
</div>
<div id="outline-container-orgfbf2bce" class="outline-3">
<h3 id="orgfbf2bce"><span class="section-number-3">32.2.</span> Assertion Functions</h3>
<div class="outline-text-3" id="text-32-2">
<table>


<colgroup>
<col  class="org-left">

<col  class="org-left">

<col  class="org-left">

<col  class="org-left">
</colgroup>
<tbody>
<tr>
<td class="org-left">assert-eq</td>
<td class="org-left">assert-eql</td>
<td class="org-left">assert-equal</td>
<td class="org-left">assert-equality</td>
</tr>

<tr>
<td class="org-left">assert-equalp</td>
<td class="org-left">assert-error</td>
<td class="org-left">assert-expands</td>
<td class="org-left">assert-false</td>
</tr>

<tr>
<td class="org-left">assert-prints</td>
<td class="org-left">assert-true</td>
<td class="org-left">fail</td>
<td class="org-left">logically-equal</td>
</tr>

<tr>
<td class="org-left">set-equal</td>
<td class="org-left">unordered-equal</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>
</tbody>
</table>

<p>
<a href="#org63aa282">top</a>
</p>
</div>
</div>
<div id="outline-container-orge3f754f" class="outline-3">
<h3 id="orge3f754f"><span class="section-number-3">32.3.</span> Usage</h3>
<div class="outline-text-3" id="text-32-3">
</div>
<ol class="org-ol">
<li><a id="org3143d88"></a>Report Format and basic syntax<br>
<div class="outline-text-4" id="text-32-3-1">
<p>
TAP-unit-test defaults to a reporting format shown below. You can do <code>(setf *use-debugger* :ask)</code> or <code>(setf *use-debugger* t)</code>, but that will only throw you into the debugger if there is an actual error generated, not a failure (or failure to see the correct error).
</p>

<p>
We can start with a basic failing test to show the reporting format. We will provide a diagnostic string in the first assertion. Tap-unit-test has an unordered-equal assertion helper that might be useful for some which is shown in this example:
</p>
<div class="org-src-container">
<pre class="src src-lisp">(<span class="org-keyword">define-test</span> t1-fail
  <span class="org-string">"describe t1-fail"</span>
  (<span class="org-keyword">let</span> ((x 1))
    (<span class="org-warning">assert-true</span> (= x 2) <span class="org-string">"Deliberate failure. We know 2 is not ~a"</span> x)
    (<span class="org-warning">assert-equal</span> x 3)
    (<span class="org-warning">assert-true</span> (unordered-equal '(3 2 1 1) '(1 2 3 2))) <span class="org-comment">; Return true if l1 is a permuation of l2.</span>
    (<span class="org-warning">assert-true</span> (set-equal '(a b c d) '(b a c c))) <span class="org-comment">;every element in both sets needs to be in the other</span>
    (<span class="org-warning">assert-error</span> 'division-by-zero
                  (<span class="org-warning">error</span> 'floating-point-overflow)
                  <span class="org-string">"testing condition assertions"</span>)
    (<span class="org-warning">assert-true</span> (unordered-equal '(3 2 1) '(1 3 4)))
    (<span class="org-warning">assert-true</span> (logically-equal t nil)) <span class="org-comment">; both true or both false</span>
    (<span class="org-warning">assert-true</span> (logically-equal nil t)))) <span class="org-comment">; both true or both false</span>
</pre>
</div>
<p>
Unlike lisp-unit, when you call <code>run-tests</code> in tap-unit-test, you call unquoted test names, even when you are running it on several tests. Also note that it does not return any type of object as a test result. If we now run it we get the following report:
</p>
<div class="org-src-container">
<pre class="src src-lisp">(run-tests t1-fail)

T1-FAIL: (= X 2) failed:
Expected T but saw NIL
   <span class="org-string">"Deliberate failure. We know 2 is not ~a"</span> =&gt; <span class="org-string">"Deliberate failure. We know 2 is not ~a"</span>
   X =&gt; 1
T1-FAIL: 3 failed:
Expected 1 but saw 3
T1-FAIL: (UNORDERED-EQUAL '(3 2 1 1) '(1 2 3 2)) failed:
Expected T but saw NIL
T1-FAIL: (SET-EQUAL '(A B C D) '(B A C C)) failed:
Expected T but saw NIL
T1-FAIL: (<span class="org-warning">ERROR</span> 'FLOATING-POINT-OVERFLOW) failed:
Should have signalled DIVISION-BY-ZERO but saw #&lt;FLOATING-POINT-OVERFLOW {100D41D203}&gt;
   <span class="org-string">"testing condition assertions"</span> =&gt; <span class="org-string">"testing condition assertions"</span>
T1-FAIL: (UNORDERED-EQUAL '(3 2 1) '(1 3 4)) failed:
Expected T but saw NIL
T1-FAIL: (LOGICALLY-EQUAL T NIL) failed:
Expected T but saw NIL
T1-FAIL: (LOGICALLY-EQUAL NIL T) failed:
Expected T but saw NIL
T1-FAIL: 0 assertions passed, 8 failed.
NIL
</pre>
</div>

<p>
Tap-unit test does not need to manually recompile tests when a tested function is modified. We will skip the proof.
</p>
</div>
<ol class="org-ol">
<li><a id="orgeb0bb51"></a>Edge Cases: Value expressions, closures and calling other tests<br>
<ol class="org-ol">
<li><a id="orgfa3c47b"></a>Values expressions<br>
<div class="outline-text-6" id="text-32-3-1-1-1">
<p>
Tap-unit-test has no special functionality for dealing with values expressions. It does accept them as input, but as expected, only compares the first value in a values expression.
</p>
<div class="org-src-container">
<pre class="src src-lisp">(<span class="org-keyword">define-test</span> t2
  <span class="org-string">"describe t2"</span>
  (<span class="org-warning">assert-equal</span> 1 2)
  (<span class="org-warning">assert-equal</span> 2 3)
  (<span class="org-warning">assert-equalp</span> (values 1 2) (values 1 2)))

(run-tests t2)
</pre>
</div>
<p>
We get what we expected, two failing assertions and one passing assertion. Does tap-unit-test follow the lisp-unit ability to actually look at all members of the values expression or just the first one? Yes. So far only the two lisp-units and tap-unit-test actually compared each item in two values expressions.
</p>
<div class="org-src-container">
<pre class="src src-lisp">(<span class="org-keyword">define-test</span> t2-values-expressions
    (<span class="org-warning">assert-equal</span> (values 1 2) (values 1 3))
    (<span class="org-warning">assert-equal</span> (values 1 2 3) (values 1 3 2)))

(run-tests t2-values-expressions)
T2-VALUES-EXPRESSIONS: (VALUES 1 3) failed:
Expected 1<span class="org-comment">; 2 but saw 1; 3</span>
T2-VALUES-EXPRESSIONS: (VALUES 1 3 2) failed:
Expected 1<span class="org-comment">; 2; 3 but saw 1; 3; 2</span>
T2-VALUES-EXPRESSIONS: 0 assertions passed, 2 failed.
</pre>
</div>
</div>
</li>
<li><a id="org9d91a66"></a>Closures<br>
<div class="outline-text-6" id="text-32-3-1-1-2">
<p>
Unfortunately no luck with closure variables. It does, however, handle looping through assertions if the variables are dynamic or defined within the test. We will skip the proof.
</p>
</div>
</li>
</ol>
</li>

<li><a id="org2baff23"></a>Calling another test<br>
<div class="outline-text-5" id="text-32-3-1-2">
<p>
While tests are not functions in tap-unit-test, they can call other tests.
</p>
<div class="org-src-container">
<pre class="src src-lisp">(<span class="org-keyword">define-test</span> t3 ()
  <span class="org-string">"describe t3"</span>
  (<span class="org-warning">assert-equal</span> 'a 'a)

(run-tests t2))
(run-tests t3)
T2: 2 failed:
Expected 1 but saw 2
T2: 3 failed:
Expected 2 but saw 3
T2: 1 assertions passed, 2 failed.
T3: 1 assertions passed, 0 failed.
</pre>
</div>
</div>
</li>
</ol>
</li>
<li><a id="org93ef397"></a>Suites, tags and other multiple test abilities<br>
<ol class="org-ol">
<li><a id="org960cc4b"></a>Lists of tests<br>
<div class="outline-text-6" id="text-32-3-2-0-1">
<p>
As mentioned earlier, tap-unit-test uses unquoted test names and does not return any kind of test-results object. Running multiple specific tests would look like the following.
</p>
<div class="org-src-container">
<pre class="src src-lisp">(run-tests t7-bad-error t1-fail)
T7-BAD-ERROR: (<span class="org-warning">ERROR</span> 'FLOATING-POINT-OVERFLOW) failed:
Should have signalled DIVISION-BY-ZERO but saw #&lt;FLOATING-POINT-OVERFLOW {100BEDBFA3}&gt;
   <span class="org-string">"testing condition assertions. This should fail"</span> =&gt; <span class="org-string">"testing condition assertions. This should fail"</span>
T7-BAD-ERROR: 0 assertions passed, 1 failed.
T1-FAIL: Y failed:
Expected 1 but saw 2
12
T1-FAIL: 1 assertions passed, 1 failed.
TOTAL: 1 assertions passed, 2 failed, 0 execution errors.
</pre>
</div>
</div>
</li>
<li><a id="org2b6bf49"></a>Packages<br>
<div class="outline-text-6" id="text-32-3-2-0-2">
<p>
If you want to run all the tests in a package, just call <code>run-tests</code> with no parameters
</p>
</div>
</li>
<li><a id="org7fbd4c3"></a>Suites and Tags<br>
<div class="outline-text-6" id="text-32-3-2-0-3">
<p>
Tap-unit-test has no suites or tags capability
</p>
</div>
</li>
</ol>
</li>
<li><a id="org14d997f"></a>Fixtures and Freezing Data<br>
<div class="outline-text-4" id="text-32-3-3">
<p>
None
</p>
</div>
</li>
<li><a id="orgcdc90fd"></a>Removing tests<br>
<div class="outline-text-4" id="text-32-3-4">
<p>
Tap-unit-test has a <code>remove-tests</code> function which actually does take a quoted list of test names unlike some of the other functions which use unquoted names.
</p>
<div class="org-src-container">
<pre class="src src-lisp">(remove-tests '(t1 t2))
</pre>
</div>
</div>
</li>
<li><a id="org9c237a7"></a>Sequencing, Random and Failure Only<br>
<div class="outline-text-4" id="text-32-3-5">
<p>
None
</p>
</div>
</li>
<li><a id="org3bc1e87"></a>Skip Capability<br></li>
<li><a id="org65e6d0d"></a>Generators<br>
<div class="outline-text-4" id="text-32-3-7">
<p>
Tap-unit-test has a <code>make-random-state</code> function for generating random data. See example below:
</p>
<div class="org-src-container">
<pre class="src src-lisp">(make-random-state)
#S(RANDOM-STATE <span class="org-builtin">:STATE</span> #.(MAKE-ARRAY 627 <span class="org-builtin">:ELEMENT-TYPE</span> '(UNSIGNED-BYTE 32)
                                     <span class="org-builtin">:INITIAL-CONTENTS</span>
                                     '(0 2567483615 454 2531281407 4203062579
                                       3352536227 284404050 622556438
                                       ...)))
</pre>
</div>
</div>
</li>
</ol>
</div>
<div id="outline-container-org00741e9" class="outline-3">
<h3 id="org00741e9"><span class="section-number-3">32.4.</span> Discussion</h3>
<div class="outline-text-3" id="text-32-4">
<p>
Basically lisp-unit and lisp-unit2 have moved on and tap-unit-test exists for historical reasons. There are enough syntactic differences that if someone is using it for an existing code base, pulling it out of quicklisp could be a breakage. No one is using it As far as I can tell.
</p>

<p>
<a href="#org63aa282">top</a>
<a id="orgd9a48e8"></a>
</p>
</div>
</div>
</div>
<div id="outline-container-org34a2285" class="outline-2">
<h2 id="org34a2285"><span class="section-number-2">33.</span> try</h2>
<div class="outline-text-2" id="text-33">
<p>
<a href="#org63aa282">top</a>
</p>
</div>
<div id="outline-container-orgf56351b" class="outline-3">
<h3 id="orgf56351b"><span class="section-number-3">33.1.</span> Summary</h3>
<div class="outline-text-3" id="text-33-1">
<table border="2" rules="all" frame="border">


<colgroup>
<col  class="org-left">

<col  class="org-left">

<col  class="org-left">

<col  class="org-right">
</colgroup>
<tbody>
<tr>
<td class="org-left"><a href="https://github.com/melisgl/try">homepage</a></td>
<td class="org-left">Gábor Melis</td>
<td class="org-left">MIT</td>
<td class="org-right">2022</td>
</tr>
</tbody>
</table>
<p>
Try's self description is:
</p>

<p>
"Try is what we get if we make tests functions and build a test framework on top of the condition system as Stefil did but also address the issue of rerunning and replaying, make the IS check more capable, use the types of the condition hierarchy to parameterize what to debug, print, rerun, and finally document the whole thing."
</p>

<p>
"Try is a library for unit testing with equal support for interactive and non-interactive workflows. Tests are functions, and almost everything else is a condition, whose types feature prominently in parameterization."
</p>
</div>
</div>

<div id="outline-container-org8cc688a" class="outline-3">
<h3 id="org8cc688a"><span class="section-number-3">33.2.</span> Assertion Functions</h3>
<div class="outline-text-3" id="text-33-2">
<table>


<colgroup>
<col  class="org-left">

<col  class="org-left">

<col  class="org-left">

<col  class="org-left">

<col  class="org-left">
</colgroup>
<tbody>
<tr>
<td class="org-left">is</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">expected-result-success</td>
<td class="org-left">unexpected-result-success</td>
<td class="org-left">expected-result-failure</td>
<td class="org-left">unexpected-result-failure</td>
<td class="org-left">&#xa0;</td>
</tr>
</tbody>
</table>


<p>
<a href="#org63aa282">top</a>
</p>
</div>
</div>
<div id="outline-container-org8e186be" class="outline-3">
<h3 id="org8e186be"><span class="section-number-3">33.3.</span> Usage</h3>
<div class="outline-text-3" id="text-33-3">
</div>
<ol class="org-ol">
<li><a id="org1357d8e"></a>Basics and Report Format<br>
<ol class="org-ol">
<li><a id="org1aa49a4"></a>Interactive<br>
<div class="outline-text-5" id="text-33-3-1-1">
<p>
The default format is interactive and throws you into the debugger. Each defined test is a lisp function that records its execution in "trial" objects.
</p>
</div>

<ol class="org-ol">
<li><a id="orgccbb853"></a>Basic Passing Test<br>
<div class="outline-text-6" id="text-33-3-1-1-1">
<p>
Here we define a test that takes one parameter and then call the test with a parameter we know will pass and see the results.
</p>
<div class="org-src-container">
<pre class="src src-lisp">(deftest test1-pass (x)
     (is (= x 1)))
</pre>
</div>
<p>
We can either funcall the test or just call it directly (test1-pass 1)
</p>
<div class="org-src-container">
<pre class="src src-lisp">  (test1-pass 1)

TEST1-PASS
  &#8901; (IS (= X 1))
&#8901; TEST1-PASS &#8901;1
#&lt;TRIAL (TEST1-PASS 1) EXPECTED-SUCCESS 0.000s &#8901;1&gt;
</pre>
</div>
<p>
The first line shows the beginning of a defined test, the second the successful assertion, the third the cumulative test result and the fourth indicates what was recorded in the trial object. If you look at the last three lines, the dot before the 1 is a "marker" that indicates an a "category" of expected success and the 1 represents the number of expected successes actually found.
</p>

<p>
The total list of categories and their markers is:
</p>
<div class="org-src-container">
<pre class="src src-lisp">((abort*             <span class="org-builtin">:marker</span> <span class="org-string">"&#8863;"</span>)
 (unexpected-failure <span class="org-builtin">:marker</span> <span class="org-string">"&#8864;"</span>)
 (unexpected-success <span class="org-builtin">:marker</span> <span class="org-string">"&#8865;"</span>)
 (skip               <span class="org-builtin">:marker</span> <span class="org-string">"-"</span>)
 (expected-failure   <span class="org-builtin">:marker</span> <span class="org-string">"&#215;"</span>)
 (expected-success   <span class="org-builtin">:marker</span> <span class="org-string">"&#8901;"</span>))
</pre>
</div>
</div>
</li>

<li><a id="orgaa39651"></a>Basic Failing Test<br>
<div class="outline-text-6" id="text-33-3-1-1-2">
<p>
The following has two assertions, both of which fail. In this case we will funcall the test and it will throw us into the debugger with restarts. We would get the same result if we just called it as a normal function (t1-fail):
</p>
<div class="org-src-container">
<pre class="src src-lisp">  (deftest t1-fail ()
  (<span class="org-keyword">let</span> ((x 1) (y 2))
   (is (equal 1 2))
    (is (= x y)
        <span class="org-builtin">:msg</span> <span class="org-string">"Intentional failure x does not equal y"</span>
        <span class="org-builtin">:ctx</span> (<span class="org-string">"*PACKAGE* is ~S and *PRINT-CASE* is ~S~%"</span>
             *package* *print-case*))))

  (funcall 't1-fail)

  UNEXPECTED-FAILURE in check:
  (IS (EQUAL 1 2))
   [Condition of type UNEXPECTED-RESULT-FAILURE]

Restarts:
 0: [RECORD-EVENT] Record the event and continue.
 1: [FORCE-EXPECTED-SUCCESS] Change outcome to TRY:EXPECTED-RESULT-SUCCESS.
 2: [FORCE-UNEXPECTED-SUCCESS] Change outcome to TRY:UNEXPECTED-RESULT-SUCCESS.
 3: [FORCE-EXPECTED-FAILURE] Change outcome to TRY:EXPECTED-RESULT-FAILURE.
 4: [ABORT-CHECK] Change outcome to TRY:RESULT-ABORT*.
 5: [SKIP-CHECK] Change outcome to TRY:RESULT-SKIP.
 6: [RETRY-CHECK] Retry check.
 7: [ABORT-TRIAL] Record the event and abort trial UAX-15-TRY-TESTS::T1-FAIL.
 8: [SKIP-TRIAL] Record the event and skip trial UAX-15-TRY-TESTS::T1-FAIL.
 9: [RETRY-TRIAL] Record the event and retry trial UAX-15-TRY-TESTS::T1-FAIL.
 10: [SET-TRY-DEBUG] Supply a new value for <span class="org-builtin">:DEBUG</span> of TRY:TRY.
 11: [RETRY] Retry SLIME REPL evaluation request.
 12: [*ABORT] Return to SLIME's top level.
 13: [ABORT] abort thread (#&lt;THREAD <span class="org-string">"new-repl-thread"</span> RUNNING {1002487C03}&gt;)

Backtrace:
  0: (TRY::SIGNAL-OUTCOME T FAILURE (<span class="org-builtin">:CHECK</span> (IS (EQUAL 1 2)) <span class="org-builtin">:ELAPSED-SECONDS</span> 0 <span class="org-builtin">:CAPTURES</span> NIL ...))
  1: ((<span class="org-keyword">FLET</span> <span class="org-string">"DEFTEST"</span> <span class="org-builtin">:IN</span> T1-FAIL) #&lt;unused argument&gt;)
  2: (TRY::CALL-TEST)
  3: (T1-FAIL)
</pre>
</div>
<p>
If you call restart 13 to abort, the REPL prints out the following:
</p>
<div class="org-src-container">
<pre class="src src-lisp">  T1-FAIL
  &#8863; non-local exit
&#8863; T1-FAIL &#8863;1
</pre>
</div>
<p>
You can see the markers summarizing the conditions being triggered in the line items and the net result.
</p>

<p>
Now lets tell it that we expect failure
</p>
<div class="org-src-container">
<pre class="src src-lisp">  (deftest t1-expected-fail ()
    (<span class="org-keyword">with-failure-expected</span> (t)
        (<span class="org-keyword">let</span> ((x 1) (y 2))
          (is (equal 1 2))
          (is (= x y)
              <span class="org-builtin">:msg</span> <span class="org-string">"Intentional failure x does not equal y"</span>
              <span class="org-builtin">:ctx</span> (<span class="org-string">"*PACKAGE* is ~S and *PRINT-CASE* is ~S~%"</span>
                    *package* *print-case*)))))

  (funcall 't1-expected-fail)

T1-EXPECTED-FAIL
  &#215; (IS (EQUAL 1 2))
  &#215; Intentional failure x does not equal y
    where
      X = 1
      Y = 2
    *PACKAGE* is #&lt;PACKAGE <span class="org-string">"UAX-15-TRY-TESTS"</span>&gt; and *PRINT-CASE* is <span class="org-builtin">:UPCASE</span>

&#8901; T1-EXPECTED-FAIL &#215;2
#&lt;TRIAL (T1-EXPECTED-FAIL) EXPECTED-SUCCESS 0.000s &#215;2&gt;
</pre>
</div>
<p>
Again you see the markers showing the conditions triggers, that there were two failures and both were expected.
</p>

<p>
Now a version where we have two assertions, the first one fails unexpectedly and the second passes:
</p>
<div class="org-src-container">
<pre class="src src-lisp">  (deftest t1b-unexpected-fail ()
        (<span class="org-keyword">let</span> ((x 1) (y 2))
          (is (= x y))
          (is (equal 1 x))))

  (t1b-unexpected-fail)
  UNEXPECTED-FAILURE in check:
  (IS (= X Y))
where
  X = 1
  Y = 2
   [Condition of type UNEXPECTED-RESULT-FAILURE]

Restarts:
 0: [RECORD-EVENT] Record the event and continue.
 1: [FORCE-EXPECTED-SUCCESS] Change outcome to TRY:EXPECTED-RESULT-SUCCESS.
 2: [FORCE-UNEXPECTED-SUCCESS] Change outcome to TRY:UNEXPECTED-RESULT-SUCCESS.
 3: [FORCE-EXPECTED-FAILURE] Change outcome to TRY:EXPECTED-RESULT-FAILURE.
 4: [ABORT-CHECK] Change outcome to TRY:RESULT-ABORT*.
 5: [SKIP-CHECK] Change outcome to TRY:RESULT-SKIP.
 6: [RETRY-CHECK] Retry check.
 7: [ABORT-TRIAL] Record the event and abort trial UAX-15-TRY-TESTS::T1B-UNEXPECTED-FAIL.
 8: [SKIP-TRIAL] Record the event and skip trial UAX-15-TRY-TESTS::T1B-UNEXPECTED-FAIL.
 9: [RETRY-TRIAL] Record the event and retry trial UAX-15-TRY-TESTS::T1B-UNEXPECTED-FAIL.
 10: [SET-TRY-DEBUG] Supply a new value for <span class="org-builtin">:DEBUG</span> of TRY:TRY.
 11: [RETRY] Retry SLIME REPL evaluation request.
 12: [*ABORT] Return to SLIME's top level.
 13: [ABORT] abort thread (#&lt;THREAD <span class="org-string">"new-repl-thread"</span> RUNNING {1009C947E3}&gt;)
</pre>
</div>
<p>
If we choose RECORD-EVENT, we get the following:
</p>
<div class="org-src-container">
<pre class="src src-lisp">  T1B-UNEXPECTED-FAIL
  &#8864; (IS (= X Y))
    where
      X = 1
      Y = 2
  &#8901; (IS (EQUAL 1 X))
&#8864; T1B-UNEXPECTED-FAIL &#8864;1 &#8901;1
#&lt;TRIAL (T1B-UNEXPECTED-FAIL) UNEXPECTED-FAILURE 161.676s &#8864;1 &#8901;1&gt;
</pre>
</div>
<p>
The last line shows two categories of results, one unexpected failure (indicated by the ⊠)  and one expected success.
</p>

<p>
If we choose SKIP-CHECK, we get:
</p>
<div class="org-src-container">
<pre class="src src-lisp">  T1B-UNEXPECTED-FAIL
  - (IS (= X Y))
  &#8901; (IS (EQUAL 1 X))
&#8901; T1B-UNEXPECTED-FAIL -1 &#8901;1
#&lt;TRIAL (T1B-UNEXPECTED-FAIL) EXPECTED-SUCCESS 10.917s -1 &#8901;1&gt;
</pre>
</div>
<p>
Now the markers show one failure that was skipped and one expected success.
</p>

<p>
Now a version where we have two assertions and we expect one specifically to fail:
</p>
<div class="org-src-container">
<pre class="src src-lisp">  (deftest t1a-expected-fail ()
        (<span class="org-keyword">let</span> ((x 1) (y 2))
          (is (equal 1 x))
          (<span class="org-keyword">with-failure-expected</span> (t)
          (is (= x y)
              <span class="org-builtin">:msg</span> <span class="org-string">"Intentional failure x does not equal y"</span>
              <span class="org-builtin">:ctx</span> (<span class="org-string">"*PACKAGE* is ~S and *PRINT-CASE* is ~S~%"</span>
                    *package* *print-case*)))))
T1A-EXPECTED-FAIL

(t1a-expected-fail)
T1A-EXPECTED-FAIL
  &#8901; (IS (EQUAL 1 X))
  &#215; Intentional failure x does not equal y
    where
      X = 1
      Y = 2
    *PACKAGE* is #&lt;PACKAGE <span class="org-string">"UAX-15-TRY-TESTS"</span>&gt; and *PRINT-CASE* is <span class="org-builtin">:UPCASE</span>

&#8901; T1A-EXPECTED-FAIL &#215;1 &#8901;1
#&lt;TRIAL (T1A-EXPECTED-FAIL) EXPECTED-SUCCESS 0.000s &#215;1 &#8901;1&gt;
</pre>
</div>
</div>
</li>
</ol>
</li>
<li><a id="org10941f6"></a>Quiet Reports<br>
<div class="outline-text-5" id="text-33-3-1-2">
<p>
The Try function allows you to report only the trial object summary (by passing :print nil):
</p>
<div class="org-src-container">
<pre class="src src-lisp">  (try 't1-fail <span class="org-builtin">:print</span> nil)
#&lt;TRIAL (T1-FAIL) UNEXPECTED-FAILURE 0.000s &#8864;2&gt;
</pre>
</div>
<p>
or only the unexpected events (by passing :print unexpected).
</p>
<div class="org-src-container">
<pre class="src src-lisp">  (try 'test9-pass-and-fail <span class="org-builtin">:print</span> 'unexpected)

TEST9-PASS-AND-FAIL
  T1B-UNEXPECTED-FAIL
    &#8864; (IS (= X Y))
      where
        X = 1
        Y = 2
  &#8864; T1B-UNEXPECTED-FAIL &#8864;1 &#8901;1
  T1A-UNEXPECTED-FAIL
    &#8864; Intentional failure x does not equal y
      where
        X = 1
        Y = 2
      *PACKAGE* is #&lt;PACKAGE <span class="org-string">"UAX-15-TRY-TESTS"</span>&gt; and *PRINT-CASE* is <span class="org-builtin">:UPCASE</span>

  &#8864; T1A-UNEXPECTED-FAIL &#8864;1 &#8901;1
&#8864; TEST9-PASS-AND-FAIL &#8864;2 &#8901;6
#&lt;TRIAL (TEST9-PASS-AND-FAIL) UNEXPECTED-FAILURE 0.000s &#8864;2 &#8901;6&gt;
</pre>
</div>
<p>
The try function does not allow you to pass parameters to the tests, so you would need to wrap those tests inside another test. For example:
</p>
<div class="org-src-container">
<pre class="src src-lisp">  (deftest test6-pass (x y)
    (is (= x 1))
    (is (= y 2))
    (is (not (= x y))))

  (deftest test7 ()
    (test6-pass 1 2)
    (test1-pass 1))

  (try 'test7 <span class="org-builtin">:print</span> 'unexpected)
#&lt;TRIAL (TEST7) EXPECTED-SUCCESS 0.000s &#8901;4&gt;
</pre>
</div>
<p>
As you can see from the result, it indicated that there were 4 expected successes in the total combination of tests.
</p>

<p>
If we had not used :print 'unexpected the result would have looked like:
</p>
<div class="org-src-container">
<pre class="src src-lisp">  (try 'test7)

TEST7
  TEST6-PASS
    &#8901; (IS (= X 1))
    &#8901; (IS (= Y 2))
    &#8901; (IS (NOT (= X Y)))
  &#8901; TEST6-PASS &#8901;3
  TEST5-PASS
    &#8901; (IS (= X 1))
  &#8901; TEST5-PASS &#8901;1
&#8901; TEST7 &#8901;4
#&lt;TRIAL (TEST7) EXPECTED-SUCCESS 0.000s &#8901;4&gt;
</pre>
</div>
<p>
Running try on its version of the uax-15 test suite would (a) have printed 343332 lines of successful assertions and the trial object would show the first version running in the emacs slime REPL and the second in a terminal (both under SBCL 2.3.0)
</p>
<div class="org-src-container">
<pre class="src src-lisp">..... 343332 lines later ...
#&lt;TRIAL (UAX-SUITE) EXPECTED-SUCCESS 31.773s &#8901;343332&gt;

..... 343332 lines later ...
#&lt;TRIAL (UAX-SUITE) EXPECTED-SUCCESS 10.887s &#8901;343332&gt;
</pre>
</div>
<p>
You can see the time discrepancy: Almost 32 seconds in the REPL to run the test and print every assertion and almost 11 seconds in the terminal. Now with :print 'unexpected, we get the following (first in the emacs REPL and then in a terminal:
</p>
<div class="org-src-container">
<pre class="src src-lisp">  (try 'uax-suite <span class="org-builtin">:print</span> 'unexpected)

#&lt;TRIAL (UAX-SUITE) EXPECTED-SUCCESS 1.527s &#8901;343332&gt;

#&lt;TRIAL (UAX-SUITE) EXPECTED-SUCCESS 1.460s &#8901;343332&gt;
</pre>
</div>
<p>
And the test run is down from 32 secs to 1.5 seconds.
</p>
</div>
<ol class="org-ol">
<li><a id="org8005870"></a>Print Compactly<br>
<div class="outline-text-6" id="text-33-3-1-2-1">
<p>
If we set the \*print-compactly* variable to t, and run try without the :print 'unexpected, try would have printed out a single dot for each assertion and the result for the running the uax-15 suite would have been (again, first in the emacs REPL and then running in a terminal):
</p>
<div class="org-src-container">
<pre class="src src-lisp">  ..... name of test ... lots of dots representing passing assertions, concluding in

#&lt;TRIAL (UAX-SUITE) EXPECTED-SUCCESS 1.990s &#8901;343332&gt;

#&lt;TRIAL (UAX-SUITE) EXPECTED-SUCCESS 1.900s &#8901;343332&gt;
</pre>
</div>
<p>
So printing the dots only saved us 30 seconds of wasted time in the REPL and 8 seconds in the terminal.
</p>
</div>
</li>
</ol>
</li>
<li><a id="org5eba5f1"></a>Failure reports only<br>
<div class="outline-text-5" id="text-33-3-1-3">
<p>
Lets create a test which calls tests we know will fail and tests we know will not fail:
</p>
<div class="org-src-container">
<pre class="src src-lisp">(deftest t1a-unexpected-fail ()
      (<span class="org-keyword">let</span> ((x 1) (y 2))
        (is (= x y)
            <span class="org-builtin">:msg</span> <span class="org-string">"Intentional failure x does not equal y"</span>
            <span class="org-builtin">:ctx</span> (<span class="org-string">"*PACKAGE* is ~S and *PRINT-CASE* is ~S~%"</span>
                  *package* *print-case*))
        (is (equal 1 x))))

(deftest t1b-unexpected-fail ()
      (<span class="org-keyword">let</span> ((x 1) (y 2))
        (is (= x y))
        (is (equal 1 x))))

(deftest test8-pass-and-fail ()
                  (t1b-unexpected-fail)
                  (test7)
                  (t1a-unexpected-fail))
</pre>
</div>
<p>
Now we call try with test8-pass-and-fail with the :print 'unexpected parameters
</p>
<div class="org-src-container">
<pre class="src src-lisp">  (try 'test8-pass-and-fail <span class="org-builtin">:print</span> 'unexpected)
TEST8-PASS-AND-FAIL
  T1B-UNEXPECTED-FAIL
    &#8864; (IS (= X Y))
      where
        X = 1
        Y = 2
  &#8864; T1B-UNEXPECTED-FAIL &#8864;1 &#8901;1
  T1A-UNEXPECTED-FAIL
    &#8864; Intentional failure x does not equal y
      where
        X = 1
        Y = 2
      *PACKAGE* is #&lt;PACKAGE <span class="org-string">"UAX-15-TRY-TESTS"</span>&gt; and *PRINT-CASE* is <span class="org-builtin">:UPCASE</span>

  &#8864; T1A-UNEXPECTED-FAIL &#8864;1 &#8901;1
&#8864; TEST8-PASS-AND-FAIL &#8864;2 &#8901;6
#&lt;TRIAL (TEST8-PASS-AND-FAIL) UNEXPECTED-FAILURE 0.003s &#8864;2 &#8901;6&gt;
</pre>
</div>
<p>
As expected the net result (last line) is 2 unexpected failures and 6 expected successes. We do not get thrown into the debugger and we only get details of the unexpected failures.
</p>
</div>
</li>

<li><a id="orgec98ff7"></a>Streams and Printer<br>
<div class="outline-text-5" id="text-33-3-1-4">
<p>
The try function acceptsa key parameters :stream and :printer to redirect the report printing.
</p>
</div>
</li>
<li><a id="orgb5695ee"></a>Other Reports<br>
<div class="outline-text-5" id="text-33-3-1-5">
<p>
The following shows the condition classes of events which can be signaled and printed:
</p>
<div class="org-src-container">
<pre class="src src-lisp">(<span class="org-keyword">let</span> ((*debug* nil)
      (*print* '(not trial-start))
      (*describe* nil))
  (<span class="org-keyword">with-test</span> (verdict-abort*)
    (<span class="org-keyword">with-test</span> (expected-verdict-success))
    (<span class="org-keyword">with-expected-outcome</span> ('failure)
      (<span class="org-keyword">with-test</span> (unexpected-verdict-success)))
    (<span class="org-keyword">handler-bind</span> (((and verdict success) #'force-expected-failure))
      (<span class="org-keyword">with-test</span> (expected-verdict-failure)))
    (<span class="org-keyword">handler-bind</span> (((and verdict success) #'force-unexpected-failure))
      (<span class="org-keyword">with-test</span> (unexpected-verdict-failure)))
    (<span class="org-keyword">with-test</span> (verdict-skip)
      (skip-trial))
    (is t <span class="org-builtin">:msg</span> <span class="org-string">"EXPECTED-RESULT-SUCCESS"</span>)
    (<span class="org-keyword">with-failure-expected</span> ('failure)
      (is t <span class="org-builtin">:msg</span> <span class="org-string">"UNEXPECTED-RESULT-SUCCESS"</span>)
      (is nil <span class="org-builtin">:msg</span> <span class="org-string">"EXPECTED-RESULT-FAILURE"</span>))
    (is nil <span class="org-builtin">:msg</span> <span class="org-string">"UNEXPECTED-RESULT-FAILURE"</span>)
    (<span class="org-keyword">with-skip</span> ()
      (is nil <span class="org-builtin">:msg</span> <span class="org-string">"RESULT-SKIP"</span>))
    (<span class="org-keyword">handler-bind</span> (((and result success) #'abort-check))
      (is t <span class="org-builtin">:msg</span> <span class="org-string">"RESULT-ABORT*"</span>))
    (<span class="org-keyword">catch</span> '<span class="org-constant">foo</span>
      (<span class="org-keyword">with-test</span> (nlx-test)
        (<span class="org-keyword">throw</span> '<span class="org-constant">foo</span> nil)))
    (<span class="org-warning">error</span> <span class="org-string">"UNHANDLED-ERROR"</span>)))
.. VERDICT-ABORT*                       <span class="org-comment">; TRIAL-START</span>
..   &#8901; EXPECTED-VERDICT-SUCCESS
..   &#8865; UNEXPECTED-VERDICT-SUCCESS
..   &#215; EXPECTED-VERDICT-FAILURE
..   &#8864; UNEXPECTED-VERDICT-FAILURE
..   - VERDICT-SKIP
..   &#8901; EXPECTED-RESULT-SUCCESS
..   &#8865; UNEXPECTED-RESULT-SUCCESS
..   &#215; EXPECTED-RESULT-FAILURE
..   &#8864; UNEXPECTED-RESULT-FAILURE
..   - RESULT-SKIP
..   &#8863; RESULT-ABORT*
..   NLX-TEST                           <span class="org-comment">; TRIAL-START</span>
..     &#8863; non-local exit                 <span class="org-comment">; NLX</span>
..   &#8863; NLX-TEST &#8863;1                      <span class="org-comment">; VERDICT-ABORT*</span>
..   &#8863; <span class="org-string">"UNHANDLED-ERROR"</span> (SIMPLE-ERROR)
.. &#8863; VERDICT-ABORT* &#8863;3 &#8864;1 &#8865;1 -1 &#215;1 &#8901;1
..
==&gt; #&lt;TRIAL (<span class="org-keyword">WITH-TEST</span> (VERDICT-ABORT*)) ABORT* 0.004s &#8863;3 &#8864;1 &#8865;1 -1 &#215;1 &#8901;1&gt;
</pre>
</div>
</div>
</li>
<li><a id="org3d0f10d"></a>Duration<br>
<div class="outline-text-5" id="text-33-3-1-6">
<p>
The try global variable \*print-duration* defaults to nil. If set to true, the number of second spent during execution on each assertion is also printed. E.g.
</p>
<div class="org-src-container">
<pre class="src src-lisp">  (<span class="org-keyword">let</span> ((*print-duration* t)
      (*debug* nil)
      (*describe* nil))
  (<span class="org-keyword">with-test</span> (timed)
    (is (<span class="org-keyword">progn</span> (sleep 0.3) t))
    (is (<span class="org-keyword">progn</span> (sleep 0.2) t))
    (<span class="org-warning">error</span> <span class="org-string">"xxx"</span>)))
..        TIMED
..  0.300   &#8901; (IS (<span class="org-keyword">PROGN</span> (SLEEP 0.3) T))
..  0.200   &#8901; (IS (<span class="org-keyword">PROGN</span> (SLEEP 0.2) T))
..          &#8863; <span class="org-string">""</span>xxx (SIMPLE-ERROR)
..  0.504 &#8863; TIMED &#8863;1 &#8901;2
..
==&gt; #&lt;TRIAL (<span class="org-keyword">WITH-TEST</span> (TIMED)) ABORT* 0.504s &#8863;1 &#8901;2&gt;
</pre>
</div>
</div>
</li>
</ol>
</li>
<li><a id="orgacc3918"></a>Edge Cases: Values expressions, loops. closures and calling other tests<br>
<ol class="org-ol">
<li><a id="org37d9d05"></a>Values expressions<br>
<div class="outline-text-5" id="text-33-3-2-1">
<p>
Try handles values expressions with no problem.
</p>
<div class="org-src-container">
<pre class="src src-lisp">(is (match-values (values (1+ 5) <span class="org-string">"sdf"</span>)
    (= * 0)
    (string= * <span class="org-string">"sdf"</span>)))
</pre>
</div>
</div>
</li>

<li><a id="org7c9fe65"></a>Now looping and closures<br>
<div class="outline-text-5" id="text-33-3-2-2">
<p>
Try has no problem with loops or finding variables that have been set in a closure containing the test.
</p>
<div class="org-src-container">
<pre class="src src-lisp">
</pre>
</div>
</div>
</li>
<li><a id="org646f895"></a>Calling a test inside another test<br>
<div class="outline-text-5" id="text-33-3-2-3">
<p>
Try has no problem with calling tests inside other tests.
</p>
<div class="org-src-container">
<pre class="src src-lisp">(<span class="org-keyword">let</span> ((x 1))
   (deftest test3-pass ()
      (is (= x 1))
      (is (funcall 'test2 1)))
   (funcall 'test3-pass))

TEST3-PASS
  &#8901; (IS (= X 1))
  &#8901; (IS (= X Y))
  &#8901; (IS (FUNCALL 'TEST2 1))
&#8901; TEST3-PASS &#8901;3
#&lt;TRIAL (TEST3-PASS) EXPECTED-SUCCESS 0.000s &#8901;3&gt;
</pre>
</div>
</div>
</li>
</ol>
</li>
<li><a id="org3f5e92f"></a>Float Tests<br>
<div class="outline-text-4" id="text-33-3-3">
<p>
Try has an extensive library of float comparisons. I will just quote from the documentation:
</p>

<p>
"Float comparisons following   <a href="https://randomascii.wordpress.com/2012/02/25/comparing-floating-point-numbers-2012-edition/">https://randomascii.wordpress.com/2012/02/25/comparing-floating-point-numbers-2012-edition/</a>
</p>

<p>
[function] FLOAT-~= X Y &amp;KEY (MAX-DIFF-IN-VALUE \*MAX-DIFF-IN-VALUE*) (MAX-DIFF-IN-ULP \*MAX-DIFF-IN-ULP*)
</p>

<p>
Return whether two numbers, X and Y, are approximately equal either according to MAX-DIFF-IN-VALUE or MAX-DIFF-IN-ULP.
</p>

<p>
If the absolute value of the difference of two floats is not greater than MAX-DIFF-IN-VALUE, then they are considered equal.
</p>

<p>
If two floats are of the same sign and the number of representable floats (ULP, unit in the last place) between them is less than MAX-DIFF-IN-ULP, then they are considered equal.
</p>

<p>
If neither X nor Y are floats, then the comparison is done with =. If one of them is a DOUBLE-FLOAT, then the other is converted to a double float, and the comparison takes place in double float space. Else, both are converted to SINGLE-FLOAT and the comparison takes place in single float space.
</p>

<p>
[variable] \*MAX-DIFF-IN-VALUE* 1.0e-16
</p>

<p>
The default value of the MAX-DIFF-IN-VALUE argument of FLOAT-~=.
</p>

<p>
[variable] \*MAX-DIFF-IN-ULP* 2
</p>

<p>
The default value of the MAX-DIFF-IN-ULP argument of FLOAT-~=.
</p>

<p>
[function] FLOAT-~&lt; X Y &amp;KEY (MAX-DIFF-IN-VALUE \*MAX-DIFF-IN-VALUE*) (MAX-DIFF-IN-ULP \*MAX-DIFF-IN-ULP*)
</p>

<p>
Return whether X is approximately less than Y. Equivalent to &lt;, but it also allows for approximate equality according to FLOAT-~=.
</p>

<p>
[function] FLOAT-~&gt; X Y &amp;KEY (MAX-DIFF-IN-VALUE \*MAX-DIFF-IN-VALUE*) (MAX-DIFF-IN-ULP \*MAX-DIFF-IN-ULP*)
</p>

<p>
Return whether X is approximately greater than Y. Equivalent to &gt;, but it also allows for approximate equality according to FLOAT-~=."
</p>
</div>
</li>


<li><a id="org9c21377"></a>Suites, tags and other multiple test abilities<br>
<ol class="org-ol">
<li><a id="org28b0482"></a>Lists of tests<br>
<div class="outline-text-5" id="text-33-3-4-1">
<p>
Try can handle lists of tests and the function list-package-tests will return a list of the try tests in a package.
</p>
<div class="org-src-container">
<pre class="src src-lisp">(test '(t1 t2))

(list-package-tests)
</pre>
</div>
</div>
</li>
<li><a id="orgde7e92e"></a>Suites<br>
<div class="outline-text-5" id="text-33-3-4-2">
<p>
Test suites in try are just tests that callother tests
</p>
<div class="org-src-container">
<pre class="src src-lisp">(deftest test6-pass (x y)
  (is (= x 1))
  (is (= y 2))
  (is (not (= x y))))

(deftest test7 ()
  (test6-pass 1 2)
  (test1-pass 1))
</pre>
</div>
<p>
Now we can call test7 and get the results for test6 and test1
</p>
<div class="org-src-container">
<pre class="src src-lisp">  (test7)
TEST7
  TEST6-PASS
    &#8901; (IS (= X 1))
    &#8901; (IS (= Y 2))
    &#8901; (IS (NOT (= X Y)))
  &#8901; TEST6-PASS &#8901;3
  TEST1-PASS
    &#8901; (IS (= X 1))
  &#8901; TEST1-PASS &#8901;1
&#8901; TEST7 &#8901;4
#&lt;TRIAL (TEST7) EXPECTED-SUCCESS 0.003s &#8901;4&gt;
</pre>
</div>
</div>
</li>
</ol>
</li>

<li><a id="org82d3c30"></a>Replay Events and Defer Descriptions<br>
<div class="outline-text-4" id="text-33-3-5">
<p>
Try has a replay-events function which reprocesses the events wich where collected in a trial object. It does not re-run the tests, it just signals the events collected in the trial object for further processing. For example, you ran a large test without :print 'unexpected and need to winnow through the output to find just the failing tests. You can replay and just get the unexpected results:
</p>
<div class="org-src-container">
<pre class="src src-lisp">(replay-events ! <span class="org-builtin">:print</span> 'unexpected)
</pre>
</div>
<p>
As you might expect, the variable ! passed in is the most recent trial. !! or !!! would be second or third most recent respectively.
</p>

<p>
The function (recent-trial &amp;optional (n 0)) will return the Nth most recent trial or NIL if there are not enough trials recorded. Every TRIAL returned by TRY gets pushed onto a list of trials, but only \*N-RECENT-TRIALS* are kept.
</p>


<p>
<a href="#org63aa282">top</a>
</p>
</div>
</li>
<li><a id="orga079d89"></a>Fixtures and Freezing Data<br>
<div class="outline-text-4" id="text-33-3-6">
<p>
Per the documentation, Try has no direct support for fixtures. One suggestion is writing macros like the following:
</p>
<div class="org-src-container">
<pre class="src src-lisp">(<span class="org-keyword">defvar</span> <span class="org-variable-name">*server*</span> nil)

(<span class="org-keyword">defmacro</span> <span class="org-function-name">with-xxx</span> (<span class="org-type">&amp;body</span> body)
  `(<span class="org-keyword">flet</span> ((,with-xxx-body ()
            ,@body))
     (<span class="org-keyword">if</span> *server*
         (<span class="org-keyword">with-xxx-body</span>)
         (<span class="org-keyword">with-server</span> (make-expensive-server)
           (<span class="org-keyword">with-xxx-body</span>)))))
</pre>
</div>
</div>
</li>

<li><a id="org4fb9866"></a>Removing tests<br>
<div class="outline-text-4" id="text-33-3-7">
<p>
Try tests can be deleted by FMAKUNBOUND, UNINTERN, or by redefining the function with DEFUN. Tests defined in a given package can be listed with LIST-PACKAGE-TESTS.
</p>
</div>
</li>

<li><a id="orgbb381f4"></a>Sequencing, Random and Failure Only<br>
<div class="outline-text-4" id="text-33-3-8">
<p>
While tests and the forms inside tests normally follow a sequential order, try allows you to shuffle the list of forms inside the body of a test.
</p>

<div class="org-src-container">
<pre class="src src-lisp">(<span class="org-keyword">loop</span> repeat 3 do
  (<span class="org-keyword">with-shuffling</span> ()
    (prin1 1)
    (prin1 2)))
.. 122112
=&gt; NIL
</pre>
</div>
</div>
</li>
<li><a id="org1101ab4"></a>Skip Capability<br>
<div class="outline-text-4" id="text-33-3-9">
<p>
As we already saw when looking at tests that had failures, you can look at the conditions triggered and decide to skip an assertion result.
</p>

<p>
The following shows a test that skips the test (server-available-p).
</p>
<div class="org-src-container">
<pre class="src src-lisp">(deftest my-suite ()
  (<span class="org-keyword">with-skip</span> ((not (server-available-p)))
    (test-server)))
</pre>
</div>
</div>
</li>

<li><a id="orga7c3678"></a>Random Data Generators<br>
<div class="outline-text-4" id="text-33-3-10">
<p>
None, but the helper libraries can fullfill this well.
</p>
</div>
</li>
</ol>
</div>


<div id="outline-container-orgc97b517" class="outline-3">
<h3 id="orgc97b517"><span class="section-number-3">33.4.</span> Discussion</h3>
<div class="outline-text-3" id="text-33-4">
<p>
I found try to be easy to use. I was a bit surprised at the lack of additional assertion comparisons other than the float comparisons, but you can easily use the normal CL comparison functions, so that is not an issue.
</p>

<p>
<a href="#org63aa282">top</a>
</p>
</div>
</div>

<div id="outline-container-orge1d9c53" class="outline-3">
<h3 id="orge1d9c53"><span class="section-number-3">33.5.</span> Who uses try</h3>
<div class="outline-text-3" id="text-33-5">
<p>
The following list is just pulling the results <code>(ql:who-depends-on :try)</code> and adding their homepage urls.
</p>
<ul class="org-ul">
<li><a href="https://github.com/melisgl/named-readtables">named-readtables</a></li>
<li><a href="https://github.com/melisgl/journal">journal</a></li>
<li><a href="https://github.com/melisgl/mgl-pax">mgl-pax/test</a></li>
<li><a href="https://github.com/antimer/lmdb/blob/master/lmdb.asd">lmdb</a></li>
</ul>


<p>
<a id="org4b187d6"></a>
</p>
</div>
</div>
</div>
<div id="outline-container-org40556cd" class="outline-2">
<h2 id="org40556cd"><span class="section-number-2">34.</span> unit-test</h2>
<div class="outline-text-2" id="text-34">
</div>
<div id="outline-container-org9ac029a" class="outline-3">
<h3 id="org9ac029a"><span class="section-number-3">34.1.</span> Summary</h3>
<div class="outline-text-3" id="text-34-1">
<table>


<colgroup>
<col  class="org-left">

<col  class="org-left">

<col  class="org-left">

<col  class="org-right">
</colgroup>
<tbody>
<tr>
<td class="org-left"><a href="https://github.com/hanshuebner/unit-test">homepage</a></td>
<td class="org-left">Manuel Odendahl, Alain Picard</td>
<td class="org-left">MIT</td>
<td class="org-right">2012</td>
</tr>
</tbody>
</table>
<p>
Again, another framework that does the basics. It will report all assertions that failed in a test. It will do a progress report on the tests, not the assertions which cannot be turned off. It does allow you to provide diagnostic strings to assertions to help in debugging, but does not allow you to pass in any variables. It has no interactivity option, so you cannot just hop into the debugger on a test failure. It has no fixture capacity, but it does have suites.
</p>
</div>
</div>
<div id="outline-container-org5e808df" class="outline-3">
<h3 id="org5e808df"><span class="section-number-3">34.2.</span> Assertion Functions</h3>
<div class="outline-text-3" id="text-34-2">
<table>


<colgroup>
<col  class="org-left">

<col  class="org-left">

<col  class="org-left">
</colgroup>
<tbody>
<tr>
<td class="org-left">test-assert</td>
<td class="org-left">test-condition</td>
<td class="org-left">test-equal</td>
</tr>
</tbody>
</table>
</div>
</div>

<div id="outline-container-orgd9aba70" class="outline-3">
<h3 id="orgd9aba70"><span class="section-number-3">34.3.</span> Usage</h3>
<div class="outline-text-3" id="text-34-3">
</div>
<ol class="org-ol">
<li><a id="orge1ad137"></a>Report Format<br>
<div class="outline-text-4" id="text-34-3-1">
<p>
Everything a return of a list of test-result objects. There is no provision for dropping into the debugger. <code>run-test</code> has an optional parameter for output that sends output by defult to <code>*debug-io*</code>
</p>
</div>
</li>
<li><a id="org8509469"></a>Basics<br>
<div class="outline-text-4" id="text-34-3-2">
<p>
Unit-test has a limited vocabulary for test functions. The <code>deftest</code> macro will create an instance of a unit-test class with the first parameter being the unit name (used to group related tests) and the second parameter being the name of the test itself.
</p>
<div class="org-src-container">
<pre class="src src-lisp">(deftest <span class="org-builtin">:test</span> <span class="org-string">"t1"</span>
  (<span class="org-keyword">let</span> ((x 1))
    (test-assert (=  x 1))
    (test-equal <span class="org-string">"a"</span> <span class="org-string">"a"</span> )
    (test-condition
     (/ 1 (- x 1))
     'division-by-zero)))
</pre>
</div>
<p>
In this case we used a string "t1" as the name of the test. We could have used a symbol 't1 or a keyword :t1. Unfortunately the <code>run-test</code> method is only defined for unit tests, which makes calling a single test a little clumsy. We have to call <code>get-test-by-name</code> and pass that to <code>run-test</code>. In your test I would assume that you would add another method to handle however you write your test names. We will continue to use  <code>get-test-by-name</code> as a reminder.
</p>
<div class="org-src-container">
<pre class="src src-lisp">(run-test (get-test-by-name <span class="org-string">"t1"</span>))
(#&lt;TEST-EQUAL-RESULT FORM: (/ 1 (- X 1)) STATUS: PASS REASON: NIL&gt;
 #&lt;TEST-EQUAL-RESULT FORM: a STATUS: PASS REASON: NIL&gt;
 #&lt;TEST-EQUAL-RESULT FORM: (= X 1) STATUS: PASS REASON: NIL&gt;)
</pre>
</div>
<p>
Not the most exciting report in the world. But lets take a look at a failing test. We can put a diagnostic string into <code>test-assert, but not into =test-equal</code>. The equality test for <code>test-equal</code> is equal, but you can change that using a keyword parameter as shown below
</p>
<div class="org-src-container">
<pre class="src src-lisp">(deftest <span class="org-builtin">:test</span> <span class="org-string">"t1-fail"</span>
  (<span class="org-keyword">let</span> ((x 1))
    (test-assert (= x 2) <span class="org-string">"we know that X (1) does not equal 2"</span>)
    (test-equal <span class="org-string">"a"</span> 'a <span class="org-builtin">:test</span> #'eq )
    (test-condition
     (/ 1 (- x 1))
     'floating-point-overflow)))

(run-test (get-test-by-name <span class="org-string">"t1-fail"</span>))
(#&lt;TEST-EQUAL-RESULT FORM: (/ 1 (- X 1)) STATUS: CRASH REASON: NIL&gt;
                     #&lt;TEST-EQUAL-RESULT FORM: 'A STATUS: FAIL REASON: NIL&gt;
                     #&lt;TEST-EQUAL-RESULT FORM: (= X
                                                  2) <span class="org-warning">STATUS: FAIL REASON: we know that X (1) does not equal 2&gt;</span>
                     #&lt;TEST-EQUAL-RESULT FORM: (VALUES 1 3 4 5) STATUS: PASS REASON: NIL&gt;
                     #&lt;TEST-EQUAL-RESULT FORM: (/ 1 (- X 1)) STATUS: PASS REASON: NIL&gt;
                     #&lt;TEST-EQUAL-RESULT FORM: a STATUS: PASS REASON: NIL&gt;
                     #&lt;TEST-EQUAL-RESULT FORM: (= X 1) STATUS: PASS REASON: NIL&gt;)
</pre>
</div>
<p>
The first thing I notice is that the list of results also includes the list of results from when we ran test t1. Everything just gets pushed to a non-exported list <code>*unit-test-results*</code>. So if you want to just see the results for the next test you are going to run, you need to run some cleanup.
</p>

<p>
T1-fail generated three results, so again a little clumnsy on ensuring you see all the results from the test. Let's set <code>*unit-test-results*</code> to nil after every test so we can this clean.
</p>

<p>
There is an exported variable =*unit-test-debug*, but looking at the source code, it does not appear to be actually used for anything, leaving it open for your to write your own code using it as a flag.
</p>

<p>
If a test calls a function that is later modified, the test does not need to be recompiled to check the tested function correctly. We will skip the proof.
</p>
</div>
</li>
<li><a id="org01a20de"></a>Edge Cases: Value expressions, closures and calling other tests<br>
<ol class="org-ol">
<li><a id="org041a7fc"></a>Value expressions<br>
<div class="outline-text-5" id="text-34-3-3-1">
<p>
Like most of the frameworks, unit-test will test a values expression by only checking the first value. We will skip the proof.
</p>
</div>
</li>
<li><a id="orgad6989a"></a>Looping and closures<br>
<div class="outline-text-5" id="text-34-3-3-2">
<p>
Unit-test provided a little bit of a surprise here. If you run a test where the assertion is inside a loop, the test-result object will be pushed to <code>unit-test::*unit-test-results*</code>, but that list will not be printed to the REPL. You just get NIL in the REPL. We will skip the proof.
</p>

<p>
Unit-test had no problem testing functions that use variables provided in a closure. We will skip the proof.
</p>

<p>
Tests can call other tests, but there is no composition, just another test result.
</p>
<div class="org-src-container">
<pre class="src src-lisp">(deftest <span class="org-builtin">:test</span> <span class="org-string">"t3"</span>
  (test-assert (= 1 1))
  (run-test (get-test-by-name <span class="org-string">"t1"</span>)))
</pre>
</div>
</div>
</li>
</ol>
</li>

<li><a id="org491c5d3"></a>Suites, tags and other multiple test abilities<br>
<ol class="org-ol">
<li><a id="orgf59ebd1"></a>Lists of tests<br>
<div class="outline-text-5" id="text-34-3-4-1">
<p>
Unit-test has no provision to handle lists of tests although you could write a method on <code>run-test</code> that would do so.
</p>
</div>
</li>
<li><a id="orgf2f1e08"></a>Suites<br>
<div class="outline-text-5" id="text-34-3-4-2">
<p>
Looking at the examples above, we gave all the tests the unit name of ":test". This is essentially the suite named :test. If we call <code>run-all-tests</code>, all the tests would be run. If we had given tests different unit names, we could run all the tests with those names by passing the keyword parameter :unit to <code>run-all-tests</code>
</p>
<div class="org-src-container">
<pre class="src src-lisp">(run-all-tests <span class="org-builtin">:unit</span> <span class="org-builtin">:some-unit-name</span>)
</pre>
</div>

<p>
<a href="#org63aa282">top</a>
</p>
</div>
</li>
</ol>
</li>
<li><a id="org8573e2d"></a>Fixtures and Freezing Data<br>
<div class="outline-text-4" id="text-34-3-5">
<p>
From the source code:
</p>
<div class="org-src-container">
<pre class="src src-lisp"><span class="org-comment-delimiter">;;;;   </span><span class="org-comment">For more complex tests requiring fancy setting up and tearing down</span>
<span class="org-comment-delimiter">;;;;   </span><span class="org-comment">(as well as reclamation of resources in case a test fails), users are expected</span>
<span class="org-comment-delimiter">;;;;   </span><span class="org-comment">to create a subclass of the unit-test class using the DEFINE-TEST-CLASS macro.</span>
<span class="org-comment-delimiter">;;;;   </span><span class="org-comment">The syntax is meant to be reminiscent of CLOS, e.g</span>
<span class="org-comment-delimiter">;;;;</span>
<span class="org-comment-delimiter">;;;;   </span><span class="org-comment">(define-test-class my-test-class</span>
<span class="org-comment-delimiter">;;;;     </span><span class="org-comment">((my-slot-1 :initarg :foo ...)</span>
<span class="org-comment-delimiter">;;;;      </span><span class="org-comment">(my-slot-2 (any valid CLOS slot options)</span>
<span class="org-comment-delimiter">;;;;      </span><span class="org-comment">....))</span>
<span class="org-comment-delimiter">;;;;   </span><span class="org-comment">After this, the methods</span>
<span class="org-comment-delimiter">;;;;   </span><span class="org-comment">(defgeneric run-test :before</span>
<span class="org-comment-delimiter">;;;;               </span><span class="org-comment">((test my-test-class) &amp;key (output *debug-io*))   and</span>
<span class="org-comment-delimiter">;;;;   </span><span class="org-comment">(defgeneric run-test :after</span>
<span class="org-comment-delimiter">;;;;               </span><span class="org-comment">((test my-test-class) &amp;key (output *debug-io*))   may be</span>
<span class="org-comment-delimiter">;;;;   </span><span class="org-comment">specialized to perform the required actions, possibly accessing the</span>
<span class="org-comment-delimiter">;;;;   </span><span class="org-comment">my-slot-1's, etc.</span>
<span class="org-comment-delimiter">;;;;</span>
<span class="org-comment-delimiter">;;;;   </span><span class="org-comment">The test form is protected by a handler case.  Care should be taken</span>
<span class="org-comment-delimiter">;;;;   </span><span class="org-comment">than any run-test specialization also be protected not to crash.</span>
</pre>
</div>
</div>
</li>
<li><a id="org4a11e59"></a>Removing tests<br>
<div class="outline-text-4" id="text-34-3-6">
<p>
None
</p>
</div>
</li>
<li><a id="org1fb3fbb"></a>Sequencing, Random and Failure Only<br>
<div class="outline-text-4" id="text-34-3-7">
<p>
I do not see any capability to shuffle test order or to run only the tests that have previously failed.
</p>
</div>
</li>
<li><a id="org29bb95d"></a>Skip Capability<br>
<ol class="org-ol">
<li><a id="org9fec3ee"></a>Assertions<br></li>
<li><a id="org692c67a"></a>Tests<br></li>
<li><a id="org49ff43c"></a>Implementation<br></li>
</ol>
</li>
<li><a id="org0a06da3"></a>Random Data Generators<br>
<div class="outline-text-4" id="text-34-3-9">
<p>
None
</p>
</div>
</li>
</ol>
</div>
<div id="outline-container-org46a4ee3" class="outline-3">
<h3 id="org46a4ee3"><span class="section-number-3">34.4.</span> Discussion</h3>
<div class="outline-text-3" id="text-34-4">
<p>
Compared to other frameworks it feels a little clumsy and basic. I would
<a href="#org63aa282">top</a>
</p>
</div>
</div>
<div id="outline-container-org57708aa" class="outline-3">
<h3 id="org57708aa"><span class="section-number-3">34.5.</span> Who Depends on Unit-Test?</h3>
<div class="outline-text-3" id="text-34-5">
<p>
It is used by <a href="https://edicl.github.io/cl-fad/">cl-fad</a> and several of the bknr programs.
</p>

<p>
<a id="orgea91eb1"></a>
</p>
</div>
</div>
</div>
<div id="outline-container-org197b08b" class="outline-2">
<h2 id="org197b08b"><span class="section-number-2">35.</span> xlunit</h2>
<div class="outline-text-2" id="text-35">
</div>
<div id="outline-container-org6412370" class="outline-3">
<h3 id="org6412370"><span class="section-number-3">35.1.</span> Summary</h3>
<div class="outline-text-3" id="text-35-1">
<table>


<colgroup>
<col  class="org-left">

<col  class="org-left">

<col  class="org-left">

<col  class="org-right">
</colgroup>
<tbody>
<tr>
<td class="org-left"><a href="http://git.kpe.io/?p=xlunit.git;a=tree">homepage</a></td>
<td class="org-left">Kevin RosenBerg</td>
<td class="org-left">BSD</td>
<td class="org-right">2015</td>
</tr>
</tbody>
</table>

<p>
Xlunit stops at the first failure in a test, so you only get partial failure reporting (joining lift in this regard). That, in and of itself would cause me to look elsewhere. Phil Gold's original concern was that while you can create hierarchies of test suites, they are not composable.
</p>
</div>
</div>

<div id="outline-container-org109ad2b" class="outline-3">
<h3 id="org109ad2b"><span class="section-number-3">35.2.</span> Assertion Functions</h3>
<div class="outline-text-3" id="text-35-2">
<table>


<colgroup>
<col  class="org-left">

<col  class="org-left">

<col  class="org-left">
</colgroup>
<tbody>
<tr>
<td class="org-left">assert-condition</td>
<td class="org-left">assert-eql</td>
<td class="org-left">assert-equal</td>
</tr>

<tr>
<td class="org-left">assert-false</td>
<td class="org-left">assert-not-eql</td>
<td class="org-left">assert-true</td>
</tr>
</tbody>
</table>

<p>
<a href="#org63aa282">top</a>
</p>
</div>
</div>
<div id="outline-container-orgdab6718" class="outline-3">
<h3 id="orgdab6718"><span class="section-number-3">35.3.</span> Usage</h3>
<div class="outline-text-3" id="text-35-3">
<p>
I find the terminology of xlunit to be confusing after getting used to other frameworks.
</p>

<p>
Xlunit requires that you create a class for a test-case or suite. Every "test" is then a named test-method on that class. <code>def-test-method</code> adds a test to the suite. The class can, of course, have slots for variables that any test in the suite can use.
</p>

<p>
Test-methods can have multiple assertions and can be applied to either a <code>test-case</code> or a <code>test-suite</code>. The macro <code>get-suite</code> applies to either <code>test-case</code> or a <code>test-suite</code> classes and creates an instance of that class.
</p>

<p>
I notice that <a href="https://github.com/jwiegley/cambl/blob/master/cambl-test.lisp">cambl-test</a> (one of the libraries that uses xlunit) wraps a <code>define-test</code> macro around <code>def-test-method</code> to make this feel more natural. That version is here:
</p>
<div class="org-src-container">
<pre class="src src-lisp">(<span class="org-keyword">defclass</span> <span class="org-type">amount-test-case</span> (test-case)
  ()
  (<span class="org-builtin">:documentation</span> <span class="org-doc">"test-case for CAMBL amounts"</span>))

(<span class="org-keyword">defmacro</span> <span class="org-function-name">define-test</span> (name <span class="org-type">&amp;rest</span> body-forms)
  `(def-test-method ,name ((test amount-test-case) <span class="org-builtin">:run</span> nil)
     ,@body-forms))
</pre>
</div>
</div>

<ol class="org-ol">
<li><a id="orgadc68cd"></a>Report Format<br>
<div class="outline-text-4" id="text-35-3-1">
<p>
Xlunit reports a single dot for a test with at least a passing assertion, an F for failure and E for errors. In testing suites, xlunit will provide one dot per test, the time it took to run the suite and, if everything is successful, OK with a count of the tests and a count of the assertions.
</p>
</div>
</li>
<li><a id="orgd6d4856"></a>Basics<br>
<div class="outline-text-4" id="text-35-3-2">
<p>
We will create a test-case named tf-xlunit that we can use to attach tests, each of whichcan have multiple assertions. The form immediately after the test method name takes both the class to which it applies and whether to run the method immediately upon compilation. The libraries using xlunit seem to define all methods with :run nil.
</p>
<div class="org-src-container">
<pre class="src src-lisp">(<span class="org-keyword">defclass</span> <span class="org-type">tf-xlunit</span> (xlunit:test-case) ())

(def-test-method t1 ((test tf-xlunit) <span class="org-builtin">:run</span> nil)
  (<span class="org-warning">assert-equal</span> <span class="org-string">"a"</span> <span class="org-string">"a"</span>)
  (<span class="org-warning">assert-condition</span> 'division-by-zero (<span class="org-warning">error</span> 'division-by-zero))
  (<span class="org-warning">assert-false</span> (= 1 2))
  (<span class="org-warning">assert-eql</span> 'a 'a)
  (<span class="org-warning">assert-not-eql</span> 'a 'b)
  (<span class="org-warning">assert-true</span> (= 1 1)))
</pre>
</div>
<p>
Unfortunately you need to run all the tests methods applicable to a test-case or suite at once. For clarity purposes, we create a separate test-case class for each method so that we do not get burdened with results from other methods. Effectively a test-case can be viewed the same as other frameworks think of suites.
</p>

<p>
The reporting is a bit underwhelming. Even more so as we get to failures.
</p>
<div class="org-src-container">
<pre class="src src-lisp">(xlunit:textui-test-run (xlunit:get-suite tf-xlunit))
.
Time: 0.0

OK (1 tests)
#&lt;TEST-RESULTS {10016CD973}&gt;
</pre>
</div>
<p>
All the assertions passed in order for the entire test to pass.
</p>

<p>
Now a test that should have six assertion failures. This time we are going to put a diagnostic message intothe first assertion. Xlunit does not provide the ability to insert variables into the diagnostic message or provide trailing variables.
</p>

<p>
I am going to create a new suite so that we just see the results for this test and will continue to do that until we get to the suites discussion.
</p>
<div class="org-src-container">
<pre class="src src-lisp">(<span class="org-keyword">defclass</span> <span class="org-type">tf-xlunit-t1-fail</span> (xlunit:test-case) ())

(def-test-method t1-fail ((test tf-xlunit-t1-fail) <span class="org-builtin">:run</span> nil)
  (<span class="org-warning">assert-equal</span> <span class="org-string">"a"</span> <span class="org-string">"b"</span> <span class="org-string">"Deliberate failure on our part"</span>)
  (<span class="org-warning">assert-condition</span> 'division-by-zero (<span class="org-warning">error</span> 'floating-point-overflow))
  (<span class="org-warning">assert-false</span> (= 1 1))
  (<span class="org-warning">assert-eql</span> 'a 'b)
  (<span class="org-warning">assert-not-eql</span> 'a 'a)
  (<span class="org-warning">assert-true</span> (= 1 2)))
</pre>
</div>
<p>
And now, the failure report:
</p>
<div class="org-src-container">
<pre class="src src-lisp">(xlunit:textui-test-run (xlunit:get-suite tf-xlunit-t1-fail))
.F
Time: 0.0

There was 1 failure:
1) <span class="org-warning">T1-FAIL: Assert equal: </span><span class="org-string"><span class="org-warning">"a"</span></span><span class="org-warning"> </span><span class="org-string"><span class="org-warning">"b"</span></span>
 Deliberate failure on our part

FAILURES!!!
Run: 1   Failures: 1   Errors: 0
#&lt;TEST-RESULTS {1003FF1353}&gt;
</pre>
</div>
<p>
Yes, the test failed. Unfortunately it only reported the first assertion failure, not all of them. No, I do not know why a dot appeared before the failure indicator. I was really hoping for it to tell me all the different assertion failures.
</p>
</div>
</li>
<li><a id="org67c754a"></a>Edge Cases: Value Expressions, closures and calling other tests<br>
<ol class="org-ol">
<li><a id="org5db5d28"></a>Value expressions<br>
<div class="outline-text-5" id="text-35-3-3-1">
<p>
XLunit has no special functionality for dealing with values expressions. Like most of the frameworks, xlunit will check values expressions but only look at the first value.
</p>
</div>
</li>
<li><a id="org4d70875"></a>Closures.<br>
<div class="outline-text-5" id="text-35-3-3-2">
<p>
Xlunit has no problem dealing with variables from closures. We will skip the proof.
</p>
</div>
</li>
<li><a id="org96f9f75"></a>Calling tests from inside tests<br>
<div class="outline-text-5" id="text-35-3-3-3">
<p>
As with several frameworks, xlunit allows a test to call another test, but there is no composition - you get two separate reports.
</p>
<div class="org-src-container">
<pre class="src src-lisp">  (<span class="org-keyword">defclass</span> <span class="org-type">tf-xlunit-t3</span> (xlunit:test-case) ())

  (def-test-method t3 ((test tf-xlunit-t3) <span class="org-builtin">:run</span> nil)<span class="org-comment">;</span>
    (<span class="org-warning">assert-equal</span> 1 1)
    (xlunit:textui-test-run (xlunit:get-suite tf-xlunit-t1-fail)))

(xlunit:textui-test-run (xlunit:get-suite tf-xlunit-t3))
..F
Time: 0.0

There was 1 failure:
1) <span class="org-warning">T1-FAIL: Assert equal: </span><span class="org-string"><span class="org-warning">"a"</span></span><span class="org-warning"> </span><span class="org-string"><span class="org-warning">"b"</span></span>
   Deliberate failure on our part

FAILURES!!!
Run: 1   Failures: 1   Errors: 0
Time: 0.003333

OK (1 tests)
#&lt;TEST-RESULTS {100B2823A3}&gt;
</pre>
</div>
</div>
</li>
</ol>
</li>
<li><a id="org0bb907b"></a>Suites, fixtures and other multiple test abilities<br>
<ol class="org-ol">
<li><a id="orgb388e35"></a>Lists of tests<br>
<div class="outline-text-5" id="text-35-3-4-1">
<p>
I did not see a way to run only a subset of the methods applicable to a test-case.
</p>
</div>
</li>
<li><a id="org67b1b85"></a>Suites and fixtures<br>
<div class="outline-text-5" id="text-35-3-4-2">
<p>
I am going to cheat here combine the discussion of fixtures and suites together and use an example from the source code. Here we create a test-case named math-test-case with two additional slots for numbera and numberb. Before any tests are run, there is a <code>set-up</code> method which initialises those slots. We then add three test methods having a single assertion earch (one slightly modified from the source code).
</p>
<div class="org-src-container">
<pre class="src src-lisp">(<span class="org-keyword">defclass</span> <span class="org-type">math-test-case</span> (test-case)
  ((numbera <span class="org-builtin">:accessor</span> numbera)
   (numberb <span class="org-builtin">:accessor</span> numberb))
  (<span class="org-builtin">:documentation</span> <span class="org-doc">"Test test-case for math testing"</span>))

(<span class="org-keyword">defmethod</span> <span class="org-function-name">set-up</span> ((tcase math-test-case))
  (setf (numbera tcase) 2)
  (setf (numberb tcase) 3))

(def-test-method test-addition ((test math-test-case) <span class="org-builtin">:run</span> nil)
  (<span class="org-keyword">let</span> ((result1 (+ (numbera test) (numberb test)))
        (result2 (+ 1 (numbera test) (numberb test))))
    (<span class="org-warning">assert-true</span> (= result1 5))
    (<span class="org-warning">assert-true</span> (= result2 6))))

(def-test-method test-subtraction ((test math-test-case) <span class="org-builtin">:run</span> nil)
  (<span class="org-keyword">let</span> ((result (- (numberb test) (numbera test))))
    (<span class="org-warning">assert-equal</span> result 1)))

   <span class="org-comment-delimiter">;;; </span><span class="org-comment">This method is meant to signal a failure</span>
(def-test-method test-subtraction-2 ((test math-test-case) <span class="org-builtin">:run</span> nil)
  (<span class="org-keyword">let</span> ((result (- (numbera test) (numberb test))))
    (<span class="org-warning">assert-equal</span> result 1 <span class="org-string">"This is meant to failure"</span>)))
</pre>
</div>
<p>
Now we run all the methods applicable to math-test-case classes.
</p>
<div class="org-src-container">
<pre class="src src-lisp">  (xlunit:textui-test-run (xlunit:get-suite math-test-case))
.F..
Time: 0.0

There was 1 failure:
1) <span class="org-warning">TEST-SUBTRACTION-2: Assert equal: -1 1</span>
   This is meant to failure

FAILURES!!!
Run: 3   Failures: 1   Errors: 0
#&lt;TEST-RESULTS {10051EF373}&gt;
</pre>
</div>
<p>
As we can see, while there are four assertions in total, the report shows 3, meaning the  number of methods run. If we looked at the internal details of the test-results instance returned at the end, it would show a count of 3 as well.
</p>

<p>
<a href="#org63aa282">top</a>
</p>
</div>
</li>
</ol>
</li>
<li><a id="org1acfbf5"></a>Removing tests<br>
<div class="outline-text-4" id="text-35-3-5">
<p>
Xlunit has a <code>remove-test</code> function
</p>
</div>
</li>
<li><a id="orga736b41"></a>Sequencing, Random and Failure Only<br>
<div class="outline-text-4" id="text-35-3-6">
<p>
Everything is sequential. There are no provisions for collecting and re-running only failed tests.
</p>
</div>
</li>
<li><a id="org5154e0a"></a>Skip Capability<br>
<div class="outline-text-4" id="text-35-3-7">
<p>
None
</p>
</div>
</li>
<li><a id="org6f725fd"></a>Random Data Generators<br>
<div class="outline-text-4" id="text-35-3-8">
<p>
None
</p>
</div>
</li>
</ol>
</div>
<div id="outline-container-org42b1d7a" class="outline-3">
<h3 id="org42b1d7a"><span class="section-number-3">35.4.</span> Discussion</h3>
<div class="outline-text-3" id="text-35-4">
<p>
Phil Gold's 2007 review essentially concluded that xlunit feels clunky and lacks composition. I see no reason to differ from his conclusion.
</p>
</div>
</div>

<div id="outline-container-orgebc0b91" class="outline-3">
<h3 id="orgebc0b91"><span class="section-number-3">35.5.</span> Who Depends on XLUnit?</h3>
<div class="outline-text-3" id="text-35-5">
<p>
<a href="https://github.com/jwiegley/cambl/blob/master/cambl-test.lisp">cambl</a>, <a href="https://github.com/TheRiver/CL-HEAP">cl-heap</a> (no longer maintained) and <a href="https://github.com/wlbr/cl-marshal">cl-marshal</a>
</p>

<p>
<a href="#org63aa282">top</a>
<a id="org72de806"></a>
</p>
</div>
</div>
</div>
<div id="outline-container-org82ee635" class="outline-2">
<h2 id="org82ee635"><span class="section-number-2">36.</span> xptest</h2>
<div class="outline-text-2" id="text-36">
</div>
<div id="outline-container-org232bd00" class="outline-3">
<h3 id="org232bd00"><span class="section-number-3">36.1.</span> Summary</h3>
<div class="outline-text-3" id="text-36-1">
<table>


<colgroup>
<col  class="org-left">

<col  class="org-left">

<col  class="org-left">

<col  class="org-right">
</colgroup>
<tbody>
<tr>
<td class="org-left">No homepage</td>
<td class="org-left">Craig Brozensky</td>
<td class="org-left">Public Domain</td>
<td class="org-right">2015</td>
</tr>
</tbody>
</table>
<p>
XPtest is very old and it does the basics. It will report all the failed assertions and provides the ability to generate failure reports with diagnostic strings. It does not provide an interactive session (no debugger, just the report). It also does not seem to provide any signal testing, so you would have to write your own condition handlers.  Overall it just feels clumsy. It was not tested in the original Phil Gold blogging note.
</p>
</div>
</div>
<div id="outline-container-org0a107b3" class="outline-3">
<h3 id="org0a107b3"><span class="section-number-3">36.2.</span> Assertion Functions</h3>
<div class="outline-text-3" id="text-36-2">
<p>
None - It just relies on CL predicates.
</p>
</div>
</div>
<div id="outline-container-orgaf2c6a4" class="outline-3">
<h3 id="orgaf2c6a4"><span class="section-number-3">36.3.</span> Usage</h3>
<div class="outline-text-3" id="text-36-3">
<p>
Xptest is very simple. You create a test-suite and a fixture. Tests are methods of the fixture and you then add them to the test-suite. You use regular CL predicates in your test and trigger a <code>failure</code> function if they are not true.
</p>
</div>
<ol class="org-ol">
<li><a id="org7311188"></a>Report Format and Basic Operation<br>
<div class="outline-text-4" id="text-36-3-1">
<div class="org-src-container">
<pre class="src src-lisp"><span class="org-comment-delimiter">;; </span><span class="org-comment">A test fixture and a suite get defined up front</span>
(def-test-fixture tf-xptest-fixture () ())

(<span class="org-keyword">defparameter</span> <span class="org-variable-name">*tf-xptest-suite*</span> (make-test-suite <span class="org-string">"tf-xptest-suite"</span> <span class="org-string">"test framework demonstration"</span>))

(<span class="org-keyword">defmethod</span> <span class="org-function-name">t1</span> ((test tf-xptest-fixture))
  (<span class="org-keyword">let</span> ((x 1) (y 'a))
  (<span class="org-keyword">unless</span> (equal 1 x)
    (failure <span class="org-string">"t1.1 failed"</span>))
  (<span class="org-keyword">unless</span> (eq 'a y)
    (failure <span class="org-string">"t1.2 failed"</span>))))

(add-test (make-test-case <span class="org-string">"t1"</span> 'tf-xptest-fixture <span class="org-builtin">:test-thunk</span> 't1) *tf-xptest-suite*)

(<span class="org-keyword">defmethod</span> <span class="org-function-name">t1-fail</span> ((test tf-xptest-fixture))
  (<span class="org-keyword">let</span> ((x 1) (y 'a))
  (<span class="org-keyword">unless</span> (equal 2 x)
    (failure <span class="org-string">"t1-fail.1 failed"</span>))
  (<span class="org-keyword">unless</span> (eq 'b y)
    (failure <span class="org-string">"t1-fail.2 failed"</span>))))

(add-test (make-test-case <span class="org-string">"t1-fail"</span> 'tf-xptest-fixture <span class="org-builtin">:test-thunk</span> 't1-fail) *tf-xptest-suite*)
</pre>
</div>
<p>
You can use <code>run-test</code> on the test-suite. That will return a list of test-result objects, but that is not terribly useful. Digging into those objects will give you start and stop times, the test-fixture, a test-failure condition (if it failed)  or a error condition if something else bad happened. Slightly more useful is running <code>report-result</code> on the list returned from <code>run-test</code>, but it only reports which tests passed and which tests failed.
</p>
<div class="org-src-container">
<pre class="src src-lisp">(run-test *tf-xptest-suite*)
(#&lt;TEST-RESULT {1002F88803}&gt; #&lt;TEST-RESULT {1002F88C93}&gt;)

(report-result (run-test *tf-xptest-suite*))
Test t1 Passed
Test t1-fail Failed
</pre>
</div>
<p>
There is a keyword parameter option of :verbose, but if you try to use it, it generates a format control error in the xptest source code that I am not going to try to debug.
</p>

<p>
Xptest properly picks up changes in tested functions without having to manually recompile tests.
</p>
</div>
</li>

<li><a id="org6bf6c21"></a>Multiple assertions, loops. closures and calling other tests<br>
<ol class="org-ol">
<li><a id="org5edfb08"></a>Multiple assertions and value expressions<br>
<div class="outline-text-5" id="text-36-3-2-1">
<p>
Xptest relies on CL for predicates and assertions, so you have to build your own multiple assertion test and decide how you would handle value expressions.
</p>
</div>
</li>
<li><a id="orgdebbe4e"></a>Closures.<br>
<div class="outline-text-5" id="text-36-3-2-2">
<p>
Xptest has no problem with the loop inside a closure test.
</p>
<div class="org-src-container">
<pre class="src src-lisp">(<span class="org-keyword">let</span> ((l1 '(#\a #\B #\z))
      (l2 '(97 66 122)))
  (<span class="org-keyword">defmethod</span> <span class="org-function-name">t2-loop</span> ((test tf-xptest-fixture))
    (<span class="org-keyword">loop</span> for x in l1 for y in l2 do
      (<span class="org-keyword">unless</span> (equal (char-code x) y)
        (failure <span class="org-string">"t2-loop"</span>)))))

(add-test (make-test-case <span class="org-string">"t2-loop"</span> 'tf-xptest-fixture <span class="org-builtin">:test-thunk</span> 't2-loop) *tf-xptest-suite*)

(report-result (run-test *tf-xptest-suite*))
</pre>
</div>
</div>
</li>
</ol>
</li>
<li><a id="org05671c8"></a>Conditions<br>
<div class="outline-text-4" id="text-36-3-3">
<p>
You would have to write your own condition handlers.
</p>
</div>
</li>
<li><a id="org639378a"></a>Suites and fixtures<br>
<div class="outline-text-4" id="text-36-3-4">
<p>
I am going to cheat here again and show the example from the source code.
</p>
<div class="org-src-container">
<pre class="src src-lisp">(<span class="org-keyword">defparameter</span> <span class="org-variable-name">*math-test-suite*</span> nil)

  (def-test-fixture math-fixture ()
    ((numbera
      <span class="org-builtin">:accessor</span> numbera)
     (numberb
      <span class="org-builtin">:accessor</span> numberb))
    (<span class="org-builtin">:documentation</span> <span class="org-doc">"Test fixture for math testing"</span>))

  (<span class="org-keyword">defmethod</span> <span class="org-function-name">setup</span> ((fix math-fixture))
    (setf (numbera fix) 2)
    (setf (numberb fix) 3))

  (<span class="org-keyword">defmethod</span> <span class="org-function-name">teardown</span> ((fix math-fixture))
    t)

  (<span class="org-keyword">defmethod</span> <span class="org-function-name">addition-test</span> ((test math-fixture))
    (<span class="org-keyword">let</span> ((result (+ (numbera test) (numberb test))))
      (<span class="org-keyword">unless</span> (= result 5)
        (failure <span class="org-string">"Result was not 5 when adding ~A and ~A"</span>
                 (numbera test) (numberb test)))))

  (<span class="org-keyword">defmethod</span> <span class="org-function-name">subtraction-test</span> ((test math-fixture))
    (<span class="org-keyword">let</span> ((result (- (numberb test) (numbera test))))
      (<span class="org-keyword">unless</span> (= result 1)
        (failure <span class="org-string">"Result was not 1 when subtracting ~A ~A"</span>
                 (numberb test) (numbera test)))))

      <span class="org-comment-delimiter">;;; </span><span class="org-comment">This method is meant to signal a failure</span>
  (<span class="org-keyword">defmethod</span> <span class="org-function-name">subtraction-test2</span> ((test math-fixture))
    (<span class="org-keyword">let</span> ((result (- (numbera test) (numberb test))))
      (<span class="org-keyword">unless</span> (= result 1)
        (failure <span class="org-string">"Result was not 1 when subtracting ~A ~A"</span>
                 (numbera test) (numberb test)))))

  (setf *math-test-suite* (make-test-suite
                         <span class="org-string">"Math Test Suite"</span>
                         <span class="org-string">"Simple test suite for arithmetic operators."</span>
                         (<span class="org-string">"Addition Test"</span> 'math-fixture
                                          <span class="org-builtin">:test-thunk</span> 'addition-test
                                          <span class="org-builtin">:description</span> <span class="org-string">"A simple test of the + operator"</span>)
                         (<span class="org-string">"Subtraction Test"</span> 'math-fixture
                                             <span class="org-builtin">:test-thunk</span> 'subtraction-test
                                             <span class="org-builtin">:description</span> <span class="org-string">"A simple test of the - operator"</span>)))

  (add-test (make-test-case <span class="org-string">"Substraction Test 2"</span> 'math-fixture
                            <span class="org-builtin">:test-thunk</span> 'subtraction-test2
                            <span class="org-builtin">:description</span> <span class="org-string">"A broken substraction test, should fail."</span>)
            *math-test-suite*)

  (report-result (run-test *math-test-suite*))
</pre>
</div>

<p>
<a href="#org63aa282">top</a>
</p>
</div>
</li>
<li><a id="orge3b774d"></a>Removing tests<br>
<div class="outline-text-4" id="text-36-3-5">
<p>
Xptest has a <code>remove-test</code> function
</p>
</div>
</li>
<li><a id="org05c37b4"></a>Sequencing, Random and Failure Only<br>
<div class="outline-text-4" id="text-36-3-6">
<p>
Sequential only
</p>
</div>
</li>
<li><a id="orgb746fa3"></a>Skip Capability<br>
<div class="outline-text-4" id="text-36-3-7">
<p>
None
</p>
</div>
</li>
<li><a id="orgc7a0ec3"></a>Random Data Generators<br>
<div class="outline-text-4" id="text-36-3-8">
<p>
None
</p>

<p>
<a href="#org63aa282">top</a>
</p>
</div>
</li>
</ol>
</div>

<div id="outline-container-org3857fb9" class="outline-3">
<h3 id="org3857fb9"><span class="section-number-3">36.4.</span> Discussion</h3>
<div class="outline-text-3" id="text-36-4">
<p>
I do not see anything here that would really make me consider it.
</p>
</div>
</div>
<div id="outline-container-org6508f8d" class="outline-3">
<h3 id="org6508f8d"><span class="section-number-3">36.5.</span> Who Depends on xptest?</h3>
<div class="outline-text-3" id="text-36-5">
<p>
Nothing in quicklisp. No idea about the wider world.
</p>

<p>
<a id="orgd4a45f6"></a>
</p>
</div>
</div>
</div>
<div id="outline-container-org5233271" class="outline-2">
<h2 id="org5233271"><span class="section-number-2">37.</span> Helper Libraries</h2>
<div class="outline-text-2" id="text-37">
</div>
<div id="outline-container-org0a100b6" class="outline-3">
<h3 id="org0a100b6"><span class="section-number-3">37.1.</span> assert-p</h3>
<div class="outline-text-3" id="text-37-1">
<p>
<a id="orga3783aa"></a>
<a href="#org63aa282">top
</a>
</p>
</div>
<ol class="org-ol">
<li><a id="orge3e9f18"></a>Summary<br>
<div class="outline-text-4" id="text-37-1-1">
<table>


<colgroup>
<col  class="org-left">

<col  class="org-left">

<col  class="org-left">

<col  class="org-right">
</colgroup>
<tbody>
<tr>
<td class="org-left"><a href="https://github.com/noloop/assert-p">homepage</a></td>
<td class="org-left">Noloop</td>
<td class="org-left">GPL3</td>
<td class="org-right">2020</td>
</tr>
</tbody>
</table>
<p>
This is a library to help build your own assertions and is built on <a href="#orged25ed0">assertion-error</a> by the same author (see below). The only library currently using it is Cacau.
</p>

<p>
I was really hoping for more here. Consider the following code from the library:
</p>
<div class="org-src-container">
<pre class="src src-lisp">(<span class="org-keyword">defun</span> <span class="org-function-name">not-equalp-p</span> (actual expected)
  <span class="org-doc">"Check actual not equalp expected"</span>
  (assertion (not (equalp actual expected)) actual expected 'not-equalp))
</pre>
</div>
<p>
Seven of the test frameworks described above provide assertions that accept diagnostic messages and pass variables to those diagnostic messages. Another eight provide assertions that accept diagnostic messages but without variables. Compared to those, this seems really elementary. I will leave it to writers of testing frameworks as to whether it is worthwhile, but from my perspective, it does not add anything useful to the forest of CL testing.
</p>

<p>
<a href="#org63aa282">top</a>
</p>
</div>
</li>
</ol>
</div>

<div id="outline-container-org60d276e" class="outline-3">
<h3 id="org60d276e"><span class="section-number-3">37.2.</span> assertion-error</h3>
<div class="outline-text-3" id="text-37-2">
<p>
<a id="orged25ed0"></a>
</p>
</div>

<ol class="org-ol">
<li><a id="org6cc4ba4"></a>Summary<br>
<div class="outline-text-4" id="text-37-2-1">
<table>


<colgroup>
<col  class="org-left">

<col  class="org-left">

<col  class="org-left">

<col  class="org-right">
</colgroup>
<tbody>
<tr>
<td class="org-left"><a href="https://github.com/noloop/assertion-error">homepage</a></td>
<td class="org-left">Noloop</td>
<td class="org-left">GPL3</td>
<td class="org-right">2019</td>
</tr>
</tbody>
</table>
<p>
This is a library to build your own assertion-error conditions. It does depend on <a href="https://github.com/Shinmera/dissect">dissect</a>. The only library currently using it is cacau.
</p>

<p>
The entire source code is:
</p>
<div class="org-src-container">
<pre class="src src-lisp">(<span class="org-keyword">define-condition</span> <span class="org-function-name">assertion-error</span> (<span class="org-warning">error</span>)
  ((assertion-error-message <span class="org-builtin">:initarg</span> <span class="org-builtin">:assertion-error-message</span> <span class="org-builtin">:reader</span> assertion-error-message)
   (assertion-error-result <span class="org-builtin">:initarg</span> <span class="org-builtin">:assertion-error-result</span> <span class="org-builtin">:reader</span> assertion-error-result)
   (assertion-error-actual <span class="org-builtin">:initarg</span> <span class="org-builtin">:assertion-error-actual</span> <span class="org-builtin">:reader</span> assertion-error-actual)
   (assertion-error-expected <span class="org-builtin">:initarg</span> <span class="org-builtin">:assertion-error-expected</span> <span class="org-builtin">:reader</span> assertion-error-expected)
   (assertion-error-stack <span class="org-builtin">:initarg</span> <span class="org-builtin">:assertion-error-stack</span> <span class="org-builtin">:reader</span> assertion-error-stack)))

(<span class="org-keyword">defun</span> <span class="org-function-name">get-stack-trace</span> ()
  (stack))
</pre>
</div>
<p>
I will leave it to writers of testing frameworks as to whether it is worthwhile.
</p>

<p>
<a href="#org63aa282">top</a>
</p>
</div>
</li>
</ol>
</div>

<div id="outline-container-org5338e57" class="outline-3">
<h3 id="org5338e57"><span class="section-number-3">37.3.</span> check-it</h3>
<div class="outline-text-3" id="text-37-3">
<p>
<a id="orgf730292"></a>
<a href="#org63aa282">top</a>
</p>
</div>
<ol class="org-ol">
<li><a id="org1d36425"></a>Summary<br>
<div class="outline-text-4" id="text-37-3-1">
<table>


<colgroup>
<col  class="org-left">

<col  class="org-left">

<col  class="org-left">

<col  class="org-right">
</colgroup>
<tbody>
<tr>
<td class="org-left"><a href="https://github.com/DalekBaldwin/check-it">homepage</a></td>
<td class="org-left">Kyle Littler</td>
<td class="org-left">LLGPL</td>
<td class="org-right">2015</td>
</tr>
</tbody>
</table>

<p>
Check-it is the opposite of a mock and stub library which provides known values. Check-it provides randomized input values based on properties of the input. Some testing frameworks provide random value generators, but this is more complete, so use this with your favorite test framework.
See <a href="#org6ac4b00">helper-generators</a> for a functional comparison of the generators between check-it and cl-quicklisp.
</p>
</div>
</li>
<li><a id="orgcfb9cda"></a>Usage<br>
<ol class="org-ol">
<li><a id="orgef00988"></a>General Usage<br>
<div class="outline-text-5" id="text-37-3-2-1">
<p>
The general usage is to call <code>generate</code> on a <code>generator</code> given a specific type with optional specifications. The following examples use optional lower and upper bounds.
</p>
<div class="org-src-container">
<pre class="src src-lisp">(<span class="org-warning">check-it:generate</span>
 (<span class="org-warning">check-it:generator</span> (integer -3 10)))
6

(<span class="org-warning">check-it:generate</span>
 (<span class="org-warning">check-it:generator</span> (character #\a #\k)))
#\f

(<span class="org-keyword">let</span> ((gen-i (<span class="org-warning">check-it:generator</span> (list (integer -10 10)
                                       <span class="org-builtin">:min-length</span> 3
                                       <span class="org-builtin">:max-length</span> 10))))
  (<span class="org-warning">check-it:generate</span> gen-i))
(5 0 8 -2 9)

(<span class="org-warning">check-it:generate</span> (<span class="org-warning">check-it:generator</span> (string <span class="org-builtin">:min-length</span> 3 <span class="org-builtin">:max-length</span> 10)))
<span class="org-string">"Uw76ZV"</span>
</pre>
</div>
</div>
</li>
<li><a id="org99e36cf"></a>Values must meet a predicate<br>
<div class="outline-text-5" id="text-37-3-2-2">
<p>
You can ensure that values meet a specific predicate. The generator will keep trying until that predicate is met. In the following example we want a character between #\a and #\f but not #\c.
</p>
<div class="org-src-container">
<pre class="src src-lisp">(<span class="org-warning">check-it:generate</span>
 (<span class="org-warning">check-it:generator</span>
  (<span class="org-warning">check-it:guard</span> (<span class="org-keyword">lambda</span> (x) (not (eql x #\c))) (character #\a #\f))))
#\e
</pre>
</div>
</div>
</li>
<li><a id="orge2897e9"></a>Or Generator<br>
<div class="outline-text-5" id="text-37-3-2-3">
<p>
The OR generator takes subgenerators and randomly chooses one. For example:
</p>
<div class="org-src-container">
<pre class="src src-lisp">(<span class="org-keyword">let</span> ((gen-num (<span class="org-warning">check-it:generator</span> (or (integer) (real)))))
  (<span class="org-keyword">loop</span> for x from 1 to 5 collect
                          (<span class="org-warning">check-it:generate</span> gen-num)))
(7 6.685932 6 -9 9)
</pre>
</div>
</div>
</li>
<li><a id="orgdeedba2"></a>Struct Generator<br>
<div class="outline-text-5" id="text-37-3-2-4">
<p>
If you have a struct that has default constructor functions, you can use a struct generator to build out the slots.
</p>
<div class="org-src-container">
<pre class="src src-lisp">(<span class="org-warning">check-it:generate</span>
 (<span class="org-warning">check-it:generator</span>
  (<span class="org-warning">check-it:struct</span> b-struct <span class="org-builtin">:slot-1</span> (integer) <span class="org-builtin">:slot-2</span> (string) <span class="org-builtin">:slot-3</span> (real))))
#S(B-STRUCT <span class="org-builtin">:SLOT-1</span> 2 <span class="org-builtin">:SLOT-2</span> <span class="org-string">"iE4qZ5U00oOs"</span> <span class="org-builtin">:SLOT-3</span> 5.9885387)
</pre>
</div>
<p>
For more fun and games you can do with this library, see <a href="https://github.com/DalekBaldwin/check-it">https://github.com/DalekBaldwin/check-it</a>
</p>

<p>
<a href="#org63aa282">top</a>
</p>
</div>
</li>
</ol>
</li>
</ol>
</div>
<div id="outline-container-orgd946025" class="outline-3">
<h3 id="orgd946025"><span class="section-number-3">37.4.</span> cl-fuzz</h3>
<div class="outline-text-3" id="text-37-4">
<p>
<a id="orgeec32e5"></a>
</p>
</div>
<ol class="org-ol">
<li><a id="org09a986a"></a>Summary<br>
<div class="outline-text-4" id="text-37-4-1">
<table>


<colgroup>
<col  class="org-left">

<col  class="org-left">

<col  class="org-left">

<col  class="org-right">
</colgroup>
<tbody>
<tr>
<td class="org-left"><a href="https://github.com/ndantam/cl-fuzz/">homepage</a></td>
<td class="org-left">Neil T. Dantam</td>
<td class="org-left">BSD 2 Clause</td>
<td class="org-right">2018</td>
</tr>
</tbody>
</table>
<p>
Cl-fuzz is another random data generating library. To use it you need to define a function to generate random data, then generate a function to perform some tests, then pass both to <code>fuzz:run-tests</code> (not <code>perform-tests</code> as the readme states). To be honest, I do not think there is much utility here compared to the frameworks we have looked at plus check-it and cl-quickcheck.
</p>

<p>
<a href="#org63aa282">top</a>
</p>
</div>
</li>
</ol>
</div>

<div id="outline-container-orgf2ea57d" class="outline-3">
<h3 id="orgf2ea57d"><span class="section-number-3">37.5.</span> cl-quickcheck</h3>
<div class="outline-text-3" id="text-37-5">
<p>
<a id="org0489b8f"></a>
</p>
</div>
<ol class="org-ol">
<li><a id="org07a3bfe"></a>Summary<br>
<div class="outline-text-4" id="text-37-5-1">
<table>


<colgroup>
<col  class="org-left">

<col  class="org-left">

<col  class="org-left">

<col  class="org-right">
</colgroup>
<tbody>
<tr>
<td class="org-left"><a href="https://github.com/mcandre/cl-quickcheck">homepage</a></td>
<td class="org-left">Andrew Pennebaker</td>
<td class="org-left">MIT</td>
<td class="org-right">2020</td>
</tr>
</tbody>
</table>

<p>
Cl-quickcheck focuses on "property based tests". In other words, write tests use random inputs matching some specification, apply a operation to the data and assert something about that result. Cl-quickcheck is effectively an assertion library with the ability to generate different types of inputs. If you look at packages in quicklisp which use it, <a href="https://github.com/pinterface/burgled-batteries">Burgled-Batteries</a> uses it in conjunction with <a href="#orga50a995">Lift</a>;  <a href="https://github.com/Inaimathi/test-utils">Test-utils</a> uses it in conjunction with <a href="#orga7f8a83">Prove</a> and only <a href="https://github.com/rotatef/json-streams">json-streams</a> uses it on its own. As such I decided to put it in the Helpers section rather than in the frameworks section.
</p>

<p>
Cl-quickcheck has somewhat more functionality than check-it in that it does have assertions. I still think the generators are the real raison d'être for both these libraries. See <a href="#org6ac4b00">helper-generators</a> for a functional comparison of the generators between check-it and cl-quicklisp.
</p>
</div>
</li>
<li><a id="orgbd62e41"></a>Assertions<br>
<div class="outline-text-4" id="text-37-5-2">
<table>


<colgroup>
<col  class="org-left">

<col  class="org-left">

<col  class="org-left">

<col  class="org-left">

<col  class="org-left">
</colgroup>
<tbody>
<tr>
<td class="org-left">is</td>
<td class="org-left">is=</td>
<td class="org-left">isnt</td>
<td class="org-left">isnt=</td>
<td class="org-left">should-signal</td>
</tr>
</tbody>
</table>
</div>
</li>
<li><a id="org55411df"></a>Report Format<br>
<div class="outline-text-4" id="text-37-5-3">
<p>
Cl-quickcheck follows the typical pattern of . for a passing test. Instead of an f, it prints X for failures.
</p>

<p>
To jump immediately into the debugger rather than a report format, set <code>*break-on-failure*</code> to t.
</p>

<p>
To eliminate progress reports, set <code>*loud*</code> to nil.
</p>
</div>
</li>
<li><a id="org1dbef92"></a>Usage<br>
<div class="outline-text-4" id="text-37-5-4">
<p>
The number of iterations of a test using a generator is set by <code>*num-trials*</code> which starts with a default value of 100.
</p>

<p>
To take a silly example, the following is a test that asserts that any integer multiplied by two will equal the integer plus itself and we will set  <code>*num-trials*</code> 20. Thus <code>n</code> will be set to a random integer generated by <code>an-integer</code> and the assertion will be run 20 times with a new <code>n</code> generated each time.
</p>
<div class="org-src-container">
<pre class="src src-lisp">(setf *num-trials* 20)
(for-all ((n an-integer))
         (is= (* 2 n) (+ n n)))
....................
</pre>
</div>
<p>
If we modify that to be always wrong, we only get a single resulting X
</p>
<div class="org-src-container">
<pre class="src src-lisp">(for-all ((n an-integer))
         (is= (* 2 n) (+ n n 1)))
X
</pre>
</div>

<p>
The following are all passing assertions.
</p>
<div class="org-src-container">
<pre class="src src-lisp">(is= 1 1)
(is = 1 1 1)
(should-signal 'division-by-zero (<span class="org-warning">error</span> 'floating-point-overflow))
(for-all ((n an-integer))
                    (is= (* 2 n) (+ n n)))
</pre>
</div>
</div>
</li>

<li><a id="org7fedcb5"></a>Miscellaneous Comments<br>
<div class="outline-text-4" id="text-37-5-5">
<p>
The first thing I had to learn looking at cl-quickcheck was that a-boolean, a-real, an-index, an-integer, k-generator, m-generator and n-generator are functions in a variable (funcallable) but a-char, a-list, a-member, a-string, a-symbol and a-tuple were functions of their own. The difference in how they can called is confusing, at least for me.
</p>

<p>
<a href="#org63aa282">top</a>
</p>
</div>
</li>
</ol>
</div>

<div id="outline-container-org4b7b55d" class="outline-3">
<h3 id="org4b7b55d"><span class="section-number-3">37.6.</span> hamcrest</h3>
<div class="outline-text-3" id="text-37-6">
<p>
<a id="org1296f8c"></a>
<a href="#org63aa282">top</a>
</p>
</div>
<ol class="org-ol">
<li><a id="orgbc035d2"></a>Summary<br>
<div class="outline-text-4" id="text-37-6-1">
<table>


<colgroup>
<col  class="org-left">

<col  class="org-left">

<col  class="org-left">

<col  class="org-right">
</colgroup>
<tbody>
<tr>
<td class="org-left"><a href="https://github.com/40ants/cl-hamcrest">homepage</a></td>
<td class="org-left">Alexander Artemenko</td>
<td class="org-left">New BSD</td>
<td class="org-right">2020</td>
</tr>
</tbody>
</table>
<p>
Hamcrest's idea is to use pattern matching to make unit tests more readable.
</p>
</div>
</li>
<li><a id="org01c3bda"></a>Usage<br>
<div class="outline-text-4" id="text-37-6-2">
<p>
<a href="#org63aa282">top</a>
</p>
</div>
</li>
</ol>
</div>

<div id="outline-container-org40744aa" class="outline-3">
<h3 id="org40744aa"><span class="section-number-3">37.7.</span> mockingbird</h3>
<div class="outline-text-3" id="text-37-7">
<p>
<a id="orgcc396d4"></a>
<a href="#org63aa282">top</a>
</p>
</div>
<ol class="org-ol">
<li><a id="org9b331e6"></a>Summary<br>
<div class="outline-text-4" id="text-37-7-1">
<table>


<colgroup>
<col  class="org-left">

<col  class="org-left">

<col  class="org-left">

<col  class="org-right">
</colgroup>
<tbody>
<tr>
<td class="org-left"><a href="https://github.com/Chream/mockingbird">homepage</a></td>
<td class="org-left">Christopher Eames</td>
<td class="org-left">MIT</td>
<td class="org-right">2017</td>
</tr>
</tbody>
</table>

<p>
Stubs and Mocks are used to ensure constant values are returned instead of computed values for use in testing.
</p>
</div>
</li>
<li><a id="org3ac4813"></a>Usage<br>
<div class="outline-text-4" id="text-37-7-2">
<p>
Assume two functions for this usage demonstration:
</p>
<div class="org-src-container">
<pre class="src src-lisp">(<span class="org-keyword">defun</span> <span class="org-function-name">foo</span> (x) x)
(<span class="org-keyword">defun</span> <span class="org-function-name">bar</span> (x y) (+ x (foo x)))
</pre>
</div>
<p>
The WITH-STUBS macro provides lexical scoping for calling functions with guaranteed results.
</p>
<div class="org-src-container">
<pre class="src src-lisp">  (<span class="org-keyword">with-stubs</span> ((foo 10))
        (foo 1))
  10

(<span class="org-keyword">with-stubs</span> ((foo 10))
      (bar 3))
6
</pre>
</div>
<p>
As an example of how this would look used in a testing framework, the following uses parachute and mb is the nickname for mockingbird.
</p>
<div class="org-src-container">
<pre class="src src-lisp">(<span class="org-keyword">define-test</span> mockingbird-1
                (<span class="org-keyword">mb:with-stubs</span> ((foo 10))
                    (is = (bar 3) 6)))
MOCKINGBIRD-1
(test 'mockingbird-1)
        &#65311; TF-PARACHUTE::MOCKINGBIRD-1
  0.003 &#10004;   (is = (bar 3) 6)
  0.007 &#10004; TF-PARACHUTE::MOCKINGBIRD-1

<span class="org-comment-delimiter">;; </span><span class="org-comment">Summary:</span>
Passed:     1
Failed:     0
Skipped:    0
#&lt;PLAIN 2, PASSED results&gt;
</pre>
</div>

<p>
The WITH-DYNAMIC-STUBS macro provides dynamic scoping for calling functions with guaranteed results.
</p>
<div class="org-src-container">
<pre class="src src-lisp">(<span class="org-keyword">with-dynamic-stubs</span> ((foo 10))
      (bar 3))
13
</pre>
</div>
<p>
The WITH-MOCKS macro provides lexical scoping for calling functions but ensuring they return nil.
</p>
<div class="org-src-container">
<pre class="src src-lisp">(<span class="org-keyword">with-mocks</span> (foo)
  (foo 5))
NIL
(<span class="org-keyword">with-mocks</span> (foo)
  (bar 5))
10
</pre>
</div>

<p>
<a href="#org63aa282">top</a>
</p>
</div>
</li>
</ol>
</div>

<div id="outline-container-org80ec78d" class="outline-3">
<h3 id="org80ec78d"><span class="section-number-3">37.8.</span> portch</h3>
<div class="outline-text-3" id="text-37-8">
<p>
<a id="orge7349dc"></a>
</p>
</div>

<ol class="org-ol">
<li><a id="org19c6eaa"></a>Summary<br>
<div class="outline-text-4" id="text-37-8-1">
<table>


<colgroup>
<col  class="org-left">

<col  class="org-left">

<col  class="org-left">

<col  class="org-right">
</colgroup>
<tbody>
<tr>
<td class="org-left"><a href="https://github.com/nallen05/portch">homepage</a></td>
<td class="org-left">Nick Allen</td>
<td class="org-left">BSD 3 Clause</td>
<td class="org-right">2009</td>
</tr>
</tbody>
</table>
<p>
Portch helps organize tests written with Franz's portable ptester library. I will leave discussion of this library to users of ptester.
</p>

<p>
<a href="#org63aa282">top</a>
</p>
</div>
</li>
</ol>
</div>
<div id="outline-container-orga7fcaa6" class="outline-3">
<h3 id="orga7fcaa6"><span class="section-number-3">37.9.</span> protest</h3>
<div class="outline-text-3" id="text-37-9">
<p>
<a id="org88667e0"></a>
<a href="#org63aa282">top</a>
</p>
</div>
<ol class="org-ol">
<li><a id="orgecfc56b"></a>Summary<br>
<div class="outline-text-4" id="text-37-9-1">
<table>


<colgroup>
<col  class="org-left">

<col  class="org-left">

<col  class="org-left">

<col  class="org-right">
</colgroup>
<tbody>
<tr>
<td class="org-left"><a href="https://github.com/phoe/protest/">homepage</a></td>
<td class="org-left">Michał Herda</td>
<td class="org-left">LLGPL</td>
<td class="org-right">2020</td>
</tr>
</tbody>
</table>
<p>
Protest is a wrapper around other testing libraries, currently 1am and parachute. It wraps around test assertions and, in case of failure, informs the user of details of the failed test step. Other useful reading would be <a href="http://metamodular.com/protocol.pdf">The concept of a protocol</a> by Robert Strandh.
</p>
</div>
</li>
<li><a id="org4234ff6"></a>Usage<br></li>

<li><a id="org2ad7259"></a>Discussion<br>
<div class="outline-text-4" id="text-37-9-3">
<p>
<a href="#org63aa282">top</a>
</p>
</div>
</li>
</ol>
</div>

<div id="outline-container-org4c2de9d" class="outline-3">
<h3 id="org4c2de9d"><span class="section-number-3">37.10.</span> rtch</h3>
<div class="outline-text-3" id="text-37-10">
<p>
<a id="org3c788cc"></a>
</p>
</div>
<ol class="org-ol">
<li><a id="org596e6bf"></a>Summary<br>
<div class="outline-text-4" id="text-37-10-1">
<table>


<colgroup>
<col  class="org-left">

<col  class="org-left">

<col  class="org-left">

<col  class="org-right">
</colgroup>
<tbody>
<tr>
<td class="org-left"><a href="http://downloads.sourceforge.net/retch/rtch_0.1.3.tar.gz">download</a></td>
<td class="org-left">David Thompson</td>
<td class="org-left">LLGPL</td>
<td class="org-right">2008</td>
</tr>
</tbody>
</table>
<p>
Rtch helps organize RT tests based on their position in a directory hierarchy. I will leave it to users of rt as to whether it is helpful. Note that the link is to a sourceforge download tar file rather than a homepage.
</p>

<p>
<a href="#org63aa282">top</a>
</p>
</div>
</li>
</ol>
</div>
<div id="outline-container-org6efe64c" class="outline-3">
<h3 id="org6efe64c"><span class="section-number-3">37.11.</span> testbild</h3>
<div class="outline-text-3" id="text-37-11">
<p>
<a id="org781420d"></a>
</p>
</div>
<ol class="org-ol">
<li><a id="orgc7f1c11"></a>Summary<br>
<div class="outline-text-4" id="text-37-11-1">
<table>


<colgroup>
<col  class="org-left">

<col  class="org-left">

<col  class="org-left">

<col  class="org-right">
</colgroup>
<tbody>
<tr>
<td class="org-left"><a href="https://github.com/e-user/testbild">homepage</a></td>
<td class="org-left">Alexander Kahl</td>
<td class="org-left">GPLv3</td>
<td class="org-right">2010</td>
</tr>
</tbody>
</table>
<p>
Testbild is an older library focused on a set of CLOS classes which can be used as a common interface for the output of test results. I will leave it to the writers of test frameworks as to whether incorporating these classes is useful for them.
</p>

<p>
<a href="#org63aa282">top</a>
</p>
</div>
</li>
</ol>
</div>
<div id="outline-container-org022234a" class="outline-3">
<h3 id="org022234a"><span class="section-number-3">37.12.</span> test-utils</h3>
<div class="outline-text-3" id="text-37-12">
<p>
<a id="org31b5dc8"></a>
</p>
</div>

<ol class="org-ol">
<li><a id="orge2ed83e"></a>Summary<br>
<div class="outline-text-4" id="text-37-12-1">
<table>


<colgroup>
<col  class="org-left">

<col  class="org-left">

<col  class="org-left">

<col  class="org-right">
</colgroup>
<tbody>
<tr>
<td class="org-left"><a href="https://github.com/inaimathi/test-utils">homepage</a></td>
<td class="org-left">Leo Zovic</td>
<td class="org-left">MIT</td>
<td class="org-right">2020</td>
</tr>
</tbody>
</table>
<p>
Test-utils provides convenience functions and macros for prove and cl-quickcheck. It adds new generators to cl-quickcheck such as a-ratio, a-number, a-keyword, an-atom, a-pair, a-vector and a-hash.
</p>

<p>
It also has QUIET-CHECK which runs a cl-quickcheck suite but only sends to <code>*standard-output*</code> on failure.
</p>

<p>
It provides additional generators for:
</p>

<ul class="org-ul">
<li>a-ratio</li>
<li>a-number</li>
<li>a-keyword</li>
<li>an-atom</li>
<li>a-pair</li>
<li>a-vector</li>
<li>a-hash</li>
<li>a-value</li>
<li>a-alist</li>
<li>a-plist</li>
<li>an-improper-list</li>
<li>an-array</li>
</ul>

<p>
<a href="#org63aa282">top</a>
</p>
</div>
</li>
</ol>
</div>
</div>

<div id="outline-container-org23fe8b8" class="outline-2">
<h2 id="org23fe8b8"><span class="section-number-2">38.</span> Test Coverage Tools</h2>
<div class="outline-text-2" id="text-38">
<p>
<a id="orgc256919"></a>
<a href="#org63aa282">top</a>
</p>
</div>

<div id="outline-container-orgd9c533b" class="outline-3">
<h3 id="orgd9c533b"><span class="section-number-3">38.1.</span> sb-cover</h3>
<div class="outline-text-3" id="text-38-1">
<p>
The following is a sample sequence running sb-cover on the package you want to test
</p>
<div class="org-src-container">
<pre class="src src-lisp">(<span class="org-keyword">require</span> <span class="org-constant">:sb-cover</span>)
<span class="org-comment-delimiter">;; </span><span class="org-comment">now you need to tell SBCL to instrument what it is about to load</span>
(<span class="org-keyword">declaim</span> (optimize sb-cover:store-coverage-data))
(asdf:oos 'asdf:load-op <span class="org-builtin">:your-package-name-here</span> <span class="org-builtin">:force</span> t)

<span class="org-comment-delimiter">;; </span><span class="org-comment">Now run your tests. (run-all-tests 'blah-blah-blah-package)</span>

(sb-cover:report <span class="org-string">"path-to-directory-for-the-coverage-htmlpages"</span> <span class="org-builtin">:form-mode</span> <span class="org-builtin">:car</span>)

<span class="org-comment-delimiter">;; </span><span class="org-comment">now restore SBCL to its normal state</span>
(<span class="org-keyword">declaim</span> (optimize (sb-cover:store-coverage-data 0)))
<span class="org-comment-delimiter">;; </span><span class="org-comment">to restore</span>
</pre>
</div>
<p>
The last line turns off the instrumentation after the report has been generated. The sb-cover:report line should have generated one or more html pages, starting with a page named cover-index.html in the specified directory directory which shows:
</p>

<ul class="org-ul">
<li>expression</li>
<li>branch</li>
</ul>

<p>
on a file by file basis in the your package. Now the html pages will also print out the source file, color coded showing not executed expressions and, where the expression might have conditionals or branches, whether each of those conditional points or branches were actually triggered in the test. E.g.
</p>
<div class="org-src-container">
<pre class="src src-lisp">(<span class="org-keyword">defun</span> <span class="org-function-name">foo</span> (x)
  (<span class="org-keyword">if</span> (evenp x) 1 2))
</pre>
</div>
<p>
If the test only ran with (foo some-even-number) and not (foo some-odd-number), that fact would be highlighted.)
</p>

<p>
sb-cover can be enabled globally. <code>(eval '(declaim (optimize sb-cover:store-coverage-data)))</code>
</p>

<p>
Per pfdietz: "The problem I have with sb-cover is that is can screw up when the readtable is changed. It needs to somehow record readtable information to properly annotate source files."
</p>

<p>
<a id="org36620b2"></a>
<a href="#org63aa282">top</a>
</p>
</div>
</div>
<div id="outline-container-org6a4e491" class="outline-3">
<h3 id="org6a4e491"><span class="section-number-3">38.2.</span> CCL code coverage</h3>
<div class="outline-text-3" id="text-38-2">
<p>
I have not used this tool.
</p>
<div class="org-src-container">
<pre class="src src-lisp">(setf ccl:*compile-code-coverage* t)

</pre>
</div>
<p>
Comment: when <code>ccl:*compile-code-coverage*</code> was set to t, compiling ironclad triggered an error:
</p>

<p>
[package ironclad]&#x2026;&#x2026;.
&gt; Error: The value (&amp;LAP . 0) is not of the expected type VAR.
&gt; While executing: DECOMP-VAR, in process listener(1).
</p>

<p>
<a href="#org63aa282">top</a>
</p>
</div>
</div>

<div id="outline-container-orge2388c0" class="outline-3">
<h3 id="orge2388c0"><span class="section-number-3">38.3.</span> cover</h3>
<div class="outline-text-3" id="text-38-3">
<p>
<a id="org36debc1"></a>
I have not tried cover.
</p>

<p>
<a href="#org63aa282">top</a>
</p>
</div>
</div>
<div id="outline-container-orga9a1958" class="outline-3">
<h3 id="orga9a1958"><span class="section-number-3">38.4.</span> <a href="https://gist.github.com/aamedina/ea994fc8f6e501dd862a2e866c9a08fa">Source Code</a></h3>
<div class="outline-text-3" id="text-38-4">
<p>
<a href="#org63aa282">top</a>
</p>
</div>
</div>
</div>
<div id="outline-container-org478327e" class="outline-2">
<h2 id="org478327e"><span class="section-number-2">39.</span> Appendix</h2>
<div class="outline-text-2" id="text-39">
<p>
<a id="org96cacca"></a>
</p>
</div>
<div id="outline-container-orgd33efb8" class="outline-3">
<h3 id="orgd33efb8"><span class="section-number-3">39.1.</span> Problem Space</h3>
<div class="outline-text-3" id="text-39-1">
<p>
Testing covers a lot of ground, there are unit tests, regression tests, test driven development, etc. Testing often runs on an automated basis, but CL being CL, it can be part of an interactive development process. Some people write their unit tests first, then develop to pass the tests (test driven development). Testing is also not error checking.
</p>

<p>
Ideally a testing framework should make it as easy as possible to write tests, cover different inputs and produce a report showing <span class="underline">what</span> passed and failed. If you are writing a library rather than an application, it can be useful to recognize that your test suites are a client to your library's API (and if you find it hard to write the tests, think about how a client user will feel).
</p>

<p>
Assuming the source is available, the tests should be part of your user documentation in showing how to use the library and an ideal testing framework should make it easy for users to see the tests as examples.
</p>

<p>
I have seen reasoned arguments that unit tests should only cover exported functions, generally on the grounds that this implicitly tests the internal functions and any additional testing is just adding technical debt. My response is typically, fine, so long as the tests on the exported function can show how it failed. If it depends on 100 internal functions, can you trace back to the real point of failure? If testing is a defense against change, then testing code that has no reason to change does not add value to your test suite - until, of course, you refactor and suddenly it does. By the way, for those who are concerned about static typing, unit tests do not replace static typing unless you actually test by really throwing different inputs at the function being tested.
</p>

<p>
<a id="orge63cd8b"></a>
</p>
</div>
</div>
<div id="outline-container-org16929c6" class="outline-3">
<h3 id="org16929c6"><span class="section-number-3">39.2.</span> Terminology</h3>
<div class="outline-text-3" id="text-39-2">
<p>
Different frameworks address different problem sets but before I discuss the problem space, I want to get some terminology out of the way first.
</p>
</div>

<ol class="org-ol">
<li><a id="orgc20ce95"></a>Testing Types<br>
<div class="outline-text-4" id="text-39-2-1">
<ul class="org-ul">
<li>Integration testing deals with how units of software interact.</li>

<li>Mutation Testing - Pfdietz brought the concept of <a href="https://static.googleusercontent.com/media/research.google.com/en//pubs/archive/46584.pdf">mutation testing</a> to my attention. This concept targets testing your test suite by inserting errors into programs and measuring the ability of the test suite to detect them.</li>

<li>Property based testing (PBT) makes statements about the output of your code based on the input. The statements are tested by feeding random data to tests that are focused on the stated properties. E.g. in testing an addition function, adding zero to thenumber should result in the same number and changing the order of the inputs should result in the same number. Similarly, a function that reverses a list should always result in (a) a list and (b) the first element of the result was the last element of the input, etc. This obviously requires more thinking about each test. In some respects, what this gets you thinking about is what constitutes valid input and edge cases, and then you need to write generators to randomly generate input that meets (or fails to meet) those criteria. PBT is not a replacement for what I will call result testing, it is an additional testing strategy. cl-quickcheck and nst provide property based testing.</li>

<li>Regression tests verify that software that has already been written is still correct after it is changed or combined with other software. In other words, it worked yesterday, does it still work after a bug fix, after refactoring or after another system has been connected. Interactive development from the repl does not address this problem.</li>

<li>Unit testing deals with a separate software system or subsystem. (I am not interested in arguing how small the unit needs to be. I leave that up to the TDD missionaries and the TDD haters.) Unit testing can be a part of regression testing - regression tests are often built on suites of unit tests. You might have multiple tests for each function and a suite of tests for every function in a file. As I use the term "unit test", I am talking about how much code is covered, not whether the unit tests are "property based tests" or result testing.</li>
</ul>
</div>
</li>

<li><a id="orga736371"></a>Other Terms<br>
<div class="outline-text-4" id="text-39-2-2">
<ul class="org-ul">
<li>Assertions - the types of equality tests available. "Assert-eq", "Assert-equal" and "Assert-true" are typical. Some packages provide assertions that have descriptive messages to help debug failures. Some packages (e.g. Confidence) provide built-in assertions test float comparisions. Some packages allow you to define your own assertions.</li>

<li>Code coverage apparently means different things to different people. I have seen test suites that cover every function, but only with a single simple expected input and 100% code coverage victory has been declared. That is barely a hand wave. As one person has said, that checks that your code is right, but does not check that your code is not wrong. Of course, there are trivial bits of code where it is pointless to try to think about possible different inputs to test.</li>

<li>Fixtures (sometimes referred to as contexts)- Fixtures create a temporary environment with a known data set used for the tests. They may be static variables, constructed database tables, etc. Typically there is a setup and teardown process to ensure that the testing environment is in a known state.</li>

<li>Mocks - Mocking is a variation on Fixtures. While fixtures are intended to create a known data collection to test against, mocking is intended to eliminate external dependencies in code and create known faux code which can be used as an input (sometimes called stubs) or compared after a test is run to see if there are expected or unexpected side effects.</li>

<li>Parametrization means running the same test body with different input each time. You can do this either by running a test against a collection of test data or you can do it within a single test by running the test body against a list of forms or test data. How you do it will depend on which way will make it easier to determine what test and what parameters triggered the failure.</li>

<li>Refactoring typically requires rewriting unit tests for everything that was touched, then re-running test suites to ensure that everything still works together.</li>

<li>Reporting - a failing test should generate a usable bug report. Do we know the input, output, function involved, expected result and what we thought we were testing for? Note that what we thought we are testing for is not the same as the expected result.</li>

<li>Shuffle Testing - Randomly changing the sequence in which tests are applied.</li>

<li>TAP - TAP (the Test Anything Protocol) is a text based interface between testing modules, decoupling reporting of errors from the presentation of reports. In other words, you can write a TAP consumer which takes TAP spec output from the test harness and the TAP consumer would be responsible for generating user friendly reports (or do other things like compare the tests against your own list of functions to generate your own code coverage report). Development on the SPEC seems to have ceased in 2017. There was a hackernews discussion in JUne 2020 which can be found <a href="https://news.ycombinator.com/item?id=23473370">here</a>.</li>

<li>Verification means that your code contains every bug in the specification.</li>

<li>Validation means that it is doing the right thing. This may or may not be possible to automate. I do not envy front end developers or designers dealing with clients.</li>

<li>TAP Output - Test Anything Protocol is a formally specified output, considered by some to be a superior alternative to xUnit type testing. Depending on the output mechanisms, TAP can be easy to read but difficult to parse.</li>
</ul>

<p>
<a href="#org63aa282">top</a>
</p>
</div>
</li>

<li><a id="org77fa4f7"></a>Discussion<br>
<div class="outline-text-4" id="text-39-2-3">
<p>
In general, each test has three parts - the setup, the action and the validation. Does the testing framework make it easy to see each of those segments when reading the test or reading any report coming out of the test?
</p>

<p>
Similarly, when the tests are run and a test fails, is it obvious from the report what happened or do you need to start a debugging session with limited information? It is one thing for a test to report failure, another thing to report what was expected compared to what was generated, and still a much better result to indicate that the correct value was in (aref array-name 2) instead of the expected (aref array-name 0) - the context of the failure.
</p>

<p>
Does the test framework allow long enough names for tests and hierarchies (or accept comments) to give meaningful reports?
</p>

<p>
How easy is it to run parameterized tests - the test logic is the same, but you run different parameters through the same tests and expect different results?
</p>

<p>
<a href="#org63aa282">top</a>
</p>
</div>
</li>
</ol>
</div>
</div>
<div id="footnotes">
<h2 class="footnotes">Footnotes: </h2>
<div id="text-footnotes">

<div class="footdef"><sup><a id="fn.1" class="footnum" href="#fnr.1" role="doc-backlink">1</a></sup> <div class="footpara" role="doc-footnote"><p class="footpara">
Not available from QuickLisp
</p></div></div>

<div class="footdef"><sup><a id="fn.2" class="footnum" href="#fnr.2" role="doc-backlink">2</a></sup> <div class="footpara" role="doc-footnote"><p class="footpara">
Looking for new maintainer. Has been forked to clunit2 and you should only consider clunit2.
</p></div></div>

<div class="footdef"><sup><a id="fn.3" class="footnum" href="#fnr.3" role="doc-backlink">3</a></sup> <div class="footpara" role="doc-footnote"><p class="footpara">
Fork of stefil
</p></div></div>

<div class="footdef"><sup><a id="fn.4" class="footnum" href="#fnr.4" role="doc-backlink">4</a></sup> <div class="footpara" role="doc-footnote"><p class="footpara">
Port to Clasp, otherwise 2015. Author has stated that it is no longer maintained and he is no longer involved in CL.
</p></div></div>

<div class="footdef"><sup><a id="fn.5" class="footnum" href="#fnr.5" role="doc-backlink">5</a></sup> <div class="footpara" role="doc-footnote"><p class="footpara">
The authors have specified it as obsolete, so it will not be further considered.
</p></div></div>

<div class="footdef"><sup><a id="fn.6" class="footnum" href="#fnr.6" role="doc-backlink">6</a></sup> <div class="footpara" role="doc-footnote"><p class="footpara">
Tap-Unit-Test is a version of lisp-unit with <a href="http://en.wikipedia.org/wiki/Test_Anything_Protocol">TAP</a> formatted reporting.
</p></div></div>


</div>
</div></div>
</body>
</html>
